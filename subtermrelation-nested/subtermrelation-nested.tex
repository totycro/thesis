\documentclass[,%fontsize=11pt,%
	%landscape,
	%DIV8, % mehr text pro seite als defaultyyp
	%DIV10,
	%DIV=calc,%
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
	11pt,
	a4paper,
	oneside,% apparently, this should stay below some other parameter to have an effect
	openany,
	%]{scrartcl}
]{memoir}



\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

% for screen display:
\usepackage[bitstream-charter]{mathdesign}
%\usepackage{amssymb} % conflicts with bitstream-charter
%\usepackage{newcent}
%\usepackage{lmodern}

\newcommand{\changefont}[3]{
\fontfamily{#1}\fontseries{#2}\fontshape{#3}\selectfont}

%\renewcommand{\familydefault}{ \sfdefault }
%\renewcommand{\rmdefault}{ppl}


%\usepackage[urw-garamond]{mathdesign}

\usepackage{lscape}
\usepackage{stackengine}
\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}


% subsections also in toc
\setcounter{tocdepth}{2}
\setsecnumdepth{subsection}


\definethms

\def\proofSkipAmount{ \vskip -0.1em }


%\usepackage{bussproof}

%\usepackage{vaucanson-g}
%\usepackage{amssymb}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
%\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}


\usepackage{amsthm}


\chapterstyle{madsen}

% define page numbering styles
\makepagestyle{numberCorner}
\makeevenfoot{numberCorner}{\thepage}{}{}
\makeoddfoot{numberCorner}{}{}{\thepage}

\makepagestyle{numberCenter}
%\makeevenfoot{numberCenter}{}{\thepage}{}
%\makeoddfoot{numberCenter}{}{\thepage}{}
%
%\makeevenhead{numberCenter}{\thechapter}{}{\thesection}
%\makeoddhead{numberCenter}{\thesection }{}{\thechapter}
\makeheadrule{numberCenter}{\textwidth}{1pt}

\makeevenhead{numberCenter}{\thepage}{}{\leftmark}
\makeoddhead{numberCenter}{\rightmark}{}{\thepage}


\makeatletter
\makepsmarks{numberCenter}{
	\def\chaptermark##1{\markboth{%
			\ifnum \value{secnumdepth} > -1
			\if@mainmatter
			\chaptername\ \thechapter\ --- %
			\fi
			\fi
	##1}{}}
	\def\sectionmark##1{\markright{%
			\ifnum \value{secnumdepth} > 0
			\thesection. \ %
			\fi
	##1}}
}
\makeatother
\newcommand{\mysetpagestyle}{
	%\pagestyle{numberCorner}
	\pagestyle{numberCenter}
}
\mysetpagestyle





\usepackage{refcheck}

%\settypeblocksize{0.64\stockheight}{0.64\stockwidth}{*}
%%\settypeblocksize{0.63\stockheight}{0.63\stockwidth}{*}
%\setlrmargins{*}{*}{1.0}
%\setulmargins{*}{*}{1.4}
%\checkandfixthelayout[nearest]

  

\begin{document}



\tableofcontents

\section{Lemmas from other pdf}
\begin{lemma}
	\label{lemma:lifting_order_not_relevant}
	$\lifgammanovar{\lifdeltanovar{\varphi}} = \lifdeltanovar{\lifgammanovar{\varphi}}$.
\end{lemma}

\clearpage

\chapter{Interpolant extraction from resolution proofs in one phase \hl{lifting terms whose quantifier position can be determined -- nested}}

\section{Incremental lifting and substitutions of lifting variables}

\begin{defi}[Substitution $\tau(\inference)$]
	For an inference $\inference$ with $\sigma = \mgu(\inference)$, we define the infinite substitution\todo{define infinite substitutions properly and apply definition here}{} $\tau(\inference)$ with $\dom(\tau(\inference)) = \dom(\sigma) \cup \{z_s \mid s\sigma \neq s\}$ as follows for a variable $x$:

	\[
		x\tau(\inference) =
		\begin{cases}
			x\sigma & \text{$x$ is a non-lifting variable} \\
			z_{t\sigma} & \text{$x$ is a lifting variable $z_t$}
		\end{cases} 
	\]
		%\qedhere

	If the inference $\inference$ is clear from the context, we abbreviate $\tau(\inference)$ by $\tau$. 
\end{defi}


\begin{lemma}
	\label{lemma:lifting_tau_commute}
	For a formula or term $\varphi$ and an inference $\inference$ such that $\tau = \tau(\inference)$,
	$\lifboth{\lifboth{ \varphi} \tau} =\nolinebreak \lifboth{ \varphi \tau } $.
\end{lemma}
\begin{proof}
	We proceed by induction.

	\begin{itemize}
		\item Suppose that $t$ is a grey constant or function symbol of the form $f(t_1, \dots, t_n)$.
			Then we can derive the following, where (IH) signifies a deduction by virtue of the induction hypothesis. 
			\begin{align*}
				\lifboth{\lifboth{t}\tau} &= \lifboth{\lifboth{ f(t_1, \dots, t_n)}\tau} \\
																  &= \lifboth{ f(\lifboth{t_1}\tau, \dots, \lifboth{t_n}\tau) } \\
																	&= f(\lifboth{\lifboth{t_1}\tau}, \dots, \lifboth{\lifboth{t_n}\tau}) \\
																 	&\stackrel{\mathclap{\text{(IH)}}}= f(\lifboth{t_1\tau}, \dots, \lifboth{t_n\tau}) \\
																	&= \lifboth{f(t_1, \dots, t_n)\tau} \\
																	&= \lifboth{t\tau}
			\end{align*}
		\item Suppose that $t$ is a colored constant or function symbol. Then:
			\[
				\lifboth{\lifboth{t}\tau}= \lifboth{z_t\tau} 
				= \lifboth{z_{t\sigma}} 
				= z_{t\sigma} 
				= \lifboth{t\sigma} 
				= \lifboth{t\tau}
			\]
		\item Suppose that $t$ is a variable $x$. Then:
			\[
				\lifboth{\lifboth{t}\tau} = \lifboth{\lifboth{ x}\tau} = \lifboth{x\tau} = \lifboth{t\tau}
			\]
		\item Suppose that $t$ is a lifting variable $z_t$. Then:
			\[
				\lifboth{\lifboth{z_t}\tau} = \lifboth{z_t\tau} 
				\qedhere
			\]
	\end{itemize}

\end{proof}



\begin{defi}[Incrementally lifted interpolant]
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$.
	We define $\LI(\pi)$ and $\LIcl(\pi)$ to be $\LI(\square)$ and $\LIcl(\square)$ respectively, where $\square$ is the empty clause derived in $\pi$.

	Let $C$ be a clause in $\pi$. 
	%For a literal $\lambda$ in $C$, we denote the corresponding literal in $\LIcl(C)$ by $\lambda\cll$, whose existence is ensured Lemma~\ref{lemma:li_vs_clause_plus_literals_equal}.

	We define $\LIcl(C) \defeq C$. \mytodo{if this version is final, drop $\LIcl(C)$ everywhere}

	We define the preliminary formula $\LI^\bullet(C)$ as follows:

	\begin{itemize}
		\item[Base case.]
			If $C \in \Gamma$, $\LI(C) \defeq \bot$.
			If otherwise $C \in \Delta$, $\LI(C) \defeq \top$.
		\item[Resolution.]

			If the clause $C$ is the result of a resolution step $\inference$ of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ using a unifier $\sigma$ such that $l\sigma =  l'\sigma$, then define $\LI(C)$ as follows:

			\begin{enumerate}

				\item If $l$ is $\Gamma$-colored:
					$\LIpre(C) \defeq \LI(C_1)\tau\spas\lor \LI(C_2)\tau $

				\item If $l$ is $\Delta$-colored:
					$\LIpre(C) \defeq \LI(C_1)\tau\spas\land \LI(C_2)\tau$

				\item If $l$ is grey:
					$\LIpre(C) \defeq
					(l\tau \land \LI(C_2)\tau) \spas\lor
					(\lnot l'\tau\land \LI(C_1)\tau)
					$

			\end{enumerate}

		\item[Factorisation.]
			If the clause $C$ is the result of a factorisation step $\inference$ of $C_1: l \lor l' \lor D$ using a unifier $\sigma$ such that $l\sigma = l'\sigma$, then $\LIpre(C) \defeq \lifboth{\LI(C_1)\tau}$.

		\item[Paramodulation.]
			If the clause $C$ is the result of a paramodulation step $\inference$ of $C_1 : s = t \lor D$ and $C_2: E\occ{r}$ with $\sigma = \mgu(\inference)$.
			Let $h\occ{r}$ be the maximal colored term in which $r$ occurs in $E\occ{r}$.
			Then define $\LI(C)$ as follows:

			\begin{enumerate}

				\item If $h\occur{r}$ is $\Delta$-colored and $h\occur{r}$ occurs more than once in $E\occur{r} \lor \LI(E\occur{r})$:
					%\label{def:PI_paramod_1}
					\newline
					$\LIpre(C) \defeq  ( s=t \land \LI(C_2) )\tau \lor (s\neq t \land \LI(C_1))\tau \lor (s=t \land h\occur{s} \neq      h\occur{t})\tau$

				\item If $h\occur{r}$ is $\Gamma$-colored and $h\occur{r}$ occurs more than once in $E\occur{r} \lor \LI(E\occur{r})$:
					%\label{def:PI_paramod_2}
					\newline
					$\LIpre(C)\defeq{} [ ( s=t \land \LI(C_2) )\tau \lor (s\neq t \land \LI(C_1))\tau ] \land\allowbreak (s\neq t \lor h\occur{s} = h\occur{t})\tau$

				\item If $r$ does not occur in a colored term in $E\occur{r}$ which occurs more than once in $E\occur{r} \lor \LI(E\occur{r})$:
					%\label{def:PI_paramod_3}
					\newline
					$\LIpre(C) \defeq{} ( s=t \land \LI(C_2) )\tau \lor (s\neq t \land \LI(C_1))\tau $ 

			\end{enumerate}

	\end{itemize}

	$\LI(C)$ is built from $\LIpre(C)$ as follows:

	\begin{enumerate}
		\item Lift all maximal colored terms in $\LIpre(C)$ which contains some variable which does not occur in $C$.
		\item Let $X$ ($Y$) be the $\Delta$-($\Gamma$-)lifting variables created in the previous step.
		\item Prefix the resulting formula with an arrangement $\Q(C)$ of the elements of $\{\forall x_t \mid x_t \in X\}\cup\allowbreak\{\exists y_t \mid y_t \in Y\}$ such that if $s$ and $r$ are terms such that $s$ is a subterm of $r$, then $z_s$ precedes $z_r$.
			\qedhere
	\end{enumerate}
\end{defi}

\section{Properties of $\LI$ and $\LIcl$}


{correct but useless here:

	\tiny 

\begin{lemma}
	\label{lemma:li_vs_clause_plus_literals_equal}
	Let $C$ be a clause in a resolution refutation of $\Gamma\cup\Delta$.

	Then for every literal $\lambda$ in $C$, there exists a literal $\lambda\cll$ in\nolinebreak{} $\LIcl(C)$ such that $\lambda\cll = \lifboth{\lambda}$ and for resolved or factorised literals $l$ and $l'$ of a resolution or factorisation inference $\inference$, we have that $\lifboth{l\cll\tau} = \lifboth{l'\cll\tau}$.
\end{lemma}
\begin{proof}
	We proceed by induction.
	\begin{description}
		\item{} Base case.
			For $C\in\Gamma\cup\Delta$, $\LIcl(C)$ is defined to be $\lifboth{C}$.

		\item{} Induction step.
			Suppose the clause $C$ is the result of a resolution, factorisation or paramodulation inference \inference{} of the clauses $\bbar C$ with $\sigma = \mgu(\inference)$.

			%Suppose the clause $C$ is the result of a resolution step \inference{} of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$.

			Every literal in $C$ is of the form $\lambda\sigma$ for a literal $\lambda$ in $C_i\in\bbar C$.
			%For every literal in $C$, there exists a predecessor $\lambda$ in a clause $C_i$ in $\bbar C$.
			%Let $\lambda$ be a literal in $C_i\in\bbar C$, such that $\lambda$ is not the predecessor of the literal being resolved or factorised in $\inference$.
			%Then $\lambda\sigma$ is occurs in $C$.

			By the induction hypothesis, $\lifboth{\lambda}$ occurs in $\LIcl(C_i)$.
			By the construction of $\LIcl(C)$ and as $\lambda$ is not a resolved or factorised literal, $\LIcl(C)$ contains a literal of the form $\lifboth{\lifboth{\lambda}\tau}$.
			But by Lemma~\ref{lemma:lifting_tau_commute}, this is nothing else than $\lifboth{\lambda\tau}$.
			As $\lambda$ occurs in the resolution derivation, it does not contain lifting variables.
			Hence we get by the definition of $\tau$ that $\lifboth{\lambda\tau} = \lifboth{\lambda\sigma}$.

			Let $l$ and $l'$ be the resolved or factorised literals of \inference.
			In order to show that $\lifboth{l\cll\tau} = \lifboth{l'\cll\tau}$,
			consider that by the induction hypothesis, this is nothing else than
			$\lifboth{\lifboth{l}\tau} = \lifboth{\lifboth{l'}\tau}$.
			But by applying a similar argument as above, this equation is equivalent to
			$\lifboth{l\sigma} = \lifboth{l'\sigma}$, which is implied by $l\sigma =\nolinebreak l'\sigma$.
			\qedhere

			\begin{comment}
				Let $l$ and $l'$ be the resolved or factorised literals.
				By the induction hypothesis,
				$l\cll = \lifboth{l}$
				and
				$l'\cll = \lifboth{l'}$.

				By a similar reasoning as above, we get that $\lifboth{\lifboth{\lambda}\tau} = \lifboth{\lambda\sigma}$ for any literal $\lambda$ in $\bbar C$.

				$\lifboth{\lambda\cll\tau} = \lifboth{\lifboth{\lambda}\tau}$
				But as $l\sigma = l'\sigma$ and

				$\lifboth{\lifboth{l}\tau } =
				\lifboth{\lifboth{l'}\tau }
				$

				As no lifting variables occur in $l$ or $l'$, we get that $l\tau = l'\tau$, which we can lift to $\lifboth{l\tau} = \lifboth{l'\tau}$.

				Note that $l\sigma = l'\sigma$.

				$l\cll = \lifboth{l}$

				$\lifboth{ \lifboth{l} \tau} = \lifboth{l\tau}$

			\end{comment}
	\end{description}
\end{proof}


\begin{lemma}
	\label{lemma:no_colored_terms}
	Let $C$ be a clause of a resolution refutation of $\Gamma\cup\Delta$.
	$\LI(C)$ and $\LIcl(C)$ do not contain colored symbols.
\end{lemma}
\begin{proof}
	For $\LI(C)$ and $\LIcl(C)$, consider the following:
	In the base case of the inductive definitions of $\LI(C)$ and $\LIcl(C)$, no colored symbols occur.
	In the inductive steps, any colored symbol which is added by $\tau$ to intermediary formulas is lifted.
\end{proof}

}

\begin{lemma}
	\label{lemma:substitute_and_lift}
	Let $\sigma$ be a substitution and $F$ a formula without $\Phi$-colored terms such that for a set of formulas $\Psi$ which does not contain $\Phi$-lifting variables, $\Psi \entails F$.
	Then $\Psi \entails \lifphinovar{F\sigma}$.
\end{lemma}
\begin{proof}
	$\lifphinovar{F\sigma}$ is an instance of $F$:
	$\sigma$ substitutes variables either for terms which do not contain $\Phi$-colored symbols or by terms containing $\Phi$-colored symbols.
	For the first kind, the lifting has no effect.
	For the latter, the lifting only replaces subterms of the terms introduced by the substitution by a lifting variable such that the original structure of $F$ remains invariant as it by assumption does not contain colored terms.
\end{proof}

\begin{lemma}
	\label{lemma:gamma_entails_delta_lifted_invariant}
	Let $C$ be a clause in a resolution refutation of $\Gamma \cup \Delta$.
	Then
	$\Gamma \entails \lifdeltanovar{ \LI(C) } \lor \lifdeltanovar{C} $
\end{lemma}
\begin{proof}
	We proceed by induction on the strengthening
	$\Gamma \entails \lifdeltanovar{ \LI(C_\Gamma) } \lor \lifdeltanovar{C_\Gamma} $\footnote{Recall that $D_\Phi$ denotes the clause created from the clause $D$ by removing all literals which are not contained $\Lang(\Phi)$.}

	\begin{description}
		\item{} Base case.
			If $C\in \Gamma$, then $\lifdeltanovar{C} = C$ and $\Gamma \entails C$.
			If otherwise $C \in \Delta$, then $\LI(C) = \top$.

		\item{} Resolution.
			Suppose the clause $C$ is the result of a resolution step \inference{} of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$.

			By the induction hypothesis we obtain the following:

			$\Gamma \entails \lifdeltanovar{\LI(C_1)} \lor \lifdeltanovar{D_\Gamma} \lor \lifdeltanovar{l_\Gamma}$

			$\Gamma \entails \lifdeltanovar{\LI(C_2)} \lor \lifdeltanovar{E_\Gamma} \lor \lnot \lifdeltanovar{l'_\Gamma}$

			Hence by Lemma~\ref{lemma:substitute_and_lift} and Lemma~\ref{lemma:lifting_tau_commute}, we get:

			$\Gamma \stackrel\markA\entails \lifdeltanovar{\LI(C_1)\tau} \lor \lifdeltanovar{D_\Gamma\tau} \lor \lifdeltanovar{l_\Gamma\tau}$

			$\Gamma \stackrel\markB\entails \lifdeltanovar{\LI(C_2)\tau} \lor \lifdeltanovar{E_\Gamma\tau} \lor \lnot \lifdeltanovar{l'_\Gamma\tau}$

			As $l_\Gamma\sigma = l'_\Gamma\sigma$,
			it holds that $l_\Gamma\tau = l'_\Gamma\tau$ and consequently 
			$\lifdeltanovar{l_\Gamma\tau} = \lifdeltanovar{l'_\Gamma\tau}$.
			We proceed by a case distinction on the color of the resolved literal to show that in each case, we have that
			$\Gamma \entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$:
			\begin{itemize}
				\item Suppose that $l$ is $\Gamma$-colored.
					Then $l_\Gamma = l$ and $l'_\Gamma = l$, and we can perform a resolution step on \markA{} and \markB{} to obtain that
					$\Gamma \entails
					\lifdeltanovar{\LI(C_1)\tau} \lor
					\lifdeltanovar{\LI(C_2)\tau} \lor 
					\lifdeltanovar{D_\Gamma\tau}  \lor
					\lifdeltanovar{E_\Gamma\tau}$.
					This however is nothing else than $\Gamma \entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$.

				\item Suppose that $l$ is $\Delta$-colored.
					Then \markA{} and \markB{} reduce to 
					$\Gamma \entails \lifdeltanovar{\LI(C_1)\tau} \lor \lifdeltanovar{D_\Gamma\tau}$
					and
					$\Gamma \entails \lifdeltanovar{\LI(C_2)\tau} \lor \lifdeltanovar{E_\Gamma\tau}$
					respectively,
					which clearly implies that 
					$\Gamma \entails \lifdeltanovar{\LI(C_1)\tau} \lor \lifdeltanovar{\LI(C_2)\tau} \lor (\lifdeltanovar{D_\Gamma\tau} \land \lifdeltanovar{E_\Gamma\tau})$.
					This is turn is however just the unfolding of
					$\Gamma \entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$.

				\item Suppose that $l$ is grey.
					Then \markA{} and \markB{} imply that
					$\Gamma \entails
					\lifdeltanovar{\LI(C_1)\tau} \lor
					\lifdeltanovar{\LI(C_2)\tau} \spas\lor\allowbreak
					(\lifdeltanovar{l_\Gamma\tau} \land \lifdeltanovar{E_\Gamma\tau}) \spas\lor\allowbreak
					(\lnot\lifdeltanovar{l'_\Gamma\tau} \land \lifdeltanovar{D_\Gamma\tau})$.
					This however is equivalent to
					$\Gamma \entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$.

			\end{itemize}


			We now conclude by showing that 
			$\Gamma \entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$
			implies that 
			$\Gamma \entails \lifdeltanovar{\LI(C)} \lor \lifdeltanovar{C_\Gamma}$.

			The difference between $\lifdeltanovar{\LIpre(C)}$ and $\lifdeltanovar{\LI(C)}$ lies only in certain maximal colored terms which are lifted in $\lifdeltanovar{\LI(C)}$, hence it suffices to consider these.
			Let $t$ be a term in $\LIpre(C)$ at position $p$ such that $\LI(C)\atp = \lifboth{t}$.
			Then $t$ is a maximal colored term and contains a variable which does not occur in\nolinebreak{} $C$.

			If $t$ is $\Delta$-colored, then $\lifdeltanovar{\LIpre(C)}\atp = \LI(C)\atp = x_t$.
			Note that as $t$ occurs at $p$ in $\LIpre(C)$, $x_t$ occurs free at $\lifdeltanovar{\LIpre(C)}\atp$.
			Hence it is implicitly universally quantified and therefore entails that an explicit universal quantification in $\LI(C)$ is valid with an arbitrarily placed quantifier.  

			If otherwise $t$ is a $\Gamma$-term, then $\lifdeltanovar{\LIpre(C)}\atp = \lifdeltanovar{t}$.
			Hence $\lifdeltanovar{t}$ represents a witness term for the existentially quantified lifting variable $y_t$ at $\LI(C)\atp$.
			In general, $\lifdeltanovar{t}$ however contains $\Delta$-lifting variables, which require being lifted in the scope of the existential quantifier of $y_t$. 

			Let $x_s$ be a $\Delta$-lifting variable which occurs in $\lifdeltanovar{t}$. 
			It is essential to see that neither $s$ nor a predecessor of $s$ in the resolution derivation is lifted in a previous step of the interpolant extraction.
			Suppose to the contrary that this is the case in the inference creating the clause $C'$.
			Let $s'$ and $t'$ be the respective predecessors of $s$ and $t$ in $C'$.
			Then one of the following two contradictions eventuate:
			\begin{itemize}
				\item Suppose that $s'$ is a subterm of the corresponding predecessor $t'$.
					Then due to the fact that $s'$ is lifted, $s'$ must contain a variable which does not occur in $C'$. But as $t'$ contains $s'$, $t'$ contains this variable as well and would be lifted at this stage already.

				\item Otherwise $t'$ does not contain $s'$.
					We have already established that $s'$ contains a variable which does not occur in $C'$.
					As all clauses are variable-disjoint, no other clause contains this variable.
					But then it does not occur in any subsequent unifier, and in particular, it never enters $t'$ by means of substitution, which implies that $s'$ due to containing this variable does not become a subterm of a successor of $t'$.

			\end{itemize}

			Hence there are three possibilities for quantification of $x_s$:
			\begin{enumerate}
			\item Neither $s$ nor a successor of $s$ in the derivation occurs at a grey position. Then $x_s$ is not quantified in the course of the interpolant extraction.
			\item A variable which does not occur in $C$ enters $s$ by means of the current substitution $\sigma$ or a variable is contained in $s$ such that the only occurrences of it in $C_1$ and $C_2$ are in $l$ and $l'$.
				Then $x_s$ is lifted in the current step and as $s$ is a subterm of $t$, $x_s$ is quantified in $\Q(C)$ prior to $y_t$.
			\item The lifting variable $x_s$ or a respective successor is quantified at a later stage in the derivation.
				Then as the quantifier for $y_t$ is contained in $\LI(C)$ and for any successor $C'$ of $C$, $\LI(C')$ contains a successor $\LI(C)$, $y_t$ is quantified in the scope of the quantifier for $x_s$.
			\end{enumerate}


			%			Suppose that $s$ contains a variable which does not occur in $C$. Then $x_s$ is quantified in $\LI(C)$ as well.
			%			As however the quantifier block of $\LI(C)$ is ordered with respect to the subterm relation of the index of the lifting variables, $x_s$ is quantified prior to $y_t$.

		\item{} Factorisation. 
			Suppose the clause $C$ is the result of a factorisation inference $\inference$ of $C_1: l \lor l' \lor D$ with $\sigma=\mgu(\inference)$.
			
			The induction hypothesis gives $\Gamma \entails \lifdeltanovar{ \LI(C_1) } \lor \lifdeltanovar{ l_\Gamma \lor l'_\Gamma \lor D_\Gamma }$.
			By Lemma~\ref{lemma:substitute_and_lift}, we obtain
			$\Gamma \entails \lifdeltanovar{ \LI(C_1)\tau } \lor \lifdeltanovar{ l_\Gamma\tau \lor l'_\Gamma\tau \lor D_\Gamma\tau }$.
			As however $l\sigma \equiv l'\sigma$, 
			also $l\tau \equiv l'\tau$, so we can apply a factorisation step and obtain that
			$\Gamma \entails \lifdeltanovar{ \LI(C_1)\tau } \lor \lifdeltanovar{ l_\Gamma\tau \lor D_\Gamma\tau }$,
			which is nothing else than $\Gamma \entails \LIpre(C) \lor \lifdeltanovar{C_\Gamma}$.

		\item{} Paramodulation.
			Suppose the clause $C$ is the result of a paramodulation inference\nolinebreak{} $\inference$ of $C_1: s=t \lor D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)$.

			By the induction hypothesis, we obtain the following: 

			$\Gamma \stackrel\markA\entails \lifdeltanovar{\LI(C_1)} \lor \lifdeltanovar{D_\Gamma} \lor \lifdeltanovar{s}=\lifdeltanovar{t}$

			$\Gamma \stackrel\markB\entails \lifdeltanovar{\LI(C_2)} \lor \lifdeltanovar{(E\occatp{r})_\Gamma}$

			Suppose now that for a model $M$ of $\Gamma$ that $M \entails \lifdeltanovar{s}\neq \lifdeltanovar{t}$.
			Then we get by \markA{} that $\Gamma \entails \lifdeltanovar{\LI(C_1)} \lor \lifdeltanovar{D_\Gamma}$, which by Lemma~\ref{lemma:substitute_and_lift} and Lemma~\ref{lemma:lifting_tau_commute} gives $\Gamma \entails \lifdeltanovar{\LI(C_1)\tau} \lor \lifdeltanovar{D_\Gamma\tau}$.
			Note that $\Gamma \entails \lifdeltanovar{s\tau}\neq \lifdeltanovar{t\tau} \lor \lifdeltanovar{\LI(C_1)\tau}$ suffices for $\Gamma \entails \lifdeltanovar{\LIpre(C)}$ and $\Gamma \entails \lifdeltanovar{D_\Gamma\tau}$ implies for $\Gamma \entails \lifdeltanovar{C_\Gamma}$.
			Therefore we obtain that 
			$\Gamma \entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$.

			Now suppose to the contrary that for a model $M$ of $\Gamma$ that $M \entails \lifdeltanovar{s}=\lifdeltanovar{t}$.
			By Lemma~\ref{lemma:substitute_and_lift} and  Lemma~\ref{lemma:lifting_tau_commute} we obtain from \markB{} that
			$\Gamma \entails \lifdeltanovar{\LI(C_2)\tau} \lor \lifdeltanovar{(E\occatp{r})_\Gamma\tau}$.
			As however $\sigma = \mgu(r, s)$, $r\tau \equiv s\tau$
			and hence $\lifdeltanovar{r\tau} \equiv \lifdeltanovar{s\tau}$.
			Therefore we also have that 
			$\Gamma \entails \lifdeltanovar{\LI(C_2)\tau} \lor \lifdeltanovar{(E\occatp{s})_\Gamma\tau}$.

			We proceed by a case distinction:
			\begin{itemize}
				\item Suppose that the position $p$ in $E\occatp{s}$ is not contained in a $\Delta$-term.
					Then
					$\lifdeltanovar{(E\occatp{s})_\Gamma\tau}$
					and
					$\lifdeltanovar{(E\occatp{t})_\Gamma\tau}$
					only differ at at position $p$.
					But as $\lifdeltanovar{s} = \lifdeltanovar{t}$, we can apply Lemma~\ref{lemma:substitute_and_lift} and Lemma~\ref{lemma:lifting_tau_commute} to obtain that 
					$\lifdeltanovar{s\tau} = \lifdeltanovar{t\tau}$.
					Thus
					$M\entails \lifdeltanovar{(E\occatp{s})_\Gamma\tau} \semiff 
					\lifdeltanovar{(E\occatp{t})_\Gamma\tau}$
					and consequently
					$M \entails \lifdeltanovar{\LI(C_2)\tau} \lor \lifdeltanovar{(E\occatp{t})_\Gamma\tau}$.
					As furthermore $\lifdeltanovar{\tau s} =\lifdeltanovar{t} \land \lifdeltanovar{\LI(C_2)\tau}$ entails $\lifdeltanovar{\LIpre(C)}$
					and $\lifdeltanovar{(E\occatp{t})_\Gamma\tau}$ is sufficient for $\lifdeltanovar{C_\Gamma}$,
					we have that 
					$M\entails \lifdeltanovar{\LIpre(C)} \lor \lifdeltanovar{C_\Gamma}$.


					\mytodo{ICI}
			\end{itemize}






	\end{description}
\end{proof}


\largered{
	proof idea for ground terms:

	double all arities of function symbols.
	exchange parameter $t$ by $t, x$, where $x$ is a fresh variable.
	change interpretation such that even second parameter is ignored.
	Then there are no ground terms.

}

\begin{lemma}
	\label{lemma:li_symmetry}
	Let $\pi$ be a refutation of $\Gamma\cup\Delta$ and $\bhat \pi$ be $\pi$ with $\bhat \Gamma = \Delta$ and $\bhat \Delta = \Gamma$.
	Then for a clause $C$ in $\pi$ and its corresponding clause $\bhat C$ in $\bhat \pi$, $\LI(C) \spas\semiff \lnot \LI(\bhat C)$.
\end{lemma}
\begin{proof}
	We proceded by induction to show that $\LIpre(C) \semiff \lnot \LIpre(\bhat C)$:
	\begin{itemize}
		\item[Base case.]
			If $C \in \Gamma$, then $\LI(C) = \bot \semiff \lnot \top \semiff \lnot \LI(\bhat C)$ as $\bhat C\in\Delta$. 
			The case for $C\in\Delta$ can be argued analogously.

		\item[Resolution.]
			Suppose the clause $C$ is the result of a resolution step \inference{} of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$.

			As $\tau$ depends only on $\sigma$,
			$\tau$ is the same for both $\pi$ and $\bhat \pi$.

			We now distinguish the following cases:

			\begin{enumerate}

				\item $l$ is $\Gamma$-colored:
					\begin{align*}
						\hspace*{\dimexpr-\leftmargini-\leftmarginii}
						\LIpre(C)	&= \LI(C_1)\tau\spas\lor {\LI(C_2)\tau} \\
															&\semiff \lnot (\lnot{\LI(C_1)\tau}\spas\land \lnot {\LI(C_2)\tau}) \\
						%&\semiff \lnot (\lifboth{(\lnot \LI(C_1))\tau}\spas\land \lifboth{(\lnot \LI(C_2))\tau}) \\
														 &\semiff \lnot ({\LI(\bhat C_1)\tau}\spas\land {\LI(\bhat C_2)\tau}) \\
														&= \lnot \LIpre(\bhat C)
					\end{align*}

				\item $l$ is $\Delta$-colored:
					This case can be argued analogously.

				\item $l$ is grey:
					Note ${l\tau} \stackrel{{\markB}}= {l'\tau}$.
					\begin{align*}
						\hspace*{\dimexpr-\leftmargini-\leftmarginii}
						\LIpre(C) &\stackrel{{\phantom{\markB}}}=
						(\lnot {{l'\tau}} \land {\LI(C_1)\tau}) \spam\lor 
						({l\tau} \land {\LI(C_2)\tau})\\
						&\stackrel{{\markB}}\semiff\,
						({{l'\tau}} \lor {\LI(C_1)\tau}) \spam\land 
						(\lnot {l\tau} \lor {\LI(C_2)\tau})\\
						&\stackrel{{\phantom{\markB}}}\semiff \lnot [ (\lnot {{l'\tau}} \land \lnot {\LI(C_1)\tau}) \spam\lor 
					({l\tau} \land \lnot{\LI(C_2)\tau}) ] \\
					&\stackrel{{\phantom{\markB}}}=\lnot [ (\lnot {{\bhat l'\tau}} \land {\LI(\bhat C_1)\tau}) \spam\lor 
				({\bhat l\tau} \land {\LI(\bhat C_2)\tau}) ]\\
				& \stackrel{{\phantom{\markB}}}= \lnot \LIpre(\bhat C) 
			\end{align*}
	\end{enumerate}


\item[Factorisation.]
	Suppose the clause $C$ is the result of a factorisation $\inference$ of $C_1: l \lor l' \lor D$ 
	with $\sigma = \mgu(\inference)$.

	As the construction is not influenced by the coloring, the induction hypothesis $\LIpre(C) = \LI(C_1)\tau$ suffices.

	Then $\LIpre(C) = \lifboth{\LI(C_1)\tau}$, so the construction is not influenced by the coloring and by the induction hypothesis, $\LIpre(C) \semiff \lnot \LIpre(\bhat C)$.

\item[Paramodulation.]
	Suppose the clause $C$ is the result of a paramodulation inference $\inference$ of $C_1: s=t \lor D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)$.


	We proceed by a case distinction:
	\begin{itemize}
		\item Suppose that $p$ in $E\occatp{r}$ is contained in a maximal $\Delta$-term $h\occ{r}$, which occurs more than once in $E\occatp{r} \lor \LI(E\occatp{r})$. 
			Then $p$ in $\bhat E\occatp{r}$ is contained in a maximal $\Gamma$-term $h\occ{r}$, which occurs more than once in $\bhat E\occatp{r} \lor \LI(\bhat E\occatp{r})$. 

			\hspace*{\dimexpr-\leftmargini-\leftmarginii}\parbox{\linewidth}{%
				%\hspace*{\dimexpr-\leftmargini-\leftmarginii}\parbox{\linewidth}{%
				\begin{align*}
					%\hspace*{\dimexpr-\leftmargini-\leftmarginii}
					\LIpre(C) 
					&= ({s\tau=t\tau} \land {\LI(C_2)\tau} ) \lor ({s\tau\neq t\tau} \land {\LI(C_1)\tau}) \lor ({s\tau=t\tau} \land {h\occur{s}\tau \neq h\occur{t}\tau}) \\
					&\semiff \lnot [ ({s\tau\neq t\tau} \lor \lnot {\LI(C_2)\tau} ) \land ({s\tau= t\tau} \lor \lnot{\LI(C_1)\tau}) \land ({s\tau\neq t\tau} \lor {h\occur{s}\tau = h\occur{t}\tau}) ] \\
					 &= \lnot [ ({s\tau\neq t\tau} \lor {\LI(\bhat C_2)\tau} ) \land ({s\tau= t\tau} \lor {\LI(\bhat C_1)\tau}) \land ({s\tau\neq t\tau} \lor {h\occur{s}\tau = h\occur{t}\tau}) ] \\
						&\semiff \lnot [ ({s\tau= t\tau} \land {\LI(\bhat C_2)\tau} ) \lor ({s\tau\neq t\tau} \land {\LI(\bhat C_1)\tau}) \land ({s\tau\neq t\tau} \lor {h\occur{s}\tau = h\occur{t}\tau}) ]\\
						&= \lnot \LIpre(\bhat C)
				\end{align*}
			}\par

		\item Suppose that $p$ in $E\occatp{r}$ is contained in a maximal $\Gamma$-term $h\occ{r}$, which occurs more than once in $E\occatp{r} \lor \LI(E\occatp{r})$. 
			This case can be argued analogously.

		\item Otherwise:
			%\hspace*{\dimexpr-\leftmargini-\leftmarginii-\leftmarginiii}\parbox{\linewidth}{%
			%\hspace*{\dimexpr-\leftmargini-\leftmarginii}\parbox{\linewidth}{%
			\begin{align*}
				%\hspace*{\dimexpr-\leftmargini-\leftmarginii}
				\LIpre(C) 
				&= ({s\tau=t\tau} \land {\LI(C_2)\tau} ) \spam\lor ({s\tau\neq t\tau} \land {\LI(C_1)\tau}) \\
				 &\semiff \lnot [ ({s\tau\neq t\tau} \lor \lnot {\LI(C_2)\tau} ) \spam\land ({s\tau= t\tau} \lor \lnot {\LI(C_1)\tau}) ] \\
					&= \lnot [ ({s\tau\neq t\tau} \lor {\LI(\bhat C_2)\tau} ) \spam\land ({s\tau= t\tau} \lor {\LI(\bhat C_1)\tau}) ] \\
					 &\semiff \lnot [ ({s\tau= t\tau} \land {\LI(\bhat C_2)\tau} ) \spam\lor ({s\tau\neq t\tau} \land {\LI(\bhat C_1)\tau}) ] \\
						&= \lnot \LIpre(\bhat C)
			\end{align*}
			%}\par

	\end{itemize}

	\end{itemize}


	We conclude by showing that 
	$\LIpre(C) \semiff \lnot \LIpre(\bhat C)$ 
	entails that 
	$\LI(C) \semiff \lnot \LI(\bhat C)$:
	Clearly the terms to be lifted in $\LIpre(C)$ and $\LIpre(\bhat C)$ are the same and differ only in their color.
	Even though this results in different lifting variables, that is of no relevance as all lifted variables are instantly bound.
	Additionally, the quantifier type of any given lifting variable in $\Q(C)$ is dual to the respective one in $\Q(\bhat C)$.
	Furthermore note that the subterm-relation is not affected by the coloring, so the ordering of the quantifiers in $\Q(C)$ and $\Q(\bhat C)$ is identical.
	Hence 
	$\LI(C) \semiff \lnot \LI(\bhat C)$.
\end{proof}


\begin{lemma}
	\label{lemma:delta_entails_li}
	Let $C$ be a clause in a resolution refutation of $\Gamma \cup \Delta$.
	Then
	$\Delta \entails \lnot\lifgammanovar{\LI(C)} \lor \lifgammanovar{C}$.
\end{lemma}
\begin{proof}
	Construct $\bhat \pi$ with $\bhat \Gamma = \Delta$ and $\bhat \Delta = \Gamma$. 
	Then by Lemma~\ref{lemma:gamma_entails_delta_lifted_invariant}, $\bhat \Gamma \entails \liftnovar{\bhat \Delta}{\LI(\bhat C)} \lor \liftnovar{\bhat \Delta}{\bhat C}$, 
	which by Lemma~\ref{lemma:li_symmetry} is nothing else than
	$\Delta \entails \lnot \liftnovar{\Gamma}{\LI(C)} \lor \liftnovar{\Gamma}{C}$.
\end{proof}

\begin{thm}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$.
	Then $\LI(\pi)$ is an interpolant of $\Gamma$ and $\Delta$.
\end{thm}
\begin{proof}
	\ref{lemma:gamma_entails_delta_lifted_invariant}
	\ref{lemma:delta_entails_li}
	plus lifting of ground terms (todo)

\end{proof}

\end{document}
