\documentclass[,%fontsize=11pt,%
	%landscape,
	%DIV8, % mehr text pro seite als defaultyyp
	%DIV10,
	%DIV=calc,%
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
	12pt,
	a4paper,
	oneside,% apparently, this should stay below some other parameter to have an effect
	openany,
	%]{scrartcl}
]{memoir}



\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}


\newcommand{\changefont}[3]{
\fontfamily{#1}\fontseries{#2}\fontshape{#3}\selectfont}
\usepackage[bitstream-charter]{mathdesign}


%\renewcommand{\familydefault}{ \sfdefault }
%\renewcommand{\rmdefault}{ppl}


%\usepackage[urw-garamond]{mathdesign}

\usepackage{lscape}
\usepackage{stackengine}
\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}


% subsections also in toc
\setcounter{tocdepth}{2}
\setsecnumdepth{subsection}


\definethms

\def\proofSkipAmount{ \vskip -0.1em }


%\usepackage{bussproof}

%\usepackage{vaucanson-g}
%\usepackage{amssymb}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
%\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}


\usepackage{amsthm}


\chapterstyle{madsen}


% define page numbering styles
\makepagestyle{numberCorner}
\makeevenfoot{numberCorner}{\thepage}{}{}
\makeoddfoot{numberCorner}{}{}{\thepage}

\makepagestyle{numberCenter}
%\makeevenfoot{numberCenter}{}{\thepage}{}
%\makeoddfoot{numberCenter}{}{\thepage}{}
%
%\makeevenhead{numberCenter}{\thechapter}{}{\thesection}
%\makeoddhead{numberCenter}{\thesection }{}{\thechapter}
\makeheadrule{numberCenter}{\textwidth}{1pt}

\makeevenhead{numberCenter}{\thepage}{}{\leftmark}
\makeoddhead{numberCenter}{\rightmark}{}{\thepage}


\makeatletter
\makepsmarks{numberCenter}{
	\def\chaptermark##1{\markboth{%
			\ifnum \value{secnumdepth} > -1
			\if@mainmatter
			\chaptername\ \thechapter\ --- %
			\fi
			\fi
	##1}{}}
	\def\sectionmark##1{\markright{%
			\ifnum \value{secnumdepth} > 0
			\thesection. \ %
			\fi
	##1}}
}
\makeatother
\newcommand{\mysetpagestyle}{
	%\pagestyle{numberCorner}
	\pagestyle{numberCenter}
}
\mysetpagestyle





\usepackage{refcheck}

\settypeblocksize{0.67\stockheight}{0.67\stockwidth}{*}
\setlrmargins{*}{*}{1.2}
\setulmargins{*}{*}{1.4}
\checkandfixthelayout[nearest]


\begin{document}

\chapter{ Number of quantifier alternations in Huang and nested }

\section{ Outline }

Goal: try proof Huang and nested equal.

Method: proof for both:

\begin{cprop}
	Let $I$ be an interpolant created by \$algorithm.
	If $I$ contains a term $t$ such that $t$ has $n$ color changes, then $I$ has at least $n$ quantifier alternations.
\end{cprop}

\subsection{generally keep in mind}

\begin{itemize}
	\item Need to define all new terms here: color-changing, single-color, $\Phi$-literal
\end{itemize}

\section{ Preliminaries }

Quantifier alternations in $I$ usually assumes the quantifier-alternation-minimising arrangement of quantifiers in $I$ 

\begin{defi}[Color alternation $\ca$]
	Colors $\Gamma$ and $\Delta$, term $t$:

	$\ca(t) \defeq \ca_\bot(t)$

	Let $t = f(t_1, \dots, t_n)$ for constant, function and variable symbols (syntax abuse)

	
	$\ca_\Phi(t) \defeq 
	\begin{cases}
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$f$ is grey} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$f$ is of color $\Phi$} \\
		1 + \max(\ca_\Psi(t_1), \dots, \ca_\Psi(t_n)) & \text{$f$ is of color $\Psi$, $\Phi \neq \Psi$} \\
	\end{cases}
	$
\end{defi}

\begin{defi}
	$\PIstepnosigma$ is defined just like $\PIstep$ but without applying any substitution.
\end{defi}
Hence $\PIstepnosigma(\cdot) \sigma = \PIstep(\cdot)$.
$C\nosigma$ is somehow the same, i.e.\ if $C = D\sigma$, then $C\nosigma = D$ where $\sigma$ is derived from the context.

\section{ Random thoughts }

\begin{itemize}
	\item Quantifiers are introduced for lifting variables which actually occur in the interpolant
	\item If term $t$ with $\ca(t) = n$ enters $I$, we need subterm $s$ of $t$ with $\ca(s) = n-1$ to be in $I$ (of course colors of $t$ and $s$ are exactly opposite)
\end{itemize}


\subsection{ Proof}
\begin{itemize}
	\item Induction over $\lifdelta{\PI(C) \lor C}$ and also about $\Gamma$-terms with $\Delta$-lifting vars in that formula. Cf. \texttt{-final}
	\item TODO: describe proof method with $\sigmazi$: which $\PI$? 
		\begin{itemize}
			\item Factorisation:
				easy: just apply $\sigma_i$ for all $i$ to $\PI(C) \lor C$. 
				When done, a literal will be there twice and we can remove it without losing anything
			\item Resolution:
				create propositional structure first.

				Ex.: $C_1 : D \lor l$, $ C_2: \lnot l \lor E$:

				If we talk about properties for which it holds that if they hold for $\PI(C_i) \lor C_i$, $i\in\{1,2\}$, then they also hold for $ A \equiv \Big((l \land \PI(C_2)) \lor (\lnot l \land \PI(C_1))\Big) \lor C\nosigma$, then we can apply $\sigma_i$ for all $i$ to that formula.

				So if we can assume it for $A$ and show it for all $\sigma_i$, we get that it holds for $\PI(C) \lor C$.

		\end{itemize}
\end{itemize}


\section{ Proof port attempt from \texttt{-final} }

\largered{ need to show that grey occurrences are in grey literals, all grey literals end up in the interpolant! }

conj: if a $\Delta$-term $t$ occurs in a $\Gamma$-literal in a clause $C$, then $t$ occurs in a grey literal in $\PI(C)$.

evidence:
\begin{itemize}
	\item situation does not occur in $\Gamma$ or $\Delta$
	\item terms are only changed by unificators
	\item $\Delta$- and $\Gamma$-terms are not unifiable, so one of the literals has to have a variable at a grey position when a $\Delta$-term enters a $\Gamma$-literal
	\item that literal has to be grey
	\item QED?
\end{itemize}

\begin{rlemma}
	If a $\Phi$-term $t$ occurs in a $\Psi$-literal in a clause $C$, then $t$ occurs at a grey position in $\PI(C)$.
\end{rlemma}
\begin{proof}
	As all grey literals of clauses involved in a refutation end up in the interpolant, it suffices to show that $t$ occurs at a grey position in a grey literal. 

	Substitutions are applied to all variables, hence we only need to consider terms $t$ which just enter a foreign colored literal.

	\mytodo{propagation 1: $\Phi$-terms vs $\Psi$-terms (in $\Psi$-literals)}

	\mytodo{propagation 2: $\Phi$-terms vs other $\Phi$-terms (in $\Psi$-literals)}

	Induction on refutation and $\sigma$; base case easy.

	Resolution or factorisation inference $\inference$. 
	Let $\lambda$ be a $\Gamma$-literal containing a variable $u$ at position $\bhat u$ such that $u\sigma_i$ contains a $\Delta$-term $t$.

	If the resolved or factorised literals are grey, they become part of $\PI(C)$ and if $t$ occurs grey there, we are done.

	\begin{itemize}
		\item Suppose the resolved literals are $\Gamma$-colored. Then IH.
		\item Suppose the resolved literals are $\Delta$-colored.
			\mytodo{}
		\item Suppose the resolved literals are grey and $t$ does not occur at a grey position in $\lambda\sigma = \lambda'\sigma$.

			\mytodo{}

	\end{itemize}


	~



	
\end{proof}

\begin{clemma}
	If a $\Phi$-term $t$ occurs in a $\Psi$-literal in a clause $C$, then $t$ occurs at a grey position in a grey literal in $\PI(C) \lor C$.
\end{clemma}
there has to be a variable $u$ in a $\Psi$-literal such that $u\sigma_i$ contains $t$.

\begin{clemma}
	If a variable $u$ occurs in a $\Phi$-literal as well as in a $\Psi$-literal in a clause $C$, then $t$ also occurs at a grey position in a grey literal in $\PI(C)$.
\end{clemma}
\begin{proof}
	Initially not the case.

	Note that we can only resolve/factorise $\Gamma$-/$\Delta$-/grey literals with other $\Gamma$-/$\Delta$-/grey literals as clearly the predicate symbol must be the same for both literals.
	Hence if a variable occurs only in $\Gamma$- or only in $\Delta$-literals, then it can never escape these.
	Hence $u$ certainly is contained in a grey literal.

	Now suppose that $u$ only occurs colored in grey literals.
	Then it occurs in a $\Gamma$-($\Delta$-) term in the original $\Gamma$-($\Delta$-)clauses which contain it.

	As shown before $u$ must occur in some grey literal.
	Suppose it does not occur at a grey position in a grey literal as otherwise we are done.
	Then $u$ only occurs in $\Gamma$-terms in grey literals as 

	\mytodo{it seems that now we have to deal with possible $\Gamma$-terms in $\Delta$-literals and so on $\Ra$ circular reasoning}



	The situation in question arises if some variable $u$ occurs in a $\Gamma$-literal in some clause and some variable $v$ occurs in a $\Delta$-literal in some clause (possibly the same), such that in the unified literals, $u$ and $v$ both occur at the same position in the respective literals.


\end{proof}

\begin{clemma}
	Resolution or factorisation step $\inference$ from $\bar C$.

	If $u$ col-change var in $(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)\sigmazi$, then $u$ also occurs grey in that formula.
\end{clemma}
\begin{proof}
	Abbreviation: $F \equiv (\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)$

	Induction over refutation and $\sigma$; base case easy.

Step:
Supp color change var $u$ present in 
$F\sigmazi$. (could also say introduced, then proof would be somehow different)

Supp $u$ not grey in 
$F\sigmazmi$ as otherwise done.
As a first step, we show that if a (not necessarily color-changing) variable $v$ occurs in a single-colored $\Phi$-term $t\occ{v}$ in $F\sigmazi$,
then at least one of the following holds:
\begin{compactenum}
\item $v$ occurs in some single-colored $\Phi$-term in $F\sigmazmi$ \label{var_occ_1}
\item there is a color-changing variable $w$ in $F\sigmazmi$ such that $v$ occurs grey in $w\sigma_i$.  \label{var_occ_2}
\end{compactenum}
We consider the different cases which can introduce a variable $v$ in a single-colored term $\Phi$: Either it has been there before, it was introduced in a s.c. $\Phi$-colored term, or a s.c.\ $\Phi$-term containing the var is in $\ran(\sigma)$.
\begin{itemize}
	\item
		Suppose a term $t'\occ{v}$ is present in $F\sigmazmi$ such that $t'\occ{v}\sigma_i = t\occ{v}$.
		Then \ref{var_occ_1} is the case.
	\item
		Suppose a variable $w$ occurs in a single-colored $\Phi$-term in $F\sigmazmi$ such that $v$ occurs grey in $w\sigma_i$.
		Suppose furthermore that \ref{var_occ_1} is not the case, i.e.\ $v$ does not occur in a s.c.\ $\Phi$-term in $F\sigmazmi$, as otherwise we would be done.
		We show that \ref{var_occ_2} is the case.

		As $v$ occurs neither grey nor in a s.c.\ $\Phi$-term in $F\sigmazmi$ but occurs in $\ran(\sigma_i)$, it must occur in $F\sigmazmi$ and this can only be in a single-colored $\Psi$-term.

		As by assumption $v$ occurs grey in $w\sigma_i$, there must be an occurrence $\bhat w$ of $w$ in a resolved or factorised literal, say $\lambda\sigmazmi$ such that for the other resolved literal $\lambda'\sigmazmi$, $\lambda'\sigmazmi\at{\bhat w}$ is a subterm in which $v$ occurs grey.
		But as the occurrence of $v$ in $\lambda'\sigmazmi\at{\bhat w}$ must be contained in a single-colored $\Psi$-term, so is $\lambda\sigmazmi\at{\bhat w}$, hence $z$ occurs in a single-colored $\Psi$-term as well.
		Therefore \ref{var_occ_2} is the case.

	\item
		Suppose there is a variable $z$ in $F\sigmazmi$ such that $v$ occurs in a single-colored $\Phi$-term in $z\sigma_i$.
		Then $z\sigma_i$ occurs in $F\sigmazmi$, but this is a witness for \ref{var_occ_1}.
\end{itemize}

Now recall that we have assumed $u$ to be a color-changing variable in $F\sigmazi$.
Hence it occurs in a single-colored $\Gamma$-term as well as in a single-colored $\Delta$-term.
By the reasoning above, this leads to two case:
\begin{itemize}
	\item In $F\sigmazmi$, $u$ occurs both in some single-colored $\Gamma$-term as well as in some single-colored $\Delta$-term.
		Then we get the result by the induction hypothesis and the fact that $u\not\in\dom(\sigma_i)$ as $u$ does occur in $F\sigmazi$.
	\item Otherwise for some color $\Phi$, $u$ does not occur in a single-colored $\Phi$-term in $F\sigmazmi$.
		Then case \ref{var_occ_2} above must hold and there is some color-changing variable $w$ in $F\sigmazmi$ such that $u$ occurs grey in $w\sigmazi$.
		But then by the induction hypothesis, $w$ occurs grey in $F\sigmazmi$ and hence $u$ occurs grey in $F\sigmazi$.
		\qedhere
\end{itemize}


\end{proof}

\begin{clemma}
	If ${\PI(C) \lor C}$ contains a maximal colored occurrence of a $\Gamma$-term $t\occ{s}$ containing $\Delta$-term $s$, then 
	$s$ occurs grey in $\PI(C) \lor C$.
\end{clemma}
\begin{proof}
	Note that it suffices to show that at the step where $s$ is introduced as subterm of $t\occ{s}$, $s$ occurs grey in $\PI(C) \lor C$ as any later modification by substitution is applied to both occurrences $s$, so they stay equal throughout the remaining derivation. \mytodo{what if it's in $\PI(C)$ and it disappears due to not being a colored literal?}
	\medskip

	\noindent
	Induction over $\pi$ and $\sigma$.
	\medskip

	\noindent
	Base case: \checkmark
	\medskip

	\noindent
	Step:
	Resolution or factorisation inference $\inference$, $\mgu(\inference) = \sigma = \sigma_1\cdots\sigma_n$ 
	The term $t\occ{s}$ is created by one of the following two ways: 
	\begin{itemize}
		\item
			A variable $u$ occurs in $(\PIstepnosigma(\inference, \PI(C_1), \PI(C_2)) \lor C\nosigma)\sigmazmi$ such that $u\sigma_i = t\occ{s}$.

			Then $u$ occurs in a resolved or factorised literal $\lambda\sigmazmi$ at $\bhat u$ such that at the other resolved or factorised literal $\lambda'\sigmaz{i-1}$, $\lambda'\sigmazmi\at{\bhat u} = t\occ{s}$.
			Then the condition is present at $(\PIstepnosigma(\inference, \PI(C_1), \PI(C_2)) \lor C\nosigma)\sigmazmi$ and we get the result by the induction hypothesis.

		\item 
			Note that we only consider maximal colored terms.
			\todo{is probably not same $t$ as in lemma statement, which isn't technically wrong but confusing} Let $t\occ{u}$ be a maximal colored $\Gamma$-term in $(\PIstepnosigma(\inference, \PI(C_1), \PI(C_2)) \lor C\nosigma)\sigmazmi$ such that in the tree-representation of $t\occ{u}$, the path from the root to $u$ does not contain a node labelled with a $\Delta$-symbol.

			Suppose that $u$ occurs grey in $(\PIstepnosigma(\inference, \PI(C_1), \PI(C_2)) \lor C\nosigma)\sigmazmi$.
			Then $s$ occurs grey in $(\PIstepnosigma(\inference, \PI(C_1), \PI(C_2)) \lor C\nosigma)\sigmazi$ and we are done.

			Now suppose that $u$ does not occur grey in $(\PIstepnosigma(\inference, \PI(C_1), \PI(C_2)) \lor C\nosigma)\sigmazmi$.

			\mytodo{need color changing variable lemma for $\PI(C) \lor C$, or actually the $\PIstep$-representation}

			\mytodo{case with $u$ in s.c.\ $\Gamma$-term}



	\end{itemize}

\end{proof}

\end{document}

