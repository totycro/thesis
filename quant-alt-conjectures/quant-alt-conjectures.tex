\documentclass[,%fontsize=11pt,%
	%landscape,
	%DIV8, % mehr text pro seite als defaultyyp
	%DIV10,
	%DIV=calc,%
	%article,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
	12pt,
	a4paper,
	oneside,% apparently, this should stay below some other parameter to have an effect
	openany,
	%]{scrartcl}
]{memoir}



\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}


%\usepackage[bitstream-charter]{mathdesign}


%\renewcommand{\familydefault}{ \sfdefault }
%\renewcommand{\rmdefault}{ppl}


%\usepackage[urw-garamond]{mathdesign}

\usepackage{lscape}
\usepackage{stackengine}
\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}


% subsections also in toc
\setcounter{tocdepth}{2}
\setsecnumdepth{subsection}


\definethms

\def\proofSkipAmount{ \vskip -0.1em }


%\usepackage{bussproof}

%\usepackage{vaucanson-g}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
%\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}


\usepackage{amsthm}


\chapterstyle{madsen}


% define page numbering styles
\makepagestyle{numberCorner}
\makeevenfoot{numberCorner}{\thepage}{}{}
\makeoddfoot{numberCorner}{}{}{\thepage}

\makepagestyle{numberCenter}
%\makeevenfoot{numberCenter}{}{\thepage}{}
%\makeoddfoot{numberCenter}{}{\thepage}{}
%
%\makeevenhead{numberCenter}{\thechapter}{}{\thesection}
%\makeoddhead{numberCenter}{\thesection }{}{\thechapter}
\makeheadrule{numberCenter}{\textwidth}{1pt}

\makeevenhead{numberCenter}{\thepage}{}{\leftmark}
\makeoddhead{numberCenter}{\rightmark}{}{\thepage}


\makeatletter
\makepsmarks{numberCenter}{
	\def\chaptermark##1{\markboth{%
			\ifnum \value{secnumdepth} > -1
			\if@mainmatter
			\chaptername\ \thechapter\ --- %
			\fi
			\fi
	##1}{}}
	\def\sectionmark##1{\markright{%
			\ifnum \value{secnumdepth} > 0
			\thesection. \ %
			\fi
	##1}}
}
\makeatother
\newcommand{\mysetpagestyle}{
	%\pagestyle{numberCorner}
	\pagestyle{numberCenter}
}
\mysetpagestyle





\usepackage{refcheck}

%\settypeblocksize{0.67\stockheight}{0.67\stockwidth}{*}
%\setlrmargins{*}{*}{1.2}
%\setulmargins{*}{*}{1.4}
%\checkandfixthelayout[nearest]

\counterwithout{section}{chapter}



\newcommand{\inv}{\ensuremath{\chi}}

\begin{document}

\chapter{ Number of quantifier alternations in Huang and nested }

\section{ Preliminaries }

For $\sigma = \mgu(\varphi, \psi)$ for two terms or literals $\varphi$ and $\psi$, we denote by $\sigma_i$ for $1\varleq i \varleq n$ the $i$th substitution which is added to $\sigma$ by the unification algorithm, where $n = |\dom(\sigma)|$.
We define $\sigma_0 \defeq \id$.

We furthermore denote the composition of all $\sigma_k$ for $i\varleq k \varleq j$ by $\sigmarange{i}{j}$.
Hence $\sigma = \sigmarange{1}{n} = \sigmarange{0}{n}$.

~

A term $t$ is \defiemph{single-colored} if $t$ is $\Phi$-colored for some $\Phi$ and all colored symbols in $t$ are $\Phi$-colored.

A literal $l$ is called a $\Phi$-literal if its predicate symbol is $\Phi$-colored.

~

Quantifier alternations in $I$ usually assumes the quantifier-alternation-minimizing arrangement of quantifiers in $I$. The lemma statements hence talk about the \emph{minimal} number of quantifier alternations, which is indeed easily obtainable, i.e.\ it's a lower and upper bound at the same time.

~

In the following, we assume that the maximum $\max$ of an empty sequence is defined to be $0$ and constants are treated as function symbols of arity $0$.
Furthermore $\bot$ is used to denote a color which is not possessed by any symbol.
\begin{defi}[Color alternation $\ca$]
	Let $\Gamma$ and $\Delta$ be sets of formulas and $t$ be a term.

	\medskip

	\noindent
	$\ca(t) \defeq \ca_\bot(t)$
	\medskip

	\noindent
	$
	\ca_\Phi(t) \defeq 
	\begin{cases}
		0 & \text{$t$ is a variable} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$t = f(t_1, \dots, t_n)$ is grey} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \parbox[t]{0.4\textwidth}{$t = f(t_1, \dots, t_n)$ is of color $\Phi$} \\
		1 + \max(\ca_\Psi(t_1), \dots, \ca_\Psi(t_n)) & \parbox[t]{0.38\textwidth}{$t = f(t_1, \dots, t_n)$ is of color $\Psi$, $\Phi \neq \Psi$} \\
	\end{cases}
	$
\end{defi}


\begin{defi}[Quantifier alternation $\qa$]
	Let $A$ be a formula.\nopagebreak
	\medskip

	\noindent
	$\qa(A) \defeq \qa_\bot(A)$
	\nopagebreak
	\medskip

	\noindent
	$
	\qa_Q(A) \defeq 
	\begin{cases}
		0 & \text{$A$ is an atom} \\
		\qa_Q(B) & \text{$A \equiv \lnot B$} \\
		\max(\parbox[t]{0.2\textwidth}{$\qa_Q(B),$\newline$ \qa_Q(C))$} & \text{$A \equiv B \circ C$, $\circ \in \{\land, \lor, \limpl\}$} \\
		\qa_Q(B) & \text{$A \equiv Q' B$, $Q = Q'$} \\
		1+\qa_{Q'}(B) & \text{$A \equiv Q' B$, $Q \neq Q'$}  \\
	\end{cases}
	$
	\nopagebreak

	\qedhere
\end{defi}
Note that this definition of quantifier alternations handles formulas in prenex and non-prenex forms.

\begin{defi}
	We define $\PIstepnosigma$ to coincide with $\PIstep$ but without applying the substitution $\sigma$ in each of the cases.
	Analogously, if $C \equiv D\sigma$, we use $C\nosigma$ to denote $D$.
\end{defi}
Hence $\PIstepnosigma(\cdot) \sigma = \PIstep(\cdot)$.


\section{Occurrence of crucial terms in the interpolant}

\begin{defi}[$\PI^*$]
	$\PI^*$ is defined as $\PI$ with the difference that in $\PI^*$, all literals are considered to be grey.
\end{defi}

Hence $\PIinit^*$ coincides with $\PIinit$.
$\PIstep^*$ coincides with $\PIstep$ in case of factorisation and paramodulation inferences.
For resolution inferences, the first two cases in the definition of $\PIstep$ do not occur for $\PIstep^*$.

$\PI^*$ enjoys the convenient property that it absorbs every literal which occurs some clause:

\begin{prop}
	For every literal which occurs in a clause of a resolution refutation $\pi$, a respective successor occurs in $\PI^*(\pi)$.
\end{prop}
\begin{proof}
	By structural induction.
\end{proof}

\begin{lemma}
	\label{lemma:grey_lits_of_pi_star_in_pi}
	For every clause $C$ of a resolution refutation,
	every grey literal, which occurs in $\PI^*(C)$, also occurs in $\PI(C)$.
\end{lemma}
\begin{proof}
	Note that $\PIinit$ and $\PIinit^*$ coincide and $\PIstep$ and $\PIstep^*$ only differ for resolution inferences.
	But more specifically, they only differ on resolution inferences, where the resolved literal is colored. However here, no grey literals are lost.
\end{proof}

Note that in $\PI^*$, we can conveniently reason about the occurrence of terms as no terms are lost throughout the extraction.
However Lemma~\ref{ref:grey_lits_of_pi_star_in_pi} allows us to transfer results about grey literals to $\PI$.
We can also give similar results about general literals and equalities occurring in the resolution refutation:

\begin{lemma}
	\label{lemma:grey_lits_all_in_PI}
	If there is a grey literal $\lambda$ in a clause $C$ of a resolution refutation $\pi$,
	then a successor of $\lambda$ occurs in $\PI(\pi)$.
\end{lemma}
\begin{proof}
	Immediate by the definition of $\PI$.
\end{proof}

\begin{lemma}
	\label{lemma:equalities_all_in_PI}
	For every equality $s=t$ of a clause in a resolution refutation $\pi$,
	a successor of $s=t$ occurs in $\PI(\pi)$.
\end{lemma}
\begin{proof}
	Equalities in clauses are only removed by means of paramodulation and as $\pi$ derives the empty clause, all equalities are removed eventually.
	For any paramodulation inference $\inference$, $\PIstep(\inference, I_1, I_2)$ contains $s=t$.
\end{proof}


We now make some considerations in the form of four lemmata about the construction of terms of certain shapes in the context of interpolant extraction.
In the following, we abbreviate $\PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor C\nosigma$ by $\inv$.

\begin{lemma}
	\label{lemma:var_grey_col_lit}
	Let $\inference$ be a resolution or factorisation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{14_1}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item
			\label{14_5}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{14_4}
			The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

		\item 
			\label{14_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\inv\sigmazmi$ grey in a $\Phi$-literal as well as grey in a $\Psi$-literal.
				\end{itemize}
			}

		\item 
			\label{14_3}
			There is a variable $v$ such that
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in $\inv\sigmazmi$
						either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
						or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.
				\end{itemize}
			}

	\end{enumerate}
\end{lemma}
\begin{proof}
	We consider the unification process, and particularly the different cases which lead to the variable $u$ in a grey position in a $\Phi$-literal in $\inv\sigmazi$:
	\begin{itemize}
		\item
			There already is a $\Phi$-literal in $\inv\sigmazmi$ which contains $u$ at a grey position and $\sigma_i$ does not change this. Then clearly \ref{14_1} is the case.

		\item
			Otherwise there must be a $\Phi$-literal in $\inv\sigmazmi$, which contains a variable $v$ at a grey position such that $u$ occurs grey in $v\sigma_i$.
			Hence in the resolved or factorised literals $\lambda$ and $\lambda'$, there is a position $p$ such that w.l.o.g.\ $\lambda\at{p} = v$ and $\lambda'\at{p}$ contains a grey occurrence of $u$, and $\lambda$ and $\lambda$ coincide along the path to $p$.

			Note that $\lambda$ and $\lambda'$ are contained in $\inv$ as all literals are added to the interpolant since the definition of $\inv$ is based on $\PI^*$.

			We distinguish based properties of the position $p$:

			\begin{itemize}
				\item
					Suppose that $p$ is contained in a single-colored $\Phi$-term.
					Then $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$ and \ref{14_5} is the case.

					% OLD AND WRONG: Then $v$ occurs grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term, which suffices for \ref{14_3} as $u$ occurs grey in $v\sigma_i$.

					%\wrong{we only know that $v$ is contained in a grey position in $\chi\sigmazmi$ in a $\Phi$-literal (as $u$ ends up there, and now we also know that it's in a s.c.\ $\Phi$-term}

				\item 
					Suppose that $p$ is contained in a single-colored $\Psi$-term.
					Then $u$ occurs grey in a $\Phi$-literal as well in a single-colored $\Psi$-term, which implies \ref{14_3}.

				\item
					Otherwise $p$ is a grey position.
					We distinguish further:

					\begin{itemize}
						\item Suppose that the resolved or factorised literal is $\Phi$-colored.
							Then $u$ occurs grey in a $\Phi$-literal and we have established item \ref{14_3}.

						\item Suppose that the resolved or factorised literal is $\Psi$-colored.
							Then the variable $v$ occurs grey in a $\Phi$-literal as well as grey in a $\Psi$-literal, hence \ref{14_2} is the case.

							Otherwise the resolved or factorised literal is grey and $u$ occurs grey in a grey literal, which is sufficient for \ref{14_4}.
							\qedhere
					\end{itemize}

			\end{itemize}

	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:var_in_sc_term}
	Let $\inference$ be a resolution or factorisation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazi$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{15_3}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item
			\label{15_1}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{15_5}
			The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

		\item
			\label{15_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term in $\inv\sigmazmi$.
				\end{itemize}
			}


		\item
			\label{15_4}
			There is a variable $v$ such that 

			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in $\inv\sigmazmi$
						grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term.
				\end{itemize}
			}


	\end{enumerate}
\end{lemma}
\begin{proof}
	We consider the different cases of the unification process which lead to the variable $u$ in a single-colored $\Phi$-term in $\inv\sigmazi$:

	\begin{itemize}
		\item There is a single-colored $\Phi$-term in $\inv\sigmazmi$ which contains $u$ such that $\sigma_i$ does not change this.
			Then \ref{15_1} is the case.


		\item Suppose that there is a single-colored $\Phi$-term in $\inv\sigmazmi$ which contains a variable $v$ such that $u$ occurs grey in $v\sigma_i$.

			Hence in the resolved or factorised literals $\lambda$ and $\lambda'$ (which are both contained in $\inv$), there is a position $p$ such that w.l.o.g.\ $\lambda\at{p} = v$ and $\lambda'\at{p}$ contains a grey occurrence of $u$, and $\lambda$ and $\lambda'$ coincide along $p$.
			We distinguish based properties of the position $p$:

			\begin{itemize}
				\item Suppose that $p$ is contained in a single-colored $\Phi$-term.
					Then $u$ is contained in a single-colored $\Phi$-term in $\inv\sigmazmi$ and \ref{15_1} holds.

				\item Suppose that $p$ is contained in a single-colored $\Psi$-term.
					As then $v$ is contained in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term, \ref{15_2} is the case.

				\item Suppose that $p$ is a grey position.
					We distinguish further:

					\begin{itemize}
						\item Suppose that the resolved or factorised literal is $\Phi$-colored.
							Then $u$ occurs grey in a $\Phi$-literal, which suffices for \ref{15_3}. 

						\item Suppose that the resolved or factorised literal is $\Psi$-colored.
							Then the variable $v$ occurs in a single-colored $\Phi$-term as well as grey in a $\Psi$-literal, which implies \ref{15_4}.

						\item
							Otherwise the resolved or factorised literal is grey. 
							But then $u$ occurs grey in a grey literal and we have established item \ref{15_5}.
					\end{itemize}


			\end{itemize}
		\item Otherwise there is a variable $w$ which occurs in $\inv\sigmazmi$ such that $u$ occurs in a single-colored $\Phi$-term in $w\sigma_i$.
			This can only be the case if $w\sigma$ already occurs in $\inv\sigmazmi$, which implies that \ref{15_1} is the case.
			\qedhere
	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:var_grey_col_lit_paramod}
	Let $\inference$ be a paramodulation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{16_1}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item
			\label{16_5}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{16_6}
			The variable $u$ occurs grey in an equality in $\inv\sigmazmi$
			or 
			some variable $v$ occurs grey in an equality in $\inv\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.


			\NB{not subsumed by \ref{16_1}}


			%\item
			%	\label{16_4}
			%	The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

			%\item 
			%	\label{16_2}
			%	There is a variable $v$ such that 
			%	{
			%		\renewcommand{\labelitemi}{\textendash}
			%		\begin{itemize}
			%			\item $u$ occurs grey in $v\sigma_i$ and
			%			\item $v$ occurs in $\inv\sigmazmi$ grey in a $\Phi$-literal as well as grey in a $\Psi$-literal.
			%		\end{itemize}
			%	}

		\item 
			\label{16_3}
			There is a variable $v$ such that
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in $\inv\sigmazmi$
						either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
						or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.
				\end{itemize}
			}


	\end{enumerate}
\end{lemma}
\begin{proof}
	Consider paramodulation: $s=t \lor D$ and $E\occatp{r}$ create $C: (D\lor E\occatp{t})\sigma$ where $\sigma = \mgu(s, r)$.

	A grey occurrence of variable $u$ can be created in $C$ by 2 means:
	either $t$ contains a grey variable and $p$ is a grey position or $\sigma$ introduces a grey occurrence of a variable in a grey position

	% this reads somewhat odd:
	% As we have the induction hypothesis for the clauses used in the derivation, we know that the statement holds for $\inv$ by the same arguments as given in the proof of Lemma~\ref{lemma:var_grey_col_lit} but for $\PIstep$ in the case of paramodulation inferences.

	Let $u$ be a variable in a grey position in a $\Phi$-literal in $\chi\sigmazi$.
	We consider the cases which lead to this situation:


	\begin{itemize}

		\item The variable $u$ is present in a $\Phi$-literal in $\chi\sigmazmi$. Then clearly \ref{16_1} is the case.

		\item Suppose that $t$ contains a grey occurrence of $u$ and $p$ is a grey position in a $\Phi$-literal.
			Then $u$ occurs grey in an equality in $\inv\sigmazmi$ and \ref{16_6} is the case.

		\item Suppose that $\sigma_i$ introduces a grey occurrence of $u$ in a $\Phi$-literal (but not in $p$\footnote{not sure if this remark is really useful}).
			Then there exists a variable $v$ which occurs grey in a $\Phi$-literal in $\chi\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.
			By that, we can derive that there exists a position $q$ in $s$ and $r$ respectively such that 
			\circled{1} $s\atq = v$ and $r\atq$ contains $u$ grey OR 
			\circled{2}
			$r\atq = v$ and $s\atq$ contains $u$ grey. Furthermore, $s$ and $r$ agree on the path to $q$

			We distinguish:


			\begin{itemize}
				\item Suppose that $q$ is contained in a single-colored $\Phi$-term.

					Then $u$ is contained in a single-colored $\Phi$-term in $\chi\sigmazmi$ which establishes \ref{16_5}.(\circled{1} + \circled{2}).

					($r$ might still be contained in other colored terms, but $u$ remains in a single-colored $\Phi$-term.

				\item Suppose that $q$ is contained in a single-colored $\Psi$-term.
					Then in $\inv\sigmazmi$, $v$ occurs grey in a $\Phi$-literal and in a s.c.\ $\Psi$-term and $v\sigma_i$ contains $u$ grey, thus establishing \ref{16_3}.


				\item Suppose that $q$ is a grey position.

					NOTE: $r$ might be in a colored term.

					In case \circled{2}, 
					$u$ occurs at in a grey position in an equality in $\inv\sigmazmi$, which shows that \ref{16_6} is the case.

					In case \circled{1}, 
					$v$ occurs at in a grey position in an equality in $\inv\sigmazmi$ and $v\sigma_i$ contains $u$ grey, which also that \ref{16_6} is the case.
					\qedhere



			\end{itemize}

	\end{itemize}

\end{proof}


\begin{lemma}
	\label{lemma:var_in_sc_term_paramod}
	Let $\inference$ be a paramodulation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazi$.

	Then at least one of the following statements holds:
	\begin{enumerate}
			% would not hurt but apparently not needed
			%\item
			%\label{17_1}
			%The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item
			\label{17_5}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{17_6}
			The variable $u$ occurs grey in an equality in $\inv\sigmazmi$
			or 
			some variable $v$ occurs grey in an equality in $\inv\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.



			%	\item
			%		\label{17_6}
			%		The variable $u$ occurs in a single-colored $\Phi$-term an equality in $\inv\sigmazmi$.
			%		\NB{indeed subsumed by \ref{17_5}}


			% would not hurt but apparently not needed
			%\item 
			%	\label{17_3}
			%	There is a variable $v$ such that
			%	{
			%		\renewcommand{\labelitemi}{\textendash}
			%		\begin{itemize}
			%			\item $u$ occurs grey in $v\sigma_i$ and
			%			\item
			%				$v$ occurs in $\inv\sigmazmi$
			%				either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
			%				or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.
			%		\end{itemize}
			%	}

		\item
			\label{17_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term in $\inv\sigmazmi$.
				\end{itemize}
			}


	\end{enumerate}

\end{lemma}
\begin{proof}
	Let $u$ be a variable in a in single-colored $\Phi$-term in $\inv\sigmazi$. 
	We consider the cases which lead to this:
	\begin{itemize}
		\item The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$ and $\sigma_i$ does not change this.
			Then \ref{17_5} is the case.

		\item
			Suppose that $t$ contains an occurrence of $u$ a single-colored $\Phi$-term in $\inv\sigmazmi$.
			Then \ref{17_5} is the case.

			\NB{the single-colored $\Phi$-term which contains $u$ occurs in an equality, but this is not relevant, i.e.\ we do not need a special equality case here like in the other lemma.}

		\item
			Suppose that $\sigma_i$ introduces a grey occurrence of $u$ in a single-colored $\Phi$-term.
			Then there exists a variable $v$ which occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.

			Hence in $s$ and $r$, there exists a position $q$ such that 
			either $s\atq$ or $r\atq$ is $v$ and the respective other subterm contains $u$ grey. 
			As $s$ and $r$ are unifiable, they agree on the path up to $q$.

			We distinguish:
			\begin{itemize}
				\item
					Suppose that $q$ is contained in a single-colored $\Phi$-term.
					Then $u$ is contained in a single-colored $\Phi$-term in $\inv\sigmazmi$ and \ref{17_5} is the case.

				\item
					Suppose that $q$ is contained in a single-colored $\Psi$-term.
					Then $v$ occurs in $\inv\sigmazmi$ in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term and $u$ occurs grey in $v\sigma_i$. Hence \ref{17_2} holds.

				\item 
					Suppose that $q$ is a grey position.
					Then $s\atq$ occurs grey in an equality.
					Hence either $v$ or $u$ occur grey in an equality in $\inv\sigmazmi$.
					Both of these cases satisfy \ref{17_6}.


			\end{itemize}


		\item 
			Suppose that a single-colored $\Phi$-term containing $u$ is contained in $\ran(\sigma_i)$ and let $\dom(\sigma_i) = \{v\}$.
			Then $v$ is unified with a term containing a single-colored $\Phi$-term containing $u$, and $v\sigma_i$ occurs in $\inv\sigmazmi$. This implies that \ref{17_5} is the case.
			\qedhere


	\end{itemize}
\end{proof}

The preceding lemmata allow us to formulate a result which acts as the core machinery for the proof of existence of terms in grey literals or equalities. We first give it for $\PI^*$ but then generalise it to $\PI$.

\begin{lemma}
	\label{lemma:col_change_and_grey_in_col_lit_star}
	Let $C$ be a clause in the resolution refutation $\pi$ of $\Gamma \cup \Delta$
	and $u$ be a variable which occurs in $\PI^*(C)\lor C$ in some literal in a single-colored $\Phi$-term or grey in a $\Phi$-literal.

	Suppose that $u$ also occurs in $\PI^*(C) \lor C$ in some literal in a single-colored $\Psi$-term or grey in a $\Psi$-literal.

	Then $u$ occurs grey in a grey literal or an equality.
\end{lemma}
Note that $\Phi$ and $\Psi$ are to be read as any pair of distinct colors, i.e.\ $\Gamma$ and $\Delta$ as well as $\Delta$ and $\Gamma$.
\begin{proof}
	We proceed by induction over $\pi$ and $\sigma$. 

	Note that initially, every pair of clauses is variable-disjoint and all symbols of a clause are either all grey or $\Phi$-colored or all grey or $\Psi$-colored, hence the lemma is vacuously true.

	For the induction step,
	we assume that the property holds for $\PI^*(C_i) \lor C_i$, $1\varleq i \varleq n$, where $C_1, \dots, C_n$ are the clauses used in a resolution or factorisation inference $\inference$.
	Note that then, the property also holds for $\inv$, i.e.\ for $\PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor C\nosigma$
	as it contains all the literals present in $\PI^*(C_i) \lor C_i$ for any $i$ (this is evident by the definition of $\PIstepstarnosigma$), and as clauses are pairwise variable-disjoint, the lemma condition can not become true for a variable for which it was not true in $\PI^*(C_i)\lor C$ for some $i$.


	Suppose that $u$ occurs in $\chi\sigmazi$ in a single-colored $\Phi$-term or grey in a $\Phi$-literal and 
	that $u$ also occurs in $\chi\sigmazi$ in a single-colored $\Psi$-term or grey in a $\Psi$-literal.

	Then we can deduce by the Lemmata~\ref{lemma:var_grey_col_lit}, \ref{lemma:var_in_sc_term}, \ref{lemma:var_grey_col_lit_paramod} and \ref{lemma:var_in_sc_term_paramod} that at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{oozoh7Oh1}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item
			\label{oozoh7Oh5}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{oozoh7Oh4}
			The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

		\item 
			\label{oozoh7Oh2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\inv\sigmazmi$ grey in a $\Phi$-literal as well as grey in a $\Psi$-literal.
				\end{itemize}
			}

		\item
			\label{oozoh7Oh6}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$ and 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term in $\inv\sigmazmi$.
				\end{itemize}
			}


		\item 
			\label{oozoh7Oh3}
			There is a variable $v$ such that
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item
						$v$ occurs in $\inv\sigmazmi$
						either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
						or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.
				\end{itemize}
			}


		\item
			\label{oozoh7Oh7}
			The variable $u$ occurs grey in an equality in $\inv\sigmazmi$
			or 
			some variable $v$ occurs grey in an equality in $\inv\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.

	\end{enumerate}

	\newcommand{\othercase}{$^\triangle$}

	By the same lemmata, we get the same set of statements where $\Phi$ and $\Psi$ are interchanged. We refer to them by the respective number followed by \othercase.

	Suppose that \ref{oozoh7Oh4} is not the case as otherwise we are done since $\sigma_i$ is trivial on $u$ as $u$ occurs in $\inv\sigmazi$.
	Furthermore, there are a number of cases which give the result by the induction hypothesis:
	For the cases \ref{oozoh7Oh2}, \ref{oozoh7Oh6} and \ref{oozoh7Oh3} we can infer that by the induction hypothesis, there is a grey occurrence of the variable $v$ in a grey literal in $\inv\sigmazmi$, and as $u$ occurs grey in $v\sigma_i$, there is a grey occurrence of $u$ in a grey literal in $\inv\sigmazi$.

	If \ref{oozoh7Oh7} or \ref{oozoh7Oh7}\othercase apply, then clearly $u$ occurs grey in an equality in $\inv\sigmazi$ and we are done.

	It remains to show that the lemma holds true in case the statements \ref{oozoh7Oh1} or \ref{oozoh7Oh5} as well as \ref{oozoh7Oh1}\othercase or \ref{oozoh7Oh5}\othercase hold.
	But note that in any combination of \ref{oozoh7Oh1} or \ref{oozoh7Oh5} and \ref{oozoh7Oh1}\othercase or \ref{oozoh7Oh5}\othercase in effect yields a situation under which the induction hypothesis again is applicable.
	Hence we may infer that $u$ occurs grey in a grey literal in $\inv\sigmazmi$ and since $\sigma_i$ is trivial $u$ as shown above, $u$ occurs grey in a grey literal in $\inv\sigmazi$.
\end{proof}

\begin{lemma}
	\label{lemma:col_change_and_grey_in_col_lit}
	Same as \ref{lemma:col_change_and_grey_in_col_lit_star} with $\PI$ in place of $\PI^*$.
\end{lemma}
\begin{proof}
	First note that $\PI$ and $\PI^*$ do not differ with respect to equalities. Therefore we only concern ourselfs with grey occurrences of variables in grey literals.

	As $\PI(C)$ for any clause $C$ is comprised of a subset of the literals of $\PI^*(C)$, the lemma prerequesites hold true only for variables in $\PI(C)$ for which they also hold true in $\PI^*(C)$.
	As by Lemma~\ref{lemma:col_change_and_grey_in_col_lit_star} the lemma holds for $\PI^*(C)$, respective grey literals with grey occurrences of the variables in question exist in $\PI^*(C)$.
	But by Lemma~\ref{lemma:grey_lits_of_pi_star_in_pi}, these literals also occur in $\PI(C)$.
\end{proof}


\section{Lifting of crucial terms leads to quantifier alternations}

\begin{lemma}
	\label{lemma:subterm_in_grey_lit}
	If ${\PI(C) \lor C}$ contains a maximal colored occurrence of a $\Phi$-term $t\occ{s}$ containing $\Psi$-term $s$, then 
	$s$ occurs grey in a grey literal or an equality in $\PI(C) \lor C$.
\end{lemma}
\begin{proof}
	Note that it suffices to show that at the step where $s$ is introduced as subterm of $t\occ{s}$, $s$ occurs grey in $\PI(C) \lor C$ as any later modification by substitution is applied to both occurrences $s$, so they stay equal throughout the remaining derivation.

	We perform an induction over $\pi$ and $\sigma$. 
	For the base case, the lemma is vacuously true as all original clauses contain only symbols of one color.

	\largered{  GO THROUGH THIS AGAIN AND CONSIDER PARAMODULATION }
	For the induction step,
	Step:
	Resolution or factorisation inference $\inference$, $\mgu(\inference) = \sigma = \sigma_1\cdots\sigma_n$ 
	The term $t\occ{s}$ is created by one of the following two ways: 

	%(we abbreviate 
	%$(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma$ by $F$.)
	\begin{itemize}
		\item
			A variable $u$ occurs in $\inv\sigmazmi$ such that $u\sigma_i = t\occ{s}$.

			Then $u$ occurs in a resolved or factorised literal $\lambda\sigmazmi$ at $\bhat u$ such that at the other resolved or factorised literal $\lambda'\sigmaz{i-1}$, $\lambda'\sigmazmi\at{\bhat u} = t\occ{s}$.
			Then the condition is present at $\inv\sigmazmi$ and we get the result by the induction hypothesis.

		\item 
			Note that we only consider maximal colored terms.

			\todo{are probably not same $t$ and $s$ as in lemma statement, which isn't technically wrong but confusing}
			Let $t\occ{u}$ be a maximal colored $\Phi$-term in $\inv\sigmazmi$ such that in the tree-representation of $t\occ{u}$, the path from the root to $u$ does not contain a node labelled with a $\Psi$-symbol, and $u\sigma_i$ contains a grey occurrence of $s$.


			Suppose that $u$ occurs grey in a grey literal in $\inv\sigmazmi$.
			Then $s$ occurs grey in a grey literal in $\inv\sigmazi$ as $\sigma_i$ does not affect $u$ since $u$ occurs in $\inv\sigmazi$ and we are done.

			If $u$ occurs grey in a $\Psi$-literal or
			if $u$ occurs in a single-colored $\Psi$-term in $\inv\sigmazmi$, then by Lemma~\ref{lemma:col_change_and_grey_in_col_lit}, $u$ also occurs grey in a grey literal or an equality in $\inv\sigmazmi$ and $s$ hence occurs grey in a grey literal or an equality in $\inv\sigmazi$. 

			Now suppose that $u$ does not occur grey in a grey literal or an equality in $\inv\sigmazmi$ as otherwise clearly we are done.

			Hence as all other cases are excluded, $u$ can only occur in $\inv\sigmazmi$ in a single-colored $\Phi$-term or grey in a $\Phi$-colored literal.
			But then, 
			since $u\sigma_i$ contains a grey occurrence of $s$, there is a position $p$ in the two resolved or factorised literals $\lambda$ and $\lambda'$ such that $\lambda\at{p} = u$ and $\lambda'\at{p}$ contains a grey occurrence of $s$.
			Furthermore, the prefix along the path to $p$ is the same in both $\lambda$ and $\lambda'$.
			As $u$ only occurs in single-colored $\Phi$-terms, $\lambda'\at{p}$ does so as well, so $s$ is contained in a single-colored $\Phi$-term in $\inv\sigmazmi$.
			Since $s$ is a $\Psi$-term, by the induction hypothesis, $s$ occurs grey in a grey literal in $\inv\sigmazmi$ and hence also in $\inv\sigma_i$.
			\qedhere
	\end{itemize}

\end{proof}

We present an example which illustrates that the occurrence of a term with $n$ color alternations in $\PI(C) \lor C$ for a clause $C$ can lead to an interpolant with $n-1$ quantifier alternations (but no less as Proposition~\ref{prop:color_alt_eq_quant_alt} shows).
\begin{exa}
	Let $\Gamma = \{ \lnot P(a) \}$ and $\Delta = \{ P(x) \lor Q(f(x)), \lnot Q(y) \}$.
	Consider the following refutation of $\Gamma \cup \Delta$:
	\begin{prooftree}
		\AxiomCm{ \lnot P(a) \mid \bot }
		\AxiomCm{ P(x) \lor Q(f(x)) \mid \top }

		\RightLabelm{\resrule{\resruleres}{x\mapsto a}}
		\BinaryInfCm{ Q(f(a)) \mid \lnot P(a) }

		\AxiomCm{ \lnot Q(y) \mid \top }
		\RightLabelm{\resrule{\resruleres}{y\mapsto f(a)}}
		\BinaryInfCm{ \square \mid \lnot P(a) }
	\end{prooftree}

	In this example, Theorem~\ref{thm:two_phases} yields the interpolant $I \equiv \exists y_a \lnot P(y_a)$ with $\qa(I) =\nolinebreak 1$.
	The existence of the term $f(a)$ with $\ca(f(a)) = 2$ in a clause of the refutation implies that $\qa(I) \vargeq 1$.
\end{exa}
	



\begin{lemma}
	\label{lemma:col_alt_in_grey_lit_then_quant_alt}
	If a term with $n$ color alternations occurs in a grey literal or an equality $\PI(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n$ quantifier alternations.
\end{lemma}
\begin{proof}
	We perform an induction on $n$
	and show the strenghtening that
	the quantification of the lifting variable corresponding to a term with $n$ color alternations is required to be in the scope of the quantification of $n-1$ alternating quantifiers.

	For $n=0$, no colored terms occur in $I$ and hence by construction no quantifiers
	and for $n=1$, there are only single-colored terms.

	Suppose that the statement holds for $n-1$ for $n>1$ and that a term $t$ with $\ca(t) = n$ occurs in $\PI(C)$.
	We assume without loss of generality that $t$ is a $\Phi$-term.
	Then $t$ contains a $\Psi$-colored term $s$ and
	by Lemma~\ref{lemma:subterm_in_grey_lit}, $s$ occurs grey in a grey literal or an equality in $\PI(C) \lor C$.
	By Lemma~\ref{lemma:grey_lits_all_in_PI} and Lemma~\ref{lemma:equalities_all_in_PI}, a successor of $s$ occurs in $\PI(\pi)$. Note that as $s$ occurs in a grey position, any successor of $s$ also occurs in a grey position.

	By the induction hypothesis, the quantification of the lifting variable for $s$ requires $n-1$ alternated quantifiers.
	As $s$ is a subterm of $t$ and $t$ is lifted, $t$ must be quantified in the scope of the quantification of $s$, and as $t$ and $s$ are of different color, their quantifier type is different. 
	Hence the quantification of the lifting variable for $t$ requires $n$ quantifier alternations.
\end{proof}

\begin{prop}
	\label{prop:color_alt_eq_quant_alt}
	If a term with $n$ color alternations occurs in $\PI(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n-1$ quantifier alternations.
\end{prop}
\begin{proof}
	By Lemma~\ref{lemma:subterm_in_grey_lit}, a term with $n-1$ color alternations occurs in a grey literal or an equality in $\PI(C) \lor C$.
	Lemma~\ref{lemma:col_alt_in_grey_lit_then_quant_alt} gives the result.
\end{proof}



\section{Monday: Paramodulation}

\subsection{Notes}
\begin{enumerate}
	\item Every equality which is used ends up in the interpolant, i.e. it's a grey literal (binary)
	\item Every equality is used eventually
\end{enumerate}
\subsection{Proof}

Extension of Lemma \ref{lemma:var_grey_col_lit}

\section{Monday prime: $\LI$}

\begin{enumerate}
	\item Agrees with $\PI$ except if lifting conditions apply.
\end{enumerate}

\begin{lemma}
	If a 
\end{lemma}



\section{directly from old proof}


\largered{this may not be correct any more w.r.t. notation ($\inv$)}

\largered{just for repetition:}
\begin{lemma}
	\label{lemma:col_change}
	Resolution or factorisation step $\inference$ from $\bar C$.

	If $u$ col-change var in $(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)\sigmazi$, then $u$ also occurs grey in that formula.
\end{lemma}
\begin{proof}
	Abbreviation: $F \equiv (\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)$

	Induction over refutation and $\sigma$; base case easy.

	Step:
	Supp color change var $u$ present in 
	$\inv\sigmazi$. (could also say introduced, then proof would be somehow different)

	Supp $u$ not grey in 
	$\inv\sigmazmi$ as otherwise done.
	As a first step, we show that if a (not necessarily color-changing) variable $v$ occurs in a single-colored $\Phi$-term $t\occ{v}$ in $\inv\sigmazi$,
	then at least one of the following holds:
	\begin{compactenum}
	\item $v$ occurs in some single-colored $\Phi$-term in $\inv\sigmazmi$ \label{var_occ_1}
	\item there is a color-changing variable $w$ in $\inv\sigmazmi$ such that $v$ occurs grey in $w\sigma_i$.  \label{var_occ_2}
	\end{compactenum}
	We consider unification process, and particularly the different cases which can introduce a variable $v$ in a single-colored term $\Phi$: Either it has been there before, it was introduced in a s.c. $\Phi$-colored term, or a s.c.\ $\Phi$-term containing the var is in $\ran(\sigma)$.
	\begin{itemize}
		\item
			Suppose a term $t'\occ{v}$ is present in $\inv\sigmazmi$ such that $t'\occ{v}\sigma_i = t\occ{v}$.
			Then \ref{var_occ_1} is the case.
		\item
			Suppose a variable $w$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$ such that $v$ occurs grey in $w\sigma_i$.
			Suppose furthermore that \ref{var_occ_1} is not the case, i.e.\ $v$ does not occur in a s.c.\ $\Phi$-term in $\inv\sigmazmi$, as otherwise we would be done.
			We show that \ref{var_occ_2} is the case.

			As $v$ occurs neither grey nor in a s.c.\ $\Phi$-term in $\inv\sigmazmi$ but occurs in $\ran(\sigma_i)$, it must occur in $\inv\sigmazmi$ and this can only be in a single-colored $\Psi$-term.

			As by assumption $v$ occurs grey in $w\sigma_i$, there must be an occurrence $\bhat w$ of $w$ in a resolved or factorised literal, say $\lambda\sigmazmi$ such that for the other resolved literal $\lambda'\sigmazmi$, $\lambda'\sigmazmi\at{\bhat w}$ is a subterm in which $v$ occurs grey.
			But as the occurrence of $v$ in $\lambda'\sigmazmi\at{\bhat w}$ must be contained in a single-colored $\Psi$-term, so is $\lambda\sigmazmi\at{\bhat w}$, hence $z$ occurs in a single-colored $\Psi$-term as well.
			Therefore \ref{var_occ_2} is the case.

		\item
			Suppose there is a variable $z$ in $\inv\sigmazmi$ such that $v$ occurs in a single-colored $\Phi$-term in $z\sigma_i$.
			Then $z\sigma_i$ occurs in $\inv\sigmazmi$, but this is a witness for~\ref{var_occ_1}.
	\end{itemize}

	Now recall that we have assumed $u$ to be a color-changing variable in $\inv\sigmazi$.
	Hence it occurs in a single-colored $\Gamma$-term as well as in a single-colored $\Delta$-term.
	By the reasoning above, this leads to two case:
	\begin{itemize}
		\item In $\inv\sigmazmi$, $u$ occurs both in some single-colored $\Gamma$-term as well as in some single-colored $\Delta$-term.
			Then we get the result by the induction hypothesis and the fact that $u\not\in\dom(\sigma_i)$ as $u$ does occur in $\inv\sigmazi$.
		\item Otherwise for some color $\Phi$, $u$ does not occur in a single-colored $\Phi$-term in $\inv\sigmazmi$.
			Then case \ref{var_occ_2} above must hold and there is some color-changing variable $w$ in $\inv\sigmazmi$ such that $u$ occurs grey in $w\sigmazi$.
			But then by the induction hypothesis, $w$ occurs grey in $\inv\sigmazmi$ and hence $u$ occurs grey in $\inv\sigmazi$.
			\qedhere
	\end{itemize}
\end{proof}


\subsection{ Proof}
\begin{itemize}
	\item Induction over $\lifdelta{\PI(C) \lor C}$ and also about $\Gamma$-terms with $\Delta$-lifting vars in that formula. Cf. \texttt{-final}

	\item \NB{now somewhat described in the proper proof below} describe proof method with $\sigmazi$: which $\PI$? 
		\begin{itemize}
			\item Factorisation:
				easy: just apply $\sigma_i$ for all $i$ to $\PI(C) \lor C$. 
				When done, a literal will be there twice and we can remove it without losing anything
			\item Resolution:
				create propositional structure first.

				Ex.: $C_1 : D \lor l$, $ C_2: \lnot l \lor E$:

				If we talk about properties for which it holds that if they hold for $\PI(C_i) \lor C_i$, $i\in\{1,2\}$, then they also hold for $ A \equiv \Big((l \land \PI(C_2)) \lor (\lnot l \land \PI(C_1))\Big) \lor C\nosigma$, then we can apply $\sigma_i$ for all $i$ to that formula.

				So if we can assume it for $A$ and show it for all $\sigma_i$, we get that it holds for $\PI(C) \lor C$.

		\end{itemize}

		Also: clauses are variable disjoint, so e.g. it's not possible that a color-changing var is created by $\PIstep$

		Also: do it like a few lemmas further down, like $(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma ) \sigmazi$
\end{itemize}


\begin{comment}
	\section{ Proof port attempt from \texttt{-final} }

	\largered{ need to show that grey occurrences are in grey literals, all grey literals end up in the interpolant! }

	conj: if a $\Delta$-term $t$ occurs in a $\Gamma$-literal in a clause $C$, then $t$ occurs in a grey literal in $\PI(C)$.

	evidence:
	\begin{itemize}
		\item situation does not occur in $\Gamma$ or $\Delta$
		\item terms are only changed by unificators
		\item $\Delta$- and $\Gamma$-terms are not unifiable, so one of the literals has to have a variable at a grey position when a $\Delta$-term enters a $\Gamma$-literal
		\item that literal has to be grey
		\item QED?
	\end{itemize}

	\begin{rlemma}
		If a $\Phi$-term $t$ occurs in a $\Psi$-literal in a clause $C$, then $t$ occurs at a grey position in $\PI(C)$.
	\end{rlemma}
	\begin{proof}
		As all grey literals of clauses involved in a refutation end up in the interpolant, it suffices to show that $t$ occurs at a grey position in a grey literal. 

		Substitutions are applied to all variables, hence we only need to consider terms $t$ which just enter a foreign colored literal.

		\mytodo{propagation 1: $\Phi$-terms vs $\Psi$-terms (in $\Psi$-literals)}

		\mytodo{propagation 2: $\Phi$-terms vs other $\Phi$-terms (in $\Psi$-literals)}

		Induction on refutation and $\sigma$; base case easy.

		Resolution or factorisation inference $\inference$. 
		Let $\lambda$ be a $\Gamma$-literal containing a variable $u$ at position $\bhat u$ such that $u\sigma_i$ contains a $\Delta$-term $t$.

		If the resolved or factorised literals are grey, they become part of $\PI(C)$ and if $t$ occurs grey there, we are done.

		\begin{itemize}
			\item Suppose the resolved literals are $\Gamma$-colored. Then IH.
			\item Suppose the resolved literals are $\Delta$-colored.
				\mytodo{}
			\item Suppose the resolved literals are grey and $t$ does not occur at a grey position in $\lambda\sigma = \lambda'\sigma$.

				\mytodo{}

		\end{itemize}


		~




	\end{proof}

	\begin{clemma}
		If a $\Phi$-term $t$ occurs in a $\Psi$-literal in a clause $C$, then $t$ occurs at a grey position in a grey literal in $\PI(C) \lor C$.
	\end{clemma}
	there has to be a variable $u$ in a $\Psi$-literal such that $u\sigma_i$ contains $t$.

	\begin{clemma}
		If a variable $u$ occurs in a $\Phi$-literal as well as in a $\Psi$-literal in a clause $C$, then $t$ also occurs at a grey position in a grey literal in $\PI(C)$.
	\end{clemma}
	\begin{proof}
		Initially not the case.

		Note that we can only resolve/factorise $\Gamma$-/$\Delta$-/grey literals with other $\Gamma$-/$\Delta$-/grey literals as clearly the predicate symbol must be the same for both literals.
		Hence if a variable occurs only in $\Gamma$- or only in $\Delta$-literals, then it can never escape these.
		Hence $u$ certainly is contained in a grey literal.

		Now suppose that $u$ only occurs colored in grey literals.
		Then it occurs in a $\Gamma$-($\Delta$-) term in the original $\Gamma$-($\Delta$-)clauses which contain it.

		As shown before $u$ must occur in some grey literal.
		Suppose it does not occur at a grey position in a grey literal as otherwise we are done.
		Then $u$ only occurs in $\Gamma$-terms in grey literals as 

		\mytodo{it seems that now we have to deal with possible $\Gamma$-terms in $\Delta$-literals and so on $\Ra$ circular reasoning}



		The situation in question arises if some variable $u$ occurs in a $\Gamma$-literal in some clause and some variable $v$ occurs in a $\Delta$-literal in some clause (possibly the same), such that in the unified literals, $u$ and $v$ both occur at the same position in the respective literals.


	\end{proof}

	\newpage
\end{comment}


\end{document}
