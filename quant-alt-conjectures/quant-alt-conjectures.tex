\documentclass[,%fontsize=11pt,%
	%landscape,
	%DIV8, % mehr text pro seite als defaultyyp
	%DIV10,
	%DIV=calc,%
	%article,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
	12pt,
	a4paper,
	oneside,% apparently, this should stay below some other parameter to have an effect
	openany,
	%]{scrartcl}
]{memoir}



\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}


%\usepackage[bitstream-charter]{mathdesign}


%\renewcommand{\familydefault}{ \sfdefault }
%\renewcommand{\rmdefault}{ppl}


%\usepackage[urw-garamond]{mathdesign}

\usepackage{lscape}
\usepackage{stackengine}
\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}


% subsections also in toc
\setcounter{tocdepth}{2}
\setsecnumdepth{subsection}


\definethms

\def\proofSkipAmount{ \vskip -0.1em }


%\usepackage{bussproof}

%\usepackage{vaucanson-g}
%\usepackage{amssymb}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
%\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}


\usepackage{amsthm}


\chapterstyle{madsen}


% define page numbering styles
\makepagestyle{numberCorner}
\makeevenfoot{numberCorner}{\thepage}{}{}
\makeoddfoot{numberCorner}{}{}{\thepage}

\makepagestyle{numberCenter}
%\makeevenfoot{numberCenter}{}{\thepage}{}
%\makeoddfoot{numberCenter}{}{\thepage}{}
%
%\makeevenhead{numberCenter}{\thechapter}{}{\thesection}
%\makeoddhead{numberCenter}{\thesection }{}{\thechapter}
\makeheadrule{numberCenter}{\textwidth}{1pt}

\makeevenhead{numberCenter}{\thepage}{}{\leftmark}
\makeoddhead{numberCenter}{\rightmark}{}{\thepage}


\makeatletter
\makepsmarks{numberCenter}{
	\def\chaptermark##1{\markboth{%
			\ifnum \value{secnumdepth} > -1
			\if@mainmatter
			\chaptername\ \thechapter\ --- %
			\fi
			\fi
	##1}{}}
	\def\sectionmark##1{\markright{%
			\ifnum \value{secnumdepth} > 0
			\thesection. \ %
			\fi
	##1}}
}
\makeatother
\newcommand{\mysetpagestyle}{
	%\pagestyle{numberCorner}
	\pagestyle{numberCenter}
}
\mysetpagestyle





\usepackage{refcheck}

%\settypeblocksize{0.67\stockheight}{0.67\stockwidth}{*}
%\setlrmargins{*}{*}{1.2}
%\setulmargins{*}{*}{1.4}
%\checkandfixthelayout[nearest]

\counterwithout{section}{chapter}



\newcommand{\inv}{\ensuremath{\chi}}

\begin{document}

%\chapter{ Number of quantifier alternations in Huang and nested }

\section{ Outline }

Goal: try proof Huang and nested equal.

Method: proof for both:

\begin{cprop}
	Let $I$ be an interpolant created by \$algorithm.
	If $I$ contains a term $t$ such that $t$ has $n$ color changes, then $I$ has at least $n$ quantifier alternations.
\end{cprop}

\subsection{generally keep in mind}

\begin{itemize}
	\item Need to define all new terms here: color-changing, single-color, $\Phi$-literal, substitutions from $0$ to $n$
		\begin{itemize}
			\item essentially same position: path from one position to other only contains grey symbol (this def allows for identical position as well)
		\end{itemize}
	\item also note: literal is sometimes used for negated or not negated predicate with terms but in regular formulas with arbitrary connectives
\end{itemize}

\section{ Preliminaries }

Quantifier alternations in $I$ usually assumes the quantifier-alternation-minimizing arrangement of quantifiers in $I$ 

\begin{defi}[Color alternation $\ca$]
	Colors $\Gamma$ and $\Delta$, term $t$:

	$\ca(t) \defeq \ca_\bot(t)$

	Let $t = f(t_1, \dots, t_n)$ for constant, function and variable symbols (syntax abuse):

	$\ca_\Phi(t) \defeq 
	\begin{cases}
		\max\footnotemark(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$f$ is grey} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$f$ is of color $\Phi$} \\
		1 + \max(\ca_\Psi(t_1), \dots, \ca_\Psi(t_n)) & \text{$f$ is of color $\Psi$, $\Phi \neq \Psi$} \\
	\end{cases}
	$
	\footnotetext{We assume that the maximum of an empty list of arguments is $0$.}
\end{defi}

\begin{defi}
	$\PIstepnosigma$ is defined just like $\PIstep$ but without applying any substitution.
\end{defi}
Hence $\PIstepnosigma(\cdot) \sigma = \PIstep(\cdot)$.
$C\nosigma$ is somehow the same, i.e.\ if $C = D\sigma$, then $C\nosigma = D$ where $\sigma$ is derived from the context.

\section{ Random thoughts }

\begin{itemize}
	\item Quantifiers are introduced for lifting variables which actually occur in the interpolant
	\item If term $t$ with $\ca(t) = n$ enters $I$, we need subterm $s$ of $t$ with $\ca(s) = n-1$ to be in $I$ (of course colors of $t$ and $s$ are exactly opposite)
\end{itemize}


\subsection{ Proof}
\begin{itemize}
	\item Induction over $\lifdelta{\PI(C) \lor C}$ and also about $\Gamma$-terms with $\Delta$-lifting vars in that formula. Cf. \texttt{-final}

	\item \NB{now somewhat described in the proper proof below} describe proof method with $\sigmazi$: which $\PI$? 
		\begin{itemize}
			\item Factorisation:
				easy: just apply $\sigma_i$ for all $i$ to $\PI(C) \lor C$. 
				When done, a literal will be there twice and we can remove it without losing anything
			\item Resolution:
				create propositional structure first.

				Ex.: $C_1 : D \lor l$, $ C_2: \lnot l \lor E$:

				If we talk about properties for which it holds that if they hold for $\PI(C_i) \lor C_i$, $i\in\{1,2\}$, then they also hold for $ A \equiv \Big((l \land \PI(C_2)) \lor (\lnot l \land \PI(C_1))\Big) \lor C\nosigma$, then we can apply $\sigma_i$ for all $i$ to that formula.

				So if we can assume it for $A$ and show it for all $\sigma_i$, we get that it holds for $\PI(C) \lor C$.

		\end{itemize}

		Also: clauses are variable disjoint, so e.g. it's not possible that a color-changing var is created by $\PIstep$

		Also: do it like a few lemmas further down, like $(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma ) \sigmazi$
\end{itemize}


\begin{comment}
\section{ Proof port attempt from \texttt{-final} }

\largered{ need to show that grey occurrences are in grey literals, all grey literals end up in the interpolant! }

conj: if a $\Delta$-term $t$ occurs in a $\Gamma$-literal in a clause $C$, then $t$ occurs in a grey literal in $\PI(C)$.

evidence:
\begin{itemize}
	\item situation does not occur in $\Gamma$ or $\Delta$
	\item terms are only changed by unificators
	\item $\Delta$- and $\Gamma$-terms are not unifiable, so one of the literals has to have a variable at a grey position when a $\Delta$-term enters a $\Gamma$-literal
	\item that literal has to be grey
	\item QED?
\end{itemize}

\begin{rlemma}
	If a $\Phi$-term $t$ occurs in a $\Psi$-literal in a clause $C$, then $t$ occurs at a grey position in $\PI(C)$.
\end{rlemma}
\begin{proof}
	As all grey literals of clauses involved in a refutation end up in the interpolant, it suffices to show that $t$ occurs at a grey position in a grey literal. 

	Substitutions are applied to all variables, hence we only need to consider terms $t$ which just enter a foreign colored literal.

	\mytodo{propagation 1: $\Phi$-terms vs $\Psi$-terms (in $\Psi$-literals)}

	\mytodo{propagation 2: $\Phi$-terms vs other $\Phi$-terms (in $\Psi$-literals)}

	Induction on refutation and $\sigma$; base case easy.

	Resolution or factorisation inference $\inference$. 
	Let $\lambda$ be a $\Gamma$-literal containing a variable $u$ at position $\bhat u$ such that $u\sigma_i$ contains a $\Delta$-term $t$.

	If the resolved or factorised literals are grey, they become part of $\PI(C)$ and if $t$ occurs grey there, we are done.

	\begin{itemize}
		\item Suppose the resolved literals are $\Gamma$-colored. Then IH.
		\item Suppose the resolved literals are $\Delta$-colored.
			\mytodo{}
		\item Suppose the resolved literals are grey and $t$ does not occur at a grey position in $\lambda\sigma = \lambda'\sigma$.

			\mytodo{}

	\end{itemize}


	~




\end{proof}

\begin{clemma}
	If a $\Phi$-term $t$ occurs in a $\Psi$-literal in a clause $C$, then $t$ occurs at a grey position in a grey literal in $\PI(C) \lor C$.
\end{clemma}
there has to be a variable $u$ in a $\Psi$-literal such that $u\sigma_i$ contains $t$.

\begin{clemma}
	If a variable $u$ occurs in a $\Phi$-literal as well as in a $\Psi$-literal in a clause $C$, then $t$ also occurs at a grey position in a grey literal in $\PI(C)$.
\end{clemma}
\begin{proof}
	Initially not the case.

	Note that we can only resolve/factorise $\Gamma$-/$\Delta$-/grey literals with other $\Gamma$-/$\Delta$-/grey literals as clearly the predicate symbol must be the same for both literals.
	Hence if a variable occurs only in $\Gamma$- or only in $\Delta$-literals, then it can never escape these.
	Hence $u$ certainly is contained in a grey literal.

	Now suppose that $u$ only occurs colored in grey literals.
	Then it occurs in a $\Gamma$-($\Delta$-) term in the original $\Gamma$-($\Delta$-)clauses which contain it.

	As shown before $u$ must occur in some grey literal.
	Suppose it does not occur at a grey position in a grey literal as otherwise we are done.
	Then $u$ only occurs in $\Gamma$-terms in grey literals as 

	\mytodo{it seems that now we have to deal with possible $\Gamma$-terms in $\Delta$-literals and so on $\Ra$ circular reasoning}



	The situation in question arises if some variable $u$ occurs in a $\Gamma$-literal in some clause and some variable $v$ occurs in a $\Delta$-literal in some clause (possibly the same), such that in the unified literals, $u$ and $v$ both occur at the same position in the respective literals.


\end{proof}

\newpage
\end{comment}

\section{directly from old proof}


\largered{just for repetition:}
\begin{lemma}
	\label{lemma:col_change}
	Resolution or factorisation step $\inference$ from $\bar C$.

	If $u$ col-change var in $(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)\sigmazi$, then $u$ also occurs grey in that formula.
\end{lemma}
\begin{proof}
	Abbreviation: $F \equiv (\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)$

	Induction over refutation and $\sigma$; base case easy.

	Step:
	Supp color change var $u$ present in 
	$\inv\sigmazi$. (could also say introduced, then proof would be somehow different)

	Supp $u$ not grey in 
	$\inv\sigmazmi$ as otherwise done.
	As a first step, we show that if a (not necessarily color-changing) variable $v$ occurs in a single-colored $\Phi$-term $t\occ{v}$ in $\inv\sigmazi$,
	then at least one of the following holds:
	\begin{compactenum}
	\item $v$ occurs in some single-colored $\Phi$-term in $\inv\sigmazmi$ \label{var_occ_1}
	\item there is a color-changing variable $w$ in $\inv\sigmazmi$ such that $v$ occurs grey in $w\sigma_i$.  \label{var_occ_2}
	\end{compactenum}
	We consider the different cases which can introduce a variable $v$ in a single-colored term $\Phi$: Either it has been there before, it was introduced in a s.c. $\Phi$-colored term, or a s.c.\ $\Phi$-term containing the var is in $\ran(\sigma)$.
	\begin{itemize}
		\item
			Suppose a term $t'\occ{v}$ is present in $\inv\sigmazmi$ such that $t'\occ{v}\sigma_i = t\occ{v}$.
			Then \ref{var_occ_1} is the case.
		\item
			Suppose a variable $w$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$ such that $v$ occurs grey in $w\sigma_i$.
			Suppose furthermore that \ref{var_occ_1} is not the case, i.e.\ $v$ does not occur in a s.c.\ $\Phi$-term in $\inv\sigmazmi$, as otherwise we would be done.
			We show that \ref{var_occ_2} is the case.

			As $v$ occurs neither grey nor in a s.c.\ $\Phi$-term in $\inv\sigmazmi$ but occurs in $\ran(\sigma_i)$, it must occur in $\inv\sigmazmi$ and this can only be in a single-colored $\Psi$-term.

			As by assumption $v$ occurs grey in $w\sigma_i$, there must be an occurrence $\bhat w$ of $w$ in a resolved or factorised literal, say $\lambda\sigmazmi$ such that for the other resolved literal $\lambda'\sigmazmi$, $\lambda'\sigmazmi\at{\bhat w}$ is a subterm in which $v$ occurs grey.
			But as the occurrence of $v$ in $\lambda'\sigmazmi\at{\bhat w}$ must be contained in a single-colored $\Psi$-term, so is $\lambda\sigmazmi\at{\bhat w}$, hence $z$ occurs in a single-colored $\Psi$-term as well.
			Therefore \ref{var_occ_2} is the case.

		\item
			Suppose there is a variable $z$ in $\inv\sigmazmi$ such that $v$ occurs in a single-colored $\Phi$-term in $z\sigma_i$.
			Then $z\sigma_i$ occurs in $\inv\sigmazmi$, but this is a witness for~\ref{var_occ_1}.
	\end{itemize}

	Now recall that we have assumed $u$ to be a color-changing variable in $\inv\sigmazi$.
	Hence it occurs in a single-colored $\Gamma$-term as well as in a single-colored $\Delta$-term.
	By the reasoning above, this leads to two case:
	\begin{itemize}
		\item In $\inv\sigmazmi$, $u$ occurs both in some single-colored $\Gamma$-term as well as in some single-colored $\Delta$-term.
			Then we get the result by the induction hypothesis and the fact that $u\not\in\dom(\sigma_i)$ as $u$ does occur in $\inv\sigmazi$.
		\item Otherwise for some color $\Phi$, $u$ does not occur in a single-colored $\Phi$-term in $\inv\sigmazmi$.
			Then case \ref{var_occ_2} above must hold and there is some color-changing variable $w$ in $\inv\sigmazmi$ such that $u$ occurs grey in $w\sigmazi$.
			But then by the induction hypothesis, $w$ occurs grey in $\inv\sigmazmi$ and hence $u$ occurs grey in $\inv\sigmazi$.
			\qedhere
	\end{itemize}
\end{proof}

~

\clearpage
\begin{comment}
	\section{random}

	\begin{clemma}
		Supp $u$ in s.c. $\Phi$-term and that  no variable occurs grey in a grey literal.
		Then $u$ does not occur grey in a $\Psi$-literal.
	\end{clemma}
	\begin{proof}
		Holds initially.

		Supp holds for first $k$ deductions.

		Supp that then there is some $\Psi$-literal $l$ which contains $v$ at a grey position such that $v\sigma_i$ contains a grey $u$.
		Then $u$ and $v$ face each other in the res/fac literals in at stage $k-1$.
		By IH, there, $u$ does not occur grey in a $\Psi$-literal (and of course not grey in a grey literal). 

		As $v$ occurs grey in a $\Psi$-literal, by contraposition, $v$ does not occur in a s.c. $\Phi$-term.

		\begin{itemize}
			\item
				Supp res/fac lits are $\Psi$-colored.
				Then $u$ does not occur grey here.

				\mytodo{}

			\item
				Supp res/fac lits are grey.
				Then $u$ and $v$ do not occur grey here.
				\mytodo{}

			\item
				Supp res/fac lits are $\Phi$-colored.
				\mytodo{}
		\end{itemize}




	\end{proof}


	~

	\begin{clemma}
		Every variable, which does not occur grey in a grey literal either does not occur in a single-colored $\Phi$-($\Psi$)-term or does not occur grey in a $\Psi$-($\Phi$)-literal.
	\end{clemma}
	\begin{proof}
		Supp $u$ occurs grey in $\Phi$-literal.
		We show that $u$ does not occur in a s.c.\ $\Psi$-term given that it does not occur grey in a grey literal.

		Supp s.c.\ $\Psi$-term $t\occ{v}$ s.t. $v\sigma_i$ contains grey $u$\todo{basically also grey occ of $v$ with $t\occ{u}$ conceivable, but that should be IH}.
		By IH, $v$ does not occur grey in a a $\Phi$-literal (given it does not occur grey in a grey literal). 

		By IH, there is no s.c.{} $\Psi$-term which contains $u$.
		Hence $t\occ{v}$ is not directly unified with some $t\occ{u}$.

		Supp $v$ occs grey where it is unified. then $u$ occs grey there as well.
		Then it can't be a grey literal, and it can't be a $\Phi$-literal. So it is a $\Psi$-literal.

	\end{proof}

	~

	\begin{clemma}
		If a var occurs in $\Gamma$ but not grey in a grey literal, it does not occur grey in $\Delta$.
	\end{clemma}

\end{comment}


\section{Thursday}

\begin{comment}
	\begin{clemma}
		\label{last_lemma}
		Suppose a variable $u$ occurs  in $\PI(C) \lor C$ in a s.c.\ $\Phi$-term OR grey in a $\Phi$-literal.
		If $u$ occurs in $\PI(C) \lor C$ in a grey position in a $\Psi$-literal OR in s.c.\ $\Psi$-term in any literal, then it also occurs at a grey position in a grey literal in $\PI(C) \lor C$.
	\end{clemma}
	\begin{proof}
		ind step; supp $u$ as in statement ubiquitously

		Supp $\Psi$-literal with grey $v$ such that $u$ grey in $v\sigma_i$.
		Other occs of $v$:

		If $v$ also occurs in $\Phi$-term, then it occurs in a $\Phi$-term and in a grey position in a $\Psi$-literal, then by IH, it occurs grey in a grey literal in $\inv\sigmazmi$.
		By $\sigma_i$, in $\inv\sigma_i$, $u$ occurs at a grey position in a grey literal in $\PI(C) \lor C$.

		If $v$ also occurs grey in a $\Phi$-literal, then similar argument.

		done?

		~

		Supp s.c.\ $\Psi$-term contains $w$ such that $u$ grey in $w\sigma_i$.
		Supp $u$ not grey in grey literal as otw done.
		other occs of $w$:

		Supp $w$ in s.c. $\Phi$-term: then IH.

		Supp $u$ in $\Psi$-term: then IH

		Supp grey in res/fac lit:
		\begin{quote}
			Supp grey: then both occ grey in grey, done.

			Supp $\Phi$-lit: then IH on $w$

			Supp $\Psi$-: then IH on $u$
		\end{quote}

	\end{proof}

\end{comment}

\begin{comment}

	\begin{clemma}
		\ref{last_lemma} nochmal gscheid:

		Let $u$ be a variable which occurs in $\PI(C)\lor C$ in some literal in a single-colored $\Phi$-term or grey in a $\Phi$-literal.

		Suppose that $u$ also occurs in $\PI(C) \lor C$ in some literal in a single-colored $\Psi$-term or grey in a $\Psi$-literal.

		Then $u$ occurs grey in a grey literal.

	\end{clemma}
	Note that $\Phi$ and $\Psi$ are to be read as any pair of different colors, i.e.\ $\Gamma$ and $\Delta$ as well as $\Delta$ and $\Gamma$.
	\begin{proof}
		Note that initially, every pair of clauses is variable-disjoint and all symbols of a clause are either all grey or $\Phi$-colored or all grey or $\Psi$-colored, hence the lemma is vacuously true.

		Induction of $\pi$ and $\sigma$.

		Let $u$ occur in $\inv\sigmazi$ in a s.c.\ $\Phi$-term.
		\hl{Suppose $u$ also occurs in $\inv\sigmazi$ in a s.c.\ $\Phi$-term.)}
		Suppose that $u$ occurs in $\inv\sigmazi$ in a s.c.\ $\Psi$-term but not in $\inv\sigmazmi$ as otherwise we are done by the induction hypothesis \hl{($u$ in s.c.\ $\Psi$-term before)}.
		Then one of the following cases applies (positions of $v$ in res/fac lit):
		\begin{itemize}
			\item There is a s.c.\ $\Psi$-term in $\inv\sigmazmi$ containing a variable $v$ such that $u$ occurs grey in $v\sigma_i$.

				In the res/fac lits in $\lambda$ and $\lambda'$ respectively, $u$ and $v$ occur at the essentially same position.

				\begin{itemize}
					\item
						If that position is in an s.c. $\Phi$-term, then we are done by the IH on~$v$.
						\hl{$v$ col change}

					\item
						If that position is in an s.c. $\Psi$-term, then we are done by the IH on~$u$.
						\hl{$u$ col change} \NB{also: $u$ is in $\Phi$-term before}

					\item
						Hence suppose that position is grey:

						If it's in a $\Phi$-literal, then we are done by the IH on $v$. \hl{$\Phi$-lit + s.c.\ $\Psi$-term}

						If it's in a $\Psi$-literal, then we are done by the IH on $u$. \hl{$\Psi$-lit + s.c.\ $\Phi$-term} (basically somewhat of propagation of preexisting circumstances)

						Otherwise the occurrence is grey in a grey literal, which we wanted to show. \hl{?}
				\end{itemize}


			\item There is a variable $v$ in $\inv\sigmazmi$ such that $v\sigma_i$ contains a s.c.\ $\Psi$-term which contains $u$.
				Then $v\sigma_i$ occurs in $\inv\sigmazmi$ and we are done by the induction hypothesis.
				\hl{$u$ in s.c.\ $\Psi$-term before}
		\end{itemize}

		\mytodo{ formulate as other proof, this part more or less must work out }

		~

		\hl{2nd part:} 

		Let $u$ occur in $\inv\sigmazi$ in a s.c.\ $\Phi$-term.

		Supp $u$ occs grey in $\Psi$-literal in $\inv\sigmazi$.
		Supp not in $\inv\sigmazmi$ as then IH would take effect. \hl{$u$ grey in $\Psi$-lit}

		Then exists $v$ grey in $\Psi$-literal in $\inv\sigmazmi$ s.t.\ $u$ grey in $v\sigma_i$.
		Distinguish based on occurrence of $u$, $v$ pair in res/fac lit:

		\begin{itemize}
			\item supp in s.c.\ $\Psi$-term. then IH on $u$. \hl{$u$ col change}
			\item supp in s.c.\ $\Phi$-term. then IH on $v$. \hl{$v$ grey in $\Psi$-lit and in s.c.\ $\Phi$-term}
			\item supp grey.
				\begin{itemize}
					\item supp in $\Phi$-lit: then IH on $v$ \hl{$\Psi$-lit + $\Phi$-lit}
					\item supp in $\Psi$-lit: IH on $u$ \hl{$\Psi$-lit + s.c.\ $\Phi$-term}, but basically same as before
					\item supp in grey lit: done

				\end{itemize}

		\end{itemize}

		\mytodo{formulate similarly, in any case the IH or the desired statement is the case}



		~

		\hl{3rd/4th part:} 

		Let $u$ occur in $\inv\sigmazi$ in grey in a $\Phi$-lit. 
		Either it was there before, or:

		There exists a $\Phi$-lit with a variable $v$ at a grey position such that $v\sigma_i$ contains a grey $u$.
		Occurrences of position of $u$ and $v$ in res/fac lit:

		\begin{itemize}
			\item Supp in s.c.\ $\Psi$-term. Then IH on $v$. \hl{$v$ in s.c. $\Psi$-term and grey in $\Phi$-lit}
			\item Supp in s.c.\ $\Phi$-term. 
		\end{itemize}

	\end{proof}

	Reformulation sketch:

	If some var $u$ occs in $\inv\sigmazi$ in a s.c.\ $\Phi$-term, then:
	\begin{itemize}
		\item was there before
		\item exists col change var which is substituted for $u$ in $\inv\sigmazi$
		\item exists var grey in $\Phi$-lit and (usually elsewhere) in s.c. $\Psi$-term (or opposite coloring)
	\end{itemize}

	~

	\noindent
	Sublemma: If $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$, then at least one of the following statements hold:
	\begin{enumerate}
		\item $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$.
			\label{14_1}

		\item 
			\label{14_2}
			A variable $v$ occurs grey in a $\Phi$-lit and grey in a $\Psi$-lit such that $v\sigma_i$ contains a grey occ of $u$.

		\item 
			\label{14_3}
			A variable occurs grey in a $\Phi$-lit and in an s.c. $\Psi$-term, OR

			a variable occurs grey in a $\Psi$-lit and in an s.c. $\Phi$-term.

			Additionally, either this variable is $u$ or it is some variable $v$ such that $v\sigma_i$ contains a grey $u$.

		\item
			\label{14_4}
			$u$ occurs at a grey position in a grey literal.

	\end{enumerate}
	\noindent
	Subproof:
	Suppose the lemma precondition. we consider the formation cases for this:
	\begin{itemize}
		\item $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$ and this fact is not changed by $\sigma_i$.
			Then we clearly have \ref{14_1}.

		\item Some $\Phi$-literal $\lambda$ in $\inv\sigmazmi$ contains a variable $v$ at a grey position such that $v\sigma_i$ contains a grey occ of $u$. 
			We distinguish further based on the position $p$ in the literal where $v$ and $u$ face each other.

			\begin{itemize}
				\item Suppose $p$ is in a s.c.\ $\Phi$-term. Then we have \ref{14_3} on $v$.
				\item Suppose $p$ is in a s.c.\ $\Psi$-term. Then we have \ref{14_3} on $u$.
				\item Suppose the res/fac lit is $\Psi$-colored, and the position is grey. Then we have \ref{14_2} on $v$.
				\item Suppose the res/fac lit is $\Phi$-colored, and the position is grey. Then we have \ref{14_1}
				\item Suppose the res/fac lit is grey, and the position is grey. Then we have \ref{14_4}

			\end{itemize}


	\end{itemize}

\end{comment}



In the following, we abbreviate $(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma)$ by $\inv$.

\begin{lemma}
	\label{lemma:var_grey_col_lit}
	Let $\inference$ be an inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{14_1}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item 
			\label{14_2}
			Some variable $v$ occurs in $\inv\sigmazmi$ grey in a $\Phi$-literal as well as grey in a $\Psi$-literal such that $u$ occurs grey in $v\sigma_i$.

		\item 
			\label{14_3}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$\footnotemark and $v$ occurs in $\inv\sigmazmi$
			either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
			or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.
			\footnotetext{Note that this includes the case that $v=u$ and $\sigma_i$ is trivial on $u$. \mytodo{this really necessary? what about case \ref{14_1}, doesn't that one subsume this?}}

		\item
			\label{14_4}
			The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

		\item
			\label{14_5}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

	\end{enumerate}
\end{lemma}
\begin{proof}
	We consider the different cases which lead to the variable $u$ in a grey position in a $\Phi$-literal in $\inv\sigmazi$:
	\begin{itemize}
		\item
			There already is a $\Phi$-literal in $\inv\sigmazmi$ which contains $u$ at a grey position and $\sigma_i$ does not change this. Then clearly \ref{14_1} is the case.

		\item
			Otherwise there must be a $\Phi$-literal in $\inv\sigmazmi$, which contains a variable $v$ at a grey position such that $u$ occurs grey in $v\sigma_i$.
			Hence in the resolved or factorised literals $\lambda$ and $\lambda'$, there is a position $p$ such that w.l.o.g.\ $\lambda\at{p} = v$ and $\lambda'\at{p}$ contains a grey occurrence of $u$, and $\lambda$ and $\lambda$ coincide along the path to $p$.
			We distinguish based properties of the position $p$:

			\begin{itemize}
				\item
					Suppose that $p$ is contained in a single-colored $\Phi$-term.
					%Then $u$ occurs in a single-colored $\POh
					Then $v$ occurs grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term, which suffices for \ref{14_3} as $u$ occurs grey in $v\sigma_i$.
					
					\wrong{we only know that $v$ is contained in a grey position in $\chi\sigmazmi$ in a $\Phi$-literal (as $u$ ends up there, and now we also know that it's in a s.c.\ $\Phi$-term}

				\item 
					Suppose that $p$ is contained in a single-colored $\Psi$-term.
					Then $u$ occurs grey in a $\Phi$-literal as well in a single-colored $\Psi$-term, which implies \ref{14_3}.

				\item
					Otherwise $p$ is a grey position.
					We distinguish further:

					\begin{itemize}
						\item Suppose that the resolved or factorised literal is $\Phi$-colored.
							Then $u$ occurs grey in a $\Phi$-literal and we have established item \ref{14_3}.

						\item Suppose that the resolved or factorised literal is $\Psi$-colored.
							Then the variable $v$ occurs grey in a $\Phi$-literal as well as grey in a $\Psi$-literal, hence \ref{14_2} is the case.

							Otherwise the resolved or factorised literal is grey and $u$ occurs grey in a grey literal, which is sufficient for \ref{14_4}.
							\qedhere
					\end{itemize}

			\end{itemize}

	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:var_in_sc_term}
	Let $\inference$ be an inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazi$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{15_1}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{15_2}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$ and $v$ occurs in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term in $\inv\sigmazmi$.

		\item
			\label{15_4}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$ and $v$ occurs in $\inv\sigmazmi$ in a single-colored $\Phi$-term as well as at a grey position in a $\Psi$-literal.

		\item
			\label{15_3}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item
			\label{15_5}
			The variable $u$ occurs grey in a grey literal in $\inv\sigmazmi$.

	\end{enumerate}
\end{lemma}
\begin{proof}
	We consider the different cases which lead to the variable $u$ in a single-colored $\Phi$-term in $\inv\sigmazi$:

	\begin{itemize}
		\item There is a single-colored $\Phi$-term in $\inv\sigmazmi$ which contains $u$ such that $\sigma_i$ does not change this.
			Then \ref{15_1} is the case.


		\item Suppose that there is a single-colored $\Phi$-term in $\inv\sigmazmi$ which contains a variable $v$ such that $u$ occurs grey in $v\sigma_i$.

			Hence in the resolved or factorised literals $\lambda$ and $\lambda'$, there is a position $p$ such that w.l.o.g.\ $\lambda\at{p} = v$ and $\lambda'\at{p}$ contains a grey occurrence of $u$, and $\lambda$ and $\lambda$ coincide along $p$.
			We distinguish based properties of the position $p$:

			\begin{itemize}
				\item Suppose that $p$ is contained in a single-colored $\Phi$-term.
					Then $u$ is contained in a single-colored $\Phi$-term in $\inv\sigmazmi$ and item \ref{15_1} holds.

				\item Suppose that $p$ is contained in a single-colored $\Psi$-term.
					As then $v$ is contained in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term, \ref{15_2} is the case.

				\item Suppose that $p$ is a grey position.
					We distinguish further:

					\begin{itemize}
						\item Suppose that the resolved or factorised literal is $\Phi$-colored.
							Then $u$ occurs grey in a $\Phi$-literal, which suffices for \ref{15_3}. 

						\item Suppose that the resolved or factorised literal is $\Psi$-colored.
							Then the variable $v$ occurs in a single-colored $\Phi$-term as well as grey in a $\Psi$-literal, which implies \ref{15_4}.

						\item
							Otherwise the resolved or factorised literal is grey. 
							But then $u$ occurs grey in a grey literal and we have established item \ref{15_5}.
					\end{itemize}


				\item Suppose that a variable $w$ occurs in $\inv\sigmazmi$ such that $u$ occurs in a single-colored $\Phi$-term in $w\sigma_i$.
					This can only be the case if $w\sigma$ already occurs in $\inv\sigmazmi$, which implies that \ref{15_1} is the case.
					\qedhere
			\end{itemize}
	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:col_change_and_grey_in_col_lit}
	Let $C$ be a clause in the resolution refutation $\pi$ of $\Gamma \cup \Delta$
	and $u$ be a variable which occurs in $\PI(C)\lor C$ in some literal in a single-colored $\Phi$-term or grey in a $\Phi$-literal.

	Suppose that $u$ also occurs in $\PI(C) \lor C$ in some literal in a single-colored $\Psi$-term or grey in a $\Psi$-literal.

	Then $u$ occurs grey in a grey literal.
\end{lemma}
Note that $\Phi$ and $\Psi$ are to be read as any pair of different colors, i.e.\ $\Gamma$ and $\Delta$ as well as $\Delta$ and $\Gamma$.
\begin{proof}
	We proceed by induction over $\pi$ and $\sigma$. 

	Note that initially, every pair of clauses is variable-disjoint and all symbols of a clause are either all grey or $\Phi$-colored or all grey or $\Psi$-colored, hence the lemma is vacuously true.

	For the induction step,
	we assume that the property holds for $\PI(C_i) \lor C_i$, $1\varleq i \varleq n$, where $C_1, \dots, C_n$ are the clauses used in a resolution or factorisation inference $\inference$.
	Note that then, the property also holds for $\inv$, i.e.\ for $\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma$ as it contains all the grey literals present in $\PI(C_i) \lor C_i$ for any $i$ (this is evident by the definition of $\PIstepnosigma$), and as clauses are pairwise variable-disjoint, the lemma condition can not become true for a variable for which it was not true in $\PI(C_i)\lor C$ for some $i$.


	Suppose that $u$ occurs in $\chi\sigmazi$ in a single-colored $\Phi$-term or grey in a $\Phi$-literal and 
	that $u$ also occurs in $\chi\sigmazi$ in a single-colored $\Psi$-term or grey in a $\Psi$-literal.

	Then we can deduce by Lemma~\ref{lemma:var_grey_col_lit} and Lemma~\ref{lemma:var_in_sc_term} that at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{oozoh7Oh1}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item 
			\label{oozoh7Oh2}
			Some variable $v$ occurs in $\inv\sigmazmi$ grey in a $\Phi$-literal as well as grey in a $\Psi$-literal such that $u$ occurs grey in $v\sigma_i$.

		\item 
			\label{oozoh7Oh3}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$ and $v$ occurs in $\inv\sigmazmi$
			either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
			or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.

		\item
			\label{oozoh7Oh4}
			The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

		\item
			\label{oozoh7Oh5}
			The variable $u$ occurs in a single-colored $\Phi$-term in $\inv\sigmazmi$.

		\item
			\label{oozoh7Oh6}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$ and $v$ occurs in a single-colored $\Phi$-term as well as in a single-colored $\Psi$-term in $\inv\sigmazmi$.


	\end{enumerate}

	\newcommand{\othercase}{$^*$}

	By the same lemmata, we get the same set of statements where $\Phi$ and $\Psi$ are interchanged. We refer to them by the respective number followed by \othercase.

	Suppose that \ref{oozoh7Oh4} is not the case as otherwise we are done since $\sigma_i$ is trivial on $u$ as $u$ occurs in $\inv\sigmazi$.
	Furthermore, there are a number of cases which give the result by the induction hypothesis:
	For the cases \ref{oozoh7Oh2}, \ref{oozoh7Oh3} and \ref{oozoh7Oh6}, we can infer that by the induction hypothesis, there is a grey occurrence of the variable $v$ in a grey literal in $\inv\sigmazmi$, and as $u$ occurs grey in $v\sigma_i$, there is a grey occurrence of $u$ in a grey literal in $\inv\sigmazi$.

	It remains to show that the lemma holds true in case the statements \ref{oozoh7Oh1} or \ref{oozoh7Oh5} as well as \ref{oozoh7Oh1}\othercase or \ref{oozoh7Oh5}\othercase hold.
	But note that in any combination of \ref{oozoh7Oh1} or \ref{oozoh7Oh5} and \ref{oozoh7Oh1}\othercase or \ref{oozoh7Oh5}\othercase in effect yields a situation under which the induction hypothesis again is applicable.
	Hence we may infer that $u$ occurs grey in a grey literal in $\inv\sigmazmi$ and since $\sigma_i$ is trivial $u$ as shown above, $u$ occurs grey in a grey literal in $\inv\sigmazi$.
\end{proof}


\section{Friday}

\begin{lemma}
	If ${\PI(C) \lor C}$ contains a maximal colored occurrence of a $\Phi$-term $t\occ{s}$ containing $\Psi$-term $s$, then 
	$s$ occurs grey in a grey literal in $\PI(C) \lor C$.
\end{lemma}
\begin{proof}
	Note that it suffices to show that at the step where $s$ is introduced as subterm of $t\occ{s}$, $s$ occurs grey in $\PI(C) \lor C$ as any later modification by substitution is applied to both occurrences $s$, so they stay equal throughout the remaining derivation.
	\medskip

	\noindent
	Induction over $\pi$ and $\sigma$. \mytodo{ as in Lemma~\ref{lemma:col_change_and_grey_in_col_lit} }
	\medskip

	\noindent
	Base case: vacuously true.
	\medskip

	\noindent
	Step:
	Resolution or factorisation inference $\inference$, $\mgu(\inference) = \sigma = \sigma_1\cdots\sigma_n$ 
	The term $t\occ{s}$ is created by one of the following two ways: 

	(we abbreviate 
	$(\PIstepnosigma(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C\nosigma$ by $F$.)
	\begin{itemize}
		\item
			A variable $u$ occurs in $\inv\sigmazmi$ such that $u\sigma_i = t\occ{s}$.

			Then $u$ occurs in a resolved or factorised literal $\lambda\sigmazmi$ at $\bhat u$ such that at the other resolved or factorised literal $\lambda'\sigmaz{i-1}$, $\lambda'\sigmazmi\at{\bhat u} = t\occ{s}$.
			Then the condition is present at $\inv\sigmazmi$ and we get the result by the induction hypothesis.

		\item 
			Note that we only consider maximal colored terms.

			\todo{are probably not same $t$ and $s$ as in lemma statement, which isn't technically wrong but confusing}
			Let $t\occ{u}$ be a maximal colored $\Phi$-term in $\inv\sigmazmi$ such that in the tree-representation of $t\occ{u}$, the path from the root to $u$ does not contain a node labelled with a $\Psi$-symbol, and $u\sigma_i$ contains a grey occurrence of $s$.


			Suppose that $u$ occurs grey in a grey literal in $\inv\sigmazmi$.
			Then $s$ occurs grey in a grey literal in $\inv\sigmazi$ as $\sigma_i$ does not affect $u$ since $u$ occurs in $\inv\sigmazi$ and we are done.

			If $u$ occurs grey in a $\Psi$-literal or
			if $u$ occurs in a single-colored $\Psi$-term in $\inv\sigmazmi$, then by Lemma~\ref{lemma:col_change_and_grey_in_col_lit}, $u$ also occurs grey in a grey literal in $\inv\sigmazmi$ and $s$ hence occurs grey in a grey literal in $\inv\sigmazi$. 

			Now suppose that $u$ does not occur grey in a grey literal $\inv\sigmazmi$ as otherwise clearly we are done.

			Hence as all other cases are excluded, $u$ can only occur in $\inv\sigmazmi$ in a single-colored $\Phi$-term or grey in a $\Phi$-colored literal.
			But then, 
			since $u\sigma_i$ contains a grey occurrence of $s$, there is a position $p$ in the two resolved or factorised literals $\lambda$ and $\lambda'$ such that $\lambda\at{p} = u$ and $\lambda'\at{p}$ contains a grey occurrence of $s$.
			Furthermore, the prefix along the path to $p$ is the same in both $\lambda$ and $\lambda'$.
			As $u$ only occurs in single-colored $\Phi$-terms, $\lambda'\at{p}$ does so as well, so $s$ is contained in a single-colored $\Phi$-term in $\inv\sigmazmi$.
			Since $s$ is a $\Psi$-term, by the induction hypothesis, $s$ occurs grey in a grey literal in $\inv\sigmazmi$ and hence also in $\inv\sigma_i$.
			\qedhere
	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:grey_lits_all_in_PI}
	If there is a grey literal $\lambda$ in a clause $C$ of a resolution refutation $\pi$,
	then a successor of $\lambda$ occurs in $\PI(\pi)$.
\end{lemma}
\begin{proof}
	Immediate by the definition of $\PI$.
\end{proof}


\mytodo{define quantifier alternations as $\ca$, 0 == no quants, 1 == one quant, 2 is $\Pi_2$ or $\Sigma_2$}

\begin{prop}
	If a term with $n$ color alternations occurs in $\PI(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n$ quantifier alternations.
\end{prop}
\begin{proof}
	We perform an induction on $n$
	and show the strenghtening that
	the quantification of the lifting variable corresponding to a term with $n$ color alternations is required to be in the scope of the quantification of $n-1$ alternating quantifiers.
	
	For $n=0$, no colored terms occur in $I$ and hence by construction no quantifiers
	and for $n=1$, there are only single-colored terms 

	Suppose the statement holds for $n-1$ for $n>1$ and a term $t$ with $\ca(t) = n$ occurs in $\PI(C)$.
	We assume that $t$ is a $\Phi$-term.
	Then $t$ contains a $\Psi$-colored term $s$ and
	by Lemma~\ref{lemma:col_change_and_grey_in_col_lit}, $s$ occurs grey in a grey literal in $\PI(C) \lor C$.
	By Lemma~\ref{lemma:grey_lits_all_in_PI}, a successor of $s$ occurs in $\PI(\pi)$.
	By the induction hypothesis, the quantification of the lifting variable for $s$ requires $n-1$ alternated quantifiers.
	As $s$ is a subterm of $t$ and $t$ is lifted, $t$ must be quantified in the scope of the quantification of $s$, and as $t$ and $s$ are of different color, their quantifier type is different. 
	Hence the quantification of the lifting variable for $t$ requires $n$ quantifier alternations.
\end{proof}

\section{Monday: Paramodulation}

\subsection{Notes}
\begin{enumerate}
	\item Every equality which is used ends up in the interpolant, i.e. it's a grey literal (binary)
	\item Every equality is used eventually
\end{enumerate}
\subsection{Proof}

Extension of Lemma \ref{lemma:var_grey_col_lit}
	
\begin{lemma}
	\label{lemma:var_grey_col_lit_paramod}
	Let $\inference$ be a \textbf{paramodulation} inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazi$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{11_1}
			The variable $u$ occurs grey in a $\Phi$-literal in $\inv\sigmazmi$.

		\item 
			\label{11_2}
			Some variable $v$ occurs in $\inv\sigmazmi$ grey in a $\Phi$-literal as well as grey in a $\Psi$-literal such that $u$ occurs grey in $v\sigma_i$.

		\item 
			\label{11_3}
			There is a variable $v$ such that $u$ occurs grey in $v\sigma_i$\footnotemark and $v$ occurs in $\inv\sigmazmi$
			either grey in a $\Phi$-literal as well as in a single-colored $\Psi$-term in any literal, 
			or grey in a $\Psi$-literal as well as in a single-colored $\Phi$-term in any literal.

		\item
			\label{11_4}
			The variable $u$ occurs at a grey position in a grey literal in $\inv\sigmazmi$.

	\end{enumerate}
\end{lemma}
\begin{proof}
	Consider paramodulation: $s=t \lor D$ and $E\occatp{r}$ create $C: (D\lor E\occatp{t})\sigma$ where $\sigma = \mgu(s, r)$.

	A grey occurrence of variable can be created in $C$ by 2 means:
	either $t$ contains a grey variable and $p$ is a grey position or $\sigma$ introduces a grey occurrence of a variable in a grey position

	\begin{itemize}
			\item case 1: 
				everything which is grey in an equality predicate ends up grey in the interpolant, so this case is easy
		\end{itemize}

\end{proof}


\end{document}

