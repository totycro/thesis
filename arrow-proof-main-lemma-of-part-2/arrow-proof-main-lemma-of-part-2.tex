\documentclass[,%fontsize=11pt,%
	paper=a4,% 
	%landscape,
	DIV11, % mehr text pro seite als defaultyyp
	%DIV10, 
	%DIV=calc,%
	twoside=false,%
	liststotoc,
	bibtotoc,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
]{scrartcl}

\usepackage{lscape}
\usepackage{stackengine}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}

% subsections also in toc
\setcounter{tocdepth}{2}

\definethms

%\def\proofSkipAmount{ \vskip -0.5em}



%\usepackage{bussproof}

%\usepackage{vaucanson-g}
\usepackage{amssymb}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}
\usepackage{tabularx}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{color}
\usepackage[final]{listings} % sourcecode in document
\usepackage{url}      % for urls
\usepackage{multicol}
\usepackage{float}
\usepackage{caption}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

\usepackage[authoryear]{natbib} % \cite ; square|round etc.
%\usepackage[numbers,square]{natbib}
%\usepackage[square, authoryear]{natbib}
%\usepackage[language=english]{biblatex}

%\bibliographystyle{plain}
\bibliographystyle{alpha}
%\bibliographystyle{alphadin}
%\bibliographystyle{dinat}
%\bibliographystyle{chicago}
%\bibliographystyle{plainnat}

\bibdata{bib.bib}

\renewcommand*{\partformat}{\partname\ \thepart\ -}
\let\partheadmidvskip\

\newcommand{\comp}{\ensuremath{\text{comp}}}
% smaller url style
\makeatletter
\def\url@leostyle{%
\@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\ttfamily}}}
\makeatother
\urlstyle{leo}

\newcommand{\myfig}[5] {
	\begin{figure}[tbph]
		\centering
		\includegraphics[#3]{#1}
		\caption[#4]{#5}
		\label{fig:#2}
	\end{figure}
}

\setlength{\parindent}{0em}
%\usepackage{thmtools} % actually already in latex_header.tex ...

\usepackage{amsthm}


\usepackage{tikz-qtree}

%\newcommand{\sig}[1]{{#1}_\Sigma}
%\newcommand{\p}[1]{{#1}_\Pi}
\newcommand{\sig}[1]{\stackrel{\Sigma}{#1}}
\newcommand{\p}[1]{\stackrel{\Pi}{#1}}

\newcommand{\e}[1]{\vskip .7em   \subsection*{#1}}

%\def\proofSkipAmount{ \vskip -0.3em}

\usepackage{refcheck}

\begin{document}

\newcommand{\substremarksym}{$\ast$}
\newcommand{\substremarkref}{$(\ast)$}

\newcommand{\lif}[1]{\lift{\Delta}{#1}{x}}
\newcommand{\newterm}{^*}
\newcommand{\de}{^\Delta}


\subsection*{noteworthy thoughts}

{\large

* if $x$ occurs in $y\sigma$, then add an arrow from every grey occurrence of $x$ to the network of $y$-occurrences. It should be possible to have this network reach every occurrence. not sure how widereaching this is as it does not cover any color-alternating terms.

}
* seem to not be able to construct $Q(f(h(x)), g(x))$ without arrow between arguments (either merge or a directed one) 

* need some kind of backwards merging

** a possibly useful criterion: $z\sigma$ occurs in $y\sigma$ for $y, z \in C_1 \cup C_2$.

* what about label for arrows containing the variable, which is manipulated by the unifier?

\subsection*{basic facts which should be used in the algorithm}

* variables only occur per clause and are only changed by unification. Hence need to establish conditions at beginning which are not violated by unification.

* without $x \lra f(x)$ situation, no mixed-colored terms can occur

* other unifications transfer mixed-colored terms without producing them, but they also modify the mixed-colored terms




\section{current version}


\mytodo{finish new version of lemma 1}

\mytodo{find formulation of merge arrows: lemma about how terms of color are related when they share variables} 

\mytodo{check if old lemma 2 occurs anywhere else}

\mytodo{basically check A, B and C for which new lemma 2 we need; consider longer NB comment in lemma 1 }


\begin{lemma}
	\label{lemma:arrow_from_grey_to_colored}
	Let $x$ be a variable in $\AIclausede(C)$ occurs in the maximal colored term $t\occ{x}$.
	If it has a grey occurrence in some literal ($\AI(C)$ or or also in literals with colored predicates), then $x\apath t\occ{x}$.
\end{lemma}
\begin{proof}
	Induction start by definition.

	Induction step with usual notation.

	We consider introductions of $t\occ{x}$ by changing the variable $y$.
	Let $\bhat y$ be the position of $y$ which causes the variable to be changed by the unification algorithm.
	$\bhat y$ is in a resolved literal, say $l$, so we denote it by $l\at{\bhat y}$ and its counterpart in $l'$ by $l'\at{\bhat y}$. 

	\begin{description}
		\item[Suppose $x$ occurs grey in $y\sigma$ and a colored $t\occ{y}$ occurs in $C_1$.]
			Then $t\occ{x}$ occurs in $C$ and we have to show that $x\apath t\occ{x}$ if $x$ occurs grey in $C$.

			\begin{itemize}
				\item Suppose $y$ has a grey occurrence $\bdot y$ in $C_1$.
					Then by the induction hypothesis, $\bdot y\apath t\occ{y}$. 
					As $\sigma$ is applied in $C$, $\bdot y\sigma\occ{x}\apath t\sigma\occ{x}$.

				\item Otherwise there are only colored occurrences of $y$, so also $l\at{\bhat y}$ is a colored occurrence. Let it be contained in the maximal colored term $s\occ{y}$.

					figure: $Q(\dots t\occ{y} \dots) \lor P(\dots s\occat{y}{p} \dots)\quad\quad \lnot P(\dots s\occat{x}{p})$

					\begin{itemize}
						\item Suppose that $x$ occurs grey in $C_2$. Then by the induction hypothesis, $x\apath l'\at{\bhat y}$ and so
							$x\apath l\at{\bhat y}$.

							As all other occurences of $y$ are contained in colored terms, \mytodo{merge arrows} \NB{this case is contained in the blue notes below}
							
						\item Suppose that $x$ does not occur grey in $C_2$.
							Suppose that $x$ does occur grey in $C$ as otherwise we are done.

							Then there exists a grey occurrence of a variable $z$ in $C_i$ such that $x$ occurs grey in $z\sigma$.

							\begin{itemize}
								\item
									Suppose $C_i = C_1$.

									\mbox{figure: $ Q(t\occ{y}) \lor z \lor l[f(y), g(z)]\quad\; \lnot l[f(h(x)), g(x)]\;\quad z\sigma = x;y\sigma=h(x)$}

									%As $z$ is changed by the unifier, it also occurs in the resolved literal, say at $\bhat z$. 
									%Since $z\sigma $ contains a grey ocurrence of $x$ and $x$ only occurs colored in $l'$, $\bhat z$ is contained in a colored term.


									By backwards merge special case 1', $z\apath t\at{y}$.

									\NB{the backwards merge special case again does a lot; without it, we know that:
										\begin{compactitem}
										\item 
											there is an arrow from $z$ to $g(z)$ by the induction hypothesis
										\item 
											there should be some arrow at $f(h(x)), g(x))$, so after the resolution step, the same arrow applies to $f(y), g(z)$.
										\item 
											as $y$ occurs colored, there should again be some arrow between $t\occ{y}$ and $f(y)$.
										\item 
											these combined should yield $z \apath t(y)$, which is what we want to show
										\end{compactitem}
									}

								\item
									Suppose $C_i = C_2$.

									By backwards merge special case 1', $z \apath t\at{y}$

									figure: $ Q(t\occ{y}) \lor l[f(y), s\occ{u}, r\occ{u}]\quad\; \lnot l[f(h(x)), s'\occ{z}, r'\occ{x}] \lor z $
									\newline
									$x$ grey in $u \sigma$, $x$ grey in $z\sigma$, 

									\NB{without special case:
										$z$ occurs grey in $C_2$, and also in the resolved literal, say at $\bhat z$.
										\begin{compactitem}
										\item merge arrow at $s\occ{u}, r\occ{u}$, $f(h(x)), r'\occ{x}$ and regular arrow from $z$ to $s'\occ{z}$
										\item merge arrow at $t\occ{y}, f(y)$
										\end{compactitem}
									}
							\end{itemize}

					\end{itemize}



			\end{itemize}

		\item[Suppose $x$ occurs colored in $y\sigma$ and $y$ occurs in $C_1$ (colored or grey).]
			~

			figure:
			$C_1: Q(\dots \bdot y \dots) \lor l\occat{\bhat y}{p}\quad\quad$
			$C_2: \lnot l\occat{\bhat y'}{p}\quad(\bhat y' \text{ is abstraction of } t\occur{x})$


			\begin{itemize}
				\item Suppose $l'\at{\bhat y}$ contains $x$.
					\begin{itemize}
							\item
					Suppose that  $x$ occurs grey in $C_2$. then by the induction hypothesis,
					$x\apath l'\at{\bhat y}$ and hence 
					$x\apath l\at{\bhat y}$. Let $\bdot y$ be an occurrence of $y$ in $C_1$ different from $l\at{\bhat y}$.

					If $l\at{\bhat y}$ is a grey occurrence and $\bdot y$ occurs colored in $C_1$, then by the induction hypothesis, $l\at{\bhat y} \apath \bdot y$. By combining the paths, we get that $x\apath \bdot y$.

					If $l\at{\bhat y}$ is a grey occurrence and $\bdot y$ occurs grey in $C_1$, then by Lemma~\ref{lemma:arrow_from_grey_to_grey}, there is a merge path between $l\at{\bhat y}$ and $\bdot y$ and hence $x\apath \bdot y$.


					If $l\at{\bhat y}$ is a colored occurrence and $\bdot y$ occurs grey in $C_1$, then by the backwards merging case 3, $x\apath \bdot y$.

					If $l\at{\bhat y}$ is a colored occurrence and $\bdot y$ occurs colored in $C_1$,  \mytodo{apply merge arrows}

					\item

					Otherwise $x$ occurs only colored in $C_2$.


					If $x$ does not occur grey in $C$, we are done, so assume it does.

					Then there exists a grey occurrence of a variable $z$ in $C_i$ such that $x$ occurs grey in $z\sigma$.

					\begin{itemize}
						\item Suppose $C_i = C_1$.

							\begin{itemize}
								\item
									Suppose $y$ occurs grey in $C_1$.
									As $x$ occurs grey in $z\sigma$ and $x$ occurs colored in $y\sigma$, by the backwards merging 1 special case, we have an arrow from $z$ to $y$. Full stop as in $C$, $x\apath y\sigma$.
									%As $y$ occurs grey in $C_1$, by the induction hypothesis, $y\apath l\at{\bhat y}$ and hence $z\apath l\at{\bhat y}$, so in $C$, we have that $x \apath l\at{\bhat y}$.

								\item
									Otherwise $y$ occurs colored in $C_1$. Then a similar reasoning goes through by backwards merging case 2.\todo{need to see variable here}
							\end{itemize}

							\mbox{figure: $ r\occ{y} \lor z \lor l[f(y), g(z)]\quad\; \lnot l[f(h(x)), g(x)]\;\quad z\sigma = x;y\sigma=h(x)$}

							\NB{without special case:
								Then there is an occurrence of $z$ in the resolved literal, sat at $l\at{\bhat z}$ such that $l'\at{\bhat z}$ is an occurrence of $x$.
								As $x$ occurs grey in $z\sigma$ and $x$ only occurs colored, both $l\at{\bhat z}$ and $l'\at{\bhat z}$ are colored occurrences.

								\begin{compactitem}
								\item arrow $z, g(z)$, merge path $f(h(x)), g(x)$
								\item if $r\occ{y}$ colored occurrence of $y$, then $f(y), r\occ{y}$
								\item if $r\occ{y}$ grey occurrence of $y$, really need some special case, but at least $y$ is visible (probably special case 1)
								\end{compactitem}

							}

						\item Suppose $C_i = C_2$.

									figure: $ r\occ{y} \lor l[f(y), s\occ{u}, r\occ{u}]\quad\; \lnot l[f(h(x)), s'\occ{z}, r'\occ{x}] \lor z $
									\newline
									$x$ grey in $u \sigma$, $x$ grey in $z\sigma$, $x$ colored in $y\sigma$

									We get $z\apath y$ by either backwards special case 1 or 2, depending whether $y$ is a grey or colored occurrence.

									\NB{version without special case appears to be similar as above}


					\end{itemize}

			\end{itemize}






		\item Suppose $l'\at{\bhat y}$ does not contain $x$.
			Then it contains a variable $u$ such that $x$ occurs grey in $u\sigma$. 
			So the situation repeats in $C_2$ as $l'\at{\bhat y}$ is contained in a colored term and $u$ is what $y$ was now.
			Hence we obtain the result by Remark~\substremarkref.

	\end{itemize}



	\end{description}
\end{proof}


\begin{clemma}
	\label{lemma:arrow_from_all_colored_to_all_colored}
	\wrong{does not work out}
	Let $x$ be a variable in $\AIclausede(C)$.
	Then there is a merge path from every colored occurrence of $x$ to every other colored occurrence of $x$ in $C$.
\end{clemma}
\begin{comment}
	\begin{proof}

		Induction start: by definition.

		Suppose holds for $C_1$ and $C_2$, usual notation.

		We consider introductions of colored occurrences of $x$.

		\begin{description}
			\item [Suppose $x$ is introduced in $t$ by means of unification.]
				$t\sigma$ contains $x$, hence there is a variable $y$ in $t$ such that $y\sigma = s\occ{x}$.

				\cbstart
				Let $\bhat y$ be the position of $y$ which causes the variable to be changed by the unification algorithm.
				$\bhat y$ is in a resolved literal, say $l$, so we denote it by $l\at{\bhat y}$ and its counterpart in $l'$ by $l'\at{\bhat y}$
				\cbend\comm{copied}

				\begin{itemize}
					\item 
						Suppose $l\at{\bhat y}$ is a grey occurrence.
						$l'\at{\bhat y}$ is an abstraction of $s\occ{x}$.
						\mytodo{}

					\item
						Suppose $l\at{\bhat y}$ is a colored occurrence.
						Then by the induction hypothesis, $l\at{\bhat y} \mpath \bdot y$ for every other colored occurrence $\bdot y$ of $y$. As the substitution $s\occ{x}$ for $y$, there are merge edges between all these occurrences.

						For the grey occurrences of $y$ \mytodo{}

				\end{itemize}


			\item [Suppose a colored term $t\occ{x}$ containing $x$ is in $\ran(\sigma)$.]
		\end{description}

	\end{proof}
\end{comment}



\begin{lemma}
	\label{lemma:arrow_from_grey_to_grey}
	Let $x$ be a variable in $\AIclausede(C)$.
	Then there is a merge arrow between every pair of distinct grey occurrences of $x$. \comm{possibly not really needed as same var is always lifted by same lifting var, they can never diverge syntactically. Still this is used in the proof.}
\end{lemma}
\begin{proof}
	Induction start: by definition.

	Suppose it holds for $C_1$ and $C_2$, usual notation.

	Suppose for some grey variable occurrence $x$ that $y$ occurs grey in $x\sigma$ for some variable $y$ which has a grey occurrence in $C$ (so either it was there in $C_i$ and $y\sigma = y$ or $y$ occurs grey in $z\sigma$ for some $z$, but then some $y$ occurs elsewhere). 

	Then there is a position $\bhat x$ in a resolved literal, say w.l.o.g.\ $l$, such that $l\at{\bhat x} = x$ and $l'\at{\bhat x} = y$.

	\begin{itemize}
		\item
			Suppose that $l\at{\bhat x}$ is a grey occurrence.
			Then so is $l'\at{\bhat x}$.
			By the induction hypothesis, both occurrences have merge edges to all other occurrences of the variable, and these are merged.
			Note that $C_1$ and $C_2$ are variable disjoint, so $x$ does not occur in $C_2$ and $y$ does not occur in $C_1$.

		\item
			Otherwise suppose that $l\at{\bhat x}$ is a colored occurrence.
			There are merge edges between all grey occurrences of $x$ in $C_1$ and $y$ in $C_2$ by the induction hypothesis.
			As $y$ occurs grey in $x\sigma$, by backwards merge case 4, there is a merge edge between every grey occurrence of $x$ and $y$.
			\qedhere
	\end{itemize}

\end{proof}

\section{proof for $\AIde$}

\section{original proof}

Ideas for simplification:

* Lemma for all cases about what is on the other side

\begin{exa}
	\label{exa:lifting_var_only_abstraction_in_arrow_proof}
	$\Gamma = \{ Q(\gamma(x)) \lor P(x), \lnot Q(\gamma(z)), R(\dots)\}$\todo{$R$ only for coloring}

	$\Delta = \{ \lnot P(\delta(y)) \lor R(y), \lnot R(a), Q(\dots) \}$\todo{$Q$ only for coloring}

	$ a \sim x_k, \delta(y) \sim x_i, \delta(a) \sim x_j $

	\begin{prooftree}
		\AxiomCm{ \bot \mid Q(\gamma(x)) \lor P(x) }
		\AxiomCm{ \top \mid \lnot P(x_i) \lor R(y) }

		\BinaryInfCm{ P(x_i) \mid Q(\gamma(x_i)) \lor R(y) }

		\AxiomCm{ \top \mid \lnot R(x_k) }

		\BinaryInfCm{ (\lnot R(x_k) \land P(x_i) ) \lor (R(x_k) \land \top)  \mid Q(\gamma(x_i)) }
		\noLine
		\UnaryInfCm{ P(x_i) \lor R(x_k)  \mid Q(\gamma(x_i)) }

		\AxiomCm{ \bot \mid \lnot Q(\gamma(z)) }

		\BinaryInfCm{ ( \lnot Q(x_j) \land ( P(x_i) \lor R(x_k) )) \lor (Q(x_j) \land \top)   \mid \square }
		\noLine
		\UnaryInfCm{   \lnot Q(x_j) \land (P(x_i) \lor R(x_k)) \mid \square }

	\end{prooftree}

	Gist: When $Q(\gamma(x_i))$ is the only symbol in $\AI\de(\cdot)$, the lifting var means $\delta(x)$, but in the actual derivation, it's $\delta(a)$. however $\tau$ fixes this.
	So before $Q$ is resolved, there is an arrow, but with the wrong lifting var ($x_i$ instead of $x_j$)
\end{exa}

\begin{remark}[\substremarksym]
	Any substitution, in particular $\sigma$, only changes a finite number of variables.
	Furthermore a result of a run of the unification algorithm is acyclic in the sense that if a substitution $u\mapsto t$ is added to the resulting substitution, it is never the case that at a later stage $t\mapsto u$ is added.
	This can easily be seen by considering that at the point when $u\mapsto t$ is added to the resulting substitution, every occurrence of $u$ is replaced by $t$, so $u$ is not encountered by the algorithm at a later stage.

	Therefore in order to show that a statement holds for every $u\mapsto t$ in a unifier $\sigma$, 
	it suffices to show by an induction argument that for every substitution $v\mapsto s$ which is added to the resulting unifier by the unification algorithm that it holds for $v\mapsto s$ under the assumption that it holds for every $w\mapsto r$ such that $w$ occurs in $s$ and $w\mapsto r$ is added to the resulting substitution at a later stage.
\end{remark}


\begin{conj}
	Let $C$ be a clause in a resolution refutation. 
	Suppose that $\AI\de(C)$ contains a maximal $\Gamma$-term $\gamma_j\occ{z_i}$ which contains a lifting variable $z_i$. %(lifting a $\Delta$-term $\delta_i$).
	%Then there is an arrow in $\arrFinal(C)$ from a term containing $z_k$ in $\AI\de(C)$ such that $\delta_k$ is an abstraction of $\delta_i$ to $\gamma_j\occ{z_i}$.
	Then $z_i \ltArrC z_j$.
	\mytodo{there still is the case that $z_i$ does not occur. also, it can be randomly introduced with no logical connection}
\end{conj}
\begin{proof}
	We proceed by induction.
	For the base case, note that no multicolored terms occur in initial clauses, so no lifting term can occur inside of a $\Gamma$-term.

	\newcommand{\oldgam}{\bm\tilde\gamma_{j\bm'}} 
	\newcommand{\newgam}{\gamma_j} % this should correspond with the statement, and there, the symbol should be plain (also below)

	Suppose a clause $C$ is the result of a resolution of $C_1: D \lor l$ and $C_2: E \lor \lnot l$ with $l\sigma = l'\sigma$.
	Furthermore suppose that for every lifting term inside a $\Gamma$-term in the clauses $C_1$ and $C_2$ of the refutation, for every term of the form $\gamma_j\occ{z_i}$ we have that $z_i \ltArrCOne z_j$ or $z_i \ltArrCTwo z_j$ respectively. Hence there is an arrow $(p_1, p_2)$ in $\arrFinal(C_1)$ or $\arrFinal(C_2)$ such that $z_i$ is contained in $\pos(p_1)$ and $z_j$ is contained in $\pos(p_2)$.
	In $\AI\de(C)$, $\pos(p_1)$ contains $\lifboth{z_i\sigma}\tau = z_i\tau$ and $\pos(p_2)$ contains $\lifboth{z_j\sigma}\tau = z_j\tau$.
	Hence the indices of the lifting variables might change, but this renaming does not affect the relation of the objects as $\arrFinal(C_1) \cup \arrFinal(C_2) \subseteq \arrFinal(C)$.


	We show that $z_i \ltArrC z_j $ holds true also for every new term of the form $\newgam\occ{z_i}$ for some $j, i$ in $\AI\de(C)$. By ``new'', we mean terms which are not present in $\AI\de(C_1)$ or $\AI\de(C_2)$.
	Note that new terms in $\AI\de(C)$ are of the form $\lifdelta{t\sigma}\tau$ for some $t \in \AI\de(C_1) \cup \AI\de(C_2)$.
	By Lemma~\ref{lemma:no_lifting_vars_in_subst}, $\sigma$ does not introduce lifting variables.
	Hence a new term of the form $\newgam\occ{z_i}$ is created either by introducing a $\Delta$-term into a $\Gamma$-term or by introducing $\newgam\occ{\delta_i}$ via $\sigma$, both followed by the lifting. 
	Note that $\tau$ only substitutes lifting variables by other lifting variables and hence does not introduce lifting variables. Furthermore by Lemma~\ref{lemma:tau_is_specialisation}, $\tau$ only substitutes lifting variables for other lifting variables, whose corresponding term is more specialised. Hence if there exists an arrow from a lifting variable to $\newgam\occ{z_i}$ according to this lemma, it is also an appropriate arrow if $\newgam\occ{z_i}$ is replaced by $\newgam\occ{z_i}\tau$.


	We now distinguish the two cases under which a new term $\newgam\occ{z_i}$ can occur in $\AI\de(C)$:

	\begin{description}
		\item[Suppose for some $\Gamma$-term $\oldgam\occ{u}$ in $\AI\de(C_1)$ or $\AI\de(C_2)$, $u\sigma$ contains a $\Delta$-term.]\hfill\nopagebreak

			Hence we have that $(\oldgam\occ{u})\sigma = \newgam\occ{\delta_i}$ for some $i$.
			Note that the position of $u$ in $\oldgam\occ{u}$ does not necessarily coincide with the position of $\delta_i$ in $\newgam\occ{\delta_i}$ as $u$ might be substituted by $\sigma$ for a grey term containing $\delta_i$.

			We have that $\lifdeltanovar{\oldgam\occ{u}\sigma}\tau = \newgam\occ{z_i}$.

			\newcommand{\hatu}{{\bm\hat u}}
			\newcommand{\hatuPrime}{t_{\bm\hat u}}
			At some well-defined point of application of the unification algorithm, $u$ is substituted by an abstraction of a term which contains $\delta_i$. This occurrence of $u$ is in $l$ and we denote it by $\hatu$.
			We furthermore denote the term at the corresponding position in $l'$ by~$\hatuPrime$.

			We distinguish cases based on the occurrences of $\hatu$ and $\hatuPrime$.
			\begin{itemize}
				\item Suppose $\hatu$ is a grey occurrence.

					\begin{figure}[h]
						\begin{prooftree}
							\AxiomCm{C_1: P(\oldgam\occ{u}) \lor Q(\hatu)}
							\AxiomCm{C_2: \lnot Q(\hatuPrime)}
							\BinaryInfCm{C: P(\newgam\occ{\delta_i})}
						\end{prooftree} 
						\caption{Example for this case}
					\end{figure}

					Then by Lemma~\ref{lemma:arrow_from_grey_to_colored}, there is an arrow from a term containing $u$ to a term containing $\gamma_j\occ{u}$ in $\arrFinal(C)$.
					As $\hatu\sigma$ is a term containing the $\Delta$-term $\delta_i$, the term at the position of $\hatu$ in $\AI\de(C)$ is $\lifboth{\hatu\sigma}\tau$, which by assumption contains $z_i$. 
					But there is an arrow from this term containing $z_i$ to $\newgam\occ{z_i}$, so $z_i \ltArrC z_j$.


					\begin{comment}% version with "less induction hypothesis"
						As $\hatu$ and $\hatuPrime$ are at corresponding positions in the resolved literal, their arrows are merged, so it suffices to show that there is an arrow from a term containing an occurrence of $z_i$ to the position of $\hatuPrime$.

						\begin{itemize} 
							\item Suppose $\hatuPrime$ is a term which does not contain a $\Delta$-term.
								Then as $\hatuPrime\sigma$ is a term containing a $\Delta$-term, we know that $\hatuPrime$ contains a variable, say $v$, for which we have that $v\sigma$ is a term which contains a $\Delta$-term.
								Then by Remark~\substremarkref, we can assume that there is an arrow from a term containing an occurrence of $z_i$ to the position of $\hatuPrime$.

							\item Suppose that $\hatuPrime$ is a term containing a $\Delta$-term.
								Then as $\hatu\sigma=\hatuPrime\sigma$, 

						\end{itemize}
					\end{comment}


				\item Suppose $\hatu$ occurs in a maximal colored term which is a $\Gamma$-term.

					\begin{figure}[h]
						\begin{prooftree}
							\AxiomCm{C_1: P(\oldgam\occ{u}) \lor Q(\gamma_k\occurat{\hatu}{p}) }
							\AxiomCm{C_2: \lnot Q(\gamma_{m}\occurat{\hatuPrime}{p})}
							\BinaryInfCm{C: P(\newgam\occ{\delta_i})}
						\end{prooftree} 
						\begin{prooftree}
							\AxiomCm{C_1: Q(\oldgam\occ{\hatu}) }
							\AxiomCm{C_2: \lnot Q(\gamma_m\occ{\hatuPrime})}
							\BinaryInfCm{C: \square }
							\noLine
							\UnaryInfCm{\comm{\newgam\occ{\delta_i}\text{ occurs in the interpolant}}}
						\end{prooftree} 
						\caption{Examples for this case}
					\end{figure}

					Then either $\hatu$ is the occurrence of $u$ in $\oldgam\occ{\hatu}$ or it occurs in a different $\Gamma$-term~$\gamma_j\occ{\hatu}$.
					In the latter case, by Lemma~\ref{lemma:arrow_from_colored_to_colored}, there is a merge edge between $\oldgam\occ{\hatu}$ and $\gamma_j\occ{\hatu}$. \mytodo{or no direct connection but  via other term}
					\todo{A (does not work like this)}
					Hence in both cases, it suffices to show that there is an arrow from a term containing an occurrence of $z_i$ to $\hatuPrime$.

					We distinguish on the shape of $\hatuPrime$:
					\begin{itemize}
						\item $\hatuPrime$ is a term which does not contain a $\Delta$-term.
							Then it contains a variable that is be substituted by $\sigma$ by a term which contains a $\Delta$-term as $u\sigma = \hatuPrime\sigma$ is a term containing a $\Delta$-term.
							We denote by $v$ the variable in $\hatuPrime$ which is substituted by a term containing a $\Delta$-term in case $\hatuPrime$ is a grey term.

							In the course of the unification algorithm, there are further unifications of $v$ since we know that $u\sigma = v\sigma$ is a term containing a $\Delta$-term. 
							Therefore by Remark~\substremarkref, we can assume that there is an appropriate arrow to $\hatuPrime$.

						\item $\hatuPrime$ is a term which contains a $\Delta$-term.
							As $\hatuPrime$ occurs in a $\Gamma$-term in $C_1$, say in $\gamma_m\occ{\hatuPrime}$, $C_1$ contains a multicolored $\Gamma$-term.
							Hence the corresponding term in $\AI\de(C_1)$, is of the form $\gamma_m\occ{z_{i\bm '}}$ for some $i\bm'$. 
							Observe that $i\bm'$ in general is not equal to $i$ as demonstrated in Example~\ref{exa:lifting_var_only_abstraction_in_arrow_proof}, even though we have that $\hatuPrime\sigma = u\sigma$.
							This is because the lifting variables in $\AI(\cdot)$ represent abstractions of the terms in the clauses of the resolution derivation (cf.\ Lemma~\ref{lemma:lifting_var_refers_to_abstraction_of_term}). 
							Therefore we only know by the induction hypothesis that $z_{i\bm'} \ltArrCOne \lifboth{\gamma_m\occ{z_{i\bm'}}} = \lifboth{\hatuPrime}$.

							However by Lemma~\ref{lemma:literals_clauses_equal} and due to the fact that $\hatu$ and $\hatuPrime$ respectively occur in the resolved literal, $\lifdeltanovar{\hatu \sigma}\tau = \lifdeltanovar{\hatuPrime \sigma}\tau$.
							As 
							$\lifdeltanovar{\hatu \sigma}\tau = \lifdeltanovar{\delta_i}\tau = z_i\tau $
							as well as
							$ \lifdeltanovar{\hatuPrime \sigma}\tau = \lifdeltanovar{z_{i\bm'}\sigma}\tau = z_{i\bm'}\tau$,
							we must have that $z_i\tau = z_{i\bm'}\tau$.
							As however $u\sigma = \delta_i$, by the definition of $\aiu$, we have that $\{z_i\mapsto z_i\} \in \tau$, so $z_{i\bm'}\tau = z_i$.

							Since $\tau$ is applied to every literal in $\AI\de(C)$ and in $\AI\de(C_1)$ an arrow from a term containing $z_{i\bm'}$ to $\hatuPrime$ exists,
							the same arrow applied to $\AI\de(C)$ points from a term containing $z_{i\bm'}\tau = z_i$ to $\hatuPrime$.
							Therefore $z_i \ltArrC z_j$.


					\end{itemize}


				\item Suppose $\hatu$ occurs in a maximal colored term which is a $\Delta$-term.
					\begin{prooftree}
						\AxiomCm{C_1: P(\oldgam\occ{u}) \lor Q(\delta_k\occurat{\hatu}{p}) }
						\AxiomCm{C_2: \lnot Q(\delta_{m}\occurat{\hatuPrime}{p})}
						\BinaryInfCm{C: P(\newgam\occ{\delta_i})}
					\end{prooftree} 

					By Lemma~\ref{lemma:arrow_for_variables_in_differently_colored_terms}, \mytodo{}
					\todo{B (check how we need colored term arrows)}


			\end{itemize}

		\item[Suppose for some variable $v$ in $\AI\de(C_1)$ or $\AI\de(C_2)$, $v\sigma = \newgam\occ{\delta_i}$ for some $i$.]\hfill\\
			As $v$ is affected by the unifier, it occurs in the literal being unified, say w.l.o.g.~in $l$ in $C_1$.
			At some well-defined point in the unification algorithm, $v$ is substituted by an abstraction of $\newgam\occ{\delta_i}$.
			Let $p$ be the position of the occurrence of $v$ in $l$ which causes this substitution.
			Furthermore, let $p'$ be the position corresponding to $p$ in~$l'$.

			Note that any arrow from or to $p'$ also applies to $p$ in $\arrFinal(C)$ and hence to $\newgam\occ{z_i}$ as they are merged due to occurring in the resolved literal.
			So it suffices to show that there is an arrow from an appropriate lifting variable to $p'$. We denote the term at $p'$ by $t$.

			Note that $t\sigma = \newgam\occ{\delta_i}$.
			So $t$ is either a $\Gamma$-term containing a $\Delta$-term, in which case we know that there is an appropriate arrow by the induction hypothesis as $t$ occurs in $l'$ in $C_2$, or $t$ is an abstraction of $\newgam\occ{\delta_i}$, in which case we can assume the existence of an appropriate arrow by Remark~\substremarkref.\wrong{probably last half sentence, this is usually not the situation where remark \substremarkref is applicable}
			\todo{C (might need some lemma as well)}
			\qedhere

			\begin{comment}
				We distinguish cases based on the shape of the term at $p'$, which we denote by $t$:
				\begin{itemize}
					\item $t$ is a variable, say $x$. 
						Then $x$ occurs elsewhere in $l'$ and $x\sigma = \newgam\occ{\delta_i}$.
						By Remark~\substremarkref, we can assume that there is an appropriate arrow for $x\sigma$ ad $p'$.

					\item $t$ is a $\Gamma$-term which does not contain a $\Delta$-term.
						$t$ is however an abstraction of $\newgam\occ{\delta_i}$, so it contains at least one variable which is substituted by a term $s$.
						Hence by Remark~\substremarkref, we can assume that an appropriate arrow pointing to $t$ exists.

						We distinguish based on the shape $s$:
						\begin{itemize}
							\item $s$ is a grey or $\Delta$-colored term containing a $\Delta$-term.
								Then a $\Delta$-term is introduced into a $\Gamma$-term by means of unification, so by the respective case of the proof, there is an arrow from an appropriate lifting variable to~$t$.

							\item $s$ is a multicolored $\Gamma$-term.
								Then by Remark~\substremarkref, we can assume that an appropriate arrow pointing to $t$ exists.
						\end{itemize}
					\item $t$ is a $\Gamma$-term containing a $\Delta$-term.
				\end{itemize}
			\end{comment}


	\end{description}

\end{proof}

\section*{something about when i started with connected components}

unification is for resolved literals.

connections between resolved literals and the rest of the clauses is covered by arrows.

if a term enters, merge arrows ensure that everything is propagated.

the special thing about colored occurrences is the fact that they can create multicolored terms in cooperation with grey occurrences..

a variable only occurs in a clause if it was never substituted by anything. Hence in particular all grey occurrences are ``original'' (TODO: renamings of variables)

Let $u$ be a grey occurrence.
let $f(u)$ be a colored occurrence.
either it is original, then we are fine by arrow propagation.
otherwise it has been introduced, but then it has used the network of another variable.

more precisely: %a variable from another clause occurs in a related literal 
a variable $v$ occurs in a related literal in a related position in another clause as $u$ in $f(u)$.
so the variable is substituted by a term containing $u$, say $t\occ{u}$
the arrows at the entry points are merged.

effect: 
$t\occ{u}$ occurs at every grey occurrence of $v$. all arrows mentioning them are merged with the ones mentioning the entry point.
this is justified as the terms there appear ``as they are'', i.e.\ as they are produced at the entry point.

however a colored occurrence cannot be produced from a grey occurrence ($\mgu(x, f(u))$) but only if a grey occ is in the literal and a colored occ is elsewhere in the clause (the network of the other var). but then there are (directed) arrows.


Every variable has a connected network in a clause. 

there is a barrier between colored terms.

~

~

\clearpage
\section{misc results}

\begin{prop}
	\label{prop:no_delta_term_in_ai_delta}
	In $\AIde(C)$, all terms are either variables, grey, $\Gamma$-terms or $\Delta$-lifting variables. 
	In particular, no $\Gamma$-term is contained in a $\Delta$-term and there is at most one color alternation. 

	In other words, the coloring of all terms follows this grammar:
	(grey | gamma )* [delta]

	\comm{not sure how this is really useful in the end of the proof where we have to switch colors and show that it also works from the $\Delta$-side}
\end{prop}
\section{results in spe}

\begin{clemma}
	there is a merge path between all occurrences of a variable $x$ in all colored terms of the same ``stage'' (and directed arrows between stages).\NB{not sure where this is going and if it's true}
\end{clemma}
\begin{proof}
	a stage means the color alternation level: only $\Gamma$, $1 \Gamma + 1 \Delta$, and so on.

	more formally: on the prefix to $x$ in a maximal colored term $t$, iterate in order and increase counter whenever the current symbol has a different color than the previously encountered color. the counter is increased for the first colored symbol. this number plus the color of $t$ define the stage.

	induction start: by def.

	induction step, usual notation.

	Suppose a term $t\occ{y}$ changes its stage. 
	So it contains a variable $y$ h





\end{proof}



\section{missteps}
\begin{clemma}
	\wrong{$Q(f(x))\lor R(x); \lnot R(g(y))$}
	\label{lemma:arrow_from_one_color_to_other_color}
	If a variable $x$ occurs in a maximal colored term $s\occ{x}$ which is a $\Gamma$-term as well as in a maximal colored term $t\occ{x}$ which is a $\Delta$-term in $C$, then $x\apath s\occ{x}$ and $x\apath t\occ{x}$.
\end{clemma}
\begin{proof}
	This situation does not occur in the induction start.

	Induction step, usual notation.

	We consider resolution steps which create this situation. 
	Clauses are variable disjoint, so if a variable occurs in a term of a color, it can only also occur in a term of another color by entering the other term via unification.

	\mytodo{case distinction: var $x$ introduced into $t$ or $y\sigma$ gives such a term ?}
\end{proof}


\begin{clemma}
	\wrong{probably wrong for same reason as \ref{wrong:same_color}}
	\label{wrong:same_color2}
	Let $x$ be a variable $s\occ{x}$ and $t\occ{x}$ be terms containing $x$ such that $x\notapath s\occ{x}$ and $x\notapath t\occ{x}$.
	\label{lemma:merge_arrow_between_same_colored_terms}
	Then $s\occ{x} \mpath t\occ{x}$.
\end{clemma}

\begin{clemma}
	\label{wrong:same_color}
	\wrong{consider: $f(x)$, $g(f(x))$, $h(g(f(x)))$, $f, h: \Gamma, g: \Delta$}
	Let $s\occ{x}$ and $t\occ{x}$ be maximal colored terms of the same color containing a variable $x$. 
	Then $s\occ{x} \mpath t\occ{x}$
\end{clemma}


\begin{lemma}
	\label{DEPR:lemma:arrow_from_grey_to_colored}
	{

		\LARGE\bfseries\color{red}
		not true in this formulation, we can have $x$, $f(x)$ and $g(x)$ with arrows just from $x$ to the two colored occurrences, even if $f$ and $g$ of same color.


	}
	Let $x$ be a variable in $\AIclause\de(C)$ which has a grey occurrence and a colored occurrence. 
	Then there is an arrow in $\arr(C)$ from a term containing a grey occurrence to a term containing a colored occurrence.
	%Suppose there is a colored and a grey occurrence of $x$.
	%Then for every colored occurrence $p$ of $x$ there is an arrow from some grey occurrence to~$p$ in \mytodo{}.
	\comm{Should also hold for all of $\AI\de$, but is currently not needed in the proof}
\end{lemma}
\begin{proof}
	For clauses $C$ in the initial clause set, $\arr(C)$ is defined to contain an arrow from every grey occurrence to every colored occurrence for every variable occurring in the clause.  

	For the induction step, suppose the lemma holds for $C_1$ and $C_2$. 
	Note that $C_1$ and $C_2$ are variable disjoint.
	\mytodo{how to continue without checking every single case?}

	Note that terms are only changed by means of substitution. 

	If a variable is substituted, it does not occur any further in the derivation. 

	If a variable is substituted by a term containing variables, this is fine because the original arrows still apply for the new terms. 
\end{proof}

\begin{lemma}
	{

		\LARGE\bfseries\color{red} (same as above)
		not true in this formulation, we can have $x$, $f(x)$ and $g(x)$ with arrows just from $x$ to the two colored occurrences, even if $f$ and $g$ of same color.


	}
	\label{DEPR:lemma:arrow_from_colored_to_colored}
	Let $x$ be a variable which occurs colored in $\AIclause\de(C)$ and again colored in the same color somewhere else in $\AI\de(C)$.
	Then there is a merge edge between the maximal colored terms containing the two occurrences.
	\comm{This is exactly the case we need, possibly show something more general}
\end{lemma}
\begin{proof}
	\mytodo{}
\end{proof}


\end{document}
