\documentclass[,%fontsize=11pt,%
	paper=a4,% 
	%landscape,
	DIV10, % mehr text pro seite als defaultyyp
	%DIV10, 
	%DIV=calc,%
	twoside=false,%
	liststotoc,
	bibtotoc,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
]{scrartcl}

\usepackage{lscape}
\usepackage{stackengine}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}

% subsections also in toc
\setcounter{tocdepth}{2}

%\declaretheorem[title=Theorem,qed=$\triangle$,parent=chapter]{thm}
\newcommand{\thmqed}{$\square$} % for thms without proof
\newcommand{\propqed}{$\square$} % for props without proof
\declaretheorem[title=Theorem]{thm}
\declaretheorem[title=Proposition,sibling=thm]{prop}
%\declaretheorem[title=Lemma,parent=chapter]{lemma}
\declaretheorem[sibling=thm]{lemma}
\declaretheorem[title=Corollary,sibling=thm]{corr}
\declaretheorem[sibling=thm,title=Definition,style=definition,qed=$\triangle$]{defi}
%\declaretheorem[title=Definition,qed=$\triangle$,parent=chapter]{defi}
\declaretheorem[title=Example,style=definition,qed=$\triangle$,sibling=thm]{exa}

\declaretheorem[sibling=thm,title=Conjecture]{conj}

\declaretheorem[title=Remark,style=remark,numbered=no,qed=$\triangle$]{remark}

%\def\proofSkipAmount{ \vskip -0.5em}



%\usepackage{bussproof}

%\usepackage{vaucanson-g}
\usepackage{amssymb}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}
\usepackage{tabularx}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{color}
\usepackage[final]{listings} % sourcecode in document
\usepackage{url}      % for urls
\usepackage{multicol}
\usepackage{float}
\usepackage{caption}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

\usepackage[authoryear]{natbib} % \cite ; square|round etc.
%\usepackage[numbers,square]{natbib}
%\usepackage[square, authoryear]{natbib}
%\usepackage[language=english]{biblatex}

%\bibliographystyle{plain}
\bibliographystyle{alpha}
%\bibliographystyle{alphadin}
%\bibliographystyle{dinat}
%\bibliographystyle{chicago}
%\bibliographystyle{plainnat}

\bibdata{bib.bib}

\renewcommand*{\partformat}{\partname\ \thepart\ -}
\let\partheadmidvskip\

\newcommand{\comp}{\ensuremath{\text{comp}}}
% smaller url style
\makeatletter
\def\url@leostyle{%
\@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\ttfamily}}}
\makeatother
\urlstyle{leo}

\newcommand{\myfig}[5] {
	\begin{figure}[tbph]
		\centering
		\includegraphics[#3]{#1}
		\caption[#4]{#5}
		\label{fig:#2}
	\end{figure}
}

\setlength{\parindent}{0em}
%\usepackage{thmtools} % actually already in latex_header.tex ...

\usepackage{amsthm}


\usepackage{tikz-qtree}

%\newcommand{\sig}[1]{{#1}_\Sigma}
%\newcommand{\p}[1]{{#1}_\Pi}
\newcommand{\sig}[1]{\stackrel{\Sigma}{#1}}
\newcommand{\p}[1]{\stackrel{\Pi}{#1}}

\newcommand{\e}[1]{\vskip .7em   \subsection*{#1}}

%\def\proofSkipAmount{ \vskip -0.3em}

\usepackage{refcheck}

\begin{document}

\newcommand{\lif}[1]{\lift{\Delta}{#1}{x}}
\newcommand{\newterm}{^*}
\newcommand{\de}{^\Delta}


\begin{lemma}
	\label{lemma:arrow_from_grey_to_colored}
	Let $x$ be a variable in $\AIclause\de(C)$.
	Suppose there is a colored and a grey occurrence of $x$.
	Then for every colored occurrence $p$ of $x$ there is an arrow from some grey occurrence to~$p$.
	\comm{Should also hold for all of $\AI\de$, but is currently not needed in the proof}
\end{lemma}
\begin{proof}
	\mytodo{}
\end{proof}

\begin{lemma}
	\label{lemma:arrow_from_colored_to_colored}
	Let $x$ be a variable which occurs colored in $\AIclause\de(C)$ and again colored somewhere else in $\AI\de(C)$.
	Then there is a merge edge between the maximal colored terms containing the two occurrences.
	\comm{This is exactly the case we need, possibly show something more general}
\end{lemma}
\begin{proof}
	\mytodo{}
\end{proof}

\begin{exa}
	\label{exa:lifting_var_only_abstraction_in_arrow_proof}
	$\Gamma = \{ Q(\gamma(x)) \lor P(x), \lnot Q(\gamma(z)), R(\dots)\}$\todo{$R$ only for coloring}

	$\Delta = \{ \lnot P(\delta(y)) \lor R(y), \lnot R(a), Q(\dots) \}$\todo{$Q$ only for coloring}

	$ a \sim x_k, \delta(y) \sim x_i, \delta(a) \sim x_j $

	\begin{prooftree}
		\AxiomCm{ \bot \mid Q(\gamma(x)) \lor P(x) }
		\AxiomCm{ \top \mid \lnot P(x_i) \lor R(y) }

		\BinaryInfCm{ P(x_i) \mid Q(\gamma(x_i)) \lor R(y) }

		\AxiomCm{ \top \mid \lnot R(x_k) }

		\BinaryInfCm{ (\lnot R(x_k) \land P(x_i) ) \lor (R(x_k) \land \top)  \mid Q(\gamma(x_i)) }
		\noLine
		\UnaryInfCm{ P(x_i) \lor R(x_k)  \mid Q(\gamma(x_i)) }

		\AxiomCm{ \bot \mid \lnot Q(\gamma(z)) }

		\BinaryInfCm{ ( \lnot Q(x_j) \land ( P(x_i) \lor R(x_k) )) \lor (Q(x_j) \land \top)   \mid \square }
		\noLine
		\UnaryInfCm{   \lnot Q(x_j) \land (P(x_i) \lor R(x_k)) \mid \square }

	\end{prooftree}

	Gist: When $Q(\gamma(x_i))$ is the only symbol in $\AI\de(\cdot)$, the lifting var means $\delta(x)$, but in the actual derivation, it's $\delta(a)$. however $\tau$ fixes this.
	So before $Q$ is resolved, there is an arrow, but with the wrong lifting var ($x_i$ instead of $x_j$)
\end{exa}

\newcommand{\substremarksym}{$\ast$}
\newcommand{\substremarkref}{$(\ast)$}
\begin{remark}[\substremarksym]
	Any substitution, in particular $\sigma$, only changes a finite number of variables.
	Furthermore a result of a run of the unification algorithm is acyclic in the sense that if a substitution $u\mapsto t$ is added to the resulting substitution, it is never the case that at a later stage $t\mapsto u$ is added.
	This can easily be seen by considering that at the point when $u\mapsto t$ is added to the resulting substitution, every occurrence of $u$ is replaced by $t$, so $u$ is not encountered by the algorithm at a later stage.

	Therefore in order to show that a statement holds for every $u\mapsto t$ in a unifier $\sigma$, 
	it suffices to show by an induction argument that for every substitution $v\mapsto s$ which is added to the resulting unifier by the unification algorithm that it holds for $v\mapsto s$ under the assumption that it holds for every $w\mapsto r$ such that $w$ occurs in $s$ and $w\mapsto r$ is added to the resulting substitution at a later stage.
\end{remark}


\begin{conj}
	Let $C$ be a clause in a resolution refutation. 
	Suppose that $\AI\de(C)$ contains a maximal $\Gamma$-term $\gamma_j\occ{z_i}$ which contains a lifting variable $z_i$. %(lifting a $\Delta$-term $\delta_i$).
	%Then there is an arrow in $\arrFinal(C)$ from a term containing $z_k$ in $\AI\de(C)$ such that $\delta_k$ is an abstraction of $\delta_i$ to $\gamma_j\occ{z_i}$.
	Then $z_i \ltArrC z_j$.
\end{conj}
\begin{proof}
	We proceed by induction.
	For the base case, note that no multicolored terms occur in inital clauses, so no lifting term can occur inside of a $\Gamma$-term.

	\newcommand{\oldgam}{\bm\tilde\gamma_{j\bm'}} 
	\newcommand{\newgam}{\gamma_j} % this should correspond with the statement, and there, the symbol should be plain (also below)

	Suppose a clause $C$ is the result of a resolution of $C_1: D \lor l$ and $C_2: E \lor \lnot l$ with $l\sigma = l'\sigma$.
	Furthermore suppose that for every lifting term inside a $\Gamma$-term in the clauses $C_1$ and $C_2$ of the refutation, for every term of the form $\gamma_j\occ{z_i}$ we have that $z_i \ltArrCOne z_j$ or $z_i \ltArrCTwo z_j$ respectively. Hence there is an arrow $(p_1, p_2)$ in $\arrFinal(C_1)$ or $\arrFinal(C_2)$ such that $z_i$ is contained in $\pos(p_1)$ and $z_j$ is contained in $\pos(p_2)$.
	In $\AI\de(C)$, $\pos(p_1)$ contains $\lifboth{z_i\sigma}\tau = z_i\tau$ and $\pos(p_2)$ contains $\lifboth{z_j\sigma}\tau = z_j\tau$.
	Hence the indicies of the lifting variables might change, but this renaming does not affect the relation of the objects as $\arrFinal(C_1) \cup \arrFinal(C_2) \subseteq \arrFinal(C)$.


	We show that $z_i \ltArrC z_j $ holds true also for every new term of the form $\newgam\occ{z_i}$ for some $j, i$ in $\AI\de(C)$. By ``new'', we mean terms which are not present in $\AI\de(C_1)$ or $\AI\de(C_2)$.
	Note that new terms in $\AI\de(C)$ are of the form $\lifdelta{t\sigma}\tau$ for some $t \in \AI\de(C_1) \cup \AI\de(C_2)$.
	By Lemma~\ref{lemma:no_lifting_vars_in_subst}, $\sigma$ does not introduce lifting variables.
	Hence a new term of the form $\newgam\occ{z_i}$ is created either by introducing a $\Delta$-term into a $\Gamma$-term or by introducing $\newgam\occ{\delta_i}$ via $\sigma$, both followed by the lifting. 
	Note that $\tau$ only substitutes lifting variables by other lifting variables and hence does not introduce lifting variables. Furthermore by Lemma~\ref{lemma:tau_is_specialisation}, $\tau$ only substitutes lifting variables for other lifting variables, whose corresponding term is more specialised. Hence if there exists an arrow from a lifting variable to $\newgam\occ{z_i}$ according to this lemma, it is also an appropriate arrow if $\newgam\occ{z_i}$ is replaced by $\newgam\occ{z_i}\tau$.


	We now distinguish the two cases under which a new term $\newgam\occ{z_i}$ can occur in $\AI\de(C)$:

	\begin{description}
		\item[Suppose for some $\Gamma$-term $\oldgam\occ{u}$ in $\AI\de(C_1)$ or $\AI\de(C_2)$, $u\sigma$ contains a $\Delta$-term.]\hfill\nopagebreak

			Hence we have that $(\oldgam\occ{u})\sigma = \newgam\occ{\delta_i}$ for some $i$.
			Note that the position of $u$ in $\oldgam\occ{u}$ does not necessarily coincide with the position of $\delta_i$ in $\newgam\occ{\delta_i}$ as $u$ might be substituted by $\sigma$ for a grey term containing $\delta_i$.

			We have that $\lifdeltanovar{\oldgam\occ{u}\sigma}\tau = \newgam\occ{z_i}$.

			\newcommand{\hatu}{{\bm\hat u}}
			\newcommand{\hatuPrime}{t_{\bm\hat u}}
			At some well-defined point of application of the unification algorithm, $u$ is substituted by an abstraction of a term which contains $\delta_i$. This occurrence of $u$ is in $l$ and we denote it by $\hatu$.
			We furthermore denote the term at the corresponding position in $l'$ by~$\hatuPrime$.

			We distinguish cases based on the occurrences of $\hatu$ and $\hatuPrime$.
			\begin{itemize}
				\item Suppose $\hatu$ is a grey occurrence.

					\begin{figure}[h]
						\begin{prooftree}
							\AxiomCm{C_1: P(\oldgam\occ{u}) \lor Q(\hatu)}
							\AxiomCm{C_2: \lnot Q(\hatuPrime)}
							\BinaryInfCm{C: P(\newgam\occ{\delta_i})}
						\end{prooftree} 
						\caption{Example for this case}
					\end{figure}

					Then by Lemma~\ref{lemma:arrow_from_grey_to_colored}, there is an arrow from $\hatu$ to $\gamma_j\occ{u}$ in $\arrFinal(C)$.
					As $\hatu\sigma$ is a term containing the $\Delta$-term $\delta_i$, the term at the position of $\hatu$ in $\AI\de(C)$ is $\lifboth{\hatu\sigma}\tau$, which by assumption contains $z_i$. 
					But there is an arrow from this term containing $z_i$ to $\newgam\occ{z_i}$, so $z_i \ltArrC z_j$.


					\begin{comment}% version with "less induction hypothesis"
						As $\hatu$ and $\hatuPrime$ are at corresponding positions in the resolved literal, their arrows are merged, so it suffices to show that there is an arrow from a term containing an occurrence of $z_i$ to the position of $\hatuPrime$.

						\begin{itemize} 
							\item Suppose $\hatuPrime$ is a term which does not contain a $\Delta$-term.
								Then as $\hatuPrime\sigma$ is a term containing a $\Delta$-term, we know that $\hatuPrime$ contains a variable, say $v$, for which we have that $v\sigma$ is a term which contains a $\Delta$-term.
								Then by Remark~\substremarkref, we can assume that there is an arrow from a term containing an occurrence of $z_i$ to the position of $\hatuPrime$.

							\item Suppose that $\hatuPrime$ is a term containing a $\Delta$-term.
								Then as $\hatu\sigma=\hatuPrime\sigma$, 

						\end{itemize}
					\end{comment}


				\item Suppose $\hatu$ occurs in a maximal colored term which is a $\Gamma$-term.

					\begin{figure}[h]
						\begin{prooftree}
							\AxiomCm{C_1: P(\oldgam\occ{u}) \lor Q(\gamma_k\occurat{\hatu}{p}) }
							\AxiomCm{C_2: \lnot Q(\gamma_{m}\occurat{\hatuPrime}{p})}
							\BinaryInfCm{C: P(\newgam\occ{\delta_i})}
						\end{prooftree} 
						\begin{prooftree}
							\AxiomCm{C_1: Q(\oldgam\occ{\hatu}) }
							\AxiomCm{C_2: \lnot Q(\gamma_m\occ{\hatuPrime})}
							\BinaryInfCm{C: \square }
							\noLine
							\UnaryInfCm{\comm{\newgam\occ{\delta_i}\text{ occurs in the interpolant}}}
						\end{prooftree} 
						\caption{Examples for this case}
					\end{figure}

					Then either $\hatu$ is the occurrence of $u$ in $\oldgam\occ{\hatu}$ or it occurs in a different $\Gamma$-term~$\gamma_j\occ{\hatu}$.
					In the latter case, by Lemma~\ref{lemma:arrow_from_colored_to_colored}, there is a merge edge between $\oldgam\occ{\hatu}$ and $\gamma_j\occ{\hatu}$. 
					Hence in both cases, it suffices to show that there is an arrow from a term containing an occurrence of $z_i$ to $\hatuPrime$.

					We distinguish on the shape of $\hatuPrime$:
					\begin{itemize}
							\item $\hatuPrime$ is a term which does not contain a $\Delta$-term.
								Then it contains a variable that is be substituted by $\sigma$ by a term which contains a $\Delta$-term as $u\sigma = \hatuPrime\sigma$ is a term containing a $\Delta$-term.
							We denote by $v$ the variable in $\hatuPrime$ which is substituted by a term containing a $\Delta$-term in case $\hatuPrime$ is a grey term.

							In the course of the unification algorithm, there are further unifications of $v$ since we know that $u\sigma = v\sigma$ is a term containing a $\Delta$-term. 
							Therefore by Remark~\substremarkref, we can assume that there is an appropriate arrow to $\hatuPrime$.

						\item $\hatuPrime$ is a term which contains a $\Delta$-term.
							As $\hatuPrime$ occurs in a $\Gamma$-term in $C_1$, say in $\gamma_m\occ{\hatuPrime}$, $C_1$ contains a multicolored $\Gamma$-term.
							Hence the corresponding term in $\AI\de(C_1)$, is of the form $\gamma_m\occ{z_{i\bm '}}$ for some $i\bm'$. 
							Observe that $i\bm'$ in general is not equal to $i$ as demonstrated in Example~\ref{exa:lifting_var_only_abstraction_in_arrow_proof}, even though we have that $\hatuPrime\sigma = u\sigma$.
							This is because the lifting variables in $\AI(\cdot)$ represent abstractions of the terms in the clauses of the resolution derivation (cf.\ Lemma~\ref{lemma:lifting_var_refers_to_abstraction_of_term}). 
							Therefore we only know by the induction hypothesis that $z_{i\bm'} \ltArrCOne \lifboth{\gamma_m\occ{z_{i\bm'}}} = \lifboth{\hatuPrime}$.

							However by Lemma~\ref{lemma:literals_clauses_equal} and due to the fact that $\hatu$ and $\hatuPrime$ respectively occur in the resolved literal, $\lifdeltanovar{\hatu \sigma}\tau = \lifdeltanovar{\hatuPrime \sigma}\tau$.
							As 
							$\lifdeltanovar{\hatu \sigma}\tau = \lifdeltanovar{\delta_i}\tau = z_i\tau $
							as well as
							$ \lifdeltanovar{\hatuPrime \sigma}\tau = \lifdeltanovar{z_{i\bm'}\sigma}\tau = z_{i\bm'}\tau$,
							we must have that $z_i\tau = z_{i\bm'}\tau$.
							As however $u\sigma = \delta_i$, by the definition of $\aiu$, we have that $\{z_i\mapsto z_i\} \in \tau$, so $z_{i\bm'}\tau = z_i$.

							Since $\tau$ is applied to every literal in $\AI\de(C)$ and in $\AI\de(C_1)$ an arrow from a term containing $z_{i\bm'}$ to $\hatuPrime$ exists,
							the same arrow applied to $\AI\de(C)$ points from a term containing $z_{i\bm'}\tau = z_i$ to $\hatuPrime$.
							Therefore $z_i \ltArrC z_j$.


					\end{itemize}


				\item Suppose $\hatu$ occurs in a maximal colored term which is a $\Delta$-term.
						\begin{prooftree}
							\AxiomCm{C_1: P(\oldgam\occ{u}) \lor Q(\delta_k\occurat{\hatu}{p}) }
							\AxiomCm{C_2: \lnot Q(\delta_{m}\occurat{\hatuPrime}{p})}
							\BinaryInfCm{C: P(\newgam\occ{\delta_i})}
						\end{prooftree} 

						By Lemma~\ref{lemma:arrow_for_variables_in_differently_colored_terms}, \mytodo{}


			\end{itemize}

			\textbf{The substitution can also introduce a grey term containing a delta term, make sure to handle that!}

			\textbf{The substitution can also introduce a gamma term containing a delta term, make sure to handle that!}

		\item[Suppose for some variable $v$ in $\AI\de(C_1)$ or $\AI\de(C_2)$, $v\sigma = \newgam\occ{\delta_i}$ for some $i$.]\hfill\\
			As $v$ is affected by the unifier, it occurs in the literal being unified, say w.l.o.g.~in $l$ in $C_1$.
			At some well-defined point in the unification algorithm, $v$ is substituted by an abstraction of $\newgam\occ{\delta_i}$.
			Let $p$ be the position of the occurrence of $v$ in $l$ which causes this substitution.
			Furthermore, let $p'$ be the position corresponding to $p$ in~$l'$.

			Note that any arrow from or to $p'$ also applies to $p$ in $\arrFinal(C)$ and hence to $\newgam\occ{z_i}$ as they are merged due to occurring in the resolved literal.
			So it suffices to show that there is an arrow from an appropriate lifting variable to $p'$. We denote the term at $p'$ by $t$.

			Note that $t\sigma = \newgam\occ{\delta_i}$.
			So $t$ is either a $\Gamma$-term containing a $\Delta$-term, in which case we know that there is an appropriate arrow by the induction hypothesis as $t$ occurs in $l'$ in $C_2$, or $t$ is an abstraction of $\newgam\occ{\delta_i}$, in which case we can assume the existence of an appropriate arrow by Remark~\substremarkref.
			\todo{recheck this paragraphs w.r.t.~$\ltArrC$}
			\qedhere

			\begin{comment}
				We distinguish cases based on the shape of the term at $p'$, which we denote by $t$:
				\begin{itemize}
					\item $t$ is a variable, say $x$. 
						Then $x$ occurs elsewhere in $l'$ and $x\sigma = \newgam\occ{\delta_i}$.
						By Remark~\substremarkref, we can assume that there is an appropriate arrow for $x\sigma$ ad $p'$.

					\item $t$ is a $\Gamma$-term which does not contain a $\Delta$-term.
						$t$ is however an abstraction of $\newgam\occ{\delta_i}$, so it contains at least one variable which is substituted by a term $s$.
						Hence by Remark~\substremarkref, we can assume that an appropriate arrow pointing to $t$ exists.

						We distinguish based on the shape $s$:
						\begin{itemize}
							\item $s$ is a grey or $\Delta$-colored term containing a $\Delta$-term.
								Then a $\Delta$-term is introduced into a $\Gamma$-term by means of unification, so by the respective case of the proof, there is an arrow from an appropriate lifting variable to~$t$.

							\item $s$ is a multicolored $\Gamma$-term.
								Then by Remark~\substremarkref, we can assume that an appropriate arrow pointing to $t$ exists.
						\end{itemize}
					\item $t$ is a $\Gamma$-term containing a $\Delta$-term.
				\end{itemize}
			\end{comment}


	\end{description}

\end{proof}


\end{document}
