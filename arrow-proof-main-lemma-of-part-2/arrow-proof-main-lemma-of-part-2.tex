\documentclass[,%fontsize=11pt,%
	paper=a4,% 
	%landscape,
	DIV10, % mehr text pro seite als defaultyyp
	%DIV10, 
	%DIV=calc,%
	twoside=false,%
	liststotoc,
	bibtotoc,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
]{scrartcl}

\usepackage{lscape}
\usepackage{stackengine}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}

% subsections also in toc
\setcounter{tocdepth}{2}

%\declaretheorem[title=Theorem,qed=$\triangle$,parent=chapter]{thm}
\newcommand{\thmqed}{$\square$} % for thms without proof
\newcommand{\propqed}{$\square$} % for props without proof
\declaretheorem[title=Theorem]{thm}
\declaretheorem[title=Proposition,sibling=thm]{prop}
%\declaretheorem[title=Lemma,parent=chapter]{lemma}
\declaretheorem[sibling=thm]{lemma}
\declaretheorem[title=Corollary,sibling=thm]{corr}
\declaretheorem[sibling=thm,title=Definition,style=definition,qed=$\triangle$]{defi}
%\declaretheorem[title=Definition,qed=$\triangle$,parent=chapter]{defi}
\declaretheorem[title=Example,style=definition,qed=$\triangle$,sibling=thm]{exa}

\declaretheorem[sibling=thm,title=Conjecture]{conj}

\declaretheorem[title=Remark,style=remark,numbered=no,qed=$\triangle$]{remark}

%\def\proofSkipAmount{ \vskip -0.5em}



%\usepackage{bussproof}

%\usepackage{vaucanson-g}
\usepackage{amssymb}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}
\usepackage{tabularx}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{color}
\usepackage[final]{listings} % sourcecode in document
\usepackage{url}      % for urls
\usepackage{multicol}
\usepackage{float}
\usepackage{caption}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

\usepackage[authoryear]{natbib} % \cite ; square|round etc.
%\usepackage[numbers,square]{natbib}
%\usepackage[square, authoryear]{natbib}
%\usepackage[language=english]{biblatex}

%\bibliographystyle{plain}
\bibliographystyle{alpha}
%\bibliographystyle{alphadin}
%\bibliographystyle{dinat}
%\bibliographystyle{chicago}
%\bibliographystyle{plainnat}

\bibdata{bib.bib}

\renewcommand*{\partformat}{\partname\ \thepart\ -}
\let\partheadmidvskip\

\newcommand{\comp}{\ensuremath{\text{comp}}}
% smaller url style
\makeatletter
\def\url@leostyle{%
\@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\ttfamily}}}
\makeatother
\urlstyle{leo}

\newcommand{\myfig}[5] {
	\begin{figure}[tbph]
		\centering
		\includegraphics[#3]{#1}
		\caption[#4]{#5}
		\label{fig:#2}
	\end{figure}
}

\setlength{\parindent}{0em}
%\usepackage{thmtools} % actually already in latex_header.tex ...

\usepackage{amsthm}


\usepackage{tikz-qtree}

%\newcommand{\sig}[1]{{#1}_\Sigma}
%\newcommand{\p}[1]{{#1}_\Pi}
\newcommand{\sig}[1]{\stackrel{\Sigma}{#1}}
\newcommand{\p}[1]{\stackrel{\Pi}{#1}}

\newcommand{\e}[1]{\vskip .7em   \subsection*{#1}}

\def\proofSkipAmount{ \vskip -0.3em}

\usepackage{refcheck}

\begin{document}

\newcommand{\lif}[1]{\lift{\Delta}{#1}{x}}
\newcommand{\newterm}{^*}
\newcommand{\de}{^\Delta}

\newcommand{\substremarksym}{$\ast$}
\newcommand{\substremarkref}{$(\ast)$}
\begin{remark}[\substremarksym]
	Any substitution, in particular $\sigma$, only changes a finite number of variables.
	Furthermore a result of a run of the unification algorithm is acyclic in the sense that if a substitution $u\mapsto t$ is added to the resulting substitution, it is never the case that at a later stage $t\mapsto u$ is added.
	This can easily be seen by considering that at the point when $u\mapsto t$ is added to the resulting substitution, every occurrence of $u$ is replaced by $t$, so $u$ is not encountered by the algorithm at a later stage.

	Therefore in order to show that a statement holds for every $u\mapsto t$ in a unifier $\sigma$, 
	it suffices to show by an induction argument that for every substitution $v\mapsto s$ which is added to the resulting unifier by the unification algorithm that it holds for $v\mapsto s$ under the assumption that it holds for every $w\mapsto r$ such that $w$ occurs in $s$ and $w\mapsto r$ is added to the resulting substitution at a later stage.
\end{remark}


\begin{conj}
	Let $C$ be a clause in a resolution refutation. 
	Suppose that $\AI\de(C)$ contains a maximal $\Gamma$-term $\gamma_j\occ{z_i}$ which contains a lifting variable $z_i$. %(lifting a $\Delta$-term $\delta_i$).
	%Then there is an arrow in $\arrFinal(C)$ from a term containing $x_k$ in $\AI\de(C)$ such that $\delta_k$ is an abstraction of $\delta_i$ to $\gamma_j\occ{z_i}$.
	Then $z_i \ltArrC y_j$.
\end{conj}
\begin{proof}
	We proceed by induction.
	For the base case, note that no multicolored terms occur in inital clauses, so no lifting term can occur inside of a $\Gamma$-term.

	\newcommand{\oldgam}{\bm\tilde\gamma_j} 
	\newcommand{\newgam}{\gamma_j} % this should correspond with the statement, and there, the symbol should be plain (also below)

	Suppose a clause $C$ is the result of a resolution of $C_1: D \lor l$ and $C_2: E \lor \lnot l$ with $l\sigma = l'\sigma$.
	Furthermore suppose that for every lifting term inside a $\Gamma$-term in the clauses $C_1$ and $C_2$ of the refutation, for every term of the form $\gamma_j\occ{z_i}$ we have that $z_i \ltArrCOne y_j$ or $z_i \ltArrCTwo y_j$ respectively. Hence there is an arrow $(p_1, p_2)$ in $\arrFinal(C_1)$ or $\arrFinal(C_2)$ such that $z_i$ is contained in $\pos(p_1)$ and $z_j$ is contained in $\pos(p_2)$.
	In $\AI\de(C)$, $\pos(p_1)$ contains $\lifboth{z_i\sigma}\tau = z_i\tau$ and $\pos(p_2)$ contains $\lifboth{z_j\sigma}\tau = z_j\tau$.
	Hence the indicies of the lifting variables might change, but this renaming does not affect the relation of the objects as $\arrFinal(C_1) \cup \arrFinal(C_2) \subseteq \arrFinal(C)$.


	We show that $z_i \ltArrC z_j $ holds true also for every new term of the form $\newgam\occ{z_i}$ for some $j, i$ in $\AI\de(C)$. By ``new'', we mean terms which are not present in $\AI\de(C_1)$ or $\AI\de(C_2)$.
	Note that new terms in $\AI\de(C)$ are of the form $\lifdelta{t\sigma}\tau$ for some $t \in \AI\de(C_1) \cup \AI\de(C_2)$.
	By Lemma~\ref{lemma:no_lifting_vars_in_subst}, $\sigma$ does not introduce lifting variables.
	Hence a new term of the form $\newgam\occ{z_i}$ is created either by introducing a $\Delta$-term into a $\Gamma$-term or by introducing $\newgam\occ{\delta_i}$ via $\sigma$, both followed by the lifting. 
	Note that $\tau$ only substitutes lifting variables by other lifting variables and hence does not introduce lifting variables. Furthermore by Lemma~\ref{lemma:tau_is_specialisation}, $\tau$ only substitutes lifting variables for other lifting variables, whose corresponding term is more specialised. Hence if there exists an arrow from a lifting variable to $\newgam\occ{z_i}$ according to this lemma, it is also an appropriate arrow if $\newgam\occ{z_i}$ is replaced by $\newgam\occ{z_i}\tau$.


	We now distinguish the two cases under which a new term $\newgam\occ{z_i}$ can occur in $\AI\de(C)$:

	\begin{description}
		\item[Suppose for some $\Gamma$-term $\oldgam\occ{u}$ in $\AI\de(C_1)$ or $\AI\de(C_2)$, $(\oldgam\occ{u})\sigma = \newgam\occ{\delta_i}$ for some $i$.]\hfill


			\textbf{The substitution can also introduce a grey term containing a delta term, make sure to handle that!}

			\textbf{The substitution can also introduce a gamma term containing a delta term, make sure to handle that!}

			\mytodo{continue here as soon as arrow pos issue is sorted out}

		\item[Suppose for some variable $v$ in $\AI\de(C_1)$ or $\AI\de(C_2)$, $v\sigma = \newgam\occ{\delta_i}$ for some $i$.]\hfill

			As $v$ is affected by the unifier, it occurs in the literal being unified, say w.l.o.g.~in $l$ in $C_1$.
			At some well-defined point in the unification algorithm, $v$ is substituted by an abstraction of $\newgam\occ{\delta_i}$.
			Let $p$ be the position of the occurrence of $v$ in $l$ which causes this substitution.
			Furthermore, let $p'$ be the position corresponding to $p$ in~$l'$.

			Note that any arrow from or to $p'$ also applies to $p$ in $\arrFinal(C)$ and hence to $\newgam\occ{z_i}$ as they are merged due to occurring in the resolved literal.
			So it suffices to show that there is an arrow from an appropriate lifting variable to $p'$. We denote the term at $p'$ by $t$.

			Note that $t\sigma = \newgam\occ{\delta_i}$.
			So $t$ is either a $\Gamma$-term containing a $\Delta$-term, in which case we know that there is an appropriate arrow by the induction hypothesis as $t$ occurs in $l'$ in $C_2$, or $t$ is an abstraction of $\newgam\occ{\delta_i}$, in which case we can assume the existence of an appropriate arrow by Remark~\substremarkref.
			\todo{recheck this paragraphs w.r.t.~$\ltArrC$}
			\qedhere

			\begin{comment}
				We distinguish cases based on the shape of the term at $p'$, which we denote by $t$:
				\begin{itemize}
					\item $t$ is a variable, say $x$. 
						Then $x$ occurs elsewhere in $l'$ and $x\sigma = \newgam\occ{\delta_i}$.
						By Remark~\substremarkref, we can assume that there is an appropriate arrow for $x\sigma$ ad $p'$.

					\item $t$ is a $\Gamma$-term which does not contain a $\Delta$-term.
						$t$ is however an abstraction of $\newgam\occ{\delta_i}$, so it contains at least one variable which is substituted by a term $s$.
						Hence by Remark~\substremarkref, we can assume that an appropriate arrow pointing to $t$ exists.

							We distinguish based on the shape $s$:
							\begin{itemize}
								\item $s$ is a grey or $\Delta$-colored term containing a $\Delta$-term.
									Then a $\Delta$-term is introduced into a $\Gamma$-term by means of unification, so by the respective case of the proof, there is an arrow from an appropriate lifting variable to~$t$.

								\item $s$ is a multicolored $\Gamma$-term.
									Then by Remark~\substremarkref, we can assume that an appropriate arrow pointing to $t$ exists.
							\end{itemize}
					\item $t$ is a $\Gamma$-term containing a $\Delta$-term.
				\end{itemize}
			\end{comment}


	\end{description}

\end{proof}


\end{document}
