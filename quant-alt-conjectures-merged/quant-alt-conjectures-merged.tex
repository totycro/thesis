\documentclass[%fontsize=11pt,%
	%landscape,
	%DIV8, % mehr text pro seite als defaultyyp
	%DIV10,
	%DIV=calc,%
	%article,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod,%
	11pt,%
	a4paper,%
	oneside,% apparently, this should stay below some other parameter to have an effect
	openany,%
	%]{scrartcl}
]{memoir}





%\usepackage[bitstream-charter]{mathdesign}
\usepackage{amssymb}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\input{../latex_header.tex}



%\renewcommand{\familydefault}{ \sfdefault }
%\renewcommand{\rmdefault}{ppl}


%\usepackage[urw-garamond]{mathdesign}





% subsections also in toc
\setcounter{tocdepth}{2}
\setsecnumdepth{subsection}


\definethms

\def\proofSkipAmount{ \vskip -0.1em }


%\usepackage{bussproof}

%\usepackage{vaucanson-g}
%\usepackage{amsmath}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
%\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}


\usepackage{amsthm}


\chapterstyle{madsen}


% define page numbering styles
\makepagestyle{numberCorner}
\makeevenfoot{numberCorner}{\thepage}{}{}
\makeoddfoot{numberCorner}{}{}{\thepage}

\makepagestyle{numberCenter}
%\makeevenfoot{numberCenter}{}{\thepage}{}
%\makeoddfoot{numberCenter}{}{\thepage}{}
%
%\makeevenhead{numberCenter}{\thechapter}{}{\thesection}
%\makeoddhead{numberCenter}{\thesection }{}{\thechapter}
\makeheadrule{numberCenter}{\textwidth}{1pt}

\makeevenhead{numberCenter}{\thepage}{}{\leftmark}
\makeoddhead{numberCenter}{\rightmark}{}{\thepage}


\makeatletter
\makepsmarks{numberCenter}{
	\def\chaptermark##1{\markboth{%
			\ifnum \value{secnumdepth} > -1
			\if@mainmatter
			\chaptername\ \thechapter\ --- %
			\fi
			\fi
	##1}{}}
	\def\sectionmark##1{\markright{%
			\ifnum \value{secnumdepth} > 0
			\thesection. \ %
			\fi
	##1}}
}
\makeatother
\newcommand{\mysetpagestyle}{
	%\pagestyle{numberCorner}
	\pagestyle{numberCenter}
}
\mysetpagestyle





\usepackage{refcheck}

%\settypeblocksize{0.67\stockheight}{0.67\stockwidth}{*}
%\setlrmargins{*}{*}{1.2}
%\setulmargins{*}{*}{1.4}
%\checkandfixthelayout[nearest]

%% somewhat of a compromise, still long lines:
%\settypeblocksize{0.67\stockheight}{0.67\stockwidth}{*}
%%\settypeblocksize{0.65\stockheight}{0.65\stockwidth}{*}
%%\settypeblocksize{0.64\stockheight}{0.64\stockwidth}{*}
%%\settypeblocksize{0.63\stockheight}{0.63\stockwidth}{*}
%\setlrmargins{*}{*}{1.2}
%\setulmargins{*}{*}{1.4}
%\checkandfixthelayout[nearest]


\counterwithout{section}{chapter}




\begin{document}



\chapter{ Number of quantifier alternations of extracted interpolants }

In this chapter, we derive lower bounds for the number of quantifier alternations for the extraction procedure in two phases as well as the one in one phase.
We arrive at the conclusion that both procedures are equal with respect to this measure and that there is a tight connection between color alternations in terms and quantifier alternations in the interpolant.

%Quantifier alternations in $I$ usually assumes the quantifier-alternation-minimizing arrangement of quantifiers in $I$. The lemma statements hence talk about the \emph{minimal} number of quantifier alternations, which is indeed easily obtainable, i.e.\ it's a lower and upper bound at the same time.


\section{Additional notation and definitions}

A literal $l$ is called a $\Phi$-literal if its predicate symbol is $\Phi$-colored.

In a literal or term $\phi$ containing a subterm $t$, $t$ is said to occur \defiemph{below} a $\Phi$-symbol $s$ if in the syntax tree representation of $\phi$, there is a node labelled $s$ on the path from the root to $t$. Note that the colored symbol may also be the predicate symbol.
Moreover, $t$ is said to occur \defiemph{directly below} a $\Phi$-symbol if it occurs below the $\Phi$-symbol $s$ and in the syntax tree representation of $\phi$ on the path from $s$ to $t$, no nodes with labels with colored symbol occur.


\subsection{Unification}

Let $\varphi$ and $\psi$ be two terms or literals.
For $\sigma = \mgu(\varphi, \psi)$, we denote by $\sigma_i$ for $1\varleq i \varleq |\dom(\sigma)|$ the $i$th substitution which is added to $\sigma$ by the unification algorithm.
We define $\sigma_0 \defeq \id$.

We furthermore denote the composition $\sigma_i \quantifierdots \sigma_j$ by $\sigmarange{i}{j}$.
Hence $\sigma = \sigmarange{1}{|\dom(\sigma)|} = \sigmarange{0}{|\dom(\sigma)|}$.

\subsection{Color and quantifier alternations}

In the following, we assume that the maximum $\max$ of an empty sequence is defined to be $0$ and constants are treated as function symbols of arity $0$.
Furthermore $\bot$ is used to denote a color which is not possessed by any symbol.
\begin{defi}[Color alternation $\ca$]
	Let $\Gamma$ and $\Delta$ be sets of formulas and $t$ be a term.

	\medskip

	\noindent
	$\ca(t) \defeq \ca_\bot(t)$
	\medskip

	\noindent
	$
	\ca_\Phi(t) \defeq 
	\begin{cases}
		0 & \text{$t$ is a variable} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$t = f(t_1, \dots, t_n)$ is grey} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \parbox[t]{0.4\textwidth}{$t = f(t_1, \dots, t_n)$ is of color $\Phi$} \\
		1 + \max(\ca_\Psi(t_1), \dots, \ca_\Psi(t_n)) & \parbox[t]{0.38\textwidth}{$t = f(t_1, \dots, t_n)$ is of color $\Psi$, $\Phi \neq \Psi$} \\
	\end{cases}
	$
\end{defi}


\begin{defi}[Quantifier alternation $\qa$]
	Let $A$ be a formula.\nopagebreak
	\medskip

	\noindent
	$\qa(A) \defeq \qa_\bot(A)$
	\nopagebreak
	\medskip

	\noindent
	$
	\qa_Q(A) \defeq 
	\begin{cases}
		0 & \text{$A$ is an atom} \\
		\qa_Q(B) & \text{$A \equiv \lnot B$} \\
		\max(\parbox[t]{0.2\textwidth}{$\qa_Q(B),$\newline$ \qa_Q(C))$} & \text{$A \equiv B \circ C$, $\circ \in \{\land, \lor, \limpl\}$} \\
		\qa_Q(B) & \text{$A \equiv Q x B$} \\
		1+\qa_{Q'}(B) & \text{$A \equiv Q' x B$, $Q \neq Q'$}  \\
	\end{cases}
	$
	\nopagebreak

	\qedhere
\end{defi}
Note that this definition of quantifier alternations handles formulas in prenex and non-prenex form.

\section{Quantifier alternations in $\PI$}


\begin{defi}[$\PI^*$]
	$\PI^*$ is defined as $\PI$ with the difference that in $\PI^*$, all literals are considered to be grey.
	$\PIinit^*$ and $\PIstep^*$ are defined analogously.
\end{defi}

Hence $\PIinit^*$ coincides with $\PIinit$.
$\PIstep^*$ coincides with $\PIstep$ in case of factorisation and paramodulation inferences.
For resolution inferences, the first two cases in the definition of $\PIstep$ do not occur for $\PIstep^*$.

$\PI^*$ enjoys the convenient property that it absorbs every literal which occurs some clause:

\begin{prop}
	\label{prop:every_lit_in_pi_star}
	For every literal which occurs in a clause of a resolution refutation $\pi$, a respective successor occurs in $\PI^*(\pi)$.
\end{prop}
\begin{proof}
	By structural induction.
\end{proof}

Note that in $\PI^*$, we can conveniently reason about the occurrence of terms as no terms are lost throughout the extraction.
However Lemma~\ref{lemma:grey_lits_of_pi_star_in_pi} allows us to transfer results about grey literals to $\PI$:

\begin{lemma}
	\label{lemma:grey_lits_of_pi_star_in_pi}
	For every clause $C$ of a resolution refutation,
	every grey literal and equality, which occurs in $\PI^*(C)$, also occurs in $\PI(C)$.
\end{lemma}
\begin{proof}
	Note that $\PIinit$ and $\PIinit^*$ coincide and $\PIstep$ and $\PIstep^*$ only differ for resolution inferences.
	More specifically, they only differ on resolution inferences, where the resolved literal is colored. However here, no grey literals are removed but only colored ones.
\end{proof}


\begin{lemma}
	\label{lemma:Ot8Gie7y}
	Let $\inference$ be an inference of a resolution refutation using the clauses $C_1, \dots, C_n$ which creates the clause $C$.
	If there is a grey literal $\lambda$ or an equality $s=t$ in $\PI(C_i) \lor C_i$ for $1 \varleq i \varleq n$, 
	then a successor of $\lambda$ or $s=t$ respectively occurs in $\PIstep(\inference, \PI(C_1), \dots, \PI(C_n)) \lor C$.
\end{lemma}
\begin{proof}
	Immediate by the definition of $\PI$.
\end{proof}

\begin{corr}
	\label{lemma:grey_lits_and_eq_all_in_PI}
	If there is a grey literal $\lambda$ or an equality $s=t$ in $\PI(C) \lor C$ or $\LI(C) \lor C$ for a clause $C$ of a resolution refutation $\pi$,
	then a successor of $\lambda$ or $s=t$ respectively occurs in $\PI(\pi)$ 
\end{corr}
\begin{proof}
	This is a direct consequence of Lemma~\ref{lemma:Ot8Gie7y}.
\end{proof}

\begin{corr}
	\label{lemma:grey_lits_and_eq_all_in_LI}
	If there is a grey literal $\lambda$ or an equality $s=t$ in $\LI(C) \lor C$ or $\LI(C) \lor C$ for a clause $C$ of a resolution refutation $\pi$,
	then a successor of $\lambda$ or $s=t$ respectively occurs in $\LI(\pi)$ 
\end{corr}
\begin{proof}
	This is a direct consequence of Lemma~\ref{lemma:Ot8Gie7y}.
\end{proof}




We now make some considerations in the form of four lemmata about the construction of certain terms in the context of interpolant extraction.
In order to do so, we frequently reason over the stepwise application of the respective unifiers, for which we employ the following definition:

\begin{defi}
	We define $\PIstepnosigma$ to coincide with $\PIstep$ but without applying the substitution $\sigma$ in each of the cases.
	Furthermore, $\PIstarnosigma(C)$ is an abbreviation of $\PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_m))$.

	Analogously, if $C \equiv D\sigma$, we use $\nosigma{C}$ to denote\nolinebreak{} $D$.
\end{defi}

In the context of an inference $\inference$ using the clauses $C_1, \dots, C_m$ to infer $C$, it holds that:
\begin{align*}
	& \PI^*(C) \lor C = \\
	& \Big(\PIstep^*(\inference, \PI^*(C_1), \dots, \PI^*(C_m)) \lor C = \\
	& \Big(\PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_m)) \lor \nosigma{C} \Big) \sigma = \\
	& \Big(\PIstarnosigma(C)\lor \nosigma{C} \Big) \sigma = \\
	& \Big(\PIstarnosigma(C)\lor \nosigma{C} \Big) \sigmarange{0}{|\dom(\sigma)|}
\end{align*}

\newcommand{\inv}{\ensuremath{\PIstarnosigma(C)\lor \nosigma{C}}}
\newcommand{\invp}{\ensuremath{(\inv)}}


Note that if we are able to show that the application of a substitution $\sigma_i$ to $\invp\sigmazmi$ maintains an invariant and the invariant holds for $\inv$, then it immediately follows that it holds for $\PI^*(C) \lor C$. 



\begin{lemma}
	\label{lemma:var_below_phi_symbol}
	Let $\inference$ be a resolution or factorisation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs directly below a $\Phi$-symbol in $\invp\sigmazi$ for $i\vargeq 1$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{14_1}
			The variable $u$ occurs directly below a $\Phi$-symbol in $\invp\sigmazmi$.

		\item
			\label{14_5}
			The variable $u$ occurs at a grey position in a grey literal or at a grey position in an equality in $\invp\sigmazi$.

		\item 
			\label{14_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\invp\sigmazmi$ directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol
				\end{itemize}
			}

	\end{enumerate}
\end{lemma}
\begin{proof}
	We consider the different situations under which the situation in question arises:

	\begin{itemize}
		\item
			There is already a literal in $\invp\sigmazmi$ where $u$ occurs directly below a $\Phi$-symbol and $\sigma_i$ does not change this.
			Then clearly \ref{14_1} is the case.

		\item
			There is a variable $v$ in $\invp\sigmazmi$ such that $v\sigma_i$ contains $u$ directly below a $\Phi$-symbol.
			As $v$ is unified with the term $v\sigma_i$, $v\sigma_i$ must occur in $\invp\sigmazmi$, which implies that \ref{14_1} is the case.

		\item
			There is a variable $v$ which occurs directly below a $\Phi$-symbol such that $u$ occurs grey in $v\sigma_i$.

			Hence in the resolved or factorised literals $\lambda$ and $\lambda'$ in $\invp\sigmazmi$, there is a position $p$ such that without loss of generality $\lambda\atp = v$ and $u$ occurs grey in $\lambda'\atp$. 
			Note that due to the definition of the unification algorithm, $\lambda$ and $\lambda'$ must coincide on the path to $p$.

			By Proposition \ref{prop:every_lit_in_pi_star}, $\lambda$ and $\lambda'$ occur in $\inv$ irrespective of their coloring.

			We distinguish cases based on the position $p$:

			\begin{itemize}
				\item Suppose that $p$ occurs directly below a $\Phi$-symbol.
					Then as $u$ occurs grey in  $\lambda'\atp$, $u$ occurs directly below a $\Phi$-symbol in $\invp\sigmazmi$ and \ref{14_1} is the case.

				\item Suppose that $p$ occurs directly below a $\Psi$-symbol.
					Then $v$ occurs directly below a $\Psi$-symbol in $\lambda\atp$ and  \ref{14_2} holds.

				\item
					Suppose that $p$ does not occur directly below a colored symbol.
					Then $p$ does not occur below any colored symbol, hence $u$ is contained in a grey literal in a grey position in $\invp\sigmazmi$. 
					As $\sigma_i$ is trivial on $u$, this occurrence of $u$ also is present in $\invp\sigmazi$ and hence \ref{14_5} is the case.
					\qedhere

			\end{itemize}
	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:var_below_phi_symbol_paramod}
	Let $\inference$ be a paramodulation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs directly below a $\Phi$-symbol in $\invp\sigmazi$ for $i\vargeq 1$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{15_1}
			The variable $u$ occurs directly below a $\Phi$-symbol in $\invp\sigmazmi$.

		\item
			\label{15_5}
			The variable $u$ occurs at a grey position in a grey literal or at a grey position in an equality in $\invp\sigmazi$.

		\item 
			\label{15_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\invp\sigmazmi$ directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol
				\end{itemize}
			}


	\end{enumerate}
\end{lemma}
\begin{proof}
	Let  $\inference$ be a paramodulation inference  of the clauses $C_1: r_1=r_2 \lor D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)=\mgu(r_1, r)$ yielding $C: (D\lor E\occatp{r_2})\sigma$.
	We consider the different situations under which the situation in question arises:

	\begin{itemize}
		\item
			There is already a literal in $\invp\sigmazmi$ where $u$ occurs directly below a $\Phi$-symbol and $\sigma_i$ does not change this.
			Then \ref{15_1} is the case.

		\item
			There is a variable $v$ in $\invp\sigmazmi$ such that $v\sigma_i$ contains $u$ directly below a $\Phi$-symbol.
			As $v$ is unified with the term $v\sigma_i$, $v\sigma_i$ must occur in $\invp\sigmazmi$, which implies that \ref{15_1} is the case.

		\item
			The variable $u$ occurs grey in $r_2$ and $p$ in $E$ is directly below a $\Phi$-symbol. 
			But then $u$ occurs grey in an equality in $\invp\sigmazmi$ and as $\sigma_i$ is trivial on $u$ also in $\invp\sigmazi$, hence \ref{15_5} holds.

		\item
			Suppose that some variable $v$ occurs directly below a $\Phi$-symbol in $\invp\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.
			Then by the definition of the unification algorithm, there exists a position $q$ such that one of $r_1\atq$ and $r\atq$ is $v$ and the other one contains a grey occurrence of $u$.

			We distinguish cases based on the position $q$:

			\begin{itemize}
				\item
					Suppose that $q$ occurs directly below a $\Phi$-symbol. Then clearly \ref{15_1} is the case.

				\item
					Suppose that $q$ occurs directly below a $\Psi$-symbol. Then as the variable $v$ also occurs directly below a $\Phi$-symbol and $u$ occurs grey in $v\sigma_i$, \ref{15_2} is the case.

				\item
					Suppose that $q$ is a grey position.
					Then \ref{15_5} is the case: 
					Either $u$ occurs grey in $r_1$ in $\invp\sigmazmi$ and then also in $\invp\sigmazi$, 
					or otherwise $v$ occurs grey in $r_1$ in $\invp\sigmazmi$, but as $v\sigma_i$ contains $u$ grey, $u$ occurs grey in of $r_1\sigma_i$ in $\invp\sigmazi$.
					\qedhere
			\end{itemize}

	\end{itemize}

\end{proof}


\begin{lemma}
	\label{lemma:col_change}
	Let $\inference$ be an inference of a resolution refutation of $\Gamma \cup \Delta$.
	Suppose that a variable $u$ occurs directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol in $\invp\sigmazi$.
	Then $u$ occurs grey in a grey literal or grey in an equality in $\invp\sigmazi$.
\end{lemma}
\begin{proof}
	We proceed by induction over the refutation.
	As the original clauses each contain symbols of at most one color, the base case is trivially true.

	For the induction step, suppose that an inference makes use of the clauses $C_1, \dots, C_n$ and that the lemma holds for $\PI^*(C_j) \lor C_j$ for $1\varleq j \varleq n$. 

	Note that then, the lemma holds for $\PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor \nosigma{C}) = \inv$.
	This is because as all clauses are variable-disjoint, 
	if a variable occurs in $\inv$ both directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol, then this must be the case also in 
	$\PI^*(C_j) \lor C_j$ for some $j$, for which the lemma by assumption holds.
	Furthermore, by the definition of $\PI^*$, every literal which occurs in $\PI^*(C_j) \lor C_i$ for some $j$ occurs in $\inv$.

	Hence it remains to show that the lemma holds for $\invp\sigma = \invp\sigma_0\quantifierdots\sigma_m$, which we do by induction over $i$ for $1\varleq i \varleq m$.
	Suppose that the lemma holds for $\invp\sigmazmi$ and in $\invp\sigmazi$, the variable $u$ occurs directly below a $\Phi$-symbol as well as directly below a $\Psi$-term.

	Then by the lemmata~\ref{lemma:var_below_phi_symbol} and \ref{lemma:var_below_phi_symbol_paramod}, we can deduce that one of the following statements holds for $\Omega = \Phi$ as well as $\Omega = \Psi$. We denote case $j$ for $\Omega = \Phi$ by $j^\Phi$ and for $\Omega = \Psi$ by $j^\Psi$.

	\begin{enumerate}
		\item
			\label{16_1}
			The variable $u$ occurs directly below a $\Omega$-symbol in $\invp\sigmazmi$.

		\item
			\label{16_4}
			The variable $u$ occurs at a grey position in a grey literal or at a grey position in an equality in $\invp\sigmazi$.

		\item 
			\label{16_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\invp\sigmazmi$ directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol
				\end{itemize}
			}
	\end{enumerate}

	If \ref{16_4}$^\Phi$ or \ref{16_4}$^\Psi$ is the case, we clearly are done.
	On the other hand if \ref{16_2}$^\Phi$ or \ref{16_2}$^\Psi$ is the case, then by the induction hypothesis, $v$ occurs grey in a grey literal or grey in an equality in $\invp\sigmazmi$. 
	As $u$ occurs grey in $v\sigma_i$, we obtain that then, $u$ occurs grey in a grey literal or grey in an equality in $\invp\sigmazi$.

	Hence the only remaining possibility is that both \ref{16_1}$^\Phi$
	and \ref{16_1}$^\Psi$ hold.
	But then $u$ occurs directly below a $\Phi$-symbol as well as below a $\Psi$-symbol in $\invp\sigmazmi$ and again by the induction hypothesis, we obtain that $u$ occurs grey in a grey literal or grey in an equality in $\invp\sigmazmi$, and as $\sigma_i$ is trivial on $u$, the same occurrence of $u$ is present in $\invp\sigmazi$.
\end{proof}



\begin{lemma}
	\label{lemma:subterm_in_grey_lit}
	Let $C$ be a clause in a resolution refutation of $\Gamma \cup \Delta$.
	If $\PI^*(C) \lor C$ contains a maximal colored occurrence of a $\Phi$-term $t\occ{s}$, which contains a maximal $\Psi$-colored term $s$, then $s$ occurs grey in a grey literal or grey in an equality in $\PI(C) \lor C$.
\end{lemma}
\begin{proof}
	Note that it suffices to show that the desired term occurs in a grey literal or equality in $\PI^*(C) \lor C$
	since by Lemma~\ref{lemma:grey_lits_of_pi_star_in_pi}, all grey literals and equalities of $\PI^*(C)$ also occur in $\PI(C)$.
	We do so by induction over the resolution refutation.
	
	As the original clauses each contain symbols of at most one color, the base case is vacuously true.

	The induction step is laid out similarly as in the proof of Lemma~\ref{lemma:col_change}. 
	We suppose that an inference makes use of the clauses $C_1, \dots, C_n$ and that the lemma holds for $\PI^*(C_j) \lor C_j$ for $1\varleq j \varleq n$. 
	Then the lemma holds for $\inv = \PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor \nosigma{C})$ as no new terms are introduced in $\inv$ and all literals from $\PI^*(C_j) \lor C_j)$ for $1\varleq j \varleq n$ occur in~$\inv$.

	It remains to show that the lemma holds for $\invp\sigma = \invp\sigma_0 \quantifierdots \sigma_m$, which we do by induction over $i$ for $0 \varleq i \varleq m$.
	We distinguish based on the situation under which a unification leads to the term $t\occ{s}$.

	\begin{itemize}
		\item 
			Suppose for some variable $u$ that $u\sigma_i$ contains $t\occ{s}$. 
			Then $u$ is unified with a term which contains $t\occ{s}$ and which occurs in $\invp\sigmazmi$.
			Hence by the induction hypothesis, $s$ occurs grey in a grey literal or grey in an equality in $\invp\sigmazmi$ and, as $\sigma_i$ does not change this, also in $\invp\sigmazi$.

		\item 
			Otherwise there is a variable $u$ which occurs directly below a $\Phi$-symbol and $v\sigma_i$ contains a grey occurrence of $s$.
			We distinguish based on the occurrences of $u$ in $\invp\sigmazmi$:

			\begin{itemize}
				\item Suppose that $u$ occurs somewhere in $\invp\sigmazmi$ grey in a grey literal or grey in an equality. Then clearly we are done.
				\item Suppose that $u$ occurs somewhere in $\invp\sigmazmi$ directly below a $\Psi$-symbol.
					Then by Lemma~\ref{lemma:col_change}, $u$ occurs grey in a grey literal or grey in an equality in $\invp\sigmazmi$, whose successor in $\invp\sigmazi$ is an occurrence of $s$ of the same coloring. Hence we are done a well.
				\item Suppose that $u$ occurs in $\invp\sigmazmi$ only directly below a $\Psi$-symbol.
					Here, we differentiate between the types of inference of the current induction step:

					\begin{itemize}
						\item
							Suppose that the inference of the current induction step is a resolution or a factorisation inference.
							As $u$ occurs grey in $v\sigma_i$, there is a position $p$ such that for the resolved or factorised literals $\lambda$ and $\lambda'$ it holds without loss of generality that $\lambda\atp = u$ and $s$ occurs grey in $\lambda'\atp$.
							Note that $\lambda$ and $\lambda'$ agree on the path to $p$, including the predicate symbol..

							Now as by assumption $u$ only occurs directly below a $\Phi$-symbol, so must $s$.
							But then $s$ occurs directly below a $\Phi$-symbol in $\invp\sigmazmi$ and we get the result by the induction hypothesis.

						\item
							Suppose that the inference of the current induction step is a paramodulation inference.
							Assume it uses the the clauses $C_1: r_1=r_2 \lor D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)=\mgu(r_1, r)$ to yield $C: (D\lor E\occatp{r_2})\sigma$.

							As $u$ is affected by $\sigma_i$, it must occur in $r_1$ or $r$. Let $\bhat u$ refer to this occurrence.

							\begin{itemize}
								\item
									Suppose that $\bhat u$ occurs directly below a $\Phi$-colored function symbol. 

									If $\bhat u$ is contained in $r_1$, then $s$ must be contained in $r$ directly below a $\Phi$-colored function symbol as $r_1$ and $r$ are unifiable. We then get the result by the induction hypothesis.

									If otherwise $\bhat u$ is contained in $r$, 
									then there are two possibilities for the occurrence of $s$ in $r_1$:

									Either $\bhat u$ occurs in a $\Phi$-colored function symbol in $r$. Then $s$ occurs in a $\Phi$-colored function symbol in $r_1$ and we get the result by the induction hypothesis.

									Otherwise $\bhat u$ occurs grey in $r$, but $r$ occurs directly below a $\Phi$-colored function symbol in $E$.
									Then however, as $r$ and $r_1$ are unifiable, $s$ must occur grey in $r_1$ and hence grey in an equality.

								\item
									Suppose that $\bhat u$ occurs directly below a $\Phi$-colored predicate symbol. 

									Then as the equality predicate is not considered to be colored, $u$ must occur grey in $r$.
									But then as $r_1$ and $r$ are unifiable, $s$ must occur grey in $r_1$ and hence grey in an equality.
									\qedhere
							\end{itemize}

					\end{itemize}

			\end{itemize}

	\end{itemize}


	%Let $C$ be a clause of a resolution refutation of $\Gamma \cup \Delta$.
	%As the literals occurring in $\PI(C)$ are a subset of the literals occurring in $\PI^*(C)$, the lemma prerequisites hold true only for terms for which they also hold in $\PI^*(C)$.
	%Therefore we can deduce that if a maximal colored $\Phi$-term $t\occ{s}$ containing a maximal $\Psi$-colored term $s$ occurs in $\PI(C)\lor C$, then $t\occ{s}$ also occurs in $\PI^*(C) \lor C$ and by Lemma~\ref{lemma:subterm_in_grey_lit_star},
	%the term $s$ occurs grey in a grey literal or grey in an equality in $\PI^*(C) \lor C$.
\end{proof}

\begin{lemma}
	\label{lemma:col_alt_in_grey_lit_then_quant_alt}
	If a term with $n$ color alternations occurs in a grey literal or in an equality in $\PI^*(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n$ quantifier alternations.
\end{lemma}
\begin{proof}
	We perform an induction on $n$
	and show the strengthening that
	the quantification of the lifting variable which replaces a term with $n$ color alternations is required to be in the scope of the quantification of $n-1$ alternating quantifiers.

	For $n=0$, no colored terms occur in $I$ and hence also no quantifiers.
	Moreover for $n=1$, there are terms of one color which evidently require at least one quantifier.

	Suppose that the statement holds for $n-1$ for $n>1$ and that a term $t$ with $\ca(t) = n$ occurs in $\PI^*(C) \lor C$.
	We assume without loss of generality that $t$ is a $\Phi$-term.
	Then $t$ contains some $\Psi$-colored term $s$ with $\ca(s) = n-1$ and
	by Lemma~\ref{lemma:subterm_in_grey_lit}, $s$ occurs grey in a grey literal or an equality in $\PI(C) \lor C$.
	By Lemma~\ref{lemma:grey_lits_and_eq_all_in_PI}, a successor of $s$ occurs in $\PI(\pi)$. Note that as $s$ occurs in a grey position, any successor of $s$ also occurs in a grey position.

	By the induction hypothesis, the quantification of the lifting variable for $s$ requires $n-1$ alternated quantifiers.
	As $s$ is a subterm of $t$ and $t$ is lifted, $t$ must be quantified in the scope of the quantification of $s$, and as $t$ and $s$ are of different color, their quantifier type is different. 
	Hence the quantification of the lifting variable for $t$ requires $n$ quantifier alternations.
\end{proof}

\begin{prop}
	\label{prop:color_alt_eq_quant_alt}
	If a term with $n$ color alternations occurs in $\PI^*(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n-1$ quantifier alternations.
\end{prop}
\begin{proof}
	By Lemma~\ref{lemma:subterm_in_grey_lit}, a term with $n-1$ color alternations occurs in a grey literal or an equality in $\PI(C) \lor C$.
	Lemma~\ref{lemma:col_alt_in_grey_lit_then_quant_alt} gives the result.
\end{proof}


We present an example which illustrates that the occurrence of a term with $n$ color alternations in $\PI(C) \lor C$ for a clause $C$ can lead to an interpolant with $n-1$ quantifier alternations (but no less as Proposition~\ref{prop:color_alt_eq_quant_alt} shows).
\begin{exa}
	Let $\Gamma = \{ \lnot P(a) \}$ and $\Delta = \{ P(x) \lor Q(f(x)), \lnot Q(y) \}$.
	Consider the following refutation of $\Gamma \cup \Delta$:
	\begin{prooftree}
		\AxiomCm{ \lnot P(a) \mid \bot }
		\AxiomCm{ P(x) \lor Q(f(x)) \mid \top }

		\RightLabelm{\resrule{\resruleres}{x\mapsto a}}
		\BinaryInfCm{ Q(f(a)) \mid \lnot P(a) }

		\AxiomCm{ \lnot Q(y) \mid \top }
		\RightLabelm{\resrule{\resruleres}{y\mapsto f(a)}}
		\BinaryInfCm{ \square \mid \lnot P(a) }
	\end{prooftree}

	In this example, Theorem~\ref{thm:two_phases} yields the interpolant $I \equiv \exists y_a \lnot P(y_a)$ with $\qa(I) =\nolinebreak 1$.
	The existence of the term $f(a)$ with $\ca(f(a)) = 2$ in a clause of the refutation implies that $\qa(I) \vargeq 1$.
\end{exa}


\section{Quantifier alternations in $\LI$}

We now show that the result of Proposition~\ref{prop:color_alt_eq_quant_alt} holds in a very similar way also for $\LI$,
which we work out in detail in this section.

\begin{clemma}
	\label{lemma:pi_li_1}
	Let $C$ be a clause in a resolution refutation of $\Gamma \cup \Delta$.
	If a maximal colored term $t$ occurs in $\LIpre(C)$ in a literal $\lambda$ at position $p$, 
	then $t$ also occurs in a corresponding literal at position $p$ in $\PI(C)$.
\end{clemma}
\begin{proof}
	Note that $\PI$ and $\LI$ differ only in the lifting conditions of $\LI$.
	As $t$ however is a colored term and not a lifting variable, and it also occurs in $\LIpre(C)$, the lifting conditions are not true for any predecessor of $t$ in $\LIpre(C)$.
\end{proof}

\begin{clemma}
	\label{lemma:pi_li_2}
	Let $C$ be a clause in a resolution refutation of $\Gamma \cup \Delta$.
	If a maximal colored term $t$ occurs in $\PI(C)$ in a literal $\lambda$ at position $p$, 
	then either $t$ or $z_{t'}$, where $t'$ is an abstraction of $t$, occurs in a corresponding literal at position $p$ in $\LIpre(C)$.
\end{clemma}
\begin{proof}
	As pointed out previously, $\PI$ and $\LI$ differ only in the lifting conditions of $\LI$.
	Suppose that no predecessor of the term in $\LI(C)$ which corresponds to $t$  fulfills a lifting condition.
	Then $t$ occurs at position $p$ in $\LIpre(C)$.
	Otherwise $z_{t'}$ occurs at the position $p$ in $\LIpre(C)$, where $t'\tau = t$ for some substitution\nolinebreak{} $\tau$.
\end{proof}

\begin{clemma}
	\mytodo{merge with 5.3. of thesis (lemma:lifting\_conditions)}
	\label{lemma:pi_li_3}
	Let $C$ be a clause of a resolution refutation such that $\LIpre(C)$ contains a maximal colored $\Phi$-term $t$ which is lifted in $\LI(C)$. 
	Suppose that $t$ contains a $\Psi$-colored subterm $s$.
	Then $s$ occurs as a subterm of $t$ in $\LIpre(C)$.
\end{clemma}
\begin{proof}
	By the construction of $\LI$, this lemma is only violated if the term $s$ or a respective predecessor is lifted due to fulfilling one of the lifting conditions.

	For the sake of contradiction, suppose that this is the case in the inference creating the clause $C'$. Let $s'$ and $t'$ be the respective predecessors of $s$ and $t$ in $C'$.
	\begin{itemize}
		\item 
			Suppose that $s'$ is lifted due to containing a variable which does not occur in $C'$.
			Then as $s'$ is a subterm of $t'$ , $t'$ contains this variable as well and therefore is lifted in $\LI(C')$, contradicting the assumption. 

		\item
			Suppose that $s'$ is lifted due to being a ground term which does not occur in $C$.
			Then $t'$ does not occur in $C'$ either as any occurrence of $t'$ would contain $s'$.
			Hence $t'$ is lifted in $\LI(C')$, contradicting the assumption.
			\qedhere
	\end{itemize}

\end{proof}

\begin{defi}
	Alternative, equivalent definition of $\LI$.

	<insert def for base case>

	Let $\LIpre_0(C) = \LIpre(C)$ and
	$Z_0$ be the set of terms in $\LIpre_i(C)$ for which some lifting conditions holds.

	We now define $\LI(C)$ and $\LIpre_i(C)$ for $i\vargeq 1$:
	\begin{enumerate}
		\item
			Let $r \in Z_i$ be such that $r$ is not subterm of any other term in $Z_i$.
			If no such $r$ exists, let $\LI(C) = \LIpre_i(C)$.

		\item
			Let $Z_{i+1} = Z_i \setminus \{ r\}$.

		\item
			Let $\LIpre_{i+1}(C)$ be built from $\LIpre{_i}(C)$ such that $r$ is lifted by a fresh lifting variable $z_r'$ and the formula is prefixed by $\forall x_r $ if $r$ is a $\Delta$-term and $\exists y_r$ if $r$ is a $\Gamma$ term.
			\qedhere

	\end{enumerate}

\end{defi}

\cbstart
\begin{lemma}
	\label{lemma:subterm_of_multicol_term}
	Let $t$ be a term with $\ca(t)=n$ which occurs grey in a grey literal or grey in an equality $\LIpre(C) \lor C$ for some clause $C$ and let $s$ be a subterm of $t$ with $\ca(s) = n-1$.
	Then there exists a clause $C'$ which is a successor of $C$ such that respective successors of $t$ and $s$, which are not lifting variables, occur in $\LIpre(C') \lor C'$, and the successor of $t$ in $\LI(C) \lor C$ is a lifting variable.
\end{lemma}
\begin{proof}
By Lemma~\ref{lemma:grey_lits_and_eq_all_in_LI}, a successor of $t$ occurs in $\LIpre(C') \lor C'$ for any successor $C'$ of $C$.
	Let $C'$ be the successor of $C$ such that $\LIpre(C')$ contains a successor of $t$ which is not a lifting variable and $\LI(C')$ contains a successor of $t$ which is a lifting variable.
	As all colored terms are lifted eventually, such a clause $C'$ must occur.

	By Lemma~\ref{lemma:pi_li_1}, $t$ occurs at the same position in $\PI(C')$.
	We assume without loss of generality that $t$ is a $\Phi$-term.
	Then $t$ contains some $\Psi$-colored term $s$ with $\ca(s) = n-1$.
	By Lemma~\ref{lemma:subterm_in_grey_lit}, $s$ occurs grey in a grey literal or grey in an equality in $\PI(C')\lor C'$.

	By Lemma~\ref{lemma:pi_li_2}, then either $s$ or $z_{s'}$, where $s'$ is an abstraction of $s$, occurs in $\LIpre(C')$ at a corresponding literal and position. 
	As $t$ is not lifted in $\LIpre(C') \lor C'$ and $s$ is a subterm of $t$, Lemma~\ref{lemma:pi_li_3} proves that $s$ is also not lifted in $\LIpre(C') \lor C'$. Hence the case of $z_{s'}$ is excluded.
\end{proof}


\begin{clemma}
	If a term $t$ with $\ca(t)=n$ occurs grey in a grey literal or grey in an equality $\LIpre(C) \lor C$ for some $C$, then $\LI(\pi)$ has at least $n$ quantifier alternations.
\end{clemma}
\begin{proof}
	We proceed by induction over $n$ to show that the lifting variable, which replace the successor of $t$ in $\LI(\pi)$, is enclosed by $n$ alternating quantifiers.

	For $n=0$, no colored terms occur and hence no lifting variables which induce quantifiers.
	Moreover, for $n=1$, the interpolant clearly must have at least one quantifier.

	We now turn to the induction step and suppose that the lemma holds for $n-1$ for $n>1$.
	By Lemma~\ref{lemma:subterm_of_multicol_term},
	there exists a clause $C'$ which is a successor of $C$ such that respective successors of $t$ and $s$, which are not lifting variables, occur in $\LIpre(C') \lor C'$, and the successor of $t$ in $\LI(C) \lor C$ is a lifting variable.
	
	Note that as $s$ is a subterm of $t$, $s$ is only quantified after $t$ (either in this stage or some subsequent one) such that the quantifier for $t$ is in the scope of the quantifier for $s$. 

	By the induction hypothesis, the quantifier for the lifting variable, which is the successor of $s$ in $\LI(\pi)$, is enclosed by $n-1$ alternating quantifiers in $\LI(\pi)$. 
	As $s$ and $t$ are of different colors, their quantifier type is different.
	Since the quantifier for $t$ occurs in the scope of the quantifier for $s$, we get that the lifting variable replacing the successor of $t$ in $\LI(\pi)$ is enclosed by $n$ alternating quantifiers.
	%The lifting and quantification of $t$ adds one quantifier to $\LIpre(C)$.
	%Let $i$ be the step where the lifted term in  $\LIpre_i(C)$ is $t$.
	%In $\LIpre_{i+1}(C)$, one quantifier is added in order to quantify the lifting variable for $t$.
	%As $s$ can only be lifted after $t$, $s$ does occur in $\LIpre_{i+1}(C)$ and by the induction hypothesis, $n-1$ alternated quantifiers are still added to $\LIpre_{i+1}(C)$.
	%As $t$ adds another one, we can infer that $t$ causes $\LI(\pi)$ to contain at least $n$ quantifier alternations.
\end{proof}
\cbend


\mytodo{conclude by explaining two main results ; describe how to apply result (term $t$ occs in ??)} 

\begin{clemma}
	need term which exist initially, and with all substs applied has max color alternations

	note that there is no term in PI, LI, or anywhere, with more alternations

	this term does occur in $\PI^*$

	hence a term with one less col alt occs grey in $\PI^*$, hence also in $\PI$. (then the usual)

	however this term may not actually occur in $\LI$ (cf.\ 703)

	POSSIBLY: do apply substs to lft vars. then show that you can jump back and forth from li to pi (basically not $z_{s'}$ but $z_s$ in that lemma above).

	Then lemmas for $\PI$ could suffice

	possibla lemma statement:

	IF $t$ WITH $\ca(t) = n$ OR $z_t$ OCCURS, THEN $n$ QUANT ALT
\end{clemma}

\vfill
\begin{thm}
	<Huang's thm> (this is here only to make the references to it in this document work)
\label{thm:two_phases}
\end{thm}

\end{document}
