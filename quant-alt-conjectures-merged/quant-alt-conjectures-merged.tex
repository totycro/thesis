\documentclass[,%fontsize=11pt,%
	%landscape,
	%DIV8, % mehr text pro seite als defaultyyp
	%DIV10,
	%DIV=calc,%
	%article,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
	12pt,
	a4paper,
	oneside,% apparently, this should stay below some other parameter to have an effect
	openany,
	%]{scrartcl}
]{memoir}



\usepackage[bitstream-charter]{mathdesign}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\input{../latex_header.tex}



%\renewcommand{\familydefault}{ \sfdefault }
%\renewcommand{\rmdefault}{ppl}


%\usepackage[urw-garamond]{mathdesign}





% subsections also in toc
\setcounter{tocdepth}{2}
\setsecnumdepth{subsection}


\definethms

\def\proofSkipAmount{ \vskip -0.1em }


%\usepackage{bussproof}

%\usepackage{vaucanson-g}
%\usepackage{amssymb}
%\usepackage{amsmath}
\usepackage{latexsym}

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
%\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}


\usepackage{amsthm}


\chapterstyle{madsen}


% define page numbering styles
\makepagestyle{numberCorner}
\makeevenfoot{numberCorner}{\thepage}{}{}
\makeoddfoot{numberCorner}{}{}{\thepage}

\makepagestyle{numberCenter}
%\makeevenfoot{numberCenter}{}{\thepage}{}
%\makeoddfoot{numberCenter}{}{\thepage}{}
%
%\makeevenhead{numberCenter}{\thechapter}{}{\thesection}
%\makeoddhead{numberCenter}{\thesection }{}{\thechapter}
\makeheadrule{numberCenter}{\textwidth}{1pt}

\makeevenhead{numberCenter}{\thepage}{}{\leftmark}
\makeoddhead{numberCenter}{\rightmark}{}{\thepage}


\makeatletter
\makepsmarks{numberCenter}{
	\def\chaptermark##1{\markboth{%
			\ifnum \value{secnumdepth} > -1
			\if@mainmatter
			\chaptername\ \thechapter\ --- %
			\fi
			\fi
	##1}{}}
	\def\sectionmark##1{\markright{%
			\ifnum \value{secnumdepth} > 0
			\thesection. \ %
			\fi
	##1}}
}
\makeatother
\newcommand{\mysetpagestyle}{
	%\pagestyle{numberCorner}
	\pagestyle{numberCenter}
}
\mysetpagestyle





\usepackage{refcheck}

%\settypeblocksize{0.67\stockheight}{0.67\stockwidth}{*}
%\setlrmargins{*}{*}{1.2}
%\setulmargins{*}{*}{1.4}
%\checkandfixthelayout[nearest]

\counterwithout{section}{chapter}



\newcommand{\inv}{\ensuremath{\chi}}

\begin{document}

\chapter{ Number of quantifier alternations in Huang and nested }

\section{ Preliminaries }

For $\sigma = \mgu(\varphi, \psi)$ for two terms or literals $\varphi$ and $\psi$, we denote by $\sigma_i$ for $1\varleq i \varleq n$ the $i$th substitution which is added to $\sigma$ by the unification algorithm, where $n = |\dom(\sigma)|$.
We define $\sigma_0 \defeq \id$.

We furthermore denote the composition of all $\sigma_k$ for $i\varleq k \varleq j$ by $\sigmarange{i}{j}$.
Hence $\sigma = \sigmarange{1}{n} = \sigmarange{0}{n}$.

~

A literal $l$ is called a $\Phi$-literal if its predicate symbol is $\Phi$-colored.


%A term $t$ is \defiemph{single-colored} if $t$ is $\Phi$-colored for some $\Phi$ and all colored symbols in $t$ are $\Phi$-colored.
\NB{The notion of single-colored is considered to be deprecated here.}

In a literal or term $\phi$ containing a subterm $t$, $t$ is said to occur \defiemph{below} a $\Phi$-symbol $s$ if in the syntax tree representation of $\phi$, there is a node labelled $s$ on the path from the root to $t$. Note that the colored symbol may also be the predicate symbol.
Moreover, $t$ is said to occur \defiemph{directly below} a $\Phi$-symbol if it occurs below the $\Phi$-symbol $s$ and in the syntax tree representation of $\phi$ on the path from $s$ to $t$, no nodes with labels with colored symbol occur.

~

Quantifier alternations in $I$ usually assumes the quantifier-alternation-minimizing arrangement of quantifiers in $I$. The lemma statements hence talk about the \emph{minimal} number of quantifier alternations, which is indeed easily obtainable, i.e.\ it's a lower and upper bound at the same time.

~

In the following, we assume that the maximum $\max$ of an empty sequence is defined to be $0$ and constants are treated as function symbols of arity $0$.
Furthermore $\bot$ is used to denote a color which is not possessed by any symbol.
\begin{defi}[Color alternation $\ca$]
	Let $\Gamma$ and $\Delta$ be sets of formulas and $t$ be a term.

	\medskip

	\noindent
	$\ca(t) \defeq \ca_\bot(t)$
	\medskip

	\noindent
	$
	\ca_\Phi(t) \defeq 
	\begin{cases}
		0 & \text{$t$ is a variable} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \text{$t = f(t_1, \dots, t_n)$ is grey} \\
		\max(\ca_\Phi(t_1), \dots, \ca_\Phi(t_n)) & \parbox[t]{0.4\textwidth}{$t = f(t_1, \dots, t_n)$ is of color $\Phi$} \\
		1 + \max(\ca_\Psi(t_1), \dots, \ca_\Psi(t_n)) & \parbox[t]{0.38\textwidth}{$t = f(t_1, \dots, t_n)$ is of color $\Psi$, $\Phi \neq \Psi$} \\
	\end{cases}
	$
\end{defi}


\begin{defi}[Quantifier alternation $\qa$]
	Let $A$ be a formula.\nopagebreak
	\medskip

	\noindent
	$\qa(A) \defeq \qa_\bot(A)$
	\nopagebreak
	\medskip

	\noindent
	$
	\qa_Q(A) \defeq 
	\begin{cases}
		0 & \text{$A$ is an atom} \\
		\qa_Q(B) & \text{$A \equiv \lnot B$} \\
		\max(\parbox[t]{0.2\textwidth}{$\qa_Q(B),$\newline$ \qa_Q(C))$} & \text{$A \equiv B \circ C$, $\circ \in \{\land, \lor, \limpl\}$} \\
		\qa_Q(B) & \text{$A \equiv Q' B$, $Q = Q'$} \\
		1+\qa_{Q'}(B) & \text{$A \equiv Q' B$, $Q \neq Q'$}  \\
	\end{cases}
	$
	\nopagebreak

	\qedhere
\end{defi}
Note that this definition of quantifier alternations handles formulas in prenex and non-prenex form.

\begin{defi}
	We define $\PIstepnosigma$ to coincide with $\PIstep$ but without applying the substitution $\sigma$ in each of the cases.
	Analogously, if $C \equiv D\sigma$, we use $C\nosigma$ to denote\nolinebreak{} $D$.
\end{defi}
Hence $\PIstepnosigma(\cdot) \sigma = \PIstep(\cdot)$.

\section{Occurrence of terms in the interpolant}

\begin{defi}[$\PI^*$]
	$\PI^*$ is defined as $\PI$ with the difference that in $\PI^*$, all literals are considered to be grey.
\end{defi}

Hence $\PIinit^*$ coincides with $\PIinit$.
$\PIstep^*$ coincides with $\PIstep$ in case of factorisation and paramodulation inferences.
For resolution inferences, the first two cases in the definition of $\PIstep$ do not occur for $\PIstep^*$.

$\PI^*$ enjoys the convenient property that it absorbs every literal which occurs some clause:

\begin{prop}
	\label{prop:every_lit_in_pi_star},
	For every literal which occurs in a clause of a resolution refutation $\pi$, a respective successor occurs in $\PI^*(\pi)$.
\end{prop}
\begin{proof}
	By structural induction.
\end{proof}

\begin{lemma}
	\label{lemma:grey_lits_of_pi_star_in_pi}
	For every clause $C$ of a resolution refutation,
	every grey literal, which occurs in $\PI^*(C)$, also occurs in $\PI(C)$.
\end{lemma}
\begin{proof}
	Note that $\PIinit$ and $\PIinit^*$ coincide and $\PIstep$ and $\PIstep^*$ only differ for resolution inferences.
	But more specifically, they only differ on resolution inferences, where the resolved literal is colored. However here, no grey literals are lost.
\end{proof}

Note that in $\PI^*$, we can conveniently reason about the occurrence of terms as no terms are lost throughout the extraction.
However Lemma~\ref{ref:grey_lits_of_pi_star_in_pi} allows us to transfer results about grey literals to $\PI$.
We can also give similar results about general literals and equalities occurring in the resolution refutation:

\begin{lemma}
	\label{lemma:grey_lits_all_in_PI}
	If there is a grey literal $\lambda$ in a clause $C$ of a resolution refutation $\pi$,
	then a successor of $\lambda$ occurs in $\PI(\pi)$.
\end{lemma}
\begin{proof}
	Immediate by the definition of $\PI$.
\end{proof}

\begin{lemma}
	\label{lemma:equalities_all_in_PI}
	For every equality $s=t$ of a clause in a resolution refutation $\pi$,
	a successor of $s=t$ occurs in $\PI(\pi)$.
\end{lemma}
\begin{proof}
	Equalities in clauses are only removed by means of paramodulation and as $\pi$ derives the empty clause, all equalities are removed eventually.
	For any paramodulation inference $\inference$ using the equality $s=t$, $\PIstep(\inference, I_1, I_2)$ contains $s=t$. 
\end{proof}


We now make some considerations in the form of four lemmata about the construction of terms of certain shapes in the context of interpolant extraction.
In the following, we abbreviate $\PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor C\nosigma$ by $\inv$.

\begin{lemma}
	\label{lemma:var_below_phi_symbol}
	Let $\inference$ be a resolution or factorisation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs directly below a $\Phi$-symbol in $\inv\sigmazi$ for $i\vargeq 1$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{14_1}
			The variable $u$ occurs directly below a $\Phi$-symbol in $\inv\sigmazmi$.

		\item
			\label{14_5}
			The variable $u$ occurs at a grey position in a grey literal or at a grey position in an equality in $\inv\sigmazi$.

		\item 
			\label{14_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\inv\sigmazmi$ directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol
				\end{itemize}
			}

	\end{enumerate}
\end{lemma}
\begin{proof}
	We consider the different situations under which the situation in question is introduced by means of unification: 

	\begin{itemize}
		\item
			There is already a literal in $\inv\sigmazmi$ where $u$ occurs directly below a $\Phi$-symbol and $\sigma_i$ does not change this.
			Then clearly \ref{14_1} is the case.

		\item
			There is a variable $v$ in $\inv\sigmazmi$ such that $v\sigma_i$ contains $u$ directly below a $\Phi$-symbol.
			As then $v$ is unified with the term $v\sigma_i$, $v\sigma_i$ must occur in $\inv\sigmazmi$, which implies that \ref{14_1} is the case.

		\item
			There is a variable $v$ which occurs directly below a $\Phi$-symbol such that $u$ occurs grey in $v\sigma_i$.

			Hence in the resolved or factorised literals $\lambda$ and $\lambda'$ in $\inv\sigmazmi$, there is a position $p$ such that without loss of generality $\lambda\atp = v$ and $u$ occurs grey in $\lambda'\atp$. 
			Note that due to the definition of the unification algorithm, $\lambda$ and $\lambda'$ must coincide on the path to $p$.

			By Proposition \ref{prop:every_lit_in_pi_star}, $\lambda$ and $\lambda'$ occur in $\inv$ irrespective of their coloring.

			We distinguish cases based on the position $p$:

			\begin{itemize}
				\item Suppose that $p$ occurs directly below a $\Phi$-symbol.
					Then as $u$ occurs grey in  $\lambda'\atp$, $u$ occurs directly below a $\Phi$-symbol in $\inv\sigmazmi$ and \ref{14_1} is the case.

				\item Suppose that $p$ occurs directly below a $\Psi$-symbol.
					Then $v$ occurs directly below a $\Psi$-symbol in $\lambda\atp$ and clearly \ref{14_2} is the case.

				\item
					Suppose that $p$ does not occur directly below a colored symbol.
					Then $p$ does not occur below any colored symbol, hence $u$ is contained in a grey literal in a grey position in $\inv\sigmazmi$. 
					As $\sigma_i$ is trivial on $u$, this occurrence of $u$ also is present in $\inv\sigmazi$ and hence \ref{14_5} is the case.
					\qedhere

			\end{itemize}
	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:var_below_phi_symbol_paramod}
	Let $\inference$ be a paramodulation inference in a refutation of $\Gamma\cup\Delta$.
	Suppose that a variable $u$ occurs directly below a $\Phi$-symbol in $\inv\sigmazi$ for $i\vargeq 1$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item
			\label{15_1}
			The variable $u$ occurs directly below a $\Phi$-symbol in $\inv\sigmazmi$.

		\item
			\label{15_5}
			The variable $u$ occurs at a grey position in a grey literal or at a grey position in an equality in $\inv\sigmazi$.

		\item 
			\label{15_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\inv\sigmazmi$ directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol
				\end{itemize}
			}


	\end{enumerate}
\end{lemma}
\begin{proof}
	Let  $\inference$ be a paramodulation inference  of the clauses $C_1: r_1=r_2 \lor D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)=\mgu(r_1, r)$ yielding $C: (D\lor E\occatp{r_2})\sigma$.
	We consider the different situations under which the situation in question is introduced by means of unification: 

	\begin{itemize}
		\item
			There is already a literal in $\inv\sigmazmi$ where $u$ occurs directly below a $\Phi$-symbol and $\sigma_i$ does not change this.
			Then \ref{15_1} is the case.

		\item
			There is a variable $v$ in $\inv\sigmazmi$ such that $v\sigma_i$ contains $u$ directly below a $\Phi$-symbol.
			As then $v$ is unified with the term $v\sigma_i$, $v\sigma_i$ must occur in $\inv\sigmazmi$, which implies that \ref{15_1} is the case.

		\item
			The variable $u$ occurs grey in $r_2$ and $p$ in $E$ is directly below a $\Phi$-symbol. 
			But then $u$ occurs grey in an equality in $\inv\sigmazmi$ and as $\sigma_i$ is trivial on $u$ also in $\inv\sigmazi$, hence \ref{15_5} holds.

		\item
			Suppose that some varaible $v$ occurs directly below a $\Phi$-symbol in $\inv\sigmazmi$ such that $u$ occurs grey in $v\sigma_i$.
			Then by the definition of the unification algorithm, there exists a position $q$ such that one of $r_1\atq$ and $r\atq$ is $v$ and the other one contains a grey occurrence of $u$.

			We distinguish cases based on the position $q$:

			\begin{itemize}
				\item
					Suppose that $q$ occurs directly below a $\Phi$-symbol. Then clearly \ref{15_1} is the case.

				\item
					Suppose that $q$ occurs directly below a $\Psi$-symbol. Then as the variable $v$ also occurs directly below a $\Phi$-symbol and $u$ occurs grey in $v\sigma_i$, \ref{15_2} is the case.

				\item
					Suppose that $q$ is a grey position.
					Then \ref{15_5} is the case: 
					Either $u$ occurs grey in $r_1$ in $\inv\sigmazmi$ and then also in $\inv\sigmazi$, 
					or otherwise $v$ occurs grey in $r_1$ in $\inv\sigmazmi$, but as $v\sigma_i$ contains $u$ grey, then $u$ occurs grey in the successor of $r_1$ in $\inv\sigmazi$.
					\qedhere
			\end{itemize}

	\end{itemize}

\end{proof}


\begin{lemma}
	\label{lemma:col_change}
	Let $\inference$ be an inference of a resolution refutation of $\Gamma \cup \Delta$.
	Suppose that a variable $u$ occurs directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol in $\inv\sigmazi$.
	Then $u$ occurs grey in a grey literal or grey in an equality in $\inv\sigmazi$.
\end{lemma}
\begin{proof}
	We proceed by induction over the refutation.
	As the original clauses each contain symbols of at most one color, the base case is trivially true.

	For the induction step, suppose that an inference makes use of the clauses $C_1, \dots, C_n$ and that the lemma holds for $\PI^*(C_j) \lor C_j$ for $1\varleq j \varleq n$. 

	Note that then, the lemma holds for $\inv = \PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor C\nosigma)$.
	This is because as all clauses are variable-disjoint, no variable can occur $\inv$ both directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol if this was not the case in $\PI^*(C_j) \lor C_j$ for some $j$, for which the lemma by assumption holds.
	Furthermore, by the definition of $\PI^*$, every literal which occurs in $\PI^*(C_j) \lor C_i$ for some $j$ occurs in $\inv$.

	Hence it remains to show that the lemma holds for $\inv\sigma = \inv\sigma_0\quantifierdots\sigma_m$, which we do by induction over $i$ for $1\varleq i \varleq m$.
	Suppose that the lemma holds for $\inv\sigmazmi$ and in $\inv\sigmazi$, the variable $u$ occurs directly below a $\Phi$-symbol as well as directly below a $\Psi$-term.

	Then by the lemmata~\ref{lemma:var_below_phi_symbol} and \ref{lemma:var_below_phi_symbol_paramod}, we can deduce that one of the following statements holds for $\Omega = \Phi$ as well as $\Omega = \Psi$. We denote case $j$ for $\Omega = \Phi$ by $j^\Phi$ and for $\Omega = \Psi$ by $j^\Psi$.

\begin{enumerate}
		\item
			\label{16_1}
			The variable $u$ occurs directly below a $\Omega$-symbol in $\inv\sigmazmi$.

		\item
			\label{16_4}
			The variable $u$ occurs at a grey position in a grey literal or at a grey position in an equality in $\inv\sigmazi$.

		\item 
			\label{16_2}
			There is a variable $v$ such that 
			{
				\renewcommand{\labelitemi}{\textendash}
				\begin{itemize}
					\item $u$ occurs grey in $v\sigma_i$ and
					\item $v$ occurs in $\inv\sigmazmi$ directly below a $\Phi$-symbol as well as directly below a $\Psi$-symbol
				\end{itemize}
			}
	\end{enumerate}

	If \ref{16_4}$^\Phi$ or \ref{16_4}$^\Psi$ is the case, we clearly are done.
	On the other hand \ref{16_2}$^\Phi$ or \ref{16_2}$^\Psi$ is the case, then by the induction hypothesis, $v$ occurs grey in a grey literal or grey in an equality in $\inv\sigmazmi$. 
	As $u$ occurs grey in $v\sigma_i$, we obtain that then, $u$ occurs grey in a grey literal or grey in an equality in $\inv$.

	Hence the only remaining possibility is that both \ref{16_1}$^\Phi$
	and \ref{16_1}$^\Psi$ hold.
	But then $u$ occurs directly below a $\Phi$-symbol as well as below a $\Psi$-symbol in $\inv\sigmazmi$ and again by the induction hypothesis, we obtain that $u$ occurs grey in a grey literal or grey in an equality in $\inv\sigmazmi$ and as $\sigma_i$ is trivial on $u$, the same occurrence of $u$ is present in $\inv\sigmazi$.
\end{proof}


\begin{lemma}
	\label{lemma:subterm_in_grey_lit_star}
	If $\PI^*(C) \lor C$ for a clause $C$ in a resolution refutation of $\Gamma \cup \Delta$ contains a maximal colored occurrence of a $\Phi$-term $t\occ{s}$, which contains a maximal $\Psi$-colored term $s$, then $s$ occurs grey in a grey literal or grey in an equality in $\PI^*(C) \lor C$.
\end{lemma}
\begin{proof}
	We proceed by induction over the resolution refutation.
	As the original clauses each contain symbols of at most one color, the base case is trivially true.

	The induction step is laid out similarly as in the proof of Lemma~\ref{lemma:col_change}. 
	We suppose that an inference makes use of the clauses $C_1, \dots, C_n$ and that the lemma holds for $\PI^*(C_j) \lor C_j$ for $1\varleq j \varleq n$. 
	Then the lemma holds for $\inv = \PIstepstarnosigma(\inference, \PI^*(C_1), \dots, \PI^*(C_n)) \lor C\nosigma)$ as no new terms are introduced in $\inv$ and all literals from $\PI^*(C_j) \lor C_j)$ for $1\varleq j \varleq n$ occur in~$\inv$.

	It remains to show that the lemma holds for $\inv\sigma = \inv \sigma_0 \quantifierdots \sigma_m$, which we do by induction over $i$ for $0 \varleq i \varleq m$.
	We distinguish on the situation under which a unification leads to the term $t\occ{s}$.

	\begin{itemize}
		\item 
			Suppose for some variable $u$ that $u\sigma_i$ contains $t\occ{s}$. 
			Then $u$ is unified with a term which contains $t\occ{s}$ and occurs in $\inv\sigmazmi$.
			Hence by the induction hypothesis, $s$ occurs grey in a grey literal or grey in an equality in $\inv\sigmazmi$ and ,as $\sigma_i$ does not change this, also in $\inv\sigmazi$.

		\item 
			Otherwise there is a variable $u$ which occurs directly below a $\Phi$-symbol and $v\sigma_i$ contains a grey occurrence of $s$.
			We distinguish based on the occurrences of $u$ in $\inv\sigmazmi$:

			\begin{itemize}
				\item Suppose that $u$ occurs in $\inv\sigmazmi$ in grey a grey literal or grey in an equality. Then clearly we are done.
				\item Suppose that $u$ occurs in $\inv\sigmazmi$ directly below a $\Psi$-symbol.
					Then by Lemma~\ref{lemma:col_change}, $u$ occurs grey in a grey literal or grey in an equality in $\inv\sigmazmi$, whose successor in $\inv\sigmazi$ is an occurrence of $s$ of the same coloring.
				\item Suppose that $u$ occurs in $\inv\sigmazmi$ only directly below a $\Psi$-symbol.
					Here, we differentiate between the types of inference of the current induction step:

					\begin{itemize}
						\item
							Suppose that the inference of the current induction step is a resolution or a factorisation inference.
							As $u$ occurs grey in $v\sigma_i$, there is a position $p$ such that for the resolved or factorised literals $\lambda$ and $\lambda'$ it holds without loss of generality that $\lambda\atp = u$ and $s$ occurs grey in $\lambda'\atp$.
							Note that $\lambda$ and $\lambda'$ agree on the path to $p$, including the predicate symbol..

							Now as by assumption $u$ only occurs directly below a $\Phi$-symbol, so must $s$.
							But then $s$ occurs directly below a $\Phi$-symbol in $\inv\sigmazmi$ and we get the result by the induction hypothesis.

						\item
							Suppose that the inference of the current induction step is a paramodulation inference.
							Let it use the the clauses $C_1: r_1=r_2 \lor D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)=\mgu(r_1, r)$ to yield $C: (D\lor E\occatp{r_2})\sigma$.

							As $u$ is affected by $\sigma_i$, it must occur in $r_1$ or $r$. Let $\bhat u$ refer to this occurrence.

							\begin{itemize}
								\item
									Suppose that $\bhat u$ occurs directly below a $\Phi$-colored function symbol. 

									If $\bhat u$ is contained in $r_1$, then $s$ must be contained in $r$ directly below a $\Phi$-symbol as $r_1$ and $r$ are unifiable. We then get the result by the induction hypothesis.

									If otherwise $\bhat u$ is contained in $r$, 
									then there are two possibilities for the occurrence of $s$ in $r_1$:

									Either $\bhat u$ occurs in a $\Phi$-colored function symbol in $r$. Then $s$ occurs in a $\Phi$-colored function symbol in $r_1$ and we get the result by the induction hypothesis.

									Otherwise $\bhat u$ occurs grey in $r$, but $r$ occurs directly below a $\Phi$-colored function symbol in $E$.
									Then however, as $r$ and $r_1$ are unifiable, $s$ must occur grey in $r_1$ and hence grey in an equality.

								\item
									Suppose that $\bhat u$ occurs directly below a $\Phi$-colored predicate symbol. 

									Then as the equality predicate is not considered to be colored, $u$ must occur grey in $r$.
									But then as $r_1$ and $r$ are unifiable, $s$ must occur grey in $r_1$ and hence grey in an equality.
									\qedhere
							\end{itemize}

					\end{itemize}

			\end{itemize}

	\end{itemize}

\end{proof}

\begin{lemma}
	\label{lemma:subterm_in_grey_lit}
	Same as \ref{lemma:subterm_in_grey_lit_star} with $\PI$ in place of $\PI^*$.
\end{lemma}
\begin{proof}
	Note that $\PI$ and $\PI^*$ only differ with respect to colored literals.
	Let $C$ be a clause of a resolution refutation of $\Gamma \cup \Delta$.
	As the literals occurring in $\PI(C)$ are a subset of the literals occurring in $\PI^*(C)$, the lemma prerequisites hold true only for terms for which they also hold in $\PI^*(C)$.

	Therefore we can deduce that if a maximal colored $\Phi$-term $t\occ{s}$ containing a maximal $\Psi$-colored term $s$ occurs in $\PI(C)\lor C$, then $t\occ{s}$ also occurs in $\PI^*(C) \lor C$ and by Lemma~\ref{lemma:subterm_in_grey_lit_star},
	the term $s$ occurs grey in a grey literal or grey in an equality in $\PI^*(C) \lor C$.
	However by Lemma~\ref{lemma:grey_lits_of_pi_star_in_pi}, all grey literals and equalities of $\PI^*(C)$ also occur in $\PI(C)$.
\end{proof}

\begin{lemma}
	\label{lemma:col_alt_in_grey_lit_then_quant_alt}
	If a term with $n$ color alternations occurs in a grey literal or an equality $\PI(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n$ quantifier alternations.
\end{lemma}
\begin{proof}
	We perform an induction on $n$
	and show the strengthening that
	the quantification of the lifting variable which replaces a term with $n$ color alternations is required to be in the scope of the quantification of $n-1$ alternating quantifiers.

	For $n=0$, no colored terms occur in $I$ and hence also no quantifiers.
	Moreover for $n=1$, there are terms of one color which evidently require at least one quantifier.

	Suppose that the statement holds for $n-1$ for $n>1$ and that a term $t$ with $\ca(t) = n$ occurs in $\PI(C)$.
	We assume without loss of generality that $t$ is a $\Phi$-term.
	Then $t$ contains some $\Psi$-colored term $s$ with $\ca(s) = n-1$ and
	by Lemma~\ref{lemma:subterm_in_grey_lit}, $s$ occurs grey in a grey literal or an equality in $\PI(C) \lor C$.
	By Lemma~\ref{lemma:grey_lits_all_in_PI} and Lemma~\ref{lemma:equalities_all_in_PI}, a successor of $s$ occurs in $\PI(\pi)$. Note that as $s$ occurs in a grey position, any successor of $s$ also occurs in a grey position.

	By the induction hypothesis, the quantification of the lifting variable for $s$ requires $n-1$ alternated quantifiers.
	As $s$ is a subterm of $t$ and $t$ is lifted, $t$ must be quantified in the scope of the quantification of $s$, and as $t$ and $s$ are of different color, their quantifier type is different. 
	Hence the quantification of the lifting variable for $t$ requires $n$ quantifier alternations.
\end{proof}

\begin{prop}
	\label{prop:color_alt_eq_quant_alt}
	If a term with $n$ color alternations occurs in $\PI(C) \lor C$ for a clause $C$, then the interpolant $I$ produced in Theorem~\ref{thm:two_phases} contains at least $n-1$ quantifier alternations.
\end{prop}
\begin{proof}
	By Lemma~\ref{lemma:subterm_in_grey_lit}, a term with $n-1$ color alternations occurs in a grey literal or an equality in $\PI(C) \lor C$.
	Lemma~\ref{lemma:col_alt_in_grey_lit_then_quant_alt} gives the result.
\end{proof}


We present an example which illustrates that the occurrence of a term with $n$ color alternations in $\PI(C) \lor C$ for a clause $C$ can lead to an interpolant with $n-1$ quantifier alternations (but no less as Proposition~\ref{prop:color_alt_eq_quant_alt} shows).
\begin{exa}
	Let $\Gamma = \{ \lnot P(a) \}$ and $\Delta = \{ P(x) \lor Q(f(x)), \lnot Q(y) \}$.
	Consider the following refutation of $\Gamma \cup \Delta$:
	\begin{prooftree}
		\AxiomCm{ \lnot P(a) \mid \bot }
		\AxiomCm{ P(x) \lor Q(f(x)) \mid \top }

		\RightLabelm{\resrule{\resruleres}{x\mapsto a}}
		\BinaryInfCm{ Q(f(a)) \mid \lnot P(a) }

		\AxiomCm{ \lnot Q(y) \mid \top }
		\RightLabelm{\resrule{\resruleres}{y\mapsto f(a)}}
		\BinaryInfCm{ \square \mid \lnot P(a) }
	\end{prooftree}

	In this example, Theorem~\ref{thm:two_phases} yields the interpolant $I \equiv \exists y_a \lnot P(y_a)$ with $\qa(I) =\nolinebreak 1$.
	The existence of the term $f(a)$ with $\ca(f(a)) = 2$ in a clause of the refutation implies that $\qa(I) \vargeq 1$.
\end{exa}





\end{document}



