\documentclass[,%fontsize=11pt,%
	paper=a4,% 
	%landscape,
	DIV11, % mehr text pro seite als defaultyyp
	%DIV10, 
	%DIV=calc,%
	twoside=false,%
	liststotoc,
	bibtotoc,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
]{scrartcl}

\usepackage{lscape}
\usepackage{stackengine}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}

% sections also in toc
\setcounter{tocdepth}{2}

\definethms

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}
\usepackage{tabularx}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{color}
\usepackage[final]{listings} % sourcecode in document
\usepackage{url}      % for urls
\usepackage{multicol}
\usepackage{float}
\usepackage{caption}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

\usepackage[authoryear]{natbib} % \cite ; square|round etc.
%\usepackage[numbers,square]{natbib}
%\usepackage[square, authoryear]{natbib}
%\usepackage[language=english]{biblatex}

%\bibliographystyle{plain}
\bibliographystyle{alpha}
%\bibliographystyle{alphadin}
%\bibliographystyle{dinat}
%\bibliographystyle{chicago}
%\bibliographystyle{plainnat}

\bibdata{bib.bib}

\renewcommand*{\partformat}{\partname\ \thepart\ -}
\let\partheadmidvskip\

\newcommand{\comp}{\ensuremath{\text{comp}}}
% smaller url style
\makeatletter
\def\url@leostyle{%
\@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\ttfamily}}}
\makeatother
\urlstyle{leo}

\newcommand{\myfig}[5] {
	\begin{figure}[tbph]
		\centering
		\includegraphics[#3]{#1}
		\caption[#4]{#5}
		\label{fig:#2}
	\end{figure}
}

\setlength{\parindent}{0em}
%\usepackage{thmtools} % actually already in latex_header.tex ...

\usepackage{amsthm}


\usepackage{tikz-qtree}

%\newcommand{\sig}[1]{{#1}_\Sigma}
%\newcommand{\p}[1]{{#1}_\Pi}
\newcommand{\sig}[1]{\stackrel{\Sigma}{#1}}
\newcommand{\p}[1]{\stackrel{\Pi}{#1}}

\newcommand{\e}[1]{\vskip .7em   \section*{#1}}

%\def\proofSkipAmount{ \vskip -0.3em}

\usepackage{refcheck}

\newcommand{\lif}[1]{\lift{\Delta}{#1}{x}}
\newcommand{\newterm}{^*}
\newcommand{\de}{^\Delta}

\begin{document}
\begin{clemma}
	\label{lemma:smallest_colored_container}
	Let a variable $x$ occur twice in $C$ such that in one occ, the smallest colored term containing $x$ is a $\Gamma$-term and for the other, the smallest colored term containing $x$ is a $\Delta$-term.
	Then $x$ occurs grey in $\AIany(C)$.
\end{clemma}
\begin{proof}
	\largered{missing: variables don't have to occur grey in $y\sigma$, e.g. in $\gamma\occ{y}$, $y\sigma$ might be $f(x)$ with $f$ $\Gamma$-colored.}
	~
	\begin{itemize}
		\item
			Suppose that in $C_i$, $\gamma\occ{x}$ occurs and in $C_j$, we have $\delta\occ{y}$ such that $x$ occurs grey in $y\sigma$.

			Then $y$ occurs in $l$ at $l\at{\bhat y}$ such that $l'\at{\bhat y}$ is an abstraction of a term containing a grey occurrence of $x$.

			Suppose that $l\at{\bhat y}$ (and therefore also $l\at{\bhat y}$) is not a grey occurrence as otherwise we are done. 

			As $l\sigma l'\sigma $, $l\at{\bhat y}$ and $l\at{\bhat y}$ share their prefix, so their color is the same.

			Then induction hypothesis.

		\item 
			Suppose that in $C_i$, $\gamma\occ{z}$ occurs and in $C_j$, $\delta\occ{y}$ occurs such that $x$ occurs grey in $y\sigma$ and in $z\sigma$.

			By Lemma~\ref{lemma:proof_along_mgu}, exists $y_1, \dots, y_n$ and $z_1, \dots z_m$ such that $x$ occurs grey in $y_i\sigma$ and in $z_i\sigma$ and term opposite of $y_n$ and $z_m$ actually contains $x$.


			If any $y_i$, $z_j$ occurs grey, done, so assume all occur colored.

			$z_m$ and $y_n$ opposite of actual $x$, as $x$ only in one clause, $z_m$ and $y_n$ in same clause. 
			they do share prefix with the occurrences of $x$ in the clause where $x$ is.

			if they there are contained in smallest col terms of opposite color $\Ra$ ind hyp

			otw of same smallest term color there.

			Note that every $y_i$, $z_j$ occurs at least twice: once as opposite var of the last one, once to unify with the next one.

			as originally different colors and at meeting point at $x$ same color, there has to be one alternation, where we use the ind hyp.


		\item
			Suppose that $\gamma\occ{x}$ in $C_i$ and $\delta\occ{x}$ in $z\sigma$ such that $z$ occurs grey in $C_j$.

			If $\delta\occ{x}$ occurs in $C_i$ (cannot occur in other clause), ind hyp.

			Suppose it does not occur. 
			Then however exists $\delta\occ{y}$ s.t. $x$ occurs grey in $y\sigma$ $\Ra$ other case.

		\item
			Suppose that $\gamma\occ{x}$ in $y\sigma$ such that $y$ occurs grey in $C_i$ and $\delta\occ{x}$ in $z\sigma$ such that $z$ occurs grey in $C_j$.

			If $\gamma\occ{x}$ and $\delta\occ{x}$ occur, ind hyp.

			If just one occurs, $\Ra$ other case.

			If none of them occur, then occur $\delta\occ{\alpha}$ s.t. $x$ grey in $\alpha\sigma$ and similar for $\gamma\occ{\beta}$ $\Ra$ other case.



	\end{itemize}
\end{proof}

\clearpage

\begin{clemma}
	Let $\sigma$ unifier.
	exists unification order $\sigma = \sigma_1 \dots \sigma_n$ with $\sigma_i =\nolinebreak \{ x_i \mapsto r_i \}$ s.t.\ 
	$x_i$ does not occur in $\{ r_i, r_{i+1}, \dots, r_n\}$.
\end{clemma}

\begin{proof}
	Suppose ordering does not exist, i.e.\ $l\sigma = l'\sigma$, but every $x_i$ occurs in some $r_j$ for $j\grq i$.

	But then last variable does not occur later..
\end{proof}

\begin{lemma}
	Let $\sigma$ unifier.

	At any stage in the run of the unification algo, exists var $x$ as one part of a difference pair s.t.\ $x$ does not occur in a function symbol in a difference pair.
\end{lemma}
\begin{proof}
	Suppose no such var exists. 


	{\tiny

	resolve all differences $x_i \sim r_i$ such that $r_i$ does not contain a variable in a function symbol.

	all variables, in particular the remaining $x_i$, occur in a function symbol in $r_j$ for some $j$.

	Iteratively resolve in some order: $x_i \mapsto r_i$, where every $r_i$ contains at least one variable.
	Hence as every $x_i$ occurs in some $r_j$, the variable in $r_i$ then occurs in $r_j$.
	
	so after a step, for the remaining difference pairs, it is still the case that every variable occurs in some $r_j$.

	We do not get an occurs check error as by assumptions, the term are unifiable.

	when we get to the point where there is only one subst left, it has to be of the form $x_i \mapsto r_i\occ{x_i}$, so we do get an occurs check error, which contradicts the assumptions that the terms are unifiable.

}
\end{proof}

\begin{lemma}
	Let $\sigma$ unifier. 
	At any stage in the run of the unification algorithm, there exists a variable as one part of a difference pair such that the other part does not contain a variable, which also occurs as one part of a difference pair, under a function symbol.
\end{lemma}
\begin{proof}
	Suppose to the contrary, that \dots.

	Construct graph with vars as nodes and arrow from $x, y$ if exists difference pair $(x, r\occ{y})$ or the symmetric pair.

	As every variable unifies to a term containg another variable, we have that $\forall x \exists y\,E(x, y)$. Hence we can build a path of length $|V|+1$, but this contains a cycle. 

\end{proof}

{TODO ICI: does this mean that there is a variable which does not have a variable in a term at its RHS? }
(all difference pairs have a variable at some side, let's call it LHS and the other one RHS)

{possibly: do induction along this order: take subst which has no var to the right, then this one occurs in the term. next term then does not actually exists necessarily, so need to show some induction property.}


evil examples:

$P(z, z, \delta), \lnot P(f(x), f(y), y)$

$P(z, f(z), f(f(\delta))), \lnot P(f(x), y, y)$

$P(u, f(z), f(f(\delta))), \lnot P(f(x), y, y)$

\begin{figure}
	\begin{clemma}
		Suppose $\Gamma$-term $s(y)$ in original diff pairs.

		Suppose $y\sigma = x$ (simplification).

		Suppose no col change, i.e.\ no var $x$ occurs in a unified literal twice such that once in s.c.\ $\Gamma$-term and once in s.c.\ $\Delta$-term.

		Suppose no $x$ grey in $l\sigma \, ( = l'\sigma )$.

		Hence at some point have diff pair $(y, v)$ with $v\sigma = x$.

		by no col change and $s(y)$, $y$ does not occur in a s.c.\ $\Delta$-term.

		As no $x$ grey in $l\sigma$ and $y\sigma = x$, no $y$ grey.

		Hence $y$ only s.c.\ $\Gamma$-col.

		$y$ and $v$ same prefix, so $v$ s.c.\ $\Gamma$-col.

	\end{clemma}


\end{figure}

\begin{defi}[col change]
	col change: a var $x$ occurs in yet to specify location twice such that once in s.c.\ $\Gamma$-term and once in s.c.\ $\Delta$-term.
\end{defi}

\newcommand{\epsilondelta}{\varepsilon\occ\delta}

\begin{clemma}
	Let $\sigma = \mgu(l, l')$

	Suppose $\Gamma$-term $s\occ{y}$ in some unification pair, $\delta$ grey in $y\sigma$.

	Suppose no col change.

	Suppose no $\delta$ grey in $l\sigma \, ( = l'\sigma )$.

	Then exists $\Gamma$-term $h\occ{\delta'}$ in $l$ or $l'$ OR in earlier $\mgu$-operation.

\end{clemma}


~

\clearpage
\begin{clemma}
	Suppose s.c.\ $\Gamma$-term containing $\Delta$-term $\delta$ is created via unification of $l$ and $l'$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item In $l\sigma$	(=$l'$), $\delta$ occurs grey.
		\item There is a variable $x$ in $l$ or $l'$ such that it occurs once in an s.c.\ $\Gamma$-term and once in an s.c.\ $\Delta$-term.
		\item A $\delta$-term occurs in a $\Gamma$-term in $l$ or $l'$ (\mytodo{ be more precise on which term}).
	\end{enumerate}
\end{clemma}
\begin{proof}
	We show that a term in question is created, then one of the statments holds, or a term in question has been created earlier during the run of the mgu.

	\begin{enumerate}
		\item
			Supp have $f(y)$ in some unification pair.

			Note $y$ not grey somewhere as otherwise done.

			At some stage exists diff pair $(y, t)$. note $y, t$ same prefix, hence same color.
			$t$ abstraction of $\epsilondelta$.

			\begin{itemize}
				\item supp $t$ contains outermost symbol of $\delta$. as $y, t$ same color, $t$ is multi-col term either in $l$ or $l'$, or created earlier during unification algo.
				\item otw $t$ contains var $v$ s.t.\ $v\sigma = \delta$ or $v\sigma = \epsilondelta$.

					Supp. $v$ occurs grey in $l$ or $l'$. then done. 

					Note during unification procedure, coloring does not disappear, hence assume now all $v$ colored.

					\hl{[ hole: col change ]}

					hence can assume all occs of $v$ are s.c.\ $\Gamma$-col.

					so have like $f(v)$, with $v\sigma = \delta$ or $v\sigma = \epsilondelta$.
					the corresponding diff pair is resolved earlier or later.

					possible argument: finitely often anyway? 

					possible argument: after finitely many variable renamings, we hit an actual term, which then is strictly smaller, hence terminates?

			\end{itemize}

		\item var substituted for multi-colored term .
	\end{enumerate}

\end{proof}

\clearpage
\begin{clemma}
	Same as above but with applied partial unifiers. Not sure which statement actually follows from this proof.
\end{clemma}
\begin{proof}
	$l\sigma = l'\sigma$.
	$\sigma = \sigma_1 \cdots \sigma_n$, where $\sigma_i$ stems from the $i$th substitution applied by the unification algo.

	Let $l_j = l\sigma_1 \cdots \sigma_j$

	Let $\sigma_i$ be unifier $x \mapsto \delta$.

	Suppose $l_i $ contains a $\Delta$-term in a $\Gamma$-term, where the respective predecessor of the $\Gamma$-term does not have a $\Delta$-term at that position or does not exist in $l_{i-1}$.

	\begin{enumerate}
			\item
				Suppose a $\Gamma$-term $t\occ{y}$ exists in $l_{i-1}$, such that it contains a grey occ of a variable $y$ such that $y\sigma_i = \epsilondelta$ at position $\bhat y$ (where $\varepsilon$ may be ``empty'').
				The corresponding difference pair is $(y, \epsilondelta)$.

				So $y$ occurs at say $\bhat y$ in $l$ or $l'$, say $\lambda$. ($y$ may occur in both, variable-disjointness might have already been broken).

				If it is a grey occurrence, we are done as $\delta$ occurs grey in $y\sigma$. \checkmark

				So assume $y$ occurs colored.
				
				$\lambda'_{i-1}\at{\bhat y} = \epsilondelta$.
				Note that $\lambda_{i-1}\at{\bhat y}$ and $\lambda'_{i-1}\at{\bhat y}$ agree on the prefix (by virtue of being a difference pair).

				\begin{itemize}
						\item
							Suppose $\lambda_{i-1}\at{\bhat y}$ occurs in an s.c.\ $\Gamma$-term.
							Then $\lambda'_{i-1}\at{\bhat y}$ is $\delta$ in a $\Gamma$-term in $l$ or $l'$.~\checkmark

						\item
							Suppose $\lambda_{i-1}\at{\bhat y}$ occurs in an s.c.\ $\Delta$-term.
							Then as $y$ occurs in $t$ in a $\Gamma$-term, we have a col change (but possibly distributed over $l$/$l'$


				\end{itemize}



				\item multi-colored insertion
	\end{enumerate}
\end{proof}



~

~


\mytodo{ express idea: all of same color or color change }

\mytodo{ possibly assume: something (var, $\Delta$-term) does not occur grey $\Ra$ then other special case }



\section{Structure (cases) of relevant unifications} 

\begin{lemma}
	For a difference pair or a not necessarily prefix-disjoint ``unification pair'' $(s, t)$, $s$ and $t$ are both of same maximal and minimal color.
\end{lemma}

Supp $f(x)$ occurs somewhere (original diff pairs or somewhere during run of algo) and $x\sigma =\nolinebreak \varepsilon\occ{\delta}$.



\subsection{fst}

Then $f(x) \sim t$, s.t.\ $t\sigma = f(\varepsilon\occ{\delta})$.

(Suppose no col change.)

\begin{enumerate}
	\item Supp $t = f(\varepsilon\occ{\delta})$. \checkmark
	\item Supp $t = f(y)$.
		$y\sigma = \varepsilon\occ{\delta}$.
		Then IH (for some IH\dots).
	\item Supp $t = f_{1/2}(y)$.
		$y\sigma = f_{1/2}(\varepsilon\occ{\delta})$.
	\item Supp $t = y$.
		$y\sigma = f(\varepsilon\occ{\delta})$.
	\item ? Supp $h(t) = y$.
\end{enumerate}

\subsection{snd}

Then actually $x \sim t$, s.t.\ $t$ possibly non-proper abstraction of $\varepsilon\occ{\delta}$.

\begin{enumerate}
	\item Supp $t = \varepsilon\occ{\delta}$. \checkmark
	\item Supp $t = y$.
		$y\sigma = \varepsilon\occ{\delta}$.
\end{enumerate}

\subsection{random notes}

suppose $z\sim f(x)$.
then $x$ is only changed if $z$ is unified with something with an $f$-prefix.



\largeblue{ look at terms where partial unification applies. the final state is just an extremely advanced applied partial unification. }

\end{document}
