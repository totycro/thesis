\documentclass[,%fontsize=11pt,%
	paper=a4,% 
	%landscape,
	DIV11, % mehr text pro seite als defaultyyp
	%DIV10, 
	%DIV=calc,%
	twoside=false,%
	liststotoc,
	bibtotoc,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
]{scrartcl}

\usepackage{lscape}
\usepackage{stackengine}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}

% sections also in toc
\setcounter{tocdepth}{2}

\definethms

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}
\usepackage{tabularx}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{color}
\usepackage[final]{listings} % sourcecode in document
\usepackage{url}      % for urls
\usepackage{multicol}
\usepackage{float}
\usepackage{caption}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

\usepackage[authoryear]{natbib} % \cite ; square|round etc.
%\usepackage[numbers,square]{natbib}
%\usepackage[square, authoryear]{natbib}
%\usepackage[language=english]{biblatex}

%\bibliographystyle{plain}
\bibliographystyle{alpha}
%\bibliographystyle{alphadin}
%\bibliographystyle{dinat}
%\bibliographystyle{chicago}
%\bibliographystyle{plainnat}

\bibdata{bib.bib}

\renewcommand*{\partformat}{\partname\ \thepart\ -}
\let\partheadmidvskip\

\newcommand{\comp}{\ensuremath{\text{comp}}}
% smaller url style
\makeatletter
\def\url@leostyle{%
\@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\ttfamily}}}
\makeatother
\urlstyle{leo}

\newcommand{\myfig}[5] {
	\begin{figure}[tbph]
		\centering
		\includegraphics[#3]{#1}
		\caption[#4]{#5}
		\label{fig:#2}
	\end{figure}
}

\setlength{\parindent}{0em}
%\usepackage{thmtools} % actually already in latex_header.tex ...

\usepackage{amsthm}


\usepackage{tikz-qtree}

%\newcommand{\sig}[1]{{#1}_\Sigma}
%\newcommand{\p}[1]{{#1}_\Pi}
\newcommand{\sig}[1]{\stackrel{\Sigma}{#1}}
\newcommand{\p}[1]{\stackrel{\Pi}{#1}}

\newcommand{\e}[1]{\vskip .7em   \section*{#1}}

%\def\proofSkipAmount{ \vskip -0.3em}

\usepackage{refcheck}

\newcommand{\lif}[1]{\lift{\Delta}{#1}{x}}
\newcommand{\newterm}{^*}
\newcommand{\de}{^\Delta}

\begin{document}

\section{serious stuff}

\begin{defi}[col change]
	col change: a var $x$ occurs in yet to specify location twice such that once in s.c.\ $\Gamma$-term and once in s.c.\ $\Delta$-term.
\end{defi}

\newcommand{\epsilondelta}{\varepsilon\occ\delta}
\newcommand{\epsilonx}{\varepsilon\occ x}
\newcommand{\epsilony}{\varepsilon\occ y}
\newcommand{\epsilonz}{\varepsilon\occ z}


\begin{defi}
	$\sigma_{i\ra j} \defeq \prod_{k=i}^j\sigma_k$.
\end{defi}

\begin{lemma}[corresponds to lemma 25 in -final]
	\label{new_25}
	Let $\sigma = \mgu(l, l') = \sigma_1 \cdots \sigma_n$.

	Suppose a s.c.\ $\Phi$-term $s\occ{y}$ occs in $l(')\sigmaz{i-1}$ where $1\varleq i \varleq n$ and $\sigma_0 = \id$ s.t.\ $\dom(\sigma_i) = \{y\}$ and a var $x$ occurs grey in $y\sigma_i$.
	At least one of the following statments holds:

	\begin{enumerate}
		\item $x$ occurs grey in $l(')\sigmazi$ (and $y$ in $l(')\sigmaz{i-1}$)
		\item $x$ occur in s.c.\ $\Phi$-term in $l(')\sigmaz{i-1}$  
			($\Ra$ $x$ occs in s.c.\ $\Phi$-col term in $l(')\sigmazi$)
			%$x$ occurs in a s.c.\ $\Phi$-term in
		\item there is a col change where $y$ is a col change var in $l(')\sigmaz{i-1}$ ( and $x$ in $l(')\sigmazi$) 
	\end{enumerate}
\end{lemma}
\begin{proof}
	If $y$ occurs grey somewhere in $l(')\sigmaz{i-1}$, we are done.\todo{ramp!}

	Suppose it only occurs colored in $l(')\sigmaz{i-1}$. (1)

	Suppose at least once in s.c.\ $\Psi$-term.
	Then in $l(')\sigmaz{i-1}$, $y$ is a col change variable (3)

	Otw.\ it occs only in $\Phi$-terms. 
	There must exist an occurrence $\bhat y$ of $y$ in literal $\lambda$ s.t.\ $\lambda'\at{\bhat y}$ is $y\sigma_i$.
But $\lambda\at{\bhat y}$ and $\lambda'\at{\bhat y}$ share the prefix, so $\lambda'\at{\bhat y}$ is a s.c.\ $\Phi$-term containing a grey occurrence of $x$. (2)
\end{proof}

not BS:

Let $\sigma = \mgu(l, l')$.

	Suppose a variable $y$ occs in $l(')\sigmaz{i-1}$ where $1\varleq i \varleq n$ and $\sigma_0 = \id$
	s.t.\ $\dom(\sigma_i) = \{y\}$ and $x$ occurs in a s.c.\ $\Phi$-term in $y\sigma_i$.

	THen in $l(')\sigmaz{i-1}$, $x$ occurs in a s.c.\ $\Phi$-term.


BS:
{

\tiny
\begin{lemma}[corresponds to lemma 26 in -final]
	Let $\sigma = \mgu(l, l')$.
	Suppose a variable $y$ occs in $l(')\sigmaz{i-1}$ where $1\varleq i \varleq n$ and $\sigma_0 = \id$
	s.t.\ $\dom(\sigma_i) = \{y\}$ and $x$ occurs in a s.c.\ $\Phi$-term in $y\sigma_i$.
	At least one of the following statments holds:

	\begin{enumerate}
		\item $x$ occurs grey in $l(')\sigmazi$
		\item $x$ occurs grey in a s.c.\ $\Phi$-term in $l(')\sigmazi$ (also in $l(')\sigmaz{i-1}$)
		\item there is a col change where $x$ is the col change var in $l(')\sigmazi$ 
	\end{enumerate}
\end{lemma}
\begin{proof}
	Suppose that $x$ does not occur grey in $l(')\sigmaz{i-1}$ as otherwise we are done.

	Suppose that $x$ also does not occur grey in a s.c.\ $\Phi$-term in $l(')\sigmaz{i-1}$ as otherwise we are done.
	
	So $x$ only occurs in s.c. $\Psi$-terms in $l(')\sigmaz{i-1}$.

	Let $\bhat y$ be the occ of $y$ of the diff pair. Then $\lambda'\at{\bhat y}$ contains an occ of $x$ in a s.c.\ $\Phi$-term.

\end{proof}

}

\begin{lemma}[corresponds to lemma 27 in -final]
	\label{new_27}
	Let $\sigma = \mgu(l, l')$, $C_1$ and $C_2$ var-disjoint and condition holds.

	\NB{this means that it holds for all resolution refutations if we pretend to have extended it to factorisation by just applying induction on exactly this. perhaps we should do this.}

	Suppose in $(C_1 \cup C_2)\sigmazi$ where $0\varleq i \varleq n$ and $\sigma_0 = \id$ there is a col change with var $x$ of $\Gamma$-term $s\occ{x}$ and $\Delta$-term~$t\occ{x}$.
	Then $x$ occs grey in $(C_1 \cup C_2)\sigmazi$.
\end{lemma}
\begin{proof}
	for $\sigma_0$, it holds.

	suppose holds for $\sigma_{i-1}$.

	3 possibilities for having a variable in a s.c.\ $\Phi$-term :
	\begin{compactenum}
	\item was there in stage $i-1$ in $(C_1 \cup C_2)\sigmaz{i-1}$
	\item $(C_1 \cup C_2)\sigmaz{i-1}$ contains term $t\occ{y}$ with $\dom(\sigma_i) = \{y\}$ and $x$ occs grey in $y\sigma_i$
	\item $(C_1 \cup C_2)\sigmaz{i-1}$ contains a variable $z$ such that $\dom(\sigma_i) = \{z\}$ and $x$ occs in a s.c.\ $\Phi$-term in $z\sigma_i$.
	\end{compactenum}

	apply this to both $s\occ{x}$ and $t\occ{x}$.

	if both variables were present in both colors in s.c.\ terms, we are done by the IH.

	So supp at least one introduced in stage $i$.
	this means at least for one of them situation 2 applies. 

	Hence lemma~\ref{new_25} applies, but not the case where $x$ already appeared in a respectively single-colored term before.

	but this means that for at least one of $s\occ{x}$ or $t\occ{x}$, $x$ occs grey in stage $i-1$ (this is stage $i$ in lemma~\ref{new_25}), or there is a col change with $x$ as var in $i-1$. 
	In the first case, we are done right away ($\sigma_i$ does not affect $x$ as $x$ still occurs after applying it), and in the second, we can use the IH.
\end{proof}

{\tiny

	small version: 

\begin{lemma}[corresponds to lemma 27 in -final (but only for literal!)]
	Let $\sigma = \mgu(l, l')$.
	Suppose in $l(')\sigmazi$ where $0\varleq i \varleq n$ and $\sigma_0 = \id$ there is a col change with var $x$ of $\Gamma$-term $s\occ{x}$ and $\Delta$-term~$t\occ{x}$.
	Then $x$ occs grey in $l(')\sigmazi$.
\end{lemma}
\begin{proof}
	induction.

	initially: $l\sigma_0$ and $l'\sigma_0$ var disjoint and condition holds for intra-vars. (so holds globally)

	3 possibilities for having a variable in a s.c.\ $\Phi$-term :
	\begin{compactenum}
	\item was there in stage $i-1$
	\item $l(')\sigmaz{i-1}$ contains term $t\occ{y}$ with $\dom(\sigma_i) = \{y\}$ and $x$ occs grey in $y\sigma_i$
	\item $l(')\sigmaz{i-1}$ contains a variable $z$ such that $\dom(\sigma_i) = \{z\}$ and $x$ occs in a s.c.\ $\Phi$-term in $z\sigma_i$.
	\end{compactenum}

	apply this to both $s\occ{x}$ and $t\occ{x}$.

	\hl{continuing with slightly different train of thought after returning from lunch:}

	if both s.c.\ $\Gamma$ and s.c.\ $\Delta$ were there in $i-1$, we are done by IH. this encompasses both 1 and 3, as by the non-BS lemma, it copies terms of a form.

	So suppose at least one introduced by situation 2.

	for both occs: either they were there in $i-1$, or we can apply lemma \ref{new_25}. in any case, we know that at least one of the three statments holds for both.

	Note index shift, in lemma all indices are one too many.

	If one of them has 1 ($x$ occurs grey in $l(')\sigmaz{i-1}$), we are done as $\sigma_i$ does not affect $x$ as $x$ occurs in $l(')\sigmazi$.

	If one of them has 3 (col change with $x$ in $l(')\sigmaz{i-1}$), then we apply the IH to it and get that $x$ occs grey in $l(')\sigmaz{i-1}$, so also in $l(')\sigmazi$.

	Otw. both were there before, which we supposed not to be the case for both, so one of them has to hit one of the other cases. 
\end{proof}

}

\begin{clemma}[corresponds to 29 in -final]
	If in $\AImatde(C) \lor \AIclde(C)$ a
	$\Gamma$-term $t\occatp{x_s}$ contains a $\Delta$-lifting variable $x_s$, then $x_s$ occurs grey in $\AIanyde(C)$,

\end{clemma}
\begin{proof}
	induction; base case works.

	supp resolution w/ usual notation.

	\begin{enumerate}
		\item Supp for some $i$ $\sigma_i = \{ u \mapsto s' \}$ s.t.\ $s'$ contains a $\Delta$-term, $s'\sigma = s$ and $u$ occurs in a maximal colored $\Gamma$-term at a single-colored $\Gamma$-position (i.e., must be below $\Gamma$-symbol and must not contain any other colored symbol as otherwise it would be lifted).

			We basically perform an induction over all construction steps of $\sigma$. Base case works by outer induction hypothesis.

			ind step:

			As $u$ is changed, it occurs in $l$ or $l'$, say in $\lambda$ at $\bhat u$.

			If $u$ occs grey anywhere in $C_{j}\sigmaz{i-1}$, in particular for example at $\lambda\sigmaz{i-1}\at{\bhat u}$, then done as $u\sigma_i = s'$, hence due to $s'\sigma=s$ we have that $u\sigma = s$.


			If $u$ occs anywhere in $C_{j}\sigmaz{i-1}$, in particular for example in $\lambda\sigmaz{i-1}\at{\bhat u}$, in a s.c.\ $\Delta$-term, then by Lemma~\ref{new_27}, $u$ occs grey in $(C_1\cup C_2)\sigmaz{i-1}$ and we are done as above.

			So suppose $u$ only occs in s.c.\ $\Gamma$-terms, in particular in $\lambda\sigmaz{i-1}\at{\bhat u}$. 
			But as $\lambda'\sigmaz{i-1}\at{\bhat u}$ has the same prefix, but it is $s'$, there is a $\Delta$-term in a $\Gamma$-term, so by the induction hypothesis $x_{s'}$ occs grey in $\AIanyde(C_j)$ for some $j$.

			As $\Gamma$-terms are not lifted in $\AIclde(C_j)$, $x_{s'}$ is not lifted there.

			As $s'$ is in the range of the unifier, $s'$ occurs in a resolved literal. 

			By the definition of $\aiu$, $\{x_{s'} \mapsto x_s\} \in \tau$
			as $s$ is the term at the position of $x_{s'}$ in $\lambda\sigma$ for $\lambda$ the resolved literal where $s'$ occurs.

			Hence there is a grey occurrence of $x_s$ in $\AIanyde(C)$.

		\item
			Suppose a variable $u$ occurs in $C_1$ or $C_2$ grey or in a maximal colored single colored $\Gamma$-colored term such that $u\sigma$ contains a multi-colored $\Gamma$-term $t$ 

			Then $\lambda'\sigmaz{i-}\at{\bhat{u}}$ actually is $t$ $\Ra$ IH.
			\qedhere

	\end{enumerate}
\end{proof}

\mytodo{ICI ICI ICI: this lemma should easily give the main result. extend to factorisation and write up nicely}

\clearpage

\section{Attempts}

\begin{clemma}
	\label{lemma:smallest_colored_container}
	Let a variable $x$ occur twice in $C$ such that in one occ, the smallest colored term containing $x$ is a $\Gamma$-term and for the other, the smallest colored term containing $x$ is a $\Delta$-term.
	Then $x$ occurs grey in $\AIany(C)$.
\end{clemma}
\begin{proof}
	\largered{missing: variables don't have to occur grey in $y\sigma$, e.g. in $\gamma\occ{y}$, $y\sigma$ might be $f(x)$ with $f$ $\Gamma$-colored.}
	~
	\begin{itemize}
		\item
			Suppose that in $C_i$, $\gamma\occ{x}$ occurs and in $C_j$, we have $\delta\occ{y}$ such that $x$ occurs grey in $y\sigma$.

			Then $y$ occurs in $l$ at $l\at{\bhat y}$ such that $l'\at{\bhat y}$ is an abstraction of a term containing a grey occurrence of $x$.

			Suppose that $l\at{\bhat y}$ (and therefore also $l\at{\bhat y}$) is not a grey occurrence as otherwise we are done. 

			As $l\sigma l'\sigma $, $l\at{\bhat y}$ and $l\at{\bhat y}$ share their prefix, so their color is the same.

			Then induction hypothesis.

		\item 
			Suppose that in $C_i$, $\gamma\occ{z}$ occurs and in $C_j$, $\delta\occ{y}$ occurs such that $x$ occurs grey in $y\sigma$ and in $z\sigma$.

			By Lemma~\ref{lemma:proof_along_mgu}, exists $y_1, \dots, y_n$ and $z_1, \dots z_m$ such that $x$ occurs grey in $y_i\sigma$ and in $z_i\sigma$ and term opposite of $y_n$ and $z_m$ actually contains $x$.


			If any $y_i$, $z_j$ occurs grey, done, so assume all occur colored.

			$z_m$ and $y_n$ opposite of actual $x$, as $x$ only in one clause, $z_m$ and $y_n$ in same clause. 
			they do share prefix with the occurrences of $x$ in the clause where $x$ is.

			if they there are contained in smallest col terms of opposite color $\Ra$ ind hyp

			otw of same smallest term color there.

			Note that every $y_i$, $z_j$ occurs at least twice: once as opposite var of the last one, once to unify with the next one.

			as originally different colors and at meeting point at $x$ same color, there has to be one alternation, where we use the ind hyp.


		\item
			Suppose that $\gamma\occ{x}$ in $C_i$ and $\delta\occ{x}$ in $z\sigma$ such that $z$ occurs grey in $C_j$.

			If $\delta\occ{x}$ occurs in $C_i$ (cannot occur in other clause), ind hyp.

			Suppose it does not occur. 
			Then however exists $\delta\occ{y}$ s.t. $x$ occurs grey in $y\sigma$ $\Ra$ other case.

		\item
			Suppose that $\gamma\occ{x}$ in $y\sigma$ such that $y$ occurs grey in $C_i$ and $\delta\occ{x}$ in $z\sigma$ such that $z$ occurs grey in $C_j$.

			If $\gamma\occ{x}$ and $\delta\occ{x}$ occur, ind hyp.

			If just one occurs, $\Ra$ other case.

			If none of them occur, then occur $\delta\occ{\alpha}$ s.t. $x$ grey in $\alpha\sigma$ and similar for $\gamma\occ{\beta}$ $\Ra$ other case.



	\end{itemize}
\end{proof}

\clearpage

\begin{clemma}
	Let $\sigma$ unifier.
	exists unification order $\sigma = \sigma_1 \dots \sigma_n$ with $\sigma_i =\nolinebreak \{ x_i \mapsto r_i \}$ s.t.\ 
	$x_i$ does not occur in $\{ r_i, r_{i+1}, \dots, r_n\}$.
\end{clemma}

\begin{proof}
	Suppose ordering does not exist, i.e.\ $l\sigma = l'\sigma$, but every $x_i$ occurs in some $r_j$ for $j\grq i$.

	But then last variable does not occur later..
\end{proof}

\begin{lemma}
	Let $\sigma$ unifier.

	At any stage in the run of the unification algo, exists var $x$ as one part of a difference pair s.t.\ $x$ does not occur in a function symbol in a difference pair.
\end{lemma}
\begin{proof}
	Suppose no such var exists. 


	{\tiny

		resolve all differences $x_i \sim r_i$ such that $r_i$ does not contain a variable in a function symbol.

		all variables, in particular the remaining $x_i$, occur in a function symbol in $r_j$ for some $j$.

		Iteratively resolve in some order: $x_i \mapsto r_i$, where every $r_i$ contains at least one variable.
		Hence as every $x_i$ occurs in some $r_j$, the variable in $r_i$ then occurs in $r_j$.

		so after a step, for the remaining difference pairs, it is still the case that every variable occurs in some $r_j$.

		We do not get an occurs check error as by assumptions, the term are unifiable.

		when we get to the point where there is only one subst left, it has to be of the form $x_i \mapsto r_i\occ{x_i}$, so we do get an occurs check error, which contradicts the assumptions that the terms are unifiable.

	}
\end{proof}

\begin{lemma}
	Let $\sigma$ unifier. 
	At any stage in the run of the unification algorithm, there exists a variable as one part of a difference pair such that the other part does not contain a variable, which also occurs as one part of a difference pair, under a function symbol.
\end{lemma}
\begin{proof}
	Suppose to the contrary, that \dots.

	Construct graph with vars as nodes and arrow from $x, y$ if exists difference pair $(x, r\occ{y})$ or the symmetric pair.

	As every variable unifies to a term containg another variable, we have that $\forall x \exists y\,E(x, y)$. Hence we can build a path of length $|V|+1$, but this contains a cycle. 

\end{proof}

{TODO ICI: does this mean that there is a variable which does not have a variable in a term at its RHS? }
(all difference pairs have a variable at some side, let's call it LHS and the other one RHS)

{possibly: do induction along this order: take subst which has no var to the right, then this one occurs in the term. next term then does not actually exists necessarily, so need to show some induction property.}


evil examples:

$P(z, z, \delta), \lnot P(f(x), f(y), y)$

$P(z, f(z), f(f(\delta))), \lnot P(f(x), y, y)$

$P(u, f(z), f(f(\delta))), \lnot P(f(x), y, y)$

\begin{figure}
	\begin{clemma}
		Suppose $\Gamma$-term $s(y)$ in original diff pairs.

		Suppose $y\sigma = x$ (simplification).

		Suppose no col change, i.e.\ no var $x$ occurs in a unified literal twice such that once in s.c.\ $\Gamma$-term and once in s.c.\ $\Delta$-term.

		Suppose no $x$ grey in $l\sigma \, ( = l'\sigma )$.

		Hence at some point have diff pair $(y, v)$ with $v\sigma = x$.

		by no col change and $s(y)$, $y$ does not occur in a s.c.\ $\Delta$-term.

		As no $x$ grey in $l\sigma$ and $y\sigma = x$, no $y$ grey.

		Hence $y$ only s.c.\ $\Gamma$-col.

		$y$ and $v$ same prefix, so $v$ s.c.\ $\Gamma$-col.

	\end{clemma}


\end{figure}

\begin{clemma}
	Let $\sigma = \mgu(l, l')$

	Suppose $\Gamma$-term $s\occ{y}$ in some unification pair, $\delta$ grey in $y\sigma$.

	Suppose no col change.

	Suppose no $\delta$ grey in $l\sigma \, ( = l'\sigma )$.

	Then exists $\Gamma$-term $h\occ{\delta'}$ in $l$ or $l'$ OR in earlier $\mgu$-operation.

\end{clemma}


~

\clearpage
\begin{clemma}
	Suppose s.c.\ $\Gamma$-term containing $\Delta$-term $\delta$ is created via unification of $l$ and $l'$.
	Then at least one of the following statements holds:
	\begin{enumerate}
		\item In $l\sigma$	(=$l'$), $\delta$ occurs grey.
		\item There is a variable $x$ in $l$ or $l'$ such that it occurs once in an s.c.\ $\Gamma$-term and once in an s.c.\ $\Delta$-term.
		\item A $\delta$-term occurs in a $\Gamma$-term in $l$ or $l'$ (\mytodo{ be more precise on which term}).
	\end{enumerate}
\end{clemma}
\begin{proof}
	We show that a term in question is created, then one of the statments holds, or a term in question has been created earlier during the run of the mgu.

	\begin{enumerate}
		\item
			Supp have $f(y)$ in some unification pair.

			Note $y$ not grey somewhere as otherwise done.

			At some stage exists diff pair $(y, t)$. note $y, t$ same prefix, hence same color.
			$t$ abstraction of $\epsilondelta$.

			\begin{itemize}
				\item supp $t$ contains outermost symbol of $\delta$. as $y, t$ same color, $t$ is multi-col term either in $l$ or $l'$, or created earlier during unification algo.
				\item otw $t$ contains var $v$ s.t.\ $v\sigma = \delta$ or $v\sigma = \epsilondelta$.

					Supp. $v$ occurs grey in $l$ or $l'$. then done. 

					Note during unification procedure, coloring does not disappear, hence assume now all $v$ colored.

					\hl{[ hole: col change ]}

					hence can assume all occs of $v$ are s.c.\ $\Gamma$-col.

					so have like $f(v)$, with $v\sigma = \delta$ or $v\sigma = \epsilondelta$.
					the corresponding diff pair is resolved earlier or later.

					possible argument: finitely often anyway? 

					possible argument: after finitely many variable renamings, we hit an actual term, which then is strictly smaller, hence terminates?

			\end{itemize}

		\item var substituted for multi-colored term .
	\end{enumerate}

\end{proof}

\clearpage
\begin{clemma}
	Let $\sigma = \mgu(l, l')$.
	Let $\gamma\occ{\delta}$ be a $\Gamma$-term containing a $\Delta$-term $\delta$ in $l\sigma$.
	Then one of the following statments holds:
	\begin{enumerate}
		\item $\delta$ occurs at a grey position in $l\sigma$ \mytodo{argue about occurring $l\sigma$}.
		\item col change (where?)
		\item in $l$ or $l'$, $\delta$ occurs in a $\Gamma$-term.
	\end{enumerate}
\end{clemma}
\begin{proof}
	Let $\sigma = \sigma_1 \cdots \sigma_n$, where $\sigma_i$ stems from the $i$th substitution applied by the unification algo.

	Let $l_j = l\sigma_1 \cdots \sigma_j$

	Let $\sigma_i$ be unifier $x \mapsto \delta$.

	Suppose $l_i $ contains a $\Delta$-term in a $\Gamma$-term, where the respective predecessor of the $\Gamma$-term does not have a $\Delta$-term at that position or does not exist in $l_{i-1}$.

	\begin{enumerate}
		\item
			Suppose a $\Gamma$-term $t\occ{y}$ exists in $l_{i-1}$, such that it contains a grey occ of a variable $y$ such that $y\sigma_i = \epsilondelta$  (where $\varepsilon$ may be ``empty'' or else some grey term).
			The corresponding difference pair is $(y, \epsilondelta)$, say at position $\bhat y$

			So $y$ occurs at say $\bhat y$ in $l$ or $l'$, say $\lambda$. ($y$ may occur in both, variable-disjointness might have already been broken).

			If it is a grey occurrence, we are done as $\delta$ occurs grey in $y\sigma$. 

			So assume $y$ occurs colored.

			$\lambda'_{i-1}\at{\bhat y} = \epsilondelta$.
			Note that $\lambda_{i-1}\at{\bhat y}$ and $\lambda'_{i-1}\at{\bhat y}$ agree on the prefix (by virtue of being a difference pair).

			\begin{itemize}
				\item
					Suppose $\lambda_{i-1}\at{\bhat y}$ occurs in an s.c.\ $\Gamma$-term.
					Then $\lambda'_{i-1}\at{\bhat y}$ is $\delta$ in a $\Gamma$-term in $l$ or $l'$ $\Ra$~IH.

				\item
					Suppose $\lambda_{i-1}\at{\bhat y}$ occurs in an s.c.\ $\Delta$-term.
					Then as $y$ occurs in $t$ in a $\Gamma$-term, we have a col change (but possibly distributed over $l$/$l'$).
					\mytodo{ lemma for col change }
			\end{itemize}

			, say
		\item
			Suppose $y$ at $\bhat y$ in $\lambda_{i-1}$ s.t.\ $y\sigma_i$ is a $\Gamma$-term containing a $\Delta$-term.

			Then $\lambda'_{i-1}\at{\bhat y}$ actually is that term $\Ra$ IH. 
	\end{enumerate}
\end{proof}

\begin{clemma}
	Let $\sigma = \mgu(l, l')$ such that in $l$ and $l'$, there are grey occs for col changes.
	Let $\gamma\occ{x}$ be a s.c.\ $\Gamma$-term containing a variable $x$ and $\delta\occ{x}$ be a s.c.\ $\Delta$-term containing the same variable $x$.
	Then $x$ occurs at a grey position.
\end{clemma}
\begin{proof}
	probably revisit later when pre-lemmas are done

\end{proof}

~

~



\section{Structure (cases) of relevant unifications} 

\begin{lemma}
	For a difference pair or a not necessarily prefix-disjoint ``unification pair'' $(s, t)$, $s$ and $t$ are both of same maximal and minimal color.
\end{lemma}

Supp $f(x)$ occurs somewhere (original diff pairs or somewhere during run of algo) and $x\sigma =\nolinebreak \varepsilon\occ{\delta}$.



\subsection{fst}

Then $f(x) \sim t$, s.t.\ $t\sigma = f(\varepsilon\occ{\delta})$.

(Suppose no col change.)

\begin{enumerate}
	\item Supp $t = f(\varepsilon\occ{\delta})$. \checkmark
	\item Supp $t = f(y)$.
		$y\sigma = \varepsilon\occ{\delta}$.
		Then IH (for some IH\dots).
	\item Supp $t = f_{1/2}(y)$.
		$y\sigma = f_{1/2}(\varepsilon\occ{\delta})$.
	\item Supp $t = y$.
		$y\sigma = f(\varepsilon\occ{\delta})$.
	\item ? Supp $h(t) = y$.
\end{enumerate}

\subsection{snd}

Then actually $x \sim t$, s.t.\ $t$ possibly non-proper abstraction of $\varepsilon\occ{\delta}$.

\begin{enumerate}
	\item Supp $t = \varepsilon\occ{\delta}$. \checkmark
	\item Supp $t = y$.
		$y\sigma = \varepsilon\occ{\delta}$.
\end{enumerate}

\subsection{random notes}

suppose $z\sim f(x)$.
then $x$ is only changed if $z$ is unified with something with an $f$-prefix.



\largeblue{ look at terms where partial unification applies. the final state is just an extremely advanced applied partial unification. }

\end{document}
