\documentclass[,%fontsize=11pt,%
	paper=a4,% 
	%landscape,
	DIV11, % mehr text pro seite als defaultyyp
	%DIV10, 
	%DIV=calc,%
	twoside=false,%
	liststotoc,
	bibtotoc,
	draft=false,% final|draft % draft ist platzsparender (kein code, bilder..)
	%titlepage,
	numbers=noendperiod
]{scrartcl}

\usepackage{lscape}
\usepackage{stackengine}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}

\usepackage{enumerate}
\usepackage{paralist}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,backgrounds,graphs,%
	matrix,patterns,arrows,decorations.pathmorphing,decorations.pathreplacing,%
	positioning,fit,calc,decorations.text,shadows%
}


\input{../latex_header.tex}

% sections also in toc
\setcounter{tocdepth}{2}

\definethms

% for color-highlighted code
%\usepackage{color} % for grey comments
%\usepackage{alltt}

%\usepackage[doublespacing]{setspace}
\usepackage[onehalfspacing]{setspace}
%\usepackage[singlespacing]{setspace}
\usepackage{tabularx}
\usepackage{hyperref}
\usepackage{comment}
\usepackage{color}
\usepackage[final]{listings} % sourcecode in document
\usepackage{url}      % for urls
\usepackage{multicol}
\usepackage{float}
\usepackage{caption}
\usepackage{subfigure}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{graphicx}

\usepackage[authoryear]{natbib} % \cite ; square|round etc.
%\usepackage[numbers,square]{natbib}
%\usepackage[square, authoryear]{natbib}
%\usepackage[language=english]{biblatex}

%\bibliographystyle{plain}
\bibliographystyle{alpha}
%\bibliographystyle{alphadin}
%\bibliographystyle{dinat}
%\bibliographystyle{chicago}
%\bibliographystyle{plainnat}

\bibdata{bib.bib}

\renewcommand*{\partformat}{\partname\ \thepart\ -}
\let\partheadmidvskip\

\newcommand{\comp}{\ensuremath{\text{comp}}}
% smaller url style
\makeatletter
\def\url@leostyle{%
\@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\small\ttfamily}}}
\makeatother
\urlstyle{leo}

\newcommand{\myfig}[5] {
	\begin{figure}[tbph]
		\centering
		\includegraphics[#3]{#1}
		\caption[#4]{#5}
		\label{fig:#2}
	\end{figure}
}

\setlength{\parindent}{0em}
%\usepackage{thmtools} % actually already in latex_header.tex ...

\usepackage{amsthm}


\usepackage{tikz-qtree}

%\newcommand{\sig}[1]{{#1}_\Sigma}
%\newcommand{\p}[1]{{#1}_\Pi}
\newcommand{\sig}[1]{\stackrel{\Sigma}{#1}}
\newcommand{\p}[1]{\stackrel{\Pi}{#1}}

\newcommand{\e}[1]{\vskip .7em   \section*{#1}}

%\def\proofSkipAmount{ \vskip -0.3em}

\usepackage{refcheck}

\newcommand{\lif}[1]{\lift{\Delta}{#1}{x}}
\newcommand{\newterm}{^*}
\newcommand{\de}{^\Delta}

\begin{document}
\begin{clemma}
	\label{lemma:smallest_colored_container}
	Let a variable $x$ occur twice in $C$ such that in one occ, the smallest colored term containing $x$ is a $\Gamma$-term and for the other, the smallest colored term containing $x$ is a $\Delta$-term.
	Then $x$ occurs grey in $\AIany(C)$.
\end{clemma}
\begin{proof}
	\largered{missing: variables don't have to occur grey in $y\sigma$, e.g. in $\gamma\occ{y}$, $y\sigma$ might be $f(x)$ with $f$ $\Gamma$-colored.}
	~
	\begin{itemize}
		\item
			Suppose that in $C_i$, $\gamma\occ{x}$ occurs and in $C_j$, we have $\delta\occ{y}$ such that $x$ occurs grey in $y\sigma$.

			Then $y$ occurs in $l$ at $l\at{\bhat y}$ such that $l'\at{\bhat y}$ is an abstraction of a term containing a grey occurrence of $x$.

			Suppose that $l\at{\bhat y}$ (and therefore also $l\at{\bhat y}$) is not a grey occurrence as otherwise we are done. 

			As $l\sigma l'\sigma $, $l\at{\bhat y}$ and $l\at{\bhat y}$ share their prefix, so their color is the same.

			Then induction hypothesis.

		\item 
			Suppose that in $C_i$, $\gamma\occ{z}$ occurs and in $C_j$, $\delta\occ{y}$ occurs such that $x$ occurs grey in $y\sigma$ and in $z\sigma$.

			By Lemma~\ref{lemma:proof_along_mgu}, exists $y_1, \dots, y_n$ and $z_1, \dots z_m$ such that $x$ occurs grey in $y_i\sigma$ and in $z_i\sigma$ and term opposite of $y_n$ and $z_m$ actually contains $x$.


			If any $y_i$, $z_j$ occurs grey, done, so assume all occur colored.

			$z_m$ and $y_n$ opposite of actual $x$, as $x$ only in one clause, $z_m$ and $y_n$ in same clause. 
			they do share prefix with the occurrences of $x$ in the clause where $x$ is.

			if they there are contained in smallest col terms of opposite color $\Ra$ ind hyp

			otw of same smallest term color there.

			Note that every $y_i$, $z_j$ occurs at least twice: once as opposite var of the last one, once to unify with the next one.

			as originally different colors and at meeting point at $x$ same color, there has to be one alternation, where we use the ind hyp.


		\item
			Suppose that $\gamma\occ{x}$ in $C_i$ and $\delta\occ{x}$ in $z\sigma$ such that $z$ occurs grey in $C_j$.

			If $\delta\occ{x}$ occurs in $C_i$ (cannot occur in other clause), ind hyp.

			Suppose it does not occur. 
			Then however exists $\delta\occ{y}$ s.t. $x$ occurs grey in $y\sigma$ $\Ra$ other case.

		\item
			Suppose that $\gamma\occ{x}$ in $y\sigma$ such that $y$ occurs grey in $C_i$ and $\delta\occ{x}$ in $z\sigma$ such that $z$ occurs grey in $C_j$.

			If $\gamma\occ{x}$ and $\delta\occ{x}$ occur, ind hyp.

			If just one occurs, $\Ra$ other case.

			If none of them occur, then occur $\delta\occ{\alpha}$ s.t. $x$ grey in $\alpha\sigma$ and similar for $\gamma\occ{\beta}$ $\Ra$ other case.



	\end{itemize}
\end{proof}

\clearpage

\begin{clemma}
	Let $\sigma$ unifier.
	exists unification order $\sigma = \sigma_1 \dots \sigma_n$ with $\sigma_i =\nolinebreak \{ x_i \mapsto r_i \}$ s.t.\ 
	$x_i$ does not occur in $\{ r_i, r_{i+1}, \dots, r_n\}$.
\end{clemma}

\begin{proof}
	Suppose ordering does not exist, i.e.\ $l\sigma = l'\sigma$, but every $x_i$ occurs in some $r_j$ for $j\grq i$.

	But then last variable does not occur later..
\end{proof}

\begin{lemma}
	Let $\sigma$ unifier.

	At any stage in the run of the unification algo, exists var $x$ s.t. $x$ does not occur in a function symbol in a difference pair.
\end{lemma}
\begin{proof}
	Suppose no such var exists. 

	resolve all differences $x_i \sim r_i$ such that $r_i$ does not contain a variable in a function symbol.

	all variables, in particular the remaining $x_i$, occur in a function symbol in $r_j$ for some $j$.

	Iteratively resolve in some order: $x_i \mapsto r_i$, where every $r_i$ contains at least one variable.
	Hence as every $x_i$ occurs in some $r_j$, the variable in $r_i$ then occurs in $r_j$.
	
	so after a step, for the remaining difference pairs, it is still the case that every variable occurs in some $r_j$.

	We do not get an occurs check error as by assumptions, the term are unifiable.

	when we get to the point where there is only one subst left, it has to be of the form $x_i \mapsto r_i\occ{x_i}$, so we do get an occurs check error, which contradicts the assumptions that the terms are unifiable.
\end{proof}

\largered{TODO ICI: does this mean that there is a variable which does not have a variable at its RHS? }
(all difference pairs have a variable at some side, let's call it LHR and the other one RHS)

\largered{possibly: do induction along this order: take subst which has no var to the right, then this one occurs in the term. next term then does not actually exists necessarily, so need to show some induction property.}


evil examples:

$P(z, z, \delta), \lnot P(f(x), f(y), y)$

$P(z, f(z), f(f(\delta))), \lnot P(f(x), y, y)$


\end{document}
