\chapter{Interpolant extraction from resolution proofs in two phases}
\label{sec:two_phases}

In \cite{Huang95}, Huang proposes an algorithm for computing interpolants of two sets of first-order formulas $\Gamma$ and $\Delta$, where $\Gamma\cup\Delta$ is unsatisfiable, by traversing a resolution refutation of $\Gamma \cup \Delta$.
We present his proof in a modified form in this section and in a more original form in appendix~\ref{sec:huang}.
The central difference lies in the treatment of the interplay of substitutions and liftings. While in \cite{Huang95}, propositional deductions are employed where only trivial substitutions occur, we provide a method which allows for commuting substitutions and liftings under certain conditions.

\section{Layout of the proof}

The underlying algorithm produces in the first phase propositional interpolants inductively for every clause which occurs in the resolution refutation.
These interpolants are propositional in the sense that they only obey the language restriction on predicates and may contain colored terms.
The propositional interpolant assigned to the last clause, the empty clause, is a propositional interpolant for the initial clause sets.

The second phase of the algorithm addresses the colored terms still contained in the propositional interpolant.
These are eliminated (lifted) by replacing them with bound variables whose quantifiers are subject to a certain ordering.



\section{Extraction of propositional interpolants}

We define a procedure $\PI$, which produces propositional interpolants from resolution refutations and is based on the ``Interpolation algorithm'' in \cite{Huang95}.
It is structured in the two subprocedures $\PIinit$ and $\PIstep$:

\begin{defi}[$\PIinit$]
	For clauses $C \in \Gamma\cup\Delta$, we define $\PIinit(C)$ as follows:

	If $C \in \Gamma$, $\PI(C) \defeq \bot$.
	If otherwise $C \in \Delta$, $\PI(C) \defeq \top$.
\end{defi}

\begin{defi}[$\PIstep$]
	Let $\inference$ be an inference of a resolution refutation of $\Gamma\cup\Delta$ which derives $C$ from from formulas $\bar C = C_1, \dots, C_n$ where $n=1$  if $\inference$ is a factorisation inference or $n=2$. 
	Let $\bar I = I_1, \dots, I_n$ be formulas.

	Then $\PIstep(\inference, \bar I)$ is defined according to the following cases:

	\begin{itemize}
		\item[Resolution.]
			\label{def:PI_resolution}

			If $\inference$ is a resolution inference of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$, then $\PIstep(\inference, I_1, I_2)$ is defined as follows:
			%$\PI(C)$ is defined according to this case distinction:
			\begin{enumerate}
				\item If $l$ is $\Gamma$-colored: $\PIstep(\inference, I_1, I_2) \defeq{} [I_1 \lor I_2]\sigma$
				\item If $l$ is $\Delta$-colored: $\PIstep(\inference, I_1, I_2) \defeq{} [I_1 \land I_2]\sigma$
				\item If $l$ is grey: $\PIstep(\inference, I_1, I_2) \defeq{} [(l \land I_2) \lor (\lnot l' \land I_1) ]\sigma $
			\end{enumerate}

		\item[Factorisation.]
			If $\inference$ is a factorisation inference of $C_1: l \lor l' \lor D$ with $\sigma = \mgu(\inference)$,
			then $\PIstep(\inference, I_1) \defeq I_1\sigma$.

		\item[Paramodulation.]
			\label{def:PI_paramod}
			Suppose that $\inference$ is a paramodulation inference of $C_1: s=t \lor D$ and $C_2: E\occur{r}$ 
			with $\sigma = \mgu(\inference)$ such that $s\sigma = r\sigma$.
			Let $h\occur{r}$ be the maximal colored term in which $r$ occurs in $E\occur{r}$.
			Then $\PIstep(\inference, I_1, I_2)$ is defined according to the following case distinction:

			\begin{enumerate}
				\item If $h\occur{r}$ is $\Delta$-colored and $h\occur{r}$ occurs more than once in $(I_2 \lor E\occur{r})\sigma$:
					\label{def:PI_paramod_1}
					\newline
					$\PIstep(\inference, I_1, I_2) \defeq{} [ ( s=t \land I_2 ) \lor (s\neq t \land I_1) ]\sigma \lor (s=t \land h\occur{s} \neq      h\occur{t})\sigma$
				\item If $h\occur{r}$ is $\Gamma$-colored and $h\occur{r}$ occurs more than once in $(I_2 \lor E\occur{r})\sigma$:
					\label{def:PI_paramod_2}
					\newline
					$\PIstep(\inference, I_1, I_2) \defeq{} [ ( s=t \land I_2 ) \lor (s\neq t \land I_1) ]\sigma \land (s\neq t \lor h\occur{s} =     h\occur{t})\sigma$
				\item If $r$ does not occur in a colored term in $E\occur{r}$ which occurs more than once in\nolinebreak{} $(I_2 \lor E\occur{r})\sigma$:
					\label{def:PI_paramod_3}
					\newline
					$\PIstep(\inference, I_1, I_2) \defeq{} [ ( s=t \land I_2 ) \lor (s\neq t \land I_1) ]\sigma$ \qedhere

			\end{enumerate}

	\end{itemize}


\end{defi}



\begin{defi}[Propositional interpolant $\PI$]
	\label{def:PI}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$.
	\defiemph{${\PI(\pi)}$} is defined to be $\PI(\square)$, where $\square$ is the empty clause derived in $\pi$.

	For a clause $C$ in $\pi$, \defiemph{$\PI(C)$} is defined as follows:
	\begin{itemize}
		\item[Base case.]
			If $C \in \Gamma\cup\Delta$, then $\PI(C) \defeq \PIinit(C)$.
		\item[Induction step.]
			If $C$ is the result of an inference $\inference$ using the clauses $\bar C$, then $\PI(C) \defeq \PIstep(\inference, \PI(C_1), \dots, \PI(C_n))$.


	\end{itemize}
\end{defi}

\begin{remark}
	The control flow of the procedure $\PI$ is mainly determined by the coloring of literals.
	In this context, two distinct but similar interpretation of the notion of color are viable: 
	On the one hand, one can employ the usual, symbol-based interpretation as given in Definition~\ref{def:coloring}, where a (predicate) symbol is considered grey if there are any formulas in $\Gamma$ as well as $\Delta$ which contain the symbol. 
	Note that this does not necessarily capture the logical function of the symbol, as the symbol then is allowed to occur in the interpolant if in the resolution refutation, only formulas from say $\Gamma$ contain the symbol.
	It is obvious that one can then also find an interpolant which does not contain the symbol by computing an interpolant for $\Gamma'$ and $\Delta$, where $\Gamma'$ is derived from $\Gamma$ by omitting any formula containing the symbol. 
	Clearly the refutation of $\Gamma \cup \Delta$ is also a refutation of $\Gamma' \cup \Delta$.

	However in \cite{Huang95}, a stricter notion is utilised.
	Here, a predicate symbol is colored based on its occurrence:
	All occurrences of predicate symbols in formulas in $\Gamma$ ($\Delta$) are considered to be $\Gamma$-($\Delta$)-colored.
	A predicate symbol occurring in the resolution derivation is $\Phi$-colored if its corresponding predecessor is.
	Factorisation inferences may create grey literals if the factorised literals are respectively $\Gamma$- and $\Delta$-colored.

	The definition above can be understood in this sense by reading conditions on the coloring of a resolved or factorised literals $l$ as being true if they apply to \emph{both} resolved or factorised literals $l$ and $l'$.
\end{remark}


\section{Lifting of colored symbols}
\label{sec:lifting}
As $\PI$ only fixes the propositional structure of the interpolant but still contains colored symbol, 
we define a procedure which replaces colored terms by variables, which eventually will become bound by appropriate quantifiers.
This replacement is referred to as lifting:


\begin{defi}[Lifting]
	Let $\varphi$ a formula or a term and $Z=\{\colterm{1}, \dotsc, \colterm{n}\}$ the maximal $\Phi$-colored terms in $\varphi$.

	Let furthermore $z_{\expa(\colterm{1})}, \ldots, z_{\expa(\colterm{n})}$ be fresh variables, referred to as \defiemph{$\Phi$-lifting variables} or \defiemph{lifting variables} if the coloring is clear from the context.
	The function $\expa$ replaces lifting variables occurring in colored terms by the term they lift in order to avoid lifting variables in the index of other lifting variables and is defined as follows:  
	\[\expa(t) \defeq \begin{cases}
			f(\expa(t_1),\dots, \expa(t_m)) & \text{if $t=f(t_1, \dots, t_m)$} \\
			t & \text{if $t$ is a non-lifting variable $x$} \\
			\expa(s) & \text{if $t$ is a lifting variable $z_s$}
	\end{cases}\]

	The lifting of $\varphi$, denoted by $\lifphi{\varphi}$, is an abbreviation of 
	$\lifphi{\varphi, Z}$ which is defined as follows:
	\[
		\lifphi{\varphi, Z} \defeq
		\begin{cases}
			\varphi & Z = \emptyset \\
			%\lifphi{\varphi\abstractionOp{\colterm{i}/z_{\colterm{i}}}, Z\setminus\{\colterm{i}\}} & \parbox[t]{0.4\linewidth}{$\colterm{i} \in Z$ such that $\colterm{i}$ is not subterm of another term in $Z$} \\
			\lifphi{\psi, Z\setminus\{\colterm{i}\}} & \parbox[t]{0.6\linewidth}{$\colterm{i} \in Z$ such that $\colterm{i}$ is not subterm of another term in $Z$, $\psi$ is created from $\varphi$ by replacing every occcurrence of $\colterm{i}$ by $z_{\colterm{i}}$} 
		\end{cases}
	\]
	To simplify the syntax, we sometimes write $\lifphinovar{\varphi}$ or $\lifboth{\varphi}$ if the lifting variables or the lifting variables and the color of the terms to lift respectively is clear from the context or not of the essence.
	%	We denote $\varphi$ lifted of both $\Gamma$- and $\Delta$-terms by $\lifboth{\varphi}$ if the variables replacing the colored terms are clear from the context or are not crucial.
\end{defi}

We usually lift $\Delta$-terms by variables with the letter $x$ and $\Gamma$-terms with the letter $y$. If the lifting is not specific to a color, we use variables with the letter $z$.


Some elementary properties of liftings are described by the following lemmas:


\begin{lemma}[Commutativity of lifting and logical operators]
	\label{lemma:lift_logic_commute}
	Let $A$ and $B$ be first-order formulas and $s$ and $t$ be terms. Then it holds that:
	\begin{enumerate}
		\item $\lift{\Phi}{\lnot A}{z} \spas\semiff{} \lnot \lift{\Phi}{A}{z}$
		\item $\lift{\Phi}{A \circ B}{z} \spas\semiff{} ( \lift{\Phi}{A}{z} \circ \lift{\Phi}{B}{z} )$ for  $\circ \in \{\land, \lor\}$
		\item $\lift{\Phi}{s = t}{z} \spas\semiff{} ( \lift{\Phi}{s}{z} = \lift{\Phi}{t}{z} )$
	\end{enumerate}
\end{lemma}


For the proof, we also require a means for commuting substitutions and liftings.
This however can not be achieved in a direct manner. The following examples illustrate
that in general for a term $t$, it is not the case that
$
\lifphi{t\sigma} =
\lifphi{t}\sigma 
$.

In the following, we assume that substitutions unless explicitly defined otherwise do not affect lifting variables.
This is justified as all substitutions which occur in resolution refutations have this property.

\begin{exa}
	\label{exa:lifting_commute}
	~
	\begin{enumerate}
		\item
			\label{exa:lifting_commute_1}
			Let $t = f(x)$ be a $\Phi$-term and $\sigma = \{x \mapsto a\}$.
			Then $\lifphi{t\sigma} = \lifphi{f(x)\sigma} = \lifphi{f(a)} = z_{f(a)}$.
			However $\lifphi{t}\sigma = \lifphi{f(x)}\sigma = z_{f(x)}\sigma = z_{f(x)}$.

			This suggests that substitutions also have to lifted terms.

		\item
			\label{exa:lifting_commute_2}
			Let $s=x$ be a variable and $\sigma = \{x\mapsto c\}$, where $c$ is a $\Phi$-term.
			Then $\lifphi{s\sigma} = 
			\lifphi{x\sigma} =
			\lifphi{c} = z_c$.
			But 
			$\lifphi{s}\sigma = 
			\lifphi{x}\sigma = 
			x\sigma = 
			c$.

			In this case, we see that terms in $\ran(\sigma)$ have to be lifted when the substitution is pulled out of the lifting.

		\item
			\label{exa:lifting_commute_3}
			Let $r = \lifphi{f(x)} = z_{f(x)}$.
			Then $\lifphi{r\sigma} = \lifphi{z_{f(x)}\sigma} = \lifphi{z_{f(x)}} = z_{f(x)}$.
			Here however, $\lifphi{r}\sigma = \lifphi{z_{f(x)}}\sigma = z_{f(x)}\sigma = z_{f(x)}$.
			This shows that obviously, as lifting variables are affected neither by substitutions nor liftings, arbitrary commutations of these can be performed. 
			Note however that in case~\ref{exa:lifting_commute_1}, lifting variables have to be modified.
			\qedhere
	\end{enumerate}
\end{exa}

As a first step towards a solution, we define a substitution which acts as a tool to ensure that modifications to terms are also applied to lifting variables.
This is vital for Item~\ref{exa:lifting_commute_1} of Example~\ref{exa:lifting_commute}.

\begin{defi}[$\tau$]
	For a substitution $\sigma$ we define the infinite substitution $\tau(\sigma)$ with $\dom(\tau(\sigma)) = \dom(\sigma) \cup \{z_s \mid s\sigma \neq s\}$ as follows for a variable $x$:

	\[
		x\tau(\sigma) =
		\begin{cases}
			x\sigma & \text{$x$ is a non-lifting variable} \\
			z_{t\sigma} & \text{$x$ is a lifting variable $z_t$}
		\end{cases} 
	\]
	%\qedhere

	If the substitution $\sigma$ is clear from the context, we abbreviate $\tau(\sigma)$ by $\tau$. 
	For inferences $\inference$, we define $\tau(\inference)$ to be $\tau(\mgu(\inference))$.
\end{defi}

\addtocounter{exa}{-2}
\begin{exa}[continued]
	Using $\tau$, we can solve the first example as $\lifphi{t\tau} = \lifphi{t\sigma} = \lifphi{f(x)\sigma} = \lifphi{f(a)} = z_{f(a)} = z_{f(x)\sigma} = z_{f(x)} \tau = \lifphi{f(x)}\tau = \lifphi{t}\tau$.
	However the second example can not be dealt with analogously.
\end{exa}
\addtocounter{exa}{1}

Now we realise the idea motivated by Item~\ref{exa:lifting_commute_2} of Example~\ref{exa:lifting_commute} and lift all terms.
It turns out that in this formulation, commutation can be done in general:


%\begin{exa}
%	\mytodo{ write in style of examples above; in examples above: write which symbols are of which color }
%
%	Let $\sigma = \{x \mapsto a\}$
%	and consider the terms $f(x)$ and $f(a)$, where $f$ and $a$ are colored symbols.
%	Clearly $f(x)\sigma = f(a)$ and therefore necessarily $z_{f(x)}\tau = z_{f(a)}$.
%
%	But now consider $z_{f(x)} \sigma$.
%	As $z_{f(x)}$ is a lifting variable, $z_{f(x)} \not\in \dom(\sigma)$ as $\sigma$ is a unifier from a resolution derivation inference.
%	Hence $z_{f(x)}\sigma = z_{f(x)}$ and therefore $\lifboth{z_{f(x)}\sigma} = \lifboth{z_{f(x)}} = z_{f(x)}$, but $\lifboth{z_{f(x)}}\tau = z_{f(x)}\tau = z_{f(a)}$.
%	So $\lifboth{z_{f(x)}\sigma} \neq \lifboth{z_{f(x)}}\tau$.
%\end{exa}
\begin{lemma}
	\label{lemma:lifting_tau_commute}
	For a formula or term $\varphi$ and a substitution $\sigma$ such that $\tau = \tau(\sigma)$,
	$\lifboth{\lifboth{ \varphi} \tau} =\nolinebreak \lifboth{ \varphi \tau } $.
\end{lemma}
\begin{proof}
	We proceed by induction.

	\begin{itemize}
		\item Suppose that $t$ is a grey constant or function symbol of the form $f(t_1, \dots, t_n)$.
			Then we can derive the following, where (IH) signifies a deduction by virtue of the induction hypothesis. 
			\begin{align*}
				\lifboth{\lifboth{t}\tau} &= \lifboth{\lifboth{ f(t_1, \dots, t_n)}\tau} \\
																													&= \lifboth{ f(\lifboth{t_1}\tau, \dots, \lifboth{t_n}\tau) } \\
																											&= f(\lifboth{\lifboth{t_1}\tau}, \dots, \lifboth{\lifboth{t_n}\tau}) \\
																									&\stackrel{\mathclap{\text{(IH)}}}= f(\lifboth{t_1\tau}, \dots, \lifboth{t_n\tau}) \\
																							&= \lifboth{f(t_1, \dots, t_n)\tau} \\
																					 &= \lifboth{t\tau}
			\end{align*}
		\item Suppose that $t$ is a colored constant or function symbol. Then:
			\[
				\lifboth{\lifboth{t}\tau}= \lifboth{z_t\tau} 
				= \lifboth{z_{t\sigma}} 
				= z_{t\sigma} 
				= \lifboth{t\sigma} 
				= \lifboth{t\tau}
			\]
		\item Suppose that $t$ is a variable $x$. Then:
			\[
				\lifboth{\lifboth{t}\tau} = \lifboth{\lifboth{ x}\tau} = \lifboth{x\tau} = \lifboth{t\tau}
			\]
		\item Suppose that $t$ is a lifting variable $z_t$. Then:
			\[
				\lifboth{\lifboth{z_t}\tau} = \lifboth{z_t\tau} 
				\qedhere
			\]
	\end{itemize}

\end{proof}

The formulation of this Lemma can however be improved.
First, note that the outer lifting of the expression $\lifboth{\lifboth{\varphi}\tau}$ is only applied to terms introduced by $\tau$, which motivates the following definition:

\begin{defi}[$\tauell$]
	For a substitution $\sigma$, we define the infinite substitution $\tauellphi(\sigma)$ on variables $x$ as follows: 
	$x\tauellphi(\sigma) \spas\defeq \lifphinovar{x\tau(\sigma)}$.

	If $\sigma$ is clear from the context, we just write $\tauellphi$.
\end{defi}



\begin{lemma}
	\label{lemma:lifting_tau_commute_2}
	For a formula or term $\varphi$,
	$\lifboth{\varphi}\tauell = \lifboth{\varphi\tau}$.
\end{lemma}
\begin{proof}~
	Immediate by Lemma~\ref{lemma:lifting_tau_commute} and the definition of $\tauell$.
\end{proof}

Second, if we can exclude the case of lifting variables, we can apply $\sigma$ as desired:
\begin{lemma}
	\label{lemma:lifting_subst_commute}
	For a formula or term $\psi$ and a substitution $\sigma$, such that no lifting variable occurs in $\psi$ or $\sigma$,
	$\lifboth{\psi}\tauell = \lifboth{\psi\sigma}$.
\end{lemma}
\begin{proof}
	Immediate by \ref{lemma:lifting_tau_commute_2} and the definition of $\tau$.
\end{proof}

Note that if the formula or term contains lifting variables,
it is not possible to perform the commutation with $\sigma$ as in Lemma~\ref{lemma:lifting_subst_commute}.
As illustrated in Item~\ref{exa:lifting_commute_3} of Example~\ref{exa:lifting_commute}, in these cases, $\tauell$ would have to leave lifting variables unchanged, which contradicts other use cases.
However in the context of interpolant extraction, one can deal with interpolants containing free occurrences of lifting variables by just employing $\tau$ in their construction instead of $\sigma$.




\begin{comment}
	\begin{lemma}
		Let $s$ and $t$ be terms such that no $x_i$ occurs in them, $\Phi$ a set of formulas and $M$ a model.
		Then $M\entails \lft{\Phi}{x}{s} = \lft{\Phi}{x}{t}$ implies that $M\entails s=t$.
		\label{lemma:lift_equality}
	\end{lemma}
	\begin{proof}
		Suppose no $\Delta$-term occurs in $s$ or $t$. Then $\lft{\Phi}{x}{s} = s$ 
		and $\lft{\Phi}{x}{t} = t$.

		Otherwise let $t_i$ be a maximal $\Delta$-term in $s$. Suppose it occurs at position $p$. In $\lft{\Phi}{x}{s}$, it is replaced by $x_i$.
		But as $M \entails \lft{\Phi}{x}{s} = \lft{\Phi}{x}{t}$, two situations can arise:
		\begin{compactenum}
		\item $x_i$ occurs at $p$ in $\lft{\Phi}{x}{t}$.
			As $x_i$ does not occur in $t$, it is placed there by the lifting.
			But $x_i$ is only employed in order to replace $t_i$, so at position $p$ in $t$, we have $t_i$.
		\item A term $r$ occurs at $p$ in $\lft{\Phi}{x}{t}$ which does not influence the evaluation of $\lft{\Phi}{x}{t}$ in $M$. This can be the case if $r$ is contained in a subterm of $u$ and in $M$, the function symbol of $u$ is interpreted such that it does not depend on the argument that contains $r$.

			But as the maximal $\Delta$-term $t_i$ occurs in $s$ at $p$ and $M \entails \lft{\Phi}{x}{s} = \lft{\Phi}{x}{t}$, there is a function symbol $u'$ in $\lft{\Phi}{x}{s}$ corresponding to $u$ which also does not depend on this argument.

			Hence even though $s$ and $t$ are not syntactically equal, $M\entails s=t$ in this case. \qedhere
		\end{compactenum}

	\end{proof}
\end{comment}


Another lemma required for the proof is the following:


\begin{lemma}
	\label{aga5tg5ba}
	Let $M$ be a model, $E$ a formula and $s$ and $t$ terms such that
	$M \entails \lifdelta{s} = \lifdelta{t}$.
	Let $h\occur{t}$ be a maximal $\Delta$-colored term containing $t$ at $p$ in $E\occurat{t}{p}$, if such a term exists. Then it holds that:
	\begin{itemize}
		\item If $h\occur{t}$ does not exists, then
			$M\entails \lifdelta{E\occurat{s}{p}} \semiff M \entails \lifdelta{E\occurat{t}{p}}$.
		\item Otherwise
			$M\entails \lifdelta{E\occurat{s}{p}} \semiff M \entails \lifdelta{E\occurat{t}{p}}$
			or $M\entails \lifdelta{h\occur{s}} \neq \lifdelta{h\occur{t}}$ holds.
	\end{itemize}
\end{lemma}
\begin{proof} 
	Suppose that the position $p$ in $E\occurat{s}{p}$ is not contained in a $\Delta$-colored term.
	Then $\lifdelta{E\occurat{t}{p}}$ and $\lifdelta{E\occurat{s}{p}}$ only differ at position $p$,
	where for the first, $\lifdelta{t}$ is at $p$, and for the latter, $\lifdelta{s}$ is at $p$.
	But in $M$, they are interpreted the same way, hence $M\entails\nolinebreak \lifdelta{E\occurat{s}{p}} \spas\semiff M \entails \lifdelta{E\occurat{t}{p}}$.

	Otherwise the position $p$ in $E\occurat{t}{p}$ is contained in the maximal $\Delta$-colored term $h\occur{t}$.
	Suppose that $M\entails \lifdelta{h\occur{s}}  = \lifdelta{h\occur{t}}$ as otherwise we would be done.
	But then $M \entails\nolinebreak \lifdelta{E\occurat{s}{p}} \semiff{} M\entails \lifdelta{E\occurat{t}{p}}$.
\end{proof} 


\section{Main lemma}
\label{sec:two_phase_main_lemma}

By lifting the propositional interpolant, we are able to already obtain a formula partially fulfilling the requirements for interpolants.
The proof is separated into parts dealing with $\PIinit$ and $\PIstep$ respectively to be later combined to a result for $\PI$.

\mytodo{ do both proofs and combine them for $\PI$}

\mytodo{make sure to explain $C_\Gamma$ notation}
\begin{lemma}
	Let $C$ be an clause in $\Gamma \cup \Delta$ 
	Then $\Gamma \entails \lifdelta{\PIinit(C) \lor\nolinebreak C_\Gamma} $.
\end{lemma}




\begin{lemma}
	Let $\inference$ be an inference in a resolution refutation of $\Gamma \cup \Delta$ using the clauses $\bar C = C_1, \dots, C_n$
	and let $\bar I = I_1, \dots, I_n$ be formulas such that 
	$\Gamma \entails \lifdelta{I_i \lor\nolinebreak (C_i)_\Gamma} $ for $1 \varleq i \varleq n$.
	Then
	$\Gamma \entails \lifdelta{\PIstep(\inference, \bar I) \lor\nolinebreak C_\Gamma} $.

\end{lemma}

\begin{proof}
	\begin{description}
		\item{Resolution.}
			Suppose that $\inference$ is a resolution inference of the clauses $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$.

			We may assume that 
			$\Gamma \entails \lifdelta{I_1 \lor (D\lor l)_\Gamma}$ and $\Gamma \entails \lifdelta{I_2 \lor (E\lor \lnot l')_\Gamma}$,
			which by Lemma \ref{lemma:lift_logic_commute} implies the following:

			\markA{} $\Gamma \entails \lifdelta{I_1} \spas\lor\allowbreak \lifdelta{D_\Gamma} \spas\lor\allowbreak \lifdelta{l_\Gamma}$ 

			\markB{} $\Gamma \entails \lifdelta{I_2} \spas\lor \lifdelta{E_\Gamma} \spas\lor \lnot \lifdelta{l'_\Gamma}$.

			We proceed by a case distinction on the color of $l$:
			\begin{enumerate}
				\item $l$ is $\Gamma$-colored. Then $\PIstep(\inference, \bar I) = [\PI(C_1\label{aou5jklah}) \lor I_2]\sigma$.
					\label{aou5jklah}

					Since $\sigma = \mgu(l, l')$, $l\sigma \syneq l'\sigma$ and therefore $\lifdelta{l\sigma} = \lifdelta{l'\sigma}$.
					As by Lemma~\ref{lemma:lifting_subst_commute} $\lifdelta{l\sigma} = \lifdelta{l}\sigma'$ and $\lifdelta{l'\sigma} = \lifdelta{l'}\sigma'$,
					we get $\lifdelta{l}\sigma' = \lifdelta{l'}\sigma'$.
					Hence by applying $\sigma'$ to \markA{} and \markB{} (note that $l_\Gamma = l$ and $l'_\Gamma = l'$ as they are $\Gamma$-colored), we can perform a resolution step on $\lifdelta{l}\sigma'$ and obtain
					$\Gamma \entails \lifdelta{I_1}\sigma' \spas\lor \lifdelta{D_\Gamma} \sigma' \spas\lor \lifdelta{I_2}\sigma' \spas\lor \lifdelta{E_\Gamma} \sigma'$.
					Now we apply Lemma~\ref{lemma:lif} and Lemma~\ref{lemma:lift_logic_commute} in the other direction 
					and get that 
					$\Gamma \entails \lifdelta{I_1\sigma \lor I_2\sigma \lor\allowbreak (D \lor E)_\Gamma \sigma}$.
					This however is nothing else than 
					$\Gamma \entails \lifdelta{\PIstep(\inference, \bar I) \lor C_\Gamma}$.

				\item $l$ is $\Delta$-colored. Then $\PIstep(\inference, \bar I) = [I_1 \land I_2]\sigma$.

					As $l$ and $l'$ are $\Delta$-colored, we can simplify \markA{} and \markB{} as follows and apply $\sigma'$:
					$\Gamma \entails \lifdelta{I_1}\sigma' \spas\lor \lifdelta{D_\Gamma}\sigma' $ and $\Gamma \entails \lifdelta{I_2}\sigma' \spas\lor \lifdelta{E_\Gamma}\sigma'$.
					These together imply that 
					$\Gamma \entails \Big(\lifdelta{I_1}\sigma' \spas\land \lifdelta{I_2}\sigma'\Big) \spas\lor\allowbreak \lifdelta{D_\Gamma}\sigma' \spas\lor\allowbreak \lifdelta{E_\Gamma}\sigma'$.
					By Lemma~\ref{lemma:lift_logic_commute} and Lemma~\ref{lemma:lif}, this is equivalent to 
					$\Gamma \entails \lifdelta{(I_1 \land I_2)\sigma \spas\lor (D \lor E)_\Gamma\sigma}$, which is nothing else than
					$\Gamma \entails \lifdelta{\PIstep(\inference, \bar I) \lor C_\Gamma}$.

				\item $l$ is grey. Then $\PIstep(\inference, \bar I) = [(l \land I_2 ) \lor (\lnot l' \land I_1)]\sigma$.

					We show that $\Gamma \entails\allowbreak \lifdelta{ \Big((l \land I_2 ) \lor\allowbreak (\lnot l' \land I_2) \lor D_\Gamma \lor E_\Gamma\Big)\sigma}$, for which by Lemma~\ref{lemma:lift_logic_commute} and Lemma~\ref{lemma:lif} it suffices to show that 
					$\Gamma \entails\allowbreak \big(\lifdelta{l}\sigma' \land \lifdelta{I_2}\sigma'\big)\spas\lor\allowbreak \big(\lnot \lifdelta{l'}\sigma' \land \lifdelta{I_2}\sigma'\big)\spas\lor\allowbreak \lifdelta{D_\Gamma}\sigma' \lor \lifdelta{E_\Gamma}\sigma'$.

					Suppose for a model $M$ of $\Gamma$ that  $M \notentails \lifdelta{D_\Gamma}\sigma'$ and $M\notentails \lifdelta{E_\Gamma}\sigma'$ as otherwise we are done.
					But then by \markA{} and \markB{}, we get that 
					$M \entails \lifdelta{I_1}\sigma' \lor \lifdelta{l}\sigma'$ and
					$M \entails\nolinebreak \lifdelta{I_2}\sigma' \lor \lnot\lifdelta{l'}\sigma'$.
					As observed in case \ref{aou5jklah}, $\lifdelta{l}\sigma' = \lifdelta{l'}\sigma'$.
					We obtain the result by a case distinction on the truth value of $\lifdelta{l}\sigma'$.

			\end{enumerate}
	\end{description}
\end{proof}

\begin{lemma}
	\label{lemma:gamma_entails_lifted_interpolant}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$ and $C$ be a clause occurring in $\pi$
	Then $\Gamma \entails \lifdelta{\PI(C) \lor\nolinebreak C}$.
\end{lemma}
\begin{proof}
	We proceed by induction on the strengthening
	Then $\Gamma \entails \lifdelta{\PI(C) \lor\nolinebreak C_\Gamma}$.

	If $C \in \Gamma\cup\Delta$, then by Lemma~TODO gives the result.

	For clauses $C$ inferred by $\inference$ from the clauses $C_1, \dots, C_n$, $\PI(C) = \PIstep(\inference, \PI(C_1), \dots, \PI(C_n))$.
	By induction hypothesis, $\Gamma \entails \lifdelta{\PI(C_i) \lor\nolinebreak (C_i)_\Gamma}$ for $1\varleq i\varleq n$, hence
	Lemma~TODO gives the induction step.
\end{proof}


{\tiny


\begin{proof}
	\largered{OLD}
	We proceed by induction on the resolution refutation of the strengthening $\Gamma \entails \lifdelta{\PI(C) \lor\nolinebreak C_\Gamma}$,
	where $D_\Phi$ denotes the clause created from $D$ by removing all literals which are not contained $\Lang(\Phi)$.
	%i.e.\ we only consider literals of $C$ which are contained in $\Lang(\Gamma)$.

	\begin{description}
		\item{Base case.}
			Either $C \in \Gamma$, then $\lifdelta{C} = C$ and $\Gamma \entails C$.
			Otherwise $C \in \Delta$ and $\PI(C) = \top$.

		\item{Resolution.}
			Suppose the clause $C$ is the result of a resolution step \inference{} of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$.

			By the induction hypothesis, we can assume that
			$\Gamma \entails \lifdelta{\PI(C_1) \lor (D\lor l)_\Gamma}$ and $\Gamma \entails \lifdelta{\PI(C_2) \lor (E\lor \lnot l')_\Gamma}$,
			which by Lemma \ref{lemma:lift_logic_commute} implies the following:

			\markA{} $\Gamma \entails \lifdelta{\PI(C_1)} \spas\lor\allowbreak \lifdelta{D_\Gamma} \spas\lor\allowbreak \lifdelta{l_\Gamma}$ 

			\markB{} $\Gamma \entails \lifdelta{\PI(C_2)} \spas\lor \lifdelta{E_\Gamma} \spas\lor \lnot \lifdelta{l'_\Gamma}$.

			\mytodo{ HERE }

			\mytodo{ merge proofs somehow? }

			We proceed by a case distinction on the color of $l$:
			\begin{enumerate}
				\item $l$ is $\Gamma$-colored. Then $\PI(C) = [\PI(C_1\label{aou5jklah}) \lor \PI(C_2)]\sigma$.
					\label{aou5jklah}

					Since $\sigma = \mgu(l, l')$, $l\sigma \syneq l'\sigma$ and therefore $\lifdelta{l\sigma} = \lifdelta{l'\sigma}$.
					As by Lemma~\ref{lemma:lifting_subst_commute} $\lifdelta{l\sigma} = \lifdelta{l}\sigma'$ and $\lifdelta{l'\sigma} = \lifdelta{l'}\sigma'$,
					we get $\lifdelta{l}\sigma' = \lifdelta{l'}\sigma'$.
					Hence by applying $\sigma'$ to \markA{} and \markB{} (note that $l_\Gamma = l$ and $l'_\Gamma = l'$ as they are $\Gamma$-colored), we can perform a resolution step on $\lifdelta{l}\sigma'$ and obtain
					$\Gamma \entails \lifdelta{\PI(C_1)}\sigma' \spas\lor \lifdelta{D_\Gamma} \sigma' \spas\lor \lifdelta{\PI(C_2)}\sigma' \spas\lor \lifdelta{E_\Gamma} \sigma'$.
					Now we apply Lemma~\ref{lemma:lif} and Lemma~\ref{lemma:lift_logic_commute} in the other direction 
					and get that 
					$\Gamma \entails \lifdelta{\PI(C_1)\sigma \lor \PI(C_2)\sigma \lor\allowbreak (D \lor E)_\Gamma \sigma}$.
					This however is nothing else than 
					$\Gamma \entails \lifdelta{\PI(C) \lor C_\Gamma}$.

				\item $l$ is $\Delta$-colored. Then $\PI(C) = [\PI(C_1) \land \PI(C_2)]\sigma$.

					As $l$ and $l'$ are $\Delta$-colored, we can simplify \markA{} and \markB{} as follows and apply $\sigma'$:
					$\Gamma \entails \lifdelta{\PI(C_1)}\sigma' \spas\lor \lifdelta{D_\Gamma}\sigma' $ and $\Gamma \entails \lifdelta{\PI(C_2)}\sigma' \spas\lor \lifdelta{E_\Gamma}\sigma'$.
					These together imply that 
					$\Gamma \entails \Big(\lifdelta{\PI(C_1)}\sigma' \spas\land \lifdelta{\PI(C_2)}\sigma'\Big) \spas\lor\allowbreak \lifdelta{D_\Gamma}\sigma' \spas\lor\allowbreak \lifdelta{E_\Gamma}\sigma'$.
					By Lemma~\ref{lemma:lift_logic_commute} and Lemma~\ref{lemma:lif}, this is equivalent to 
					$\Gamma \entails \lifdelta{(\PI(C_1) \land \PI(C_2))\sigma \spas\lor (D \lor E)_\Gamma\sigma}$, which is nothing else than
					$\Gamma \entails \lifdelta{\PI(C) \lor C_\Gamma}$.

				\item $l$ is grey. Then $\PI(C) = [(l \land \PI(C_2) ) \lor (\lnot l' \land \PI(C_1))]\sigma$.

					We show that $\Gamma \entails\allowbreak \lifdelta{ \Big((l \land \PI(C_2) ) \lor\allowbreak (\lnot l' \land \PI(C_2)) \lor D_\Gamma \lor E_\Gamma\Big)\sigma}$, for which by Lemma~\ref{lemma:lift_logic_commute} and Lemma~\ref{lemma:lif} it suffices to show that 
					$\Gamma \entails\allowbreak \big(\lifdelta{l}\sigma' \land \lifdelta{\PI(C_2)}\sigma'\big)\spas\lor\allowbreak \big(\lnot \lifdelta{l'}\sigma' \land \lifdelta{\PI(C_2)}\sigma'\big)\spas\lor\allowbreak \lifdelta{D_\Gamma}\sigma' \lor \lifdelta{E_\Gamma}\sigma'$.

					Suppose for a model $M$ of $\Gamma$ that  $M \notentails \lifdelta{D_\Gamma}\sigma'$ and $M\notentails \lifdelta{E_\Gamma}\sigma'$ as otherwise we are done.
					But then by \markA{} and \markB{}, we get that 
					$M \entails \lifdelta{\PI(C_1)}\sigma' \lor \lifdelta{l}\sigma'$ and
					$M \entails\nolinebreak \lifdelta{\PI(C_2)}\sigma' \lor \lnot\lifdelta{l'}\sigma'$.
					As observed in case \ref{aou5jklah}, $\lifdelta{l}\sigma' = \lifdelta{l'}\sigma'$.
					We obtain the result by a case distinction on the truth value of $\lifdelta{l}\sigma'$.

			\end{enumerate}

		\item{Factorisation.}
			Suppose the clause $C$ is the result of a factorisation inference $\inference$ of $C_1: l \lor l' \lor D$ with $\sigma=\mgu(\inference)$.

			% Then $\PI(C) = \PI(C_1)\sigma$.

			The induction hypothesis gives that
			$\Gamma \entails \lifdelta{\PI(C_1) \lor l \lor l' \lor D}$.
			Let $\sigma'$ be defined as in Lemma \ref{lemma:lif}.
			Then $\Gamma \entails \lifdelta{\PI(C_1) \lor l \lor l' \lor D}\sigma'$ and by Lemma \ref{lemma:lif} and Lemma~\ref{lemma:lift_logic_commute},
			$\Gamma \entails \lifdelta{\PI(C_1)\sigma} \spas\lor \lifdelta{l\sigma} \spas\lor \lifdelta{l'\sigma} \spas\lor \lifdelta{D\sigma}$.

			As $\sigma = \mgu(l, l')$, $l\sigma \syneq l'\sigma$ and hence $\lifdelta{l\sigma} = \lifdelta{l'\sigma}$.
			But then we can apply a factorisation step and get that
			$\Gamma \entails \lifdelta{\PI(C_1)\sigma} \spas\lor \lifdelta{l\sigma} \spas\lor \lifdelta{D\sigma}$
			which by Lemma \ref{lemma:lif} and Lemma \ref{lemma:lift_logic_commute} is equivalent to 
			$\Gamma \entails\nolinebreak \lifdelta{\PI(C_1)\sigma \lor l\sigma \lor D\sigma}$.
			This in turn is nothing else than $\Gamma \entails \lifdelta{\PI(C) \lor C}$.

		\item{Paramodulation.}
			Suppose the clause $C$ is the result of a paramodulation inference\nolinebreak{} $\inference$ of $C_1: s=t \lor   D$ and $C_2: E\occatp{r}$ with $\sigma=\mgu(\inference)$.


			By the induction hypothesis, we get that 
			$\Gamma \entails \lifdelta{\PI(C_1) \lor (D\lor s=t)_\Gamma}$ and 
			$\Gamma \entails \lifdelta{\PI(C_2) \lor (E\occurat{r}{p})_\Gamma}$.
			This is by Lemma~\ref{lemma:lift_logic_commute} equivalent to
			\markA{} $\Gamma \entails \lifdelta{\PI(C_1)} \spas\lor\allowbreak \lifdelta{D_\Gamma} \spas\lor \lifdelta{s} = \lifdelta{t}$
			and \markB{} 
			$\Gamma \entails \lifdelta{\PI(C_2)} \spas\lor \lifdelta{(E\occurat{r}{p})_\Gamma}$ respectively.


			We distinguish two cases:\nopagebreak
			\begin{enumerate}
				\item Suppose $s$ does not occur in a maximal $\Delta$-term $h\occur{s}$ in $E\occurat{s}{p}$, which occurs more than once in $\PI(C_2) \lor (E\occurat{r}{p})_\Gamma$.
					\label{klehjy}

					Let $M$ be a model of $\Gamma$.
					First, assume that $M \entails \lifdelta{s} \neq \lifdelta{t}$.
					Then by \markA{} we have that $M \entails \lifdelta{\PI(C_1)} \lor \lifdelta{D_\Gamma}$.
					By applying $\sigma'$ and Lemma~\ref{lemma:lif}, we hence can conclude from 
					$M \entails \lifdelta{s\sigma} \neq \lifdelta{t\sigma}$ that 
					$M \entails \lifdelta{\PI(C_1)\sigma} \lor \lifdelta{D_\Gamma\sigma}$.


					Second, assume to the contrary that $M \entails \lifdelta{s} = \lifdelta{t}$.
					\todo{this is wrong in the same way as the -nested proof was, fix just like the other one}
					We distinguish cases:
					\begin{itemize}
						\item
							Suppose that $s$ does not occur in a maximal $\Delta$-term in $(E\occat{s}{p})_\Gamma$.
							Then by Lemma~\ref{aga5tg5ba} $M\entails \lifdelta{(E\occat{t}{p})_\Gamma} \semiff M \entails \lifdelta{(E\occat{s}{t})_\Gamma}$.

							Due to $\sigma=\mgu(s, r)$, $s\sigma \syneq r\sigma$.
							Suppose they are both not $\Delta$-colored.
							Then the lifting does not affect them and 
							$\lifdelta{(E\occurat{s}{p})_\Gamma\sigma} \syneq \lifdelta{(E\occurat{r}{p})_\Gamma\sigma}$.
							Otherwise the lifting will replace them with the same variable and we as well get that
							$\lifdelta{(E\occurat{s}{p})_\Gamma\sigma} \syneq \lifdelta{(E\occurat{r}{p})_\Gamma\sigma}$.
							Hence $M\entails \lifdelta{(E\occurat{t}{p})_\Gamma\sigma} \semiff\allowbreak M\entails 
							\lifdelta{(E\occurat{r}{p})_\Gamma\sigma}$

						\item
							Otherwise $r$ occurs in a maximal $\Delta$-term $h\occ{r}$ in $(E\occat{r}{p})_\Gamma$, but $h\occur{r}$ does not occur elsewhere in $\PI(C_2) \lor (E\occurat{r}{p})_\Gamma$.
							Then the lifting variable $x_{h\occur{r}}$ occurs only once in \markB{}.
							Hence $\Gamma$ does not pose any restriction on $x_{h\occur{r}}$ and we can substitute it by $x_{h\occur{t}}$. 
							So in $M$ we have that $M\entails \lifdelta{(E\occurat{t}{p})_\Gamma} \semiff\allowbreak M\entails \lifdelta{(E\occurat{r}{p})_\Gamma}$.

					\end{itemize}

					Hence in any of the cases, by \markB{} and by applying $\sigma'$ and Lemma~\ref{lemma:lif}
					it follows from $M\entails \lifdelta{s\sigma} = \lifdelta{t\sigma}$ 
					that $M \entails \lifdelta{\PI(C_2)\sigma} \lor \lifdelta{(E\occurat{t}{p})_\Gamma\sigma}$. 
					\medskip

					In conclusion, we can derive that 
					$\Gamma \entails
					(\lifdelta{s\sigma} \neq \lifdelta{t\sigma} \spas\land\allowbreak (\lifdelta{\PI(C_1)\sigma} \lor \lifdelta{D_\Gamma}\sigma))
					\spam{\lor}\allowbreak
					(\lifdelta{s\sigma} = \lifdelta{t\sigma} \spas\land (\lifdelta{\PI(C_2)\sigma} \lor \lifdelta{(E\occat{t}{p})_\Gamma\sigma}))$.
					This however implies that
					$\Gamma \entails
					\Big(\lifdelta{s\sigma} \neq \lifdelta{t\sigma} \spas\land (\lifdelta{\PI(C_1)\sigma} )\Big)
					\spas{\lor}\allowbreak
					\Big(\lifdelta{s\sigma} =\nolinebreak \lifdelta{t\sigma} \spas\land (\lifdelta{\PI(C_2)\sigma}) \Big)
					\spas\lor\allowbreak \Big(\lifdelta{D_\Gamma\sigma} \lor \lifdelta{(E\occat{t}{p})_\Gamma\sigma}\Big)$, 
					which by Lemma~\ref{lemma:lift_logic_commute} is nothing else than
					$\Gamma \entails \lifdelta{\PI(C) \lor C}$.

				\item Otherwise $s$ occurs in a maximal $\Delta$-term $h\occurat{s}{q}$ in $E\occurat{s}{p}$, which occurs more than once in $E\occat{s}{p}$.

					Then a similar line of argument as in case~\ref{klehjy} can be employed, with the difference that the application of Lemma~\ref{aga5tg5ba} in the case of $M\entails \lifdelta{s} = \lifdelta{t}$ yields the additional possibility that 
					$M\entails \lifdelta{h\occur{s}} \neq \lifdelta{h\occur{t}}$.
					Hence we arrive at:

					$\Gamma \entails
					\Big(\lifdelta{s}\sigma'=\lifdelta{t}\sigma' \land \lifdelta{\PI(C_2)}\sigma'\Big) \spas\lor\allowbreak
					\Big(\lifdelta{s}\sigma'\neq\lifdelta{t}\sigma' \land \lifdelta{\PI(C_1)}\sigma'\Big) \spas\lor\allowbreak
					\Big(\lifdelta{s}\sigma'=\lifdelta{t}\sigma' \land (\lifdelta{h\occur{s}}\sigma') \neq (\lifdelta{h\occur{t}}\sigma' )\Big) \spas\lor\allowbreak
					\Big(\lifdelta{D_\Gamma}\sigma' \lor \lifdelta{(E\occurat{t}{p})_\Gamma}\sigma'\Big)$

					This however is by Lemma~\ref{lemma:lif} and Lemma~\ref{lemma:lift_logic_commute} equivalent to $\Gamma \entails \lifdelta{\PI(C) \lor\nolinebreak C}$.
					\qedhere
			\end{enumerate}
	\end{description}
\end{proof}
}


\section{Symmetry of the extracted interpolants}
\label{sec:symmetry}

The interpolant extraction procedure $\PI$ exhibits a convenient property which is termed \emph{symmetry} in \cite[Definition 3]{interpolantStrenth} and will be used to show that results concerning $\Gamma$ can easily be generalised to results for $\Delta$.
We develop it starting from $\PIinit$ and $\PIstep$ in order to then state it for $\PI$. 

\newcommand{\primex}[1]{\ensuremath{\bhat{#1}}}

\begin{lemma}
	\label{lemma:symmetry_base}
	Let $C$ be a clause in $\Gamma \cup \Delta$ and $\primex C$ the same clause in $\primex\Gamma\cup \primex\Delta$ such that $\primex\Gamma = \Delta$ and $\primex\Delta = \Gamma$.
	Then $\PIinit(C) \semiff \lnot \PIinit(\primex C)$. 
\end{lemma}
\begin{proof}
	\[
		\PIinit(C) =
	\begin{cases} \top & \text{ if $C \in \Delta$} \\ \bot & \text{ if $C \in \Gamma$}\end{cases}
	\spam= \begin{cases} \top & \text{ if $\primex C \in \primex\Gamma$} \\ \bot & \text{ if $\primex C \in \primex\Delta$}\end{cases}\\
		\spam =
	 \begin{cases} \lnot \bot & \text{ if $\primex C \in \primex\Gamma$} \\ \lnot \top & \text{ if $\primex C \in \primex\Delta$}\end{cases}
		=
		\lnot \PIinit(\primex C) 
		\qedhere
	\]
\end{proof}

\begin{lemma}
	\label{lemma:symmetry_step}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$ and
	$\primex\pi$ be $\pi$ with $\primex\Gamma = \Delta$ and $\primex\Delta = \Gamma$.
	If $\inference$ is an inference of $\pi$ using the clauses $\bar C = C_1, \dots, C_n$ and
	$I_1, \dots, I_n$ and 
	$\primex I_1, \dots, \primex I_n$ are formulas  
	such that $I_i \semiff \lnot \primex I_i$ for $1\varleq i \varleq n$, then
	$\PIstep(\inference, I_1, \dots, I_n) \spas\semiff \PIstep(\primex\inference, \primex I_1, \dots, \primex I_n)$.
\end{lemma}
\begin{proof}
	Let $\primex\varphi$ denote the clause/formula/literal/term in $\primex\pi$ corresponding to the clause/formula/literal/term $\varphi$ in $\pi$.

	We distinguish cases based on the type of $\inference$:

	\begin{itemize}
		\item[Resolution.]
			\newcommand{\p}[1]{\primex{#1}}

			Suppose that $\inference$ is a resolution inference of $C_1: D \lor l$ and $C_2: E \lor \lnot l'$ with $\sigma = \mgu(\inference)$.

			We distinguish the following cases:
			\begin{enumerate}
				\item $l$ is $\Gamma$-colored. Then $\primex l$ is $\Delta$-colored.
					\begin{align*}
						\PIstep(\inference, I_1, \dots, I_n) &= I_1\sigma \lor I_2\sigma\\
													 &\semiff \lnot ( \lnot I_1\sigma \land \lnot I_2\sigma )\\
														&\semiff \lnot ( \p I_1\sigma \land \p I_2\sigma ) \\
														&= \lnot \PIstep(\primex \inference, \p I_1, \p I_2)  
					\end{align*}
				\item $l$ is $\Delta$-colored. This case can be argued analogously.

				\item $l$ is grey. Then $\primex l$ is grey. 
					Note that $l\sigma \syneq l'\sigma$ \markB.
					\nopagebreak 
					\begin{align*}
						\PIstep(\inference, I_1, \dots, I_n) 
						&=  [(l \land I_2) \lor (\lnot l'  \land I_1)]\sigma\\
						&\hspace{-1pt}\stackrel{\mathclap{\markB}}\semiff[(\lnot l \lor I_2) \land (l' \lor I_1)]\sigma\\
						 &\semiff \lnot [(l \land \lnot I_2) \lor (\lnot l'  \land \lnot I_1)]\sigma\\
						 &= \lnot [(\p l \land\lnot I_2 ) \lor (\lnot \p{l'}\land \lnot I_1 )]\sigma\\
						 &= \lnot  [(\p l \land \p I_2 ) \lor (\lnot \p{l'} \land \p I_1)]\sigma \\
						 &= \lnot \PIstep(\p \inference, \p I_1, \dots, \p I_n)
					\end{align*}
			\end{enumerate}

				\item[Factorisation.]
					Suppose that $\inference$ is a factorisation inference of $C_1: l \lor l' \lor D$
					with $\sigma = \mgu(\inference)$.
					Then $\PIstep(\inference, I_1) = I_1\sigma \spas\semiff \lnot \p I_1\sigma = \lnot \PIstep(\p \inference, \p I_1)$.

				\item[Paramodulation.]
					Suppose that $\inference$ is a paramodulation inference of $C_1: s=t \lor D$ and $C_2: E\occur{r}$ 
					with $\sigma = \mgu(\inference)$.

					We proceed by a case distinction:
					$\PIstep(\inference, I_1, I_2)$

					\begin{enumerate}
						\item $r$ occurs in a maximal $\Delta$-term $h\occur{r}$ in $E\occur{r}$ and $h\occur{r}$ occurs more than once in $I_2 \lor E\occur{r}$.
							Then $\primex r$ occurs in a maximal $\Gamma$-term $\primex h\occur{r}$ in $\primex E\occur{r}$ and $\primex h\occur{r}$ occurs more than once in $\primex E\occur{r} \lor \PI(\primex E\occur{r})$.
							\begin{align*}
								\PIstep(\inference, I_1, I_2) &= [ ( s=t \land I_2 ) \lor (s\neq t \land I_1) ]\sigma \lor (s=t \land h\occur{s} \neq h\occur{t})\sigma\\
														&= [ ( s=t \land \lnot \p I_2 ) \lor (s\neq t \land \lnot \p I_1) ]\sigma \lor (s=t \land h\occur{s} \neq h\occur{t})\sigma\\
														&\semiff \lnot [ ( s\neq t \lor \p I_2 ) \land (s= t \lor \p I_1) ]\sigma \land \lnot (s\neq t \lor h\occur{s} = h\occur{t})\sigma\\
														&\semiff \lnot [ ( s = t \land \p I_2 ) \lor (s\neq t \land \p I_1) ]\sigma \land \lnot (s\neq t \lor h\occur{s} = h\occur{t})\sigma\\
													 &= \lnot \PIstep(\primex \inference, \p I_1, \p I_2)
							\end{align*}

						\item $r$ occurs in a maximal $\Gamma$-term $h\occur{r}$ in $E\occur{r}$ and $h\occur{r}$ occurs more than once in $I_2 \lor E\occur{r}$.
							This case can be argued analogously.
						\item Otherwise:
							\begin{align*}
								\PIstep(\inference, I_1, I_2) &= [ ( s=t \land I_2 ) \lor (s\neq t \land I_1) ]\sigma \\
														&= [ ( s=t \land \lnot \p I_2 ) \lor (s\neq t \land \lnot \p I_1) ]\sigma \\
														&\semiff \lnot [ ( s\neq t \lor \p I_2 ) \land (s=t \lor \p I_1) ]\sigma \\
														&\semiff \lnot [ ( s=t \land \p I_2 ) \lor (s\neq t \land \p I_1) ]\sigma \\
													 &= \lnot \PIstep(\primex \inference, \p I_1, \p I_2)
								\qedhere
							\end{align*}
					\end{enumerate}


	\end{itemize}

\end{proof}



\begin{lemma}
	\label{lemma:symmetry}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$ and
	$\primex\pi$ be $\pi$ with $\primex\Gamma = \Delta$ and $\primex\Delta = \Gamma$.
	Then for a clause $C$ and its corresponding clause $\primex C$ in $\primex \pi$, $\PI(C) \semiff \lnot \PI(\primex C)$.
\end{lemma}
\begin{proof}
	We prove this lemma by induction.

	For $C \in \Gamma \cup \Delta$, we obtain the result by Lemma~\ref{lemma:symmetry_base}.


	For the induction step, suppose that the clause $C$ is the result of an inference $\inference$ of the clauses $\bar C = C_1, \dots, C_n$.
	Then by the induction hypothesis, $\PI(C_i) \semiff \lnot \PI(\primex C_i)$ for $1 \varleq i \varleq n$. 
	Hence we can apply Lemma~\ref{lemma:symmetry_step} to obtain that $\PIstep(\inference, \PI(C_1), \dots, \PI(C_n)) \semiff \lnot \PIstep(\primex \inference, \PI(\primex C_1), \dots, \PI(\primex C_n))$.
	But this is nothing else than $\PI(C) \spas\semiff \lnot \PI(\primex C)$.
\end{proof}


\begin{corr}
	\label{cor:delta_entails_lifted_interpolant}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$. 
	Then $\Delta \entails \lft{\Gamma}{x}{ \lnot \PI(C) \lor C }$ for $C$ in $\pi$.
\end{corr}
\begin{proof}
	Form $\primex \pi$ from $\pi$ using $\primex \Gamma = \Delta$ and $\primex \Delta = \Gamma$ as initial clause sets.
	By Lemma \ref{lemma:gamma_entails_lifted_interpolant}, it holds that $\primex \Gamma \entails \lft{\primex\Delta}{x}{ \PI(\primex C) \lor \primex C }$ for $\primex C$ in $\primex \pi$ and 
	by Lemma \ref{lemma:symmetry}, we obtain that 
	$\primex \Gamma \entails \lft{\primex\Delta}{x}{ \lnot \PI(C) \lor \primex C }$ for the clause $C$ in $\pi$ corresponding to $\primex C$ in $\primex \pi$. 
	This however is nothing else than 
	$\Delta \entails\nolinebreak \lft{\Gamma}{x}{ \lnot \PI(C) \lor C }$.
\end{proof}


\section{Propositional and one-sided interpolants}

We now show that the results presented in section \ref{sec:two_phase_main_lemma} and \ref{sec:symmetry}
already are give interpolants which are propositional interpolants in the sense that besides possibly containing colored terms, they are proper interpolants.
Note that this coincides with the notion of ``relational interpolant'' as given in \cite{Huang95} and is defined formally in our notation in~\ref{def:huang_orig_rel_prop_interpol}.

\begin{corr}
	\label{cor:propositional_interpolant}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$.
	Then
	\begin{enumerate}
		\item$\Gamma\entails \PI(\pi)$
		\item$\Delta\entails \lnot \PI(\pi)$
		\item $\PS(\PI(\pi)) \subseteq \PS(\Gamma) \cap \PS(\Delta)$.
	\end{enumerate}
\end{corr}
\begin{proof}
	By the definition of $\PI$, 
	$\PI(\pi)$ denotes $\PI(\square)$, where $\square$ is the empty clause derived in $\PI$.
	By Lemma~\ref{lemma:gamma_entails_lifted_interpolant}, we get that 
	$ \Gamma \entails \lifdelta{\PI(\pi)}$.
	As the lifting replaces terms by variables which are then implicitly universally quantified, $\PI(\pi)$ is an instance of $\lifdelta{\PI(\pi)}$.
	Therefore $\Gamma \entails \PI(\pi)$.

	By Corollary~\ref{cor:delta_entails_lifted_interpolant}, $\Delta \entails \lnot \lifgamma{\PI(\pi)}$,
	thus by a similar argument as above, $\Delta \entails \lnot \PI(\pi)$.


	Finally, by the construction of $\PI$, $\PI(\pi)$ is solely comprised of grey predicate symbols.
\end{proof}


From Lemma~\ref{lemma:gamma_entails_lifted_interpolant}, we can also easily derive a result on a restricted notion of interpolation which we refer to as one-sided interpolants. 

\begin{defi}
	Let $\Gamma$ and $\Delta$ be sets of first-order formulas.
	A \defiemph{one-sided interpolant} of $\Gamma$ and $\Delta$ is a first-order formula $I$ such that
	\begin{enumerate}
		\item $\Gamma \entails I$
		\item $\Delta \entails \lnot I$
		\item $\Lang(I) \subseteq \Lang(\Gamma) $
			\qedhere
	\end{enumerate}
\end{defi}

Note that if $I$ is a one-sided interpolant for $\Gamma$ and $\Delta$ and additionally $\Lang(I) \subseteq \Lang(\Delta)$ holds, then $I$ is an interpolant for $\Gamma$ and $\Delta$.

\begin{prop}
	Let $\Gamma$ and $\Delta$ be sets of first-order formulas such that $\Gamma\cup\Delta$ is unsatisfiable.
	Then there is a one-sided interpolant of $\Gamma$ and $\Delta$ which is a $\Pi_1$ formula.
\end{prop}
\begin{proof}
	Let $\pi$ be a resolution refutation of $\Gamma\cup\Delta$.
	By Lemma~\ref{lemma:gamma_entails_lifted_interpolant}, we have that
	$ \Gamma \entails \lifdelta{\PI(\pi)}$,
	or equivalently
	$\Gamma \entails \forall x_1 \quantifierdots \forall x_n  \PI(\pi)$, where $x_1, \dots, x_n$ are the $\Delta$-lifting variables occurring in $\PI(\pi)$.

	By Corollary~\ref{cor:propositional_interpolant}, we get that
	$\Delta \entails \lnot \PI(\pi)$.
	This however provides witness terms for 
	$\Delta \entails \exists x_1 \quantifierdots \exists x_n \lnot \lifdelta{ \PI(\pi) }$, where we can pull the quantifiers inwards to obtain that
	$\Delta \entails \lnot  \forall x_1 \quantifierdots \forall x_n \lnot \lifdelta{ \PI(\pi) }$.

	Clearly $\forall x_1 \quantifierdots \forall x_n \lifdelta{ \PI(\pi) }$ is devoid of $\Delta$-terms and hence a one-sided interpolant, which is a $\PI_1$ formula.
\end{proof}



\section{Quantifying over lifting variables}

As we have already seen in Corollary~\ref{cor:propositional_interpolant} that $\PI(\pi)$ forms a propositional interpolant, it remains to lift all colored terms and quantify over the resulting lifting variables in a viable order.


\begin{lemma}
	%Let $\{z_1,\ldots, z_n\}$ be the maximal colored terms of a clause $C$.
	%Then 
	%$ Q_1 z_1 \ldots Q_n z_n \lft{\Gamma}{y}{ \lft{\Delta}{x}{ C}  }
	%\;\liff\;
	%Q_1 z_1 \ldots Q_n z_n \lft{\Delta}{x'}{ \lft{\Gamma}{y'}{ C}  }$ for $Q_i \in \{\forall, \exists\}$ for $1\varleq i\varleq n$.

	For a formula or term $\varphi$,
	$ \lft{\Gamma}{y}{ \lft{\Delta}{x}{ \varphi}  } =
	\lft{\Delta}{x}{ \lft{\Gamma}{y}{ \varphi }  }$.
	%\label{lemma:naming_of_colored_variables}
	\label{lemma:lifting_order_not_relevant}
\end{lemma}
\begin{proof}
	Let $\varphi$ be a multi-colored term as otherwise we are done.
	Suppose without loss of generality that it is a $\Gamma$-term which contains a maximal $\Delta$-term $t$ as position $p$.
	Then $\lft{\Delta}{x}{ \lft{\Gamma}{y}{ \varphi }  }
	= \lft{\Delta}{x}{ y_\varphi }
	= y_\varphi $.

	On the other hand
	$\lft{\Gamma}{y}{ \lft{\Delta}{x}{ \varphi}  } = \lft{\Gamma}{y}{ \psi }$ such that $\psi$ is equal to $\varphi$ besides having $x_t$ at position $p$.
	But $\lft{\Gamma}{y}{ \psi } = y_{\expa(\psi)} = y_\varphi$.
	%	\begin{comment}
	%		Suppose a term $t$ in $C$ is affected by a lifting.
	%		We only need to consider maximal colored terms as grey terms are not affected by the liftings.
	%		Without loss of generality let $t$ be a maximal $\Delta$-colored term.
	%
	%		Let $\Phi$ be the positions of maximal occurrences of $t$.
	%		Then in the left hand side, exactly all terms at positions $\Phi$ are replaced by $x_i$ for some $i$.
	%
	%		In the right hand side, all terms at positions $\Phi$ are replaced by $\lft{\Gamma}{y'}{t}$ first. 
	%		However after this step,
	%		all these terms are equal to $\lft{\Gamma}{y'}{t}$, and as all distinct maximal $\Gamma$-terms are replaced by distinct variables, no other maximal colored term is equal to $\lft{\Gamma}{y'}{t}$.
	%		Hence exactly the terms at positions $\Phi$ are replaced by the same variable $x'_j$ for some $j$.
	%	\end{comment}
\end{proof}


\begin{thm}
	\label{thm:two_phases}
	Let $\pi$ be a resolution refutation of $\Gamma \cup \Delta$ and
	$t_1, \dots, t_n$ be an arrangement of the maximal colored terms in $\PI(\pi)$ according to the subterm order, i.e.\ if $t_i$ is a subterm of $t_j$, then $i<j$.
	Then
	$Q_1 z_{t_1} \ldots Q_n z_{t_n}\,\lifgamma{\lifdelta{\PI(\pi)}}$, where $Q_i$ is $\forall$ $(\exists)$ if $z_{t_i}$ replaces a $\Delta$ $(\Gamma)$-term, is an interpolant.
\end{thm}
\begin{proof}
	By Lemma \ref{lemma:gamma_entails_lifted_interpolant}, $\Gamma \entails \forall x_{s_1} \ldots \forall x_{s_m}\,\lifdelta{\PI(\pi)}$, where $s_1, \dots s_m$ are the maximal colored $\Delta$-terms in $\PI(\pi)$.

	A term in $\lifdelta{\PI(\pi)}$ is either $x_{s_i}$, $1 \varleq i \varleq m$, a grey term or a $\Gamma$-terms.
	Let $t$ be a maximal $\Gamma$-term in $\PI(\pi)$ and ${r_1}, \dots, {r_k}$ the maximal $\Delta$-terms in\nolinebreak{} $t$.
	Then in $\lifdelta{\PI(\pi)}$, the terms ${r_1}, \dots, {r_k}$ are replaced by $x_{r_1}, \dots, x_{r_k}$ respectively.
	Note that as all of ${r_1}, \dots, {r_k}$ are subterms of $t$, all of $x_{r_1}, \dots, x_{r_k}$ precede $y_t$ in the arrangement of the lifting variables.
	%Note that all of $r_1, \dots, r_k$ are subterms of $t$.
	%Note that the $\Delta$-terms, which are replaced by $x_{r_1}, \ldots, x_{i_{j_k}}$ respectively, are each of strictly smaller size than $t$ as they are strict subterms of $t$.

	%Then it is of the form $f(x_{i_1}, \ldots, x_{i_{n_x}}, u_1, \ldots, u_{n_u}, v_1, \ldots, v_{n_v})$, where $f$ is $\Gamma$-colored, the $u_j$, $1\varleq j \varleq n_u$ are grey terms and the $v_j$, $1\varleq j\varleq n_v$ are $\Gamma$-terms.

	In $\lifgamma{\lifdelta{\PI(\pi)}}$, $t$ is lifted by $y_t$, which is existentially quantified.
	Hence $t$ is a witness for $y_j$ as due to the quantifier ordering,
	it is bound in the scope of the quantification of the lifting variables $x_{r_1}, \dots, x_{r_k}$.
	Therefore $\Gamma \entails Q_1 z_{t_1} \ldots Q_n z_n\,\lifgamma{\lifdelta{\PI(\pi)}}$.

	By Corollary \ref{cor:delta_entails_lifted_interpolant} $\Delta \entails \forall y_{u_1} \dots \forall y_{u_{k'}}\,\lnot \lift{\Gamma}{\PI(\pi)}{y}$, where $u_1, \dots u_{k'}$ are the maximal colored $\Gamma$-terms in $\PI(\pi)$.

	By a similar line of argumentation as above, we can replace the maximal $\Delta$-\nolinebreak{}terms by variables which are then existentially quantified and arrive at
	$\Delta \entails\nolinebreak{} \overline Q_1 z_{t_1} \dots \overline Q_n z_{t_n}\,\lnot \lft{\Delta}{x}{\lft{\Gamma}{y}{\PI(\pi)}}$ where $\overline Q_i = \exists$ ($\forall$) if $Q_i = \forall$ ($\exists$).
	Therefore also
	$\Delta \entails\nolinebreak{} \lnot Q_1 z_{t_1} \dots Q_n z_{t_n}\,\lft{\Delta}{x}{\lft{\Gamma}{y}{\PI(\pi)}}$ and
	finally by Lemma \ref{lemma:lifting_order_not_relevant},
	$\Delta \entails\nolinebreak{} \lnot Q_1 z_{t_1} \dots Q_n z_{t_n}\,\lft{\Gamma}{y}{\lft{\Delta}{x}{\PI(\pi)}}$.

	As it is now easy to see that $Q_1 z_{t_1} \dots Q_n z_{t_n}\,\lft{\Gamma}{y}{\lft{\Delta}{x}{\PI(\pi)}}$ contains no colored symbol, it is an interpolant.
\end{proof}


\begin{remark}
	In this proof, we order the lifting variables in the interpolant according to the subterm relation of the terms they represent.
	This differs from the proof in \cite{Huang95}, where the ordering is based on the length of these terms.
	The proof of the theorem above however shows that both of these approaches are equally valid, but clearly the subterm-based ordering in general allows for more permutations than the length-based ordering. 
\end{remark}

We conclude by presenting the algorithm on an a larger instance: 

\begin{exa}
	Let $\Gamma = \{ G(x, y) \lor L(x, y) \lor x = y, \lnot G(v, f(v)), \lnot Z(w) \lor \lnot Z(f(w)) \}$
	and 
	$\Delta = \{ Z(d), \lnot Z(z) \lor \lnot L(z, u) \}$.

	We use the following resolution refutation $\pi$ for the extraction of the interpolant:

	{ %\small

		~


		\begin{adjustwidth}{8em}{0em}
			\def\defaultHypSeparation{\hskip 1.4em}
			\def\ScoreOverhang{-0em}
			\begin{prooftree}
				\AxiomCm{ Z(d) }

				\AxiomCm{ G(x, y) \lor L(x, y) \lor x = y }
				\AxiomCm{ \lnot Z(z) \lor \lnot  L(z, u) }
				\RightLabelm{\resrule{\resruleres}{z \mapsto x}}
				\BinaryInfCm{  G(x, y) \lor x=y \lor \lnot Z(x) }

				\AxiomCm{ \lnot Z(w) \lor \lnot Z(f(w)) }
				\AxiomCm{ Z(d)}
				\RightLabelm{\resrule{\resruleres}{w \mapsto d}}
				\BinaryInfCm{ \lnot Z(f(d)) }

				\RightLabelm{\resrule{\resrulepar}{y\mapsto f(d)}}
				\BinaryInfCm{ G(x, f(d)) \lor \lnot Z(x) \lor \lnot Z(x) }
				\RightLabelm{\resrule{\resrulefac}{\id}}
				\UnaryInfCm{ G(x, f(d)) \lor \lnot Z(x)  }

				\AxiomCm{ \lnot G(v, f(v)) }

				\insertBetweenHyps{\hskip -9em}

				\RightLabelm{\resrule{\resruleres}{v\mapsto d,\, x\mapsto d}}
				\BinaryInfCm{  \lnot Z(d)  }

				\insertBetweenHyps{\hskip -10em}

				\RightLabelm{\resrule{\resruleres}{\id}}
				\BinaryInfCm{  \square }
			\end{prooftree}
		\end{adjustwidth}
		~

		~
	}

	In the following tree, we show the propositional interpolant $\PI(C)$ for the corresponding clauses $C$ (in simplified form):
	{
		\def\defaultHypSeparation{\hskip 4.4em}
		\begin{prooftree}

			\AxiomCm{ \top  }

			\AxiomCm{ \bot}
			\AxiomCm{ \top }
			\BinaryInfCm{  L(x, y) }

			\AxiomCm{ \bot}
			\AxiomCm{ \top }
			\BinaryInfCm{ \lnot Z(d) }

			\BinaryInfCm{ (x = f(d) \land \lnot Z(f(d)) ) \lor (x \neq f(d) \land L(x, f(d))) }
			\UnaryInfCm{  (x = f(d) \land \lnot Z(f(d)) ) \lor (x \neq f(d) \land L(x, f(d))) }

			\AxiomCm{ \bot }

			\BinaryInfCm{  (d = f(d) \land \lnot Z(f(d)) ) \lor (d \neq f(d) \land L(d, f(d))) }

			\BinaryInfCm{ \lnot Z(d) \lor  \big( (d = f(d) \land \lnot Z(f(d)) ) \lor (d \neq f(d) \land L(d, f(d))) \big)}
		\end{prooftree}
	}


	\noindent
	Hence
	\[\PI(\pi) \spal=  \lnot Z(d) \spam\lor  (d = f(d) \land \lnot Z(f(d)) ) \spam\lor (d \neq f(d) \land L(d, f(d))) \]
	and lifting and quantification gives the final interpolant
	\[ \forall x_d \exists y_{f(d)} \big( \lnot Z(x_d) \spam\lor  (x_d = y_{f(d)} \land \lnot Z(y_{f(d)}) ) \spam\lor (x_d \neq y_{f(d)} \land L(x_d, y_{f(d)})) \big)\]
	\qedhere

	%neg:
	%$ \exists x_d \forall y_{f(d)} ( Z(x_d) \land  (x_d \neq y_{f(d)} \lor Z(y_{f(d)}) ) \land (x_d = y_{f(d)} \lor \lnot L(x_d, y_{f(d)})) )$




	\begin{comment}
		\begin{prooftree}


			\AxiomCm{ G(x, y) \lor L(x, y) \lor x = y \mid \bot }
			\AxiomCm{ \lnot Z(z) \lor \lnot  L(z, u) \mid \top}
			\BinaryInfCm{  G(x, y) \lor x=y \lor \lnot Z(x) \mid (L(x,y) \land \top) \lor (\lnot L(x,y) \land \bot)}
			\noLine
			\UnaryInfCm{  G(x, y) \lor x=y \lor \lnot Z(x) \mid L(x,y)}

			\AxiomCm{ \lnot Z(w) \lor \lnot Z(f(w)) \mid \bot }
			\AxiomCm{ Z(d)\mid \top}
			\BinaryInfCm{ \lnot Z(f(d)) \mid Z(d) \markC  \hl{error}}

			\BinaryInfCm{ G(x, f(d)) \lor \lnot Z(x) \lor \lnot Z(y) \mid (x=f(d) \land Z(d)) \lor (x\neq f(d) \land L(x, f(d))) }
			\UnaryInfCm{ G(x, f(d)) \lor \lnot Z(x)  \mid (x=f(d) \land Z(d)) \lor (x\neq f(d) \land L(x, f(d))) }

			\AxiomCm{ \lnot G(v, f(v)) \mid \bot}

			\BinaryInfCm{  \lnot Z(d)  \mid (d=f(d) \land Z(d)) \lor (d\neq f(d) \land L(d, f(d))) \markC }

			\AxiomCm{ Z(d) \mid \bot }

			\BinaryInfCm{  \square \mid Z(d) \land (  (d=f(d) \land Z(d)) \lor (d\neq f(d) \land L(d, f(d))) ) \markC }



		\end{prooftree}
	\end{comment}


\end{exa}

