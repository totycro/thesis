\section{Preliminaries}
\todo[inline]{this section contains all the required notation but will just be written up nicely at the end}

The language of a first-order formula $A$ is denoted by $\Lang(A)$ and contains all predicate, constant and function symbols that occur in $A$.
These are also referred to as the \emph{\mbox{non-logical} symbols} of $A$.
The \emph{logical symbols} on the other hand include all logical connectives, quantifiers, the equality symbol ($=$) as well as symbols denoting truth ($\top$) and falsity ($\bot$).

For formulas $A_1, \ldots, A_n$, $\Lang(A_1, \ldots, A_n) = \bigcup_{1\leq i \leq n} \Lang(A_i)$.

A term $s$ is a subterm of a term $t$ if $s$ occurs in $t$. $s$ is a strict subterm of $t$ if $s$ is a subterm of $t$ and $s \neq t$.

An occurrence of $\Phi$-term is called \emph{maximal} if it does not occur as subterm of another $\Phi$-term.
An occurrence of a colored term $t$ is a maximal colored term if it does not occur as subterm of another colored term.
\todo{colors are only defined later}


We denote $x_1, \ldots, x_n$ by $\bar x$.

For a set of formulas $\Phi$, $\lnot \Phi$ denotes $\{\lnot A \mid A \in \Phi\}$.

A substitution is a mapping of variables to terms. It is denoted by $\phi\subst{x/t}$, where $\phi$ is a formula or term where each occurrence of the variable $x$ is replaced by the term $t$.
A substitution $\sigma$ is called trivial on $x$ if $x\sigma = x$. Otherwise it is called non-trivial.

An \defiemph{abstraction} on the other hand is a mapping of terms to variables. It is denoted by $\phi\abstractionOp{t/x}$, where $\phi$ is a formula or term where each occurrence of the term $t$ is replaced by the variable $x$.

A term $s$ is an \defiemph{instance} of a term $t$ if there exists a substitution $\sigma$ such that $t\sigma = s$.
If $s$ is an instance of $t$, then $t$ is an \defiemph{abstraction} of $s$. Note that the abstraction- and instance-relation are reflexive. 
$s$ is a \defiemph{proper} instance (abstraction) of $t$ if $s$ is an instance (abstraction) of $t$ and $s\neq t$.

The length of a term or formula $\phi$ is the number of logical and non-logical symbols in $\phi$.

$A\occurat{s}{p}$ denotes $A$ with an occurrence of $s$ at position $p$.

$A\occur{s}$ denotes $A$ where the term $s$ occurs on some set of positions $\Phi$. $A\occur{t}$ denotes $A\occur{s}$ where on each position in $\Phi$, $s$ has been replaced by $t$. Due to its vagueness, this notation is mostly used in order to emphasis that the term $s$ does occur in $A$ in some way.

TODO: define $\Sigma$ as subformula set; possibly remove definition in chapter 2

TODO: define $\equiv$ as syntactic equality. Define also $\semiff$, $\liff$.

TODO: define what we mean by model and free variables.
(need universal quantification of free vars)

TODO: define ground, non-ground

TODO: define set-notation of unifiers

TODO: define infinite-domain unifiers

TODO: define range and domain of substitutions

TODO: define prenex formulas with matrix and prefix

TODO: define prefix of term position: e.g. u in f(c, g(u, x, h(a))) has the prefix f(., g(., ., .)), or possible written as sequence of symbols (algo: always go to parent starting at u)

\section{Craig Interpolation}

\todo[inline]{TODO: write some text about what interpolation means and that we prove more or less only reverse interpolation, but that's fine by the proposition }

\begin{defi}
	\label{def:interpolant}
	Let $\Gamma$ and $\Delta$ be sets of first-order formulas.
	An \defiemph{interpolant} of $\Gamma$ and $\Delta$ is a first-order formula $I$ such that 
	\begin{enumerate}
		\item $ \Gamma \entails I$ \label{int_1}
		\item $ I \entails \Delta $  \label{int_2}
		\item $ \Lang(I) \subseteq \Lang(\Gamma) \intersect \Lang(\Delta)$.  \label{int_3}
	\end{enumerate}

	\begin{samepage}
		A \defiemph{reverse interpolant} of $\Gamma$ and $\Delta$ is a first-order formula $I$ such that $I$ meets conditions \ref{int_1} and \ref{int_3} of an interpolant as well as:
		\begin{enumerate}[\quad\:1'.]
				\setcounter{enumi}{1}
			\item $ \Delta \entails \lnot I $  \label{int_2prime}
				\qedhere
		\end{enumerate}
	\end{samepage}
\end{defi}

\begin{thm}[Interpolation]
	\label{thm:interpolation_original}
	Let $\Gamma$ and $\Delta$ be sets of first-order formulas such that $ \Gamma \entails \Delta $.
	Then there exists an interpolant for $\Gamma$ and $\Delta$.
\end{thm}
%
%\begin{thm}[Reverse Interpolation]
\begin{restatable}[Reverse Interpolation]{thm}{interpolationRevThm}
		\label{thm:interpolation}
		Let $\Gamma$ and $\Delta$ be sets of first-order formulas such that $ \Gamma \cup \Delta $ is unsatisfiable.
	Then there exists a reverse interpolant for $\Gamma$ and $\Delta$.
\end{restatable}



\begin{prop}
	Theorem \ref{thm:interpolation_original} and \ref{thm:interpolation} are equivalent.
	\label{prop:interpolations_equivalent}
\end{prop}
\begin{proof}
	Let $\Gamma$ and $\Delta$ be sets of first-order formulas such that $ \Gamma \entails \Delta$.
	Then $\Gamma \cup \lnot \Delta$ is unsatisfiable.
	By Theorem \ref{thm:interpolation}, there exists a reverse interpolant $I$ for $\Gamma$ and $\lnot \Delta$.
	As $\lnot \Delta \entails \lnot I$, we get by contraposition that $I \entails \Delta$, hence $I$ is an interpolant for $\Gamma$ and $\Delta$

	For the other direction,
	let $\Gamma$ and $\Delta$ be sets of first-order formulas such that $ \Gamma \cup \Delta$ is unsatisfiable.
	Then $\Gamma \entails \lnot \Delta$, hence by Theorem \ref{thm:interpolation_original}, there exists an interpolant $I$ of $\Gamma$ and $\lnot \Delta$.
	But as thus $ I\entails \lnot \Delta$, we get by contraposition that $\Delta \entails \lnot I$, so $I$ is a reverse interpolant for $\Gamma$ and $\Delta$.
\end{proof}

As the notions of interpolation and reverse interpolation in this sense coincide, we will in the following only speak of interpolation where  will be clear from the context which definition applies.

\begin{lemma}
	\label{lemma:logically_equivalent_sets}
	Let $\Gamma, \Gamma', \Delta, \Delta'$ be sets of first order formulas such that $\Gamma \semiff \Gamma'$ and $\Delta \semiff \Delta'$ and $\Lang(\Gamma) \cap \Lang(\Delta) = \Lang(\Gamma') \cap \Lang(\Delta')$ .
	Then $I$ is an interpolant for $\Gamma$ and $\Delta$ if and only if $I$ is an interpolant for $\Gamma'$ and $\Delta'$.
\end{lemma}
\begin{proof}
	Clearly $\Gamma \entails I$ holds if and only if $\Gamma' \entails I$ and similarly
	$\Delta \entails \lnot I$ holds if and only if $\Delta' \entails \lnot I$.
	As the intersections of the respective languages coincide, the language condition on $I$ is satisfied in both directions.
\end{proof}

\begin{remark}
	In Lemma \ref{lemma:logically_equivalent_sets}, it is not sufficient to require that $\Gamma \semiff \Gamma'$ and $\Delta \semiff \Delta'$. 
	Consider the example where
	$\Gamma = \Delta = \{ \forall x (x=c)\}$
	and 
	$\Gamma' = \Delta' = \{ \forall x (x=d)\}$.
	Then even though $\Gamma$ and $\Gamma'$ as well as $\Delta$ and $\Delta'$ have the same models,
	$\Lang(\Gamma) \cap \Lang(\Delta) = \{c\}$
	whereas
	$\Lang(\Gamma') \cap \Lang(\Delta') = \{d\}$.
	Therefore $\forall x (x=c)$ is an interpolant for $\Gamma$ and $\Delta$ but not for $\Gamma'$ and $\Delta'$.
\end{remark}

In the context of interpolation, every non-logical symbol is assigned a color which indicates its origin(s). 
\begin{defi}[Coloring]
A non-logical symbol is said to be \defiemph{$\Gamma$ ($\Delta$)-colored} if it only occurs in $\Gamma$ ($\Delta$) and \defiemph{grey} in case it occurs in both $\Gamma$ and $\Delta$. A symbol is \defiemph{colored} if it is $\Gamma$- or $\Delta$-colored.
A term is a \defiemph{$\Phi$-term} if its outermost symbol is $\Phi$-colored.

A term $t$ is \defiemph{mixed-colored} if $t$ is $\Phi$-colored for some $\Phi$ and $t$ contains a term which is colored but not $\Phi$-colored.

  An occurrence of a variable $x$ is called \defiemph{$\Phi$-colored} if it is contained in a maximal $\Phi$-colored term. It is called \defiemph{colored} if it is of any color and \defiemph{grey} otherwise.

\end{defi}


